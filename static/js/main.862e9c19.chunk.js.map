{"version":3,"sources":["assets/CrimsonText-Regular.ttf","assets/CrimsonText-Bold.ttf","assets/logo.png","components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","components/loadproject/ProjectsList.js","logging.js","shared_state.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","components/loadproject/IntroSection.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","this","hidePopup","bind","div","document","createElement","classList","add","appendChild","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","e","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","remove","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","id","node","insertSectionBlock","text","longText","logger","logEvent","link","Block","create","type","data","node_id","nodes","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","handleMouseUp","clickedNode","resetPos","getGraphNode","value","focus","getParent","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","get","deleteNode","old","new","setNodeByKey","key","newStyle","moveToRangeOfNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","wrapBlockByKey","removeNodeByKey","insertInline","insertText","convertToInline","querySelector","removeDocNode","LinkNode","props","state","hover","externalHover","setHover","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","onContextMenu","Component","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","graphNode","addGraphNode","position","moveTo","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","blockTarget","innerDiv","mouse","getClientOffset","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","onMouseOver","onMouseUp","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","map","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","code","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","moveToStartOfNode","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","moveBackward","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","t","n","r","s","o","u","require","a","i","f","Error","l","call","1","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","toString","ids","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","x2centre","grad","vals","rightLeftCalc","topBotCalc","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","keys","Array","isArray","Object","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","show","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","updateName","newValue","substring","finishEditing","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","removeChild","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","setArrowColour","selected_option","newRelation","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","isOnGraph","getNodeId","translate","dropShadow","radius","arrow_hitbox","editRect","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","editText","doNotDeleteIfEmptyText","setIsOnGraph","isFromJSON","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","blur","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","rectHeight","size","delete_if_empty_text","textarea","preEditText","screen_coords","display","scrollHeight","save_changes","updateDocShortText","save_and_hide","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","graphPane","$el","panZoom","zoomMin","zoomMax","root_point","doc","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","setAttribute","loadNodesFromJSON","getNodeById","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","el","db","Dexie","version","stores","projects","ProjectsList","project","role","aria-label","onClick","loadProject","renameProject","duplicateProject","deleteProject","EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY","Logger","db_id","shouldLogToConsole","conditions","logToConsole","JSON","stringify","stateIsDirty","getLog","events","timestamp","Date","setLog","save","saves","then","catch","err","msg","SharedState","onDataLoad","doc_value","graph_value","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getEditor","getArgumentMarkdown","downloadExperimentData","exportPDF","onbeforeunload","getStateIsDirty","returnValue","mapFromJSON","projectName","title","lastSavedDocumentState","changes","mapToJSON","idExists","info","logSaveState","message","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","argument","logs","file","Blob","href","URL","createObjectURL","download","getExperimentId","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","getReactPdfDocument","markdown","Font","register","family","fonts","src","CrimsonText","CrimsonTextBold","fontWeight","styles","StyleSheet","page","fontFamily","paddingBottom","heading","textDecoration","startsWith","pdf","toBlob","getArgumentHTML","regex","replacement","innerText","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LoadProject","addProject","updateProjectsFromDb","transitionToEditor","prompt","newName","ExperimentControls","backToMenu","IntroSection","Logo","alt","videoId","opts","playerVars","modestbranding","App","phase","transitionToMenu","getStorageUsed","newSharedState","finishCondition","navigator","storage","estimate","storageUsed","usage","quota","toPrecision","autoload","DndProvider","backend","Backend","defaultSize","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","process","fetch","response","contentType","headers","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.862e9c19.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Regular.62f10d46.ttf\";","module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Bold.89b16aa6.ttf\";","module.exports = __webpack_public_path__ + \"static/media/logo.09afe702.png\";","export default class OptionPopup {\r\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\r\n        this.hidePopup = this.hidePopup.bind(this)\r\n\r\n        this.div = document.createElement(\"div\");\r\n        this.div.classList.add(\"option-popup-div\");\r\n        this.div.appendChild(this.generateTable(entries, callback, selected));\r\n        this.div.style.left = x + \"px\";\r\n        this.div.style.top = y + \"px\";\r\n\r\n        if (parent === undefined) {\r\n            parent = document.getElementById(\"graph\");\r\n        }\r\n        parent.appendChild(this.div);\r\n\r\n        // prevent the popup from showing up partially offscreen\r\n        const rect = this.div.getBoundingClientRect()\r\n        if (rect.right > window.innerWidth) {\r\n            this.div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\r\n        }\r\n        if (rect.bottom > window.innerHeight) {\r\n            this.div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\r\n        }\r\n\r\n        if (shouldHideOnClickOutside) {\r\n            setTimeout(() => this.hideOnClickOutside(this.div), 0.01);\r\n        }\r\n    }\r\n\r\n    generateTable(entries, callback, selected) {\r\n        var table = document.createElement(\"table\");\r\n        entries.forEach(entry => {\r\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\r\n\r\n            var row = table.insertRow();\r\n            row.classList.add(\"option-row\");\r\n            if (entry.name === selected) {\r\n                row.classList.add(\"option-row-selected\");\r\n            }\r\n\r\n            const selectItem = (e) => {\r\n                if (entry.isClickable) {                    \r\n                    callback(entry);\r\n                    this.hidePopup();\r\n                }\r\n            }\r\n\r\n            var colourCell = row.insertCell();\r\n            colourCell.textContent = entry.symbol;\r\n            colourCell.style.color = entry.colour;\r\n            colourCell.style.fontSize = \"150%\";\r\n            colourCell.style.padding = '10px'\r\n            \r\n            var nameCell = row.insertCell();\r\n            nameCell.classList.add('option-cell')\r\n            nameCell.textContent = entry.name\r\n\r\n            colourCell.addEventListener('click', selectItem)\r\n            nameCell.addEventListener('click', selectItem)\r\n\r\n            if (entry.buttons) {\r\n                entry.buttons.forEach(buttonEntry => {\r\n                    var buttonCell = row.insertCell()\r\n                    var button = document.createElement('BUTTON')\r\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\r\n                    button.className = \"pure-button\"\r\n                    button.style.padding = \"0px 10px 0px 10px\"\r\n                    buttonCell.appendChild(button)\r\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \r\n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row, selected: entry.name === selected,\r\n                            hidePopup: this.hidePopup})\r\n                })\r\n            }\r\n        });\r\n\r\n        return table;\r\n    }\r\n\r\n    hidePopup() {\r\n        this.div.remove()\r\n    }\r\n\r\n    hideOnClickOutside(element) {\r\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\r\n\r\n        const outsideClickListener = event => {\r\n            if (!element.contains(event.target) && isVisible(element)) {\r\n              element.remove();\r\n              removeClickListener()\r\n            }\r\n        }\r\n    \r\n        const removeClickListener = () => {\r\n            document.removeEventListener('click', outsideClickListener)\r\n        }\r\n    \r\n        document.addEventListener('click', outsideClickListener)\r\n        document.addEventListener('contextmenu', outsideClickListener)\r\n    }\r\n}","import { Block, Text } from 'slate';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default function GraphPlugin(options) {\r\n    return {\r\n        onMouseUp(event, editor, next) {\r\n            var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n            if (draggedNode) {\r\n                draggedNode.resetPos();\r\n\r\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n                    toast.error('You can\\'t add the same node twice!')\r\n                    console.log('Duplicate - editor')\r\n                } else {\r\n                    const target = editor.findEventRange(event)\r\n                    if (target) {\r\n                        editor.select(target)\r\n\r\n                        // prevent insertion inside an inline link\r\n                        // (insertion inside a section is fixed by schema)\r\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\r\n                        if (linkNode) {\r\n                            editor.moveToEndOfNode(linkNode)\r\n                        }\r\n\r\n                        addSection(draggedNode, editor)\r\n                    }\r\n                }\r\n            }\r\n            next();\r\n        },\r\n        \r\n        onBlur(event, editor, next) {\r\n            editor.deselect();\r\n            next();\r\n        },\r\n\r\n        commands: {\r\n            removeGraphLink(editor, node) {\r\n                const document = editor.value.document\r\n                if (!document.hasNode(node.key)) {\r\n                    console.log('couldnt remove graph link, node doesnt exist');\r\n                    \r\n                    return\r\n                }\r\n\r\n                if (node.type === \"section\") {\r\n                    // move the children out from inside this section to be after it\r\n                    const section_index = editor.value.document.nodes.indexOf(node)\r\n                    if (section_index !== -1) {\r\n                        var child_index = 0;\r\n                        node.nodes.forEach(child => {\r\n                            if (!document.hasNode(child.key)) {\r\n                                return\r\n                            }\r\n\r\n                            const nodeStyle = node.data.get(\"nodeStyle\")\r\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\r\n                                editor.removeNodeByKey(child.key)\r\n                            } else {\r\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + child_index + 1)\r\n                            }\r\n                            child_index ++\r\n                        });\r\n                    }\r\n                    editor.removeNodeByKey(node.key)\r\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \r\n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\r\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\r\n\r\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\r\n\r\n    editor.getSharedState().logger.logEvent({\r\n        'type': 'doc_create_from_node', \r\n        'node_id': draggedNode.id, \r\n        'short_text': draggedNode.text, \r\n        'long_text': draggedNode.longText\r\n    });\r\n}\r\n\r\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\r\n    var link = Block.create({\r\n        type: 'link',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: text})]\r\n    })\r\n\r\n    var body = Block.create({\r\n        type: 'body',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: longText})]\r\n    })\r\n\r\n    var section = Block.create({\r\n        type: 'section',\r\n        data: {node_id: id, nodeStyle: initialNodeStyle},\r\n        nodes: [link, body]\r\n    })    \r\n    \r\n    editor.insertBlock(section);\r\n    editor.moveToEndOfNode(section)\r\n\r\n    return section\r\n}\r\n\r\nexport function handleMouseUp(editor, clickedNode) {\r\n    var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n    if (draggedNode) {\r\n        draggedNode.resetPos();\r\n\r\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n            toast.error('You can\\'t add the same node twice!')\r\n            console.log('Duplicate - node');\r\n            \r\n        } else {\r\n            const { value } = editor\r\n            const { document } = value\r\n            editor.focus()\r\n\r\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\r\n                clickedNode = document.getParent(clickedNode);\r\n            }\r\n\r\n            editor.moveToEndOfNode(clickedNode);\r\n\r\n            addSection(draggedNode, editor);\r\n\r\n            editor.getSharedState().draggedNode = false;\r\n            return true;\r\n        }\r\n    }\r\n}","import { Block } from 'slate';\r\nimport OptionPopup from '../graph/OptionPopup.js'\r\nimport { insertSectionBlock } from './GraphPlugin.js';\r\n\r\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\r\n    var entries = [\r\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"⌶\"},\r\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"▤\"},\r\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"▔\"},\r\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"▂\"},\r\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n    ]\r\n\r\n    if (entriesToHide) {\r\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    const onOptionSelect = (selectedEntry) => {\r\n        const selected = selectedEntry.name\r\n        if (selected === \"Delete\") {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_delete\",\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n            deleteNode(node, editor);\r\n        } else {\r\n            var nodeStyle = node.data.get(\"nodeStyle\")\r\n            if (!nodeStyle) {\r\n                nodeStyle = \"Inline\"\r\n            }\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_change_format\",\r\n                old: nodeStyle,\r\n                new: selected,\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n\r\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\r\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\r\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\r\n                convertFromInline(node, editor, selected)\r\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\r\n                convertToInline(node, editor, selected)\r\n            }\r\n        }\r\n    }\r\n\r\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\r\n}\r\n\r\nexport function deleteNode(node, editor) {\r\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\r\n\r\n    editor.removeNodeByKey(node.key)\r\n}\r\n\r\nfunction convertFromInline(node, editor, newStyle) {\r\n    editor.moveToRangeOfNode(node);\r\n    const parent = editor.value.document.getParent(node.key)\r\n    if (parent && parent.text === node.text) {\r\n        editor.moveToRangeOfNode(parent)\r\n    }\r\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, \"\", newStyle)    \r\n}\r\n\r\nfunction convertToInline(node, editor) {\r\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\r\n    // need to get 0th child because previous of section is the body inside it\r\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\r\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\r\n\r\n    const getEmptyParagraph = () => Block.create({\r\n        type: 'paragraph'\r\n    })\r\n\r\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\r\n    if (!prev && !next) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n\r\n    editor.moveToRangeOfNode(node)\r\n\r\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\r\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\r\n        editor.wrapBlockByKey(node.key, \"paragraph\")\r\n        editor.removeNodeByKey(node.key)\r\n    } else {\r\n        editor.removeNodeByKey(node.key)\r\n    }\r\n\r\n    editor.insertInline({\r\n            type: \"link\",\r\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\r\n        })\r\n        .insertText(shortText)\r\n}\r\n\r\nexport const getNodeStyleClass = (verbose) => {\r\n    switch (verbose) {\r\n        case \"Heading only\":\r\n            return \" hide-body\"\r\n\r\n        case \"Body only\":\r\n            return \" hide-heading\"\r\n    \r\n        default:\r\n            return \"\";\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport { showNodeSwitchMenu } from '../NodeSwitch';\r\n\r\nclass LinkNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        \r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_cursor\", cursorInside)\r\n        }\r\n        \r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"node-link\" + hoverClass;\r\n\r\n        if (this.props.linkStyle === \"heading\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    <u><b>{this.props.children}</b></u>\r\n                </p>\r\n            );\r\n\r\n        } else if (this.props.linkStyle === \"inline\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}\r\n                        onMouseEnter={() => this.setHover(true)} \r\n                        onMouseLeave={() => this.setHover(false)}\r\n                        onContextMenu={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nexport default LinkNode;","import React, { Component } from 'react';\r\n\r\nexport default class BodyNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n        this.selectNode = props.selectNode;\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\r\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\r\n\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"body_cursor\", cursorInside);\r\n            node.setHoverer(\"body_mouse\", this.state.hover);\r\n        }\r\n\r\n        if (this.props.isEmpty) {\r\n                return (\r\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\r\n                        Type some text...{this.props.children}\r\n                    </p>\r\n                );\r\n        } else {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","export const ItemTypes = {\r\n    BLOCK: \"block\",\r\n}","import { DragSource } from 'react-dnd';\r\nimport { ItemTypes } from '../../dragtypes';\r\nimport { addSection } from './GraphPlugin.js'\r\n\r\nconst blockSource = {\r\n    canDrag(props) {\r\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\r\n        return props.editor.value.selection.isCollapsed\r\n    },\r\n\r\n    beginDrag(props) {\r\n      // Return the data describing the dragged item\r\n      const item = { id: props.node.id, node: props.node }\r\n      return item\r\n    },\r\n\r\n    endDrag(props, monitor, component) {\r\n        if (!monitor.didDrop()) {            \r\n            return\r\n        }\r\n\r\n        const dropResult = monitor.getDropResult()\r\n        const sharedState = props.editor.getSharedState()\r\n\r\n        if (dropResult.droppedOnGraph) {\r\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\r\n            const draggedNode = {\r\n                id: graphNode.id,\r\n                node: graphNode,\r\n                text: \"\",\r\n                longText: props.node.text\r\n            }\r\n            props.editor.moveTo(props.node.key)\r\n            \r\n            addSection(draggedNode, props.editor, \"Body only\")\r\n            props.editor.removeNodeByKey(props.node.key)\r\n        } else {\r\n            const document = props.editor.value.document;\r\n            const blockParent = document.getParent(props.node.key);\r\n            const blockIndex = blockParent.nodes.indexOf(props.node);\r\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\r\n\r\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\r\n\r\n            sharedState.logger.logEvent({\r\n                'type': 'reorder',\r\n                'id': props.node.data.get('node_id'),\r\n                'old_index': blockIndex,\r\n                'new_index': dropResult.indexDroppedOn + indexShift,\r\n            });\r\n        }\r\n    },\r\n  }\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDragSource: connect.dragSource(),\r\n        dragPreview: connect.dragPreview(),\r\n        isDragging: monitor.isDragging(),\r\n    }\r\n}\r\n\r\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\r\nimport { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst blockTarget = {\r\n    hover(props, monitor, component) {\r\n        const mouse = monitor.getClientOffset();\r\n\r\n        // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\r\n        const outerDiv = ReactDOM.findDOMNode(component)        \r\n        const outerRect = outerDiv.getBoundingClientRect()\r\n        \r\n        var innerDiv;\r\n        for (let item of outerDiv.children) {\r\n            if (item.classList.contains('plain-block') || item.classList.contains('section')) {\r\n                innerDiv = item;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!innerDiv) {\r\n            console.log('error: couldn\\'t find the inner div!');\r\n            return\r\n        }\r\n        const innerRect = innerDiv.getBoundingClientRect()       \r\n    \r\n        // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\r\n        const offset = (innerRect.y - outerRect.y)\r\n        var newState = false\r\n        if (mouse.y + offset > (innerRect.y + innerRect.height / 2)) {\r\n            newState = true\r\n        }\r\n        if (component.state.overHalf !== newState) {\r\n            component.setState({overHalf: newState});\r\n        }\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        const document = props.editor.value.document;\r\n        const blockParent = document.getParent(props.node.key);\r\n        const blockIndex = blockParent.nodes.indexOf(props.node);\r\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        isOver: monitor.isOver(),\r\n        isOverCurrent: monitor.isOver({ shallow: true }),\r\n        canDrop: monitor.canDrop(),\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\nimport { showNodeSwitchMenu, getNodeStyleClass } from '../NodeSwitch';\r\n\r\nclass SectionNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"section_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\r\n\r\n        const value = this.props.editor.value\r\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\r\n\r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\r\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\r\n        \r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}}\r\n                        onContextMenu={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}\r\n                        ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(SectionNode))","\r\nimport { getEventTransfer } from 'slate-react';\r\n\r\nexport default function LoggingPlugin(options) {\r\n    return {\r\n        onCopy(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"copy\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onCut(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"cut\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            var transfer = getEventTransfer(event);\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"paste\",\r\n                paste_type: transfer.type,\r\n                content: transfer.fragment ? transfer.fragment.text : \"\",\r\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\r\n            });\r\n            \r\n            next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\n\r\nclass PlainBlockNode extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            hover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\r\n\r\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)}\r\n                        ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\r\nimport { cx, css } from 'emotion'\r\n\r\nexport const Button = React.forwardRef(\r\n  ({ className, active, reversed, ...props }, ref) => (\r\n    <span\r\n      {...props}\r\n      ref={ref}\r\n      className={cx(\r\n        className,\r\n        css`\r\n          cursor: pointer;\r\n          color: ${reversed\r\n            ? active ? 'white' : '#aaa'\r\n            : active ? 'black' : '#ccc'};\r\n        `\r\n      )}\r\n    />\r\n  )\r\n)\r\n\r\nexport const EditorValue = React.forwardRef(\r\n  ({ className, value, ...props }, ref) => {\r\n    const textLines = value.document.nodes\r\n      .map(node => node.text)\r\n      .toArray()\r\n      .join('\\n')\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        {...props}\r\n        className={cx(\r\n          className,\r\n          css`\r\n            margin: 30px -20px 0;\r\n          `\r\n        )}\r\n      >\r\n        <div\r\n          className={css`\r\n            font-size: 14px;\r\n            padding: 5px 20px;\r\n            color: #404040;\r\n            border-top: 2px solid #eeeeee;\r\n            background: #f8f8f8;\r\n          `}\r\n        >\r\n          Slate's value as text\r\n        </div>\r\n        <div\r\n          className={css`\r\n            color: #404040;\r\n            font: 12px monospace;\r\n            white-space: pre-wrap;\r\n            padding: 10px 20px;\r\n            div {\r\n              margin: 0 0 0.5em;\r\n            }\r\n          `}\r\n        >\r\n          {textLines}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\n\r\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\r\n  <span\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      'material-icons',\r\n      className,\r\n      css`\r\n        font-size: 18px;\r\n        vertical-align: text-bottom;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        white-space: pre-wrap;\r\n        margin: 0 -20px 10px;\r\n        padding: 10px 20px;\r\n        font-size: 14px;\r\n        background: #f8f8e8;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        & > * {\r\n          display: inline-block;\r\n        }\r\n\r\n        & > * + * {\r\n          margin-left: 15px;\r\n        }\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\r\n  <Menu\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        position: relative;\r\n        padding: 1px 18px 17px;\r\n        margin: 0 -20px;\r\n        border-bottom: 2px solid #eee;\r\n        margin-bottom: 20px;\r\n      `\r\n    )}\r\n  />\r\n))","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { css } from 'emotion'\r\nimport { Button, Icon, Menu } from './SlateComponents.js'\r\n\r\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\r\n\r\nconst MarkButton = ({ editor, type, icon }) => {\r\n  const { value } = editor\r\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\r\n  return (\r\n    <Button\r\n      reversed\r\n      active={isActive}\r\n      onMouseDown={event => {\r\n        event.preventDefault()\r\n        editor.setBlocks((isActive ? \"paragraph\" : type))\r\n\r\n        editor.getSharedState().logger.logEvent({\r\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\r\n      });\r\n      }}\r\n    >\r\n      <Icon>{icon}</Icon>\r\n    </Button>\r\n  )\r\n}\r\n\r\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\r\n  const root = window.document.getElementById('root')\r\n  return ReactDOM.createPortal(\r\n    <Menu\r\n      ref={ref}\r\n      className={css`\r\n        padding: 8px 7px 6px;\r\n        position: absolute;\r\n        z-index: 1;\r\n        top: -10000px;\r\n        left: -10000px;\r\n        margin-top: -6px;\r\n        opacity: 0;\r\n        background-color: #222;\r\n        border-radius: 4px;\r\n        transition: opacity 0.25s;\r\n      `}\r\n    >\r\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\r\n    </Menu>,\r\n    root\r\n  )\r\n})\r\n\r\n\r\nclass HoveringMenu extends React.Component {\r\n\r\n  menuRef = React.createRef()\r\n\r\n  componentDidMount = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  componentDidUpdate = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  updateMenu = () => {\r\n    const menu = this.menuRef.current\r\n    if (!menu) return\r\n\r\n    const value = this.props.editor.value\r\n    const { fragment, selection } = value\r\n\r\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\r\n      menu.removeAttribute('style')\r\n      return\r\n    }\r\n\r\n    const native = window.getSelection()\r\n    const range = native.getRangeAt(0)\r\n    const rect = range.getBoundingClientRect()\r\n    menu.style.opacity = 1\r\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\r\n\r\n    menu.style.left = `${rect.left +\r\n      window.pageXOffset -\r\n      menu.offsetWidth / 2 +\r\n      rect.width / 2}px`\r\n  }\r\n\r\n  render = (props, editor, next) => {\r\n    return (\r\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default function HoveringMenuPlugin(options) {\r\n    return {\r\n        renderEditor (props, editor, next) {\r\n            const children = next()\r\n            return (\r\n              <React.Fragment>\r\n                {children}\r\n                <HoveringMenu editor={editor} />\r\n              </React.Fragment>\r\n            )\r\n          },\r\n\r\n        renderBlock (props, editor, next) {\r\n            switch (props.node.type) {\r\n            case 'heading':\r\n                return <u><b>{props.children}</b></u>\r\n            default:\r\n                return next()\r\n            }\r\n        },\r\n    }\r\n}","import { Block, Text } from 'slate';\r\n\r\nexport const schema = {\r\n    inlines: {\r\n        link: {\r\n            parent: [{type: ''}, {type: 'paragraph'}],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'parent_type_invalid':\r\n                        editor.unwrapInlineByKey(error.node.key)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled link inline err \" + error);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    blocks: {\r\n        section: {\r\n            parent: {object: \"document\"},\r\n            nodes: [\r\n                {\r\n                    match: {type: 'link'},\r\n                    min: 1,\r\n                    max: 1,\r\n                },\r\n                {\r\n                    match: {type: 'body'},\r\n                    min: 1,\r\n                    max: 1,\r\n                }\r\n            ],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'child_max_invalid':\r\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \r\n                        // this can happen if the enter key is pressed (splits the current node)\r\n                        moveBlockAfterSection(editor, error.child, error.node)\r\n                        editor.setNodeByKey(error.child.key, 'paragraph')\r\n                        return\r\n\r\n                    case 'child_type_invalid':\r\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \r\n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\r\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\r\n                            if (linkNode) {\r\n                                const textNode = linkNode.getLastText()\r\n                                const offset = textNode.text ? textNode.text.length : 0\r\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\r\n                            } else {\r\n                                addMissing(editor, error, \"link\", error.child.text)\r\n                            }\r\n                        }\r\n\r\n                        editor.removeNodeByKey(error.child.key)\r\n                        \r\n                        return\r\n                    \r\n                    case 'child_min_invalid':\r\n                        var hasChildTypes = [];\r\n                        error.node.nodes.forEach(node => {\r\n                            hasChildTypes.push(node.type)\r\n                        })\r\n                        \r\n                        if (!hasChildTypes.includes(\"link\")) {\r\n                            addMissing(editor, error, \"link\")\r\n                        }\r\n\r\n                        if (!hasChildTypes.includes(\"body\")) {\r\n                            addMissing(editor, error, \"body\")\r\n                        }\r\n\r\n                        return\r\n                    \r\n                    case 'parent_object_invalid':\r\n                        // a section has ended up inside another section - shift it out\r\n                        moveBlockAfterSection(editor, error.node, error.parent)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled section schema err \" + error);\r\n                        \r\n                        return\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\r\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\r\n    if (sectionIndex === -1) {\r\n        return\r\n    }\r\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\r\n}\r\n\r\nfunction addMissing(editor, error, nodeType, text=\"\") {\r\n    const node_id = error.node.data.get(\"node_id\")\r\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\r\n    if (!text) {\r\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\r\n    }\r\n    const index = nodeType === \"link\" ? 0 : 1\r\n\r\n    addBlock(editor, error.node, nodeType, index, node_id, text)\r\n}\r\n\r\nfunction addBlock(editor, parent, nodeType, index, id, text) {\r\n    var block = Block.create({\r\n        type: nodeType,\r\n        data: {node_id: id},\r\n        nodes: [Text.create({'text': text})]\r\n    })\r\n    editor.insertNodeByKey(parent.key, index, block);\r\n    \r\n}","import React from 'react';\r\nimport { Editor } from 'slate-react';\r\nimport { Value } from 'slate';\r\nimport NodePlugin from './NodePlugin.js';\r\nimport GraphPlugin from './GraphPlugin.js';\r\nimport LoggingPlugin from './LoggingPlugin.js';\r\nimport ReorderPlugin from './ReorderPlugin.js';\r\nimport HoveringMenu from './HoveringMenu.js';\r\nimport { schema } from './Schema.js'\r\n\r\nconst plugins = {\r\n    'graph': [\r\n        LoggingPlugin(),\r\n        GraphPlugin(),\r\n        NodePlugin(),\r\n        ReorderPlugin(),\r\n    ],\r\n    'plain': [\r\n        LoggingPlugin(),\r\n        HoveringMenu(),\r\n    ]\r\n};\r\n\r\nconst emptyValue = Value.fromJSON({\r\n    document: {\r\n        nodes: [\r\n            {\r\n                object: 'block',\r\n                type: 'paragraph',\r\n                nodes: [\r\n                    {\r\n                        object: 'text',\r\n                        text: '',\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n    },\r\n});\r\n\r\nclass DocEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.props.sharedState.editor_ref = React.createRef();\r\n    }\r\n\r\n    componentDidMount() {\r\n        const sharedState = this.props.sharedState\r\n        sharedState.getSavedDocValue((savedValue) => {\r\n            this.setState({\r\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\r\n            }, sharedState.editorHasLoaded)\r\n        })\r\n    }\r\n\r\n    state = {\r\n        value: undefined, // don't display editor until the db's saved document loads\r\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\r\n    }\r\n    \r\n    queries = {\r\n        getSharedState: () => {\r\n            return this.props.sharedState;\r\n        },\r\n        getValue: () => {\r\n            return this.state.value;\r\n        },\r\n        mapHasLoaded: () => {\r\n            this.setState({ mapHasLoaded: true })\r\n        }\r\n    }\r\n\r\n    onChange = ({ value }) => {\r\n        this.setState({ value })\r\n    }\r\n\r\n    render() {\r\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\r\n\r\n        if (this.state.value !== undefined) {\r\n            return <Editor\r\n                className={\"slate-editor\" + plainClass}\r\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\r\n                ref={this.props.sharedState.editor_ref}\r\n                schema={schema}\r\n                plugins={plugins[this.props.sharedState.condition]}\r\n                queries={this.queries}\r\n                value={this.state.value}\r\n                onChange={this.onChange}\r\n                placeholder=\"Write your document here...\"\r\n                spellCheck={false}\r\n            />\r\n        } else {\r\n            return <p></p>\r\n        }\r\n    }\r\n}\r\n\r\nexport default DocEditor;","import SVG from 'svg.js';\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\n(function e(t, n, r) {\r\n    function s(o, u) {\r\n        if (!n[o]) {\r\n            if (!t[o]) {\r\n                // eslint-disable-next-line no-sequences\r\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\r\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\r\n                var n = t[o][1][e];return s(n ? n : e);\r\n            }, l, l.exports, e, t, n, r);\r\n        }return n[o].exports;\r\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\r\n        s(r[o]);\r\n    }return s;\r\n})({ 1: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Id = require(\"idy\"),\r\n            SetOrGet = require(\"set-or-get\"),\r\n            IterateObject = require(\"iterate-object\"),\r\n            Deffy = require(\"deffy\");\r\n\r\n        // Internal cache\r\n        var _connections = {},\r\n            _betweenTwoBubbles = {},\r\n            container = null,\r\n            markers = null;\r\n\r\n        function delete_connectable(con) {\r\n            con.line.remove();\r\n            con.marker.remove();\r\n\r\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\r\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\r\n\r\n            var toString = function() {\r\n                var ids = [con.source.id(), con.target.id()],\r\n                    id1 = ids.join(\"->\"),\r\n                    id2 = ids.reverse().join(\"->\");\r\n\r\n                con._ = con.id = id1;\r\n\r\n                if (_betweenTwoBubbles[id2]) {\r\n                    con._ = id2;\r\n                    return id2;\r\n                }\r\n\r\n                con.id = id1;\r\n                return id1;\r\n            }\r\n\r\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\r\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\r\n        }\r\n\r\n        /**\r\n         * connectable\r\n         * Connects two elements.\r\n         *\r\n         * @name connectable\r\n         * @function\r\n         * @param {Object} options An object containing the following fields:\r\n         *\r\n         *  - `container` (SVGElement): The line elements container.\r\n         *  - `markers` (SVGElement): The marker elements container.\r\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\r\n         *\r\n         * @param {SVGElement} elmTarget The target SVG element.\r\n         * @return {Object} The connectable object containing:\r\n         *\r\n         *  - `source` (SVGElement): The source element.\r\n         *  - `target` (SVGElement): The target element.\r\n         *  - `line` (SVGElement): The line element.\r\n         *  - `marker` (SVGElement): The marker element.\r\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\r\n         *  - [`update` (Function)](#update)\r\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\r\n         */\r\n        function connectable(options, elmTarget) {\r\n\r\n            var con = {};\r\n\r\n            if (elmTarget === undefined) {\r\n                elmTarget = options;\r\n                options = {};\r\n            }\r\n\r\n            container = options.container || container;\r\n            var elmSource = this;\r\n            markers = options.markers || markers;\r\n\r\n            options.k = options.k || 100;\r\n            options.kk = options.kk || 10;\r\n\r\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\r\n                markerId = \"triangle-\" + Id(),\r\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\r\n            \r\n            if (options.specialCoords) {\r\n                line.addClass('connector-line');\r\n            }\r\n\r\n            marker.attr({\r\n                id: markerId,\r\n                viewBox: \"0 0 10 10\",\r\n                refX: \"0\",\r\n                refY: \"5\",\r\n                markerUnits: \"strokeWidth\",\r\n                markerWidth: \"4\",\r\n                markerHeight: \"5\"\r\n            });\r\n\r\n            marker.path().attr({\r\n                d: \"M 0 0 L 10 5 L 0 10 z\"\r\n            });\r\n\r\n            // Append the SVG elements\r\n            con.source = elmSource;\r\n            con.target = elmTarget;\r\n            con.line = line;\r\n            con.marker = marker;\r\n\r\n\r\n            if (options.specialCoords) {\r\n                // remove this when node is deleted\r\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\r\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\r\n            }\r\n\r\n            SetOrGet(_connections, con.source.id(), []).push(con);\r\n            SetOrGet(_connections, con.target.id(), []).push(con);\r\n\r\n            SetOrGet(_betweenTwoBubbles, {\r\n                toString: function toString() {\r\n                    var ids = [con.source.id(), con.target.id()],\r\n                        id1 = ids.join(\"->\"),\r\n                        id2 = ids.reverse().join(\"->\");\r\n\r\n                    con._ = con.id = id1;\r\n\r\n                    if (_betweenTwoBubbles[id2]) {\r\n                        con._ = id2;\r\n                        return id2;\r\n                    }\r\n\r\n                    con.id = id1;\r\n                    return id1;\r\n                }\r\n            }, []).push(con);\r\n            \r\n\r\n            /**\r\n             * computeLineCoordinates\r\n             * The function that computes the new coordinates.\r\n             * It can be overriden with a custom function.\r\n             *\r\n             * @name computeLineCoordinates\r\n             * @function\r\n             * @param {Connectable} con The connectable instance.\r\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\r\n             */\r\n            con.computeLineCoordinates = function (cons) {\r\n\r\n                var output = [],\r\n                    l = cons.length;\r\n\r\n                IterateObject(cons, function (con, i) {\r\n\r\n                    var sT = con.source.transform(),\r\n                        tT = con.target.transform(),\r\n                        sB = con.source.bbox(),\r\n                        tB = con.target.bbox(),\r\n                        x1 = sT.x + sB.width / 2,\r\n                        y1 = sT.y + sB.height / 2,\r\n                        x2 = tT.x + tB.width / 2,\r\n                        y2 = tT.y + tB.height / 2,\r\n                        cx = (x1 + x2) / 2,\r\n                        cy = (y1 + y2) / 2,\r\n                        dx = Math.abs((x1 - x2) / 2),\r\n                        dy = Math.abs((y1 - y2) / 2),\r\n                        dd = null,\r\n                        out = {\r\n                        x1: x1,\r\n                        y1: y1,\r\n                        x2: x2,\r\n                        y2: y2,\r\n                        ex: x1,\r\n                        ey: y1\r\n                    };\r\n\r\n                    if (i !== (l - 1) / 2) {\r\n                        dd = Math.sqrt(dx * dx + dy * dy);\r\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                    }\r\n                    output.push(out);\r\n                });\r\n\r\n                return output;\r\n            };\r\n\r\n            if (options.specialCoords) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var sT = con.source.transform(),\r\n                            tT = con.target.transform(),\r\n                            sB = con.source.bbox(),\r\n                            tB = con.target.bbox(),\r\n                            x1 = sT.x + sB.width / 2,\r\n                            y1 = sT.y + sB.height / 2 - 20;\r\n\r\n                        var xDiff = sT.x - tT.x;\r\n                        var yDiff = sT.y - tT.y;\r\n                        var x2, y2;\r\n\r\n                        var x2centre = tT.x + tB.width / 2\r\n                        var y2centre = tT.y + tB.height / 2\r\n\r\n                        var grad = (y2centre - y1) / ((x2centre - x1) === 0 ? 0.0000001 : (x2centre - x1))\r\n\r\n                        if (grad === 0) {\r\n                            grad = 0.0000001\r\n                        }\r\n\r\n                        var left = tT.x - 10\r\n                        var right = tT.x + tB.width - 30\r\n                        var top = tT.y - 10\r\n                        var bottom = tT.y + tB.height - 30\r\n                        \r\n                        var rightLeftCalc = () => {\r\n                            var x2 = xDiff < 0 ? left : right\r\n                            return { \r\n                                x: x2,\r\n                                y: ((x2 - x1) * grad) + y1\r\n                            }\r\n                        }\r\n\r\n                        var topBotCalc = () => {\r\n                            var y2 = yDiff < 0 ? top : bottom\r\n                            return {\r\n                                x: ((y2 - y1) * (1/grad)) + x1,\r\n                                y: y2\r\n                            }\r\n                        }\r\n\r\n                        var vals\r\n                        if (Math.abs(xDiff) >= Math.abs(yDiff)) {\r\n                            vals = rightLeftCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (y2 > bottom || y2 < top) {\r\n                                vals = topBotCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n\r\n                        } else {\r\n                            vals = topBotCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (x2 > right || x2 < left) {\r\n                                vals = rightLeftCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n                        }\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dx = Math.abs((x1 - x2) / 2),\r\n                            dy = Math.abs((y1 - y2) / 2),\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (i !== (l - 1) / 2) {\r\n                            dd = Math.sqrt(dx * dx + dy * dy);\r\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                        }\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            if (options.padEllipse) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\r\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\r\n                            xR1,\r\n                            xR2,\r\n                            yR1,\r\n                            yR2,\r\n                            sT = con.source.transform(),\r\n                            tT = con.target.transform()\r\n\r\n                        if (elmS.tagName === \"circle\") {\r\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\r\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\r\n                        } else {\r\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\r\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\r\n\r\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\r\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\r\n                        }\r\n\r\n                        // Get centers\r\n                        var sx = sT.x + xR1 / 2,\r\n                            sy = sT.y + yR1 / 2,\r\n                            tx = tT.x + xR2 / 2,\r\n                            ty = tT.y + yR2 / 2\r\n\r\n                        // Calculate distance from source center to target center\r\n                        ,\r\n                            dx = tx - sx,\r\n                            dy = ty - sy,\r\n                            d = Math.sqrt(dx * dx + dy * dy)\r\n\r\n                        // Construct unit vector between centers\r\n                        ,\r\n                            ux = dx / d,\r\n                            uy = dy / d\r\n\r\n                        // Point on source circle\r\n                        ,\r\n                            cx1 = sx + xR1 * ux,\r\n                            cy1 = sy + yR1 * uy\r\n\r\n                        // Point on target circle\r\n                        ,\r\n                            cx2 = sx + (d - xR2 - 5) * ux,\r\n                            cy2 = sy + (d - yR2 - 5) * uy;\r\n\r\n                        var x1 = cx1 + xR1 / 2,\r\n                            y1 = cy1 + yR1 / 2,\r\n                            x2 = cx2 + xR2 / 2,\r\n                            y2 = cy2 + yR2 / 2\r\n                        // TODO\r\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\r\n                        //  , angle = 0\r\n                        ;\r\n\r\n                        //if (i !== (l - 1) / 2) {\r\n                        //    angle = step * (i + 1);\r\n                        //}\r\n\r\n\r\n                        //var xC1 = (sT.x + xR1)\r\n                        //  , yC1 = (sT.y + yR1)\r\n                        //  , xC2 = (tT.y + xR2)\r\n                        //  , yC2 = (tT.y + yR2)\r\n                        //  , ddx1 = x1 - xC1\r\n                        //  , ddy1 = y1 - yC1\r\n                        //  , ddx2 = x2 - xC2\r\n                        //  , ddy2 = y2 - yC2\r\n                        //  , cosAngle = Math.cos(angle)\r\n                        //  , sinAngle = Math.sin(angle)\r\n                        //  , cosAngleM = Math.cos(-angle)\r\n                        //  , sinAngleM = Math.sin(-angle)\r\n                        //  ;\r\n\r\n                        // TODO This should change the points to arrange them on the circle\r\n                        //\r\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\r\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\r\n\r\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\r\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\r\n\r\n                        // ===================\r\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\r\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\r\n\r\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\r\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (isNaN(out.x1)) {\r\n                            out.x1 = sT.x + xR1 * 2;\r\n                            out.y1 = sT.y + yR1 / 2;\r\n                            out.x2 = sT.x;\r\n                            out.y2 = out.y1;\r\n                            out.ex = (out.x1 + out.x2) / 2;\r\n                            out.ey = out.y1 - options.kk * (i + 1);\r\n                        } else {\r\n                            dx = Math.abs((x1 - x2) / 2);\r\n                            dy = Math.abs((y1 - y2) / 2);\r\n\r\n                            if (i !== (l - 1) / 2) {\r\n                                dd = Math.sqrt(dx * dx + dy * dy);\r\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                            }\r\n                        }\r\n\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            elmSource.cons = elmSource.cons || [];\r\n            elmSource.cons.push(con);\r\n\r\n            /**\r\n             * update\r\n             * Updates the line coordinates.\r\n             *\r\n             * @name update\r\n             * @function\r\n             * @return {undefined}\r\n             */\r\n            con.update = function () {\r\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\r\n                    results = con.computeLineCoordinates(cons);\r\n\r\n                IterateObject(results, function (r, i) {\r\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\r\n                });\r\n            };\r\n\r\n            con.update();\r\n            elmSource.on(\"dragmove\", con.update);\r\n            elmTarget.on(\"dragmove\", con.update);\r\n\r\n            /**\r\n             * setLineColor\r\n             * Sets the line color.\r\n             *\r\n             * @name setLineColor\r\n             * @function\r\n             * @param {String} color The new color.\r\n             * @param {Connectable} c The connectable instance.\r\n             * @return {undefined}\r\n             */\r\n            con.setLineColor = function (color, c) {\r\n                c = c || this;\r\n                c.line.stroke(color);\r\n                c.marker.fill(color);\r\n            };\r\n\r\n            return con;\r\n        }\r\n\r\n        if (typeof SVG === \"function\") {\r\n            SVG.extend(SVG.Element, {\r\n                connectable: connectable,\r\n                delete_connectable: delete_connectable\r\n            });\r\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\r\n            throw new Error(\"SVG.js is not loaded but it is required.\");\r\n        }\r\n\r\n        module.exports = connectable;\r\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Typpy = require(\"typpy\");\r\n\r\n        /**\r\n         * Deffy\r\n         * Computes a final value by providing the input and default values.\r\n         *\r\n         * @name Deffy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Anything|Function} def The default value or a function getting the\r\n         * input value as first argument.\r\n         * @param {Object|Boolean} options The `empty` value or an object containing\r\n         * the following fields:\r\n         *\r\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\r\n         *\r\n         * @return {Anything} The computed value.\r\n         */\r\n        function Deffy(input, def, options) {\r\n\r\n            // Default is a function\r\n            if (typeof def === \"function\") {\r\n                return def(input);\r\n            }\r\n\r\n            options = Typpy(options) === \"boolean\" ? {\r\n                empty: options\r\n            } : {\r\n                empty: false\r\n            };\r\n\r\n            // Handle empty\r\n            if (options.empty) {\r\n                return input || def;\r\n            }\r\n\r\n            // Return input\r\n            if (Typpy(input) === Typpy(def)) {\r\n                return input;\r\n            }\r\n\r\n            // Return the default\r\n            return def;\r\n        }\r\n\r\n        module.exports = Deffy;\r\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\r\n        /**\r\n         * Typpy\r\n         * Gets the type of the input value or compares it\r\n         * with a provided type.\r\n         *\r\n         * Usage:\r\n         *\r\n         * ```js\r\n         * Typpy({}) // => \"object\"\r\n         * Typpy(42, Number); // => true\r\n         * Typpy.get([], \"array\"); => true\r\n         * ```\r\n         *\r\n         * @name Typpy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {String|Boolean} It returns `true` if the\r\n         * input has the provided type `target` (if was provided),\r\n         * `false` if the input type does *not* have the provided type\r\n         * `target` or the stringified type of the input (always lowercase).\r\n         */\r\n        function Typpy(input, target) {\r\n            if (arguments.length === 2) {\r\n                return Typpy.is(input, target);\r\n            }\r\n            return Typpy.get(input, true);\r\n        }\r\n\r\n        /**\r\n         * Typpy.is\r\n         * Checks if the input value has a specified type.\r\n         *\r\n         * @name Typpy.is\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {Boolean} `true`, if the input has the same\r\n         * type with the target or `false` otherwise.\r\n         */\r\n        Typpy.is = function (input, target) {\r\n            return Typpy.get(input, typeof target === \"string\") === target;\r\n        };\r\n\r\n        /**\r\n         * Typpy.get\r\n         * Gets the type of the input value. This is used internally.\r\n         *\r\n         * @name Typpy.get\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Boolean} str A flag to indicate if the return value\r\n         * should be a string or not.\r\n         * @return {Constructor|String} The input value constructor\r\n         * (if any) or the stringified type (always lowercase).\r\n         */\r\n        Typpy.get = function (input, str) {\r\n\r\n            if (typeof input === \"string\") {\r\n                return str ? \"string\" : String;\r\n            }\r\n\r\n            if (null === input) {\r\n                return str ? \"null\" : null;\r\n            }\r\n\r\n            if (undefined === input) {\r\n                return str ? \"undefined\" : undefined;\r\n            }\r\n\r\n            // eslint-disable-next-line no-self-compare\r\n            if (input !== input) {\r\n                return str ? \"nan\" : NaN;\r\n            }\r\n\r\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\r\n        };\r\n\r\n        module.exports = Typpy;\r\n    }, {}], 4: [function (require, module, exports) {\r\n        /**\r\n         * Idy\r\n         * Generates a random id and potentially unique.\r\n         *\r\n         * @name Idy\r\n         * @function\r\n         * @param {Number} length The id length (default: 10).\r\n         * @return {String} The generated id.\r\n         */\r\n        function Idy(length) {\r\n            length = length || 10;\r\n            return Math.random().toString(35).substr(2, length);\r\n        }\r\n\r\n        module.exports = Idy;\r\n    }, {}], 5: [function (require, module, exports) {\r\n        /**\r\n         * IterateObject\r\n         * Iterates an object. Note the object field order may differ.\r\n         *\r\n         * @name IterateObject\r\n         * @function\r\n         * @param {Object} obj The input object.\r\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\r\n         * @return {Function} The `IterateObject` function.\r\n         */\r\n        function IterateObject(obj, fn) {\r\n            var i = 0,\r\n                keys = [];\r\n\r\n            if (Array.isArray(obj)) {\r\n                for (; i < obj.length; ++i) {\r\n                    if (fn(obj[i], i, obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                keys = Object.keys(obj);\r\n                for (; i < keys.length; ++i) {\r\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        module.exports = IterateObject;\r\n    }, {}], 6: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Deffy = require(\"deffy\");\r\n\r\n        /**\r\n         * SetOrGet\r\n         * Sets or gets an object field value.\r\n         *\r\n         * @name SetOrGet\r\n         * @function\r\n         * @param {Object|Array} input The cache/input object.\r\n         * @param {String|Number} field The field you want to update/create.\r\n         * @param {Object|Array} def The default value.\r\n         * @return {Object|Array} The field value.\r\n         */\r\n        function SetOrGet(input, field, def) {\r\n            return input[field] = Deffy(input[field], def);\r\n        }\r\n\r\n        module.exports = SetOrGet;\r\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\r\n        arguments[4][2][0].apply(exports, arguments);\r\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\r\n        arguments[4][3][0].apply(exports, arguments);\r\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\r\nimport LinkNode from './nodes/LinkNode.js'\r\nimport BodyNode from './nodes/BodyNode.js'\r\nimport SectionNode from './nodes/SectionNode.js'\r\nimport { Block } from 'slate'\r\nimport { getEventTransfer } from 'slate-react';\r\nimport { deleteNode } from './NodeSwitch.js'\r\n\r\nexport default function LinkPlugin(options) {\r\n    return {\r\n        commands: {\r\n            wrapLinkAtSelection(editor, node_id) {\r\n                return editor.wrapInline({\r\n                    type: \"link\",\r\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\r\n                });\r\n            }\r\n        },\r\n\r\n        renderInline(props, editor, next) {\r\n            if (props.node.type === 'link') {\r\n                var { ref, id } = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        renderBlock(props, editor, next) {\r\n            var refAndId;\r\n\r\n            if (props.node.type === 'body') {\r\n                refAndId = getRefAndId(props, editor, \"long\");\r\n\r\n                // set up the placeholder text to only appear when the body is empty and no text is selected\r\n                var isEmpty = !props.node.text\r\n\r\n                var selectNode = () => {\r\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\r\n                }\r\n\r\n                return <BodyNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                            isEmpty={isEmpty}\r\n                            selectNode={selectNode}\r\n                        />\r\n\r\n            } else if (props.node.type === 'link') {\r\n                refAndId = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            linkStyle=\"heading\"\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                        />\r\n\r\n            } else if (props.node.type === 'section') {\r\n                refAndId = getRefAndId(props, editor, \"section\");\r\n\r\n                return <SectionNode\r\n                    ref={refAndId.ref}\r\n                    {...props}\r\n                    sharedState={editor.getSharedState()}\r\n                    nodeId={refAndId.id}\r\n                />\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        onDrop(event, editor, next) {\r\n            // suppress drop events\r\n            // do not call next()\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\r\n\r\n            var transfer = getEventTransfer(event);\r\n\r\n            if (transfer.type === \"fragment\") {\r\n\r\n                // if pasting into a link or body, just paste plain text, not a fragment\r\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\r\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\r\n                    editor.insertText(textNoNewlines)\r\n\r\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\r\n                    return\r\n                }\r\n\r\n                const fragmentInlines = getLinkInlines(transfer.fragment)\r\n\r\n                if (fragmentInlines) {\r\n                    const docInlines = getLinkInlines(editor.value.document)\r\n                    const usedIds = []\r\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\r\n                    \r\n                    // let the paste happen so we can operate on the document instead of inline\r\n                    next()\r\n\r\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\r\n                    fragmentInlines.forEach(inline => {\r\n                        usedIds.forEach(usedId => {\r\n                            const id = inline.data.get(\"node_id\")\r\n                            if (usedId.id === id) {\r\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\r\n                                inlinesWithId.forEach(inlineWithId => {\r\n                                    if (inlineWithId.key !== usedId.key) {\r\n                                        editor.unwrapInlineByKey(inlineWithId.key)\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                }\r\n            } else {\r\n                next()\r\n            }\r\n        },\r\n\r\n        onChange(editor, next) {\r\n            // update all node texts (both link and body)\r\n            const sharedState = editor.getSharedState();\r\n            [\r\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\r\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\r\n            ].forEach( update =>\r\n                editor.value.blocks.forEach(block => {\r\n                    const updateText = (linkNode) => {\r\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\r\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\r\n                        const id = linkNode.data.get('node_id')\r\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\r\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\r\n                            deleteNode(linkNode, editor)\r\n                        } else {\r\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\r\n                        }\r\n                    }\r\n\r\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\r\n                    linkNodes.forEach(updateText)\r\n\r\n                    if (block.type === update.nodeType) {\r\n                        updateText(block)\r\n                    }\r\n                })\r\n            )\r\n\r\n            next()\r\n        },\r\n\r\n        onKeyDown(e, editor, next) {\r\n            const { value } = editor\r\n            const { document, selection, startBlock} = value\r\n            const { start, end } = selection\r\n\r\n            // if a whole section (block or inline) is deleted, tell the graph node\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\r\n                document.getDescendantsAtRange(selection).forEach(node => {\r\n                    if (node.type === 'section' || node.type === 'link') {\r\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\r\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\r\n                        setTimeout(() => {\r\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\r\n                        }, 0)\r\n                    }\r\n                })\r\n            }\r\n\r\n            // prevent delete key from merging body and link blocks with next\r\n            if (e.key === \"Delete\") {\r\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\r\n                    const nextBlock = document.getNextBlock(start.key)\r\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\r\n                        editor.moveToStartOfNode(nextBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                \r\n            }\r\n\r\n            // prevent backspace from merging body and link blocks with previous\r\n            if (e.key === 'Backspace') {\r\n                const prevBlock = document.getPreviousBlock(start.key)\r\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\r\n                    if (prevBlock) {\r\n                        editor.moveToEndOfNode(prevBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        } else if (prevBlock.text === \"\") {\r\n                            editor.removeNodeByKey(prevBlock.key)\r\n                         }\r\n                    }\r\n                    return editor\r\n                }\r\n            }\r\n\r\n            if (e.key === 'Enter') {\r\n                if (value.inlines.some(inline => inline.type === 'link')) {\r\n                    return // do nothing to avoid splitting the link\r\n                }\r\n\r\n                // when enter is pressed inside a link *block* (not inline), just go to body\r\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\r\n                    // unless the offset is 0, in which case insert a block before and go to that\r\n                    if (start.offset === 0) {\r\n                        const blockToInsert = Block.create({object: 'block', type: ''})\r\n                        const section = document.getParent(startBlock.key);\r\n                        const sectionParent = document.getParent(section.key);                    \r\n                        const sectionIndex = sectionParent.nodes.indexOf(section);\r\n\r\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\r\n                        return editor.moveBackward(1)\r\n                    } else {\r\n                        const nextBlock = document.getNextBlock(start.key)\r\n                        if (nextBlock) {\r\n                            return editor.moveToStartOfNode(nextBlock);\r\n                        } else {\r\n                            return editor.moveToEndOfNode(startBlock);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // prevent the cursor disappearing when navigating into the body placeholder text\r\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\r\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\r\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\r\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\r\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\r\n                    // its hard to work out how many lines of text there so use an estimate\r\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\r\n                        editor.moveToEndOfNode(relevantBlock)\r\n                        e.preventDefault()\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent tab from taking focus from the editor\r\n            if (e.key === 'Tab') {\r\n                e.preventDefault()\r\n            }\r\n\r\n            return next()\r\n        }\r\n    }\r\n\r\n    function getRefAndId(props, editor, long_or_short) {\r\n        var id = props.node.data.get(\"node_id\");\r\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\r\n        var ref = React.createRef();\r\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\r\n        return { ref, id };\r\n    }\r\n}","import React from 'react';\r\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\r\n\r\nexport default function ReorderPlugin(options) {\r\n    return {\r\n        renderBlock(props, editor, next) {            \r\n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\r\n                return <PlainBlockNode {...props}/>\r\n            }\r\n            \r\n            return next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './DocPane.css';\r\nimport DocEditor from './DocEditor.js'\r\n\r\nclass DocPane extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"pane doc\">\r\n                <DocEditor sharedState={this.props.sharedState} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\r\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\r\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\r\n\r\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\r\n\r\nconst COLOURS = [\r\n    'red',\r\n    'goldenrod',\r\n    'green',\r\n    'aqua',\r\n    'blue',\r\n    'fuchsia',\r\n    'purple',\r\n    'saddlebrown'\r\n]\r\n\r\nvar DEFAULT_ARROW_OPTIONS = [\r\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"→\"},\r\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"→\"},\r\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"→\"},\r\n];\r\n\r\nexport default class MouseFollower {\r\n    constructor(shared_state, svg, connectables_container, markers, links) {\r\n        this.shared_state = shared_state;\r\n        this.drawing_arrow_from = false;\r\n        this.connector = undefined;\r\n        this.connectables_container = connectables_container;\r\n        this.markers = markers;\r\n        this.links = links;\r\n\r\n        this.arrow_id_counter = 0\r\n\r\n        this.completed_arrows = []\r\n\r\n        this.mouse_rect = svg.group();\r\n        window.addEventListener('mousemove', e => {\r\n            var point = svg.point(e.clientX, e.clientY);\r\n            this.mouse_rect.move(point.x, point.y);\r\n            \r\n            if (typeof(this.connector) !== 'undefined') {\r\n                this.connector.update();\r\n            }\r\n        });\r\n\r\n        // cancel arrows if they don't end on a node\r\n        window.addEventListener('mouseup', (e) => {\r\n            if (this.drawing_arrow_from) {\r\n                e.preventDefault();\r\n                this.stop_drawing_arrow();\r\n            }\r\n        });\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            arrows: this.completed_arrows,\r\n            arrow_id_counter: this.arrow_id_counter,\r\n            arrowOptions: this.arrowOptions,\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\r\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\r\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\r\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\r\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\r\n\r\n        return mf\r\n    }\r\n\r\n    // draw all the arrows in this.completed_arrows\r\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\r\n    draw_loaded_arrows(get_node) {\r\n        this.completed_arrows.forEach(arrow => {\r\n            const originNode = get_node(arrow.origin)\r\n            const destinationNode = get_node(arrow.destination)\r\n\r\n            if (!originNode) {\r\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\r\n                return\r\n            }\r\n\r\n            if (!destinationNode) {\r\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\r\n                return\r\n            }\r\n\r\n            const connector = this.draw_arrow(\r\n                originNode,\r\n                destinationNode,\r\n                arrow.colour\r\n            )\r\n            this.add_context_menu_to_arrow(connector, arrow)\r\n            \r\n            // update the arrow start and end points\r\n            originNode.group.node.dispatchEvent(new CustomEvent(\"dragmove\"))\r\n        })\r\n    }\r\n\r\n    update_source(new_source) {\r\n        if (typeof(this.connector) === 'undefined') {\r\n            this.connector = new_source.connectable({\r\n                container: this.connectables_container,\r\n                markers: this.markers\r\n            }, this.mouse_rect);\r\n        } else {\r\n            this.connector.marker.show();\r\n            this.connector.line.show();\r\n\r\n            this.connector.target = this.mouse_rect;\r\n            this.connector.source = new_source;\r\n            this.connector.update();\r\n        }\r\n        if (this.connector) {\r\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (typeof(this.connector) !== 'undefined') {\r\n            this.connector.target = this.connector.source;\r\n            this.connector.marker.hide();\r\n            this.connector.line.hide();\r\n        }\r\n    }\r\n\r\n    start_arrow(source_node) {\r\n        this.drawing_arrow_from = source_node;\r\n        if (this.connector) {\r\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    draw_arrow(origin, destination, colour) {\r\n        var connector = origin.group.connectable({\r\n            container: this.links,\r\n            markers: this.markers,\r\n            specialCoords: true\r\n        }, destination.group);\r\n        connector.setLineColor(colour);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n\r\n        return connector\r\n    }\r\n\r\n    add_context_menu_to_arrow(connector, arrowObject) {\r\n        const show_context_menu = e => {\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\r\n                arrowObject.colour = new_colour\r\n            }, arrowObject);\r\n            e.preventDefault();\r\n        };\r\n        connector.line.on(\"click\", show_context_menu);\r\n        connector.line.on(\"contextmenu\", show_context_menu);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n\r\n        // detect if the user changes the colour of this arrow\r\n        window.addEventListener('colourchange', (e) => {\r\n            if (e.detail.oldColour === arrowObject.colour) {\r\n                connector.setLineColor(e.detail.newColour)\r\n                arrowObject.colour = e.detail.newColour\r\n            }\r\n        })\r\n\r\n        // detect if all arrows of this colour were deleted\r\n        window.addEventListener('arrowdelete', (e) => {\r\n            if (e.detail.colour === arrowObject.colour) {\r\n                this.remove_arrow(connector, arrowObject)\r\n            }\r\n        })\r\n    }\r\n\r\n    complete_arrow(end_node) {\r\n        // no arrows to self\r\n        if (end_node === this.drawing_arrow_from) {\r\n            this.stop_drawing_arrow();\r\n            return;\r\n        }\r\n\r\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\r\n\r\n        var c1 = this.drawing_arrow_from.group.getScreenCoords();\r\n        var c2 = end_node.group.getScreenCoords();\r\n        var midpoint = [(c1.x + c2.x) / 2, (c1.y + c2.y) / 2]\r\n\r\n        // only add the arrow to the list of completed arrows once a colour is selected\r\n        // to prevent weird states being saved and loaded\r\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\r\n        const colourWasSelected = (colour) => {\r\n            const id = this.getNewId()\r\n            const arrowObject = {\r\n                id: id,\r\n                origin: drawing_arrow_from_id,\r\n                destination: end_node.id,\r\n                colour: colour,\r\n            }\r\n            this.completed_arrows.push(arrowObject)\r\n\r\n            this.add_context_menu_to_arrow(connector, arrowObject)\r\n        }\r\n\r\n        this.edit_connector_type(connector, midpoint[0], midpoint[1], false, colourWasSelected);\r\n\r\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\r\n        this.stop_drawing_arrow();\r\n    }\r\n\r\n    getArrowByID(id) {\r\n        return this.completed_arrows.find(arrow => arrow.id === id)\r\n    }\r\n\r\n    getNewId() {\r\n        this.arrow_id_counter++\r\n        return this.arrow_id_counter\r\n    }\r\n\r\n    changeArrowColour(entry, direction) {\r\n        const oldColour = entry.colour\r\n        var newColour = this.getNextAvailableColour(entry, direction)\r\n        if (!newColour) {\r\n            return\r\n        }\r\n        entry.colour = newColour\r\n\r\n        window.dispatchEvent(new CustomEvent('colourchange', {\r\n            detail: {\r\n                oldColour: oldColour,\r\n                newColour: newColour,\r\n            }\r\n        }))\r\n\r\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\r\n\r\n        return newColour\r\n    }\r\n\r\n    getNextAvailableColour(entry, direction) {\r\n        // find all the colours which are not used by arrowOptions other than this one\r\n        const availableColours = COLOURS.filter(colour => \r\n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\r\n        )\r\n\r\n        if (!availableColours) {\r\n            return undefined\r\n        } else {\r\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\r\n            if (thisColourIndex !== -1) {\r\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\r\n                if (nextIndex < 0) {\r\n                    nextIndex = availableColours.length - 1\r\n                }\r\n                return availableColours[nextIndex]\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrowOptions() {\r\n        const clickEditButton = (e, params) => {\r\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\r\n\r\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\r\n\r\n            transientEntry.isClickable = false\r\n\r\n            var editButton = buttonCell.children[0]\r\n\r\n            const updateName = () => {\r\n                var newValue = input.value\r\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\r\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\r\n                }\r\n                if (newValue) {\r\n                    underlyingEntry.name = newValue\r\n                }\r\n\r\n                return newValue\r\n            }\r\n\r\n            const finishEditing = () => {\r\n                var newValue = updateName()\r\n                if (newValue) {\r\n                    nameCell.textContent = newValue\r\n                }\r\n\r\n                transientEntry.isClickable = true\r\n\r\n                colourCell.textContent = colourButton.textContent\r\n                colourCell.style.color = colourButton.style.color\r\n                \r\n                editButton.classList.remove('pure-button-active')\r\n                editButton.onclick = (e) => clickEditButton(e, params)\r\n            }\r\n\r\n            editButton.classList.add('pure-button-active')\r\n            editButton.onclick = finishEditing\r\n\r\n            var input = document.createElement(\"input\")\r\n            \r\n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\r\n            input.value = nameCell.textContent\r\n            input.addEventListener('keyup', (e) => {\r\n                if (e.key === 'Enter' && input.value) {\r\n                    finishEditing()\r\n                }\r\n            })\r\n            input.addEventListener('change', updateName)\r\n\r\n            nameCell.textContent = \"\"\r\n            nameCell.appendChild(input)\r\n\r\n            var colourButton = document.createElement(\"button\")\r\n            colourButton.className = 'pure-button'\r\n            colourButton.textContent = colourCell.textContent\r\n            colourCell.textContent = \"\"\r\n            colourCell.appendChild(colourButton)\r\n            colourButton.style.color = colourCell.style.color\r\n            colourButton.style.padding = 0\r\n            colourButton.addEventListener(\"click\", () => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\r\n                transientEntry.colour = underlyingEntry.colour\r\n            })\r\n            colourButton.addEventListener(\"contextmenu\", (e) => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\r\n                transientEntry.colour = underlyingEntry.colour\r\n                e.preventDefault()\r\n            })\r\n\r\n            input.focus()\r\n        }\r\n\r\n        const clickDeleteArrowTypeButton = (e, params) => {\r\n            var { row, underlyingEntries, underlyingEntry, transientEntry, selected, hidePopup } = params\r\n            transientEntry.isClickable = false\r\n            \r\n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\r\n                // remove from underlyingEntries\r\n                var index = underlyingEntries.indexOf(underlyingEntry)\r\n                if (index !== -1) {\r\n                    underlyingEntries.splice(index, 1)\r\n                }\r\n\r\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\r\n                setTimeout(() => row.parentNode.removeChild(row), 0)\r\n\r\n                // tell all arrows of this colour to delete themselves\r\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\r\n                    detail: {\r\n                        colour: underlyingEntry.colour,\r\n                    }\r\n                }))\r\n\r\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour})\r\n\r\n                // if the selected arrow type was deleted, hide the optionpopup\r\n                if (selected) {\r\n                    hidePopup()\r\n                }\r\n            }\r\n\r\n            transientEntry.isClickable = true\r\n        }\r\n\r\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\r\n            var entryWithButtons = {...entry}\r\n            entryWithButtons.buttons = [\r\n                {\r\n                    className: 'edit-icon',\r\n                    click: clickEditButton,\r\n                    underlyingEntry: entry,\r\n                },\r\n                {\r\n                    className: 'delete-icon',\r\n                    click: clickDeleteArrowTypeButton,\r\n                    underlyingEntry: entry,\r\n                    underlyingEntries: this.arrowOptions,\r\n                }\r\n            ]\r\n            return entryWithButtons\r\n        })\r\n        \r\n        return [\r\n            ...arrowOptionsWithButtons,\r\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\r\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n        ]\r\n    }\r\n\r\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\r\n        var prev_selected = undefined;\r\n        \r\n        const arrowOptions = this.getArrowOptions()\r\n\r\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\r\n        prev_selected = prev_selected ? prev_selected.name : undefined\r\n\r\n        const setArrowColour = (selected_option) => {\r\n            connector.setLineColor(selected_option.colour);\r\n            this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\r\n\r\n            if (onColourSelected) {\r\n                onColourSelected(selected_option.colour)\r\n            }\r\n        }\r\n\r\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\r\n            if (selected_option.name === \"Delete\") {\r\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\r\n                this.remove_arrow(connector, arrowObject);\r\n            } else if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\r\n                const colour = this.getNextAvailableColour(null, 1)\r\n\r\n                if (!colour) {\r\n                    toast.error(\"Maximum number of arrow types reached!\")\r\n                } else {\r\n                    const newRelation = {\r\n                        'name': 'New relation',\r\n                        'colour': colour,\r\n                        'symbol': \"→\",\r\n                    }\r\n                    this.arrowOptions.push(newRelation)\r\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\r\n\r\n                    if (!prev_selected) {\r\n                        setArrowColour(newRelation)\r\n                    }\r\n\r\n                    // open a new option popup to allow the user to select the new arrow type and edit it\r\n                    this.edit_connector_type(connector, popup_x, popup_y, true, onColourSelected, arrowObject)\r\n                }\r\n            } else {\r\n                setArrowColour(selected_option)\r\n            }\r\n        }, prev_selected);\r\n    }\r\n\r\n    remove_arrow(connector, arrowObject) {\r\n        connector.line.node.instance.delete_connectable(connector);\r\n\r\n        if (arrowObject) {\r\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \r\n        }\r\n    }\r\n\r\n    stop_drawing_arrow() {\r\n        this.drawing_arrow_from = false;\r\n        this.hide();\r\n    }\r\n}","import OptionPopup from \"./OptionPopup\";\r\n\r\nvar ARROW_HITBOX_MARGIN = 20;\r\n\r\nclass GraphNode {\r\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList) {\r\n        var { shortText, x, y, width, height, id, isOnGraph, longText } = params\r\n        this.id = id ? id : shared_state.getNodeId();\r\n\r\n        this.getNodesList = getNodesList;\r\n        \r\n        this.group = nodes.group().translate(x, y);\r\n\r\n        this.dropShadow = this.group.rect(width, height).radius(5).addClass('node-drop-shadow')\r\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\r\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0).radius(10).addClass('arrow-hitbox');\r\n        \r\n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\r\n        this.editRect = this.group.rect(width - 10, height - 10).radius(5).translate(5, 5).addClass('editing-node-rect')\r\n        this.text = this.group.text(\"\").addClass('node-text');\r\n        this.updateShortText(shortText)\r\n        this.updateLongText(longText)\r\n\r\n        this.setupRectDragging(this.rect, shared_state);\r\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\r\n        const complete_arrow = (e) => {\r\n            if (mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.complete_arrow(this);\r\n            }\r\n        };\r\n        this.arrow_hitbox.on('mouseup', complete_arrow);\r\n        this.rect.on('mouseup', complete_arrow);\r\n        this.text.on('mouseup', complete_arrow);\r\n\r\n        this.setupHover(shared_state);\r\n        this.setupContextMenu(shared_state);\r\n\r\n        if (focus_text_area) {\r\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\r\n        }\r\n        \r\n        this.setIsOnGraph(isOnGraph);\r\n\r\n        // don't log add node events if they are just loaded from a save\r\n        if (!params.isFromJSON) {\r\n            shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList) {\r\n        var params = json\r\n        params.x = json.screenCoords.x\r\n        params.y = json.screenCoords.y\r\n        params.width = 200\r\n        params.height = 42\r\n        params.isFromJSON = true\r\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList)\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            id: this.id,\r\n            shortText: this.shortText,\r\n            longText: this.longText,\r\n            screenCoords: this.group.getScreenCoords(),\r\n            isOnGraph: this.isOnGraph,\r\n        }\r\n    }\r\n\r\n    setIsOnGraph(newVal) {\r\n        this.isOnGraph = newVal;\r\n        if (this.isOnGraph) {\r\n            this.rect.addClass(\"node-on-graph\");\r\n        } else {\r\n            this.rect.removeClass(\"node-on-graph\");\r\n        }\r\n    }\r\n\r\n    setupContextMenu(shared_state) {\r\n        var showOptionMenu = e => {\r\n            e.preventDefault();\r\n            \r\n            var entries = [\r\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n            ]\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\r\n                if (selected_option.name === \"Delete\") {\r\n                    this.delete(shared_state);\r\n                }\r\n            });\r\n            \r\n            return false;\r\n        };\r\n        this.rect.on('contextmenu', showOptionMenu);\r\n        this.text.on('contextmenu', showOptionMenu);\r\n    }\r\n\r\n    setupHover(shared_state) {\r\n        this.hoverers = []\r\n\r\n        const startHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, true);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\r\n            });\r\n        };\r\n        const endHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, false);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\r\n            });\r\n        };\r\n        this.rect.on('mouseenter', startHover);\r\n        this.text.on('mouseenter', startHover);\r\n        this.rect.on('mouseleave', endHover);\r\n        this.text.on('mouseleave', endHover);\r\n    }\r\n\r\n    setHoverer(hoverer, isHovering) {\r\n        if (isHovering) {\r\n            if (!this.hoverers.includes(hoverer)) {\r\n                this.hoverers.push(hoverer)\r\n            }\r\n        } else {\r\n            // remove the hoverer\r\n            var index = this.hoverers.indexOf(hoverer);\r\n            if (index !== -1) this.hoverers.splice(index, 1);\r\n        }\r\n\r\n        this.setHovered(this.hoverers.length > 0)\r\n    }\r\n\r\n    setHovered(isHovered) {        \r\n        if (isHovered) {\r\n            this.rect.addClass(\"hovered\");\r\n        } else {\r\n            this.rect.removeClass(\"hovered\");\r\n        }\r\n    }\r\n\r\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\r\n    // but we only want to make the node itself draggable\r\n    // so we need to intercept drag events on the rect, and move the entire group instead!\r\n    setupRectDragging(rect, shared_state) {\r\n        this.setupGroupDragging(rect, shared_state, rect);\r\n        this.setupGroupDragging(this.text, shared_state, rect, true);\r\n        \r\n        this.text.click((e) => e.preventDefault());\r\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\r\n        rect.click(edit_text_if_not_just_dropped);\r\n        this.text.click(edit_text_if_not_just_dropped);\r\n    }\r\n\r\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\r\n        rect.draggy(); // setup dragging on the rect\r\n        rect.on('mousedown', (e) => {\r\n            e.stopPropagation(); // don't pan when moving a node\r\n        });\r\n        just_dropped_obj.just_dropped = false;\r\n        rect.on('dragstart', (e) => {\r\n            var start_x = this.group.x();\r\n            var start_y = this.group.y();\r\n            document.activeElement.blur();\r\n            shared_state.draggedNode = {\r\n                id: this.id,\r\n                text: this.getShortText(),\r\n                longText: this.getLongText(),\r\n                resetPos: () => {\r\n                    this.group.move(start_x, start_y);\r\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n                },\r\n                node: this\r\n            };\r\n\r\n            this.dropShadow.translate(5, 5)\r\n            this.dropShadow.addClass('visible')\r\n            \r\n            rect.off('dragmove');\r\n            rect.on('dragmove', (e) => {\r\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\r\n                if (center) {\r\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n                } else {\r\n                    rect.x(0);\r\n                    rect.y(0);\r\n                }\r\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n            });\r\n            rect.off('dragend');\r\n            rect.on('dragend', (e) => {\r\n                // prevent the textarea showing\r\n                // unless the drag amount was zero or just a tiny accidental drag\r\n                var x_diff = (this.group.x() - start_x);\r\n                var y_diff = (this.group.y() - start_y);\r\n                var nudge = 10;\r\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\r\n                    just_dropped_obj.just_dropped = true;\r\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\r\n                }\r\n                shared_state.draggedNode = false;\r\n\r\n                this.dropShadow.translate(0, 0)\r\n                this.dropShadow.removeClass('visible')\r\n            });\r\n        });\r\n    }\r\n\r\n    // click/drag events on the arrow hitbox should start the arrow creation process\r\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\r\n        arrow_hitbox.on('mousemove', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.update_source(this.group);\r\n            }\r\n        });\r\n        arrow_hitbox.on('mouseleave', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.hide();\r\n            }\r\n        });\r\n        arrow_hitbox.on('mousedown', (e) => {\r\n            mouse_follower.start_arrow(this);\r\n            e.stopPropagation(); // don't pan when dragging an arrow\r\n        });\r\n    }\r\n\r\n    updateShortText(newShortText) {\r\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\r\n        \r\n        const CHARS_PER_LINE = 21;\r\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\r\n\r\n        this.text.text(formattedText.join(\"\\n\"));\r\n        this.resizeRect(formattedText.length);\r\n    }\r\n\r\n    updateLongText(newLongText) {\r\n        this.longText = newLongText;\r\n    }\r\n\r\n    splitIntoLines(charsPerLine, text) {\r\n        var formattedText = [];\r\n        var line = \"\";\r\n        text.split(\" \").forEach(word => {\r\n            var segments = [];\r\n            if (word.length > charsPerLine) {\r\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\r\n                    if (segments.length > 0) {\r\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\r\n                    }\r\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\r\n                }\r\n            }\r\n            else {\r\n                segments = [word];\r\n            }\r\n            segments.forEach(segment => {\r\n                if ((line + segment).length < charsPerLine) {\r\n                    var space = line.length > 0 ? \" \" : \"\";\r\n                    line += space + segment;\r\n                }\r\n                else {\r\n                    formattedText.push(line);\r\n                    line = segment;\r\n                }\r\n            });\r\n        });\r\n        formattedText.push(line);\r\n        return formattedText;\r\n    }\r\n\r\n    // resize the rect so that the text fits on it\r\n    resizeRect(numLinesOfText) {\r\n        this.rect.width(200);\r\n        const rectHeight = numLinesOfText * 21 + 20\r\n        this.rect.height(rectHeight);\r\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n        this.dropShadow.height(rectHeight)\r\n        this.editRect.height(rectHeight - 10)\r\n\r\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\r\n\r\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n    }\r\n\r\n    getShortText() {\r\n        return this.shortText;\r\n    }\r\n\r\n    getLongText() {\r\n        return this.longText;\r\n    }\r\n\r\n    editText(shared_state, delete_if_empty_text = false) {\r\n        document.activeElement.blur(); // remove focus from everything\r\n\r\n        var textarea = document.querySelector('#nodeedit');\r\n        textarea.value = this.getShortText();\r\n\r\n        const preEditText = this.getShortText()\r\n\r\n        var screen_coords = this.group.getScreenCoords();\r\n        textarea.style.left = screen_coords.x + \"px\";\r\n        textarea.style.top = screen_coords.y + \"px\";\r\n        textarea.style.display = \"inline-block\";\r\n        textarea.focus();\r\n\r\n        textarea.style.width = \"180px\";\r\n        textarea.style.height = 'auto';\r\n        textarea.style.height = (textarea.scrollHeight) + 'px';\r\n\r\n        this.text.hide();\r\n\r\n        this.editRect.addClass('visible')\r\n        this.setHoverer('editNodeDirectly', true)\r\n\r\n        var save_changes = () => {\r\n            this.updateShortText(textarea.value);\r\n            shared_state.updateDocShortText(this.id, this.getShortText());\r\n        };\r\n        var save_and_hide = () => {\r\n            save_changes();\r\n            textarea.style.display = \"none\";\r\n            if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\r\n                this.delete(shared_state);\r\n            }\r\n            this.text.show();\r\n            this.updateShortText(this.shortText);\r\n\r\n            if (this.getShortText() !== preEditText) {\r\n                shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\r\n            }\r\n\r\n            this.editRect.removeClass('visible')\r\n            this.setHoverer('editNodeDirectly', false)\r\n        };\r\n        textarea.onblur = save_and_hide;\r\n        textarea.onkeyup = (e) => {\r\n            if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\r\n                e.preventDefault();\r\n                document.activeElement.blur();\r\n            } else {\r\n                save_changes();\r\n            }\r\n        };\r\n    }\r\n\r\n    delete(shared_state) {\r\n        shared_state.removeGraphNode(this.id);\r\n        \r\n        // remove from the list of nodes (used for saving)\r\n        const nodesList = this.getNodesList()\r\n        var index = nodesList.indexOf(this);\r\n        if (index !== -1) {\r\n            nodesList.splice(index, 1)\r\n        } else {\r\n            console.log('node not found in this.nodesList when deleting');\r\n        }        \r\n\r\n        this.group.remove();\r\n\r\n        // delete arrows\r\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\r\n\r\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\r\n    }\r\n}\r\n\r\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst graphTarget = {\r\n    canDrop(props, monitor) {\r\n        const item = monitor.getItem()\r\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\r\nimport './GraphPane.css';\r\nimport SVG from 'svg.js';\r\nimport 'svg.panzoom.js';\r\nimport 'svg.draggy.js';\r\nimport './svg.connectable.js';\r\nimport MouseFollower from './MouseFollower.js';\r\nimport GraphNode from './GraphNode.js';\r\nimport DropifyGraphPane from './DropifyGraphPane.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nclass GraphPane extends React.Component {\r\n    componentDidMount() {\r\n        this.props.sharedState.getSavedGraph((json) => {\r\n            this.nodesList = [];\r\n\r\n            this.props.sharedState.graphPane = this;\r\n\r\n            this.$el = document.querySelector(\"#graph\")\r\n\r\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 1, zoomMax: 1 }); // just pan, no zoom\r\n\r\n            SVG.extend(SVG.Element, {\r\n                getScreenCoords: function () {\r\n                    var root_point = this.doc().node.getBoundingClientRect();\r\n                    var point = this.point(0, 0);\r\n                    return {\r\n                        x: -point.x - root_point.left,\r\n                        y: -point.y - root_point.top\r\n                    };\r\n                }\r\n            })\r\n\r\n            var links = svg.group();\r\n            var markers = svg.group();\r\n            var nodes = svg.group();\r\n\r\n            const json_connections = json ? json.connections : undefined\r\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\r\n            this.mouse_follower = mouse_follower\r\n\r\n            // add new nodes on mouse click\r\n            svg.on('dblclick', (e) => {\r\n                // only clicks on background and not when dragging\r\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\r\n                    return;\r\n                }\r\n\r\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n            });\r\n\r\n            this.setupTextDropping(svg, nodes, mouse_follower);\r\n\r\n            svg.on('panStart', (e) => {\r\n                document.activeElement.blur();\r\n            });\r\n\r\n            var textarea = document.querySelector('#nodeedit');\r\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\r\n            textarea.addEventListener(\"input\", (e) => {\r\n                textarea.style.height = 'auto';\r\n                textarea.style.height = (textarea.scrollHeight) + 'px';\r\n            });\r\n\r\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\r\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\r\n            }\r\n            if (json && json.nodes) {\r\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\r\n            }\r\n\r\n            this.getNodeById = this.getNodeById.bind(this)\r\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\r\n\r\n            if (this.nodesList.length === 0) {\r\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\r\n            }\r\n        })\r\n    }\r\n\r\n    getNodeById(id) {\r\n        return this.nodesList.find(node => node.id.toString() === id.toString())\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            nodes: this.nodesList.map(node => node.toJSON()),\r\n            connections: this.mouse_follower.toJSON()\r\n        }\r\n    }\r\n\r\n    loadNodesFromJSON(json, mouse_follower, nodes) {\r\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList))\r\n    }\r\n\r\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\r\n        this.noNodesIndicator = svg.text(\"Double click to add a node\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\r\n        this.noNodesIndicator.on('dblclick', (e) => {\r\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n        });\r\n    }\r\n\r\n    setupTextDropping(svg, nodes, mouse_follower) {\r\n        this.$el.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        this.$el.addEventListener(\"drop\", (e) => {\r\n            e.preventDefault();\r\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\r\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\r\n            }\r\n            \r\n            var data = e.dataTransfer.getData(\"Text\");\r\n\r\n            if (data.includes('\\n')) {\r\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\r\n                return\r\n            }\r\n\r\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\r\n                toast.error('You can\\'t add the same node to the graph twice!')\r\n                return\r\n            }\r\n\r\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, e.clientX, e.clientY, false);\r\n            this.props.sharedState.addLinkAtSelection(node.id, node);\r\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\r\n            document.activeElement.blur();\r\n        });\r\n    }\r\n\r\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false) {\r\n        var point = svg.point(x, y);\r\n        const params = {\r\n            shortText: text,\r\n            longText: \"\", \r\n            x: point.x,\r\n            y: point.y,\r\n            width: 200,\r\n            height: 42,\r\n            isOnGraph: false,\r\n            id: undefined, // set automatically\r\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\r\n        }\r\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList);\r\n        this.nodesList.push(node);\r\n\r\n        if (this.noNodesIndicator) {\r\n            this.noNodesIndicator.hide();\r\n        }\r\n\r\n        return node;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.$el.somePlugin('destroy');\r\n    }\r\n\r\n    render() {\r\n        return this.props.connectDropTarget(\r\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\r\n                <textarea id='nodeedit'></textarea>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\r\n\r\nconst db = new Dexie('writeReasonDb');\r\ndb.version(1).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\r\n\r\nexport default db;","import React, { Component } from 'react';\r\n\r\nexport default class ProjectsList extends Component {\r\n    render() {\r\n        return (\r\n            <div className='display-block'>\r\n                <table className='pure-table'>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>ID</th>\r\n                            <th>Name</th>\r\n                            <th></th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {\r\n                            this.props.projects.map(project => <tr key={project.id.toString()}>\r\n                                <td>{project.id}</td>\r\n                                <td>{project.name}</td>\r\n                                <td>\r\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"...\">\r\n                                        <button className=\"pure-button\" onClick={() => this.props.loadProject(project.id)}>Open</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.renameProject(project.id)}>Rename</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.duplicateProject(project.id)}>Duplicate</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.deleteProject(project.id)}>Delete</button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>)\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        );\r\n      }\r\n}","import db from './db.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY = [\r\n    'session_start',\r\n    'document_content_detailed',\r\n    'document_content_markdown',\r\n]\r\n\r\nexport default class Logger {\r\n    shouldLogToConsole = false;\r\n\r\n    constructor(db_id, params) {\r\n        this.db_id = db_id;\r\n        this.conditions = params;\r\n        this.logToConsole(\"Logging begin, db_id \" + db_id + \"\\nParams \" + JSON.stringify(params, null, 1));\r\n\r\n        // used for tracking whether changes have been made since last save\r\n        // obviously, does not track events which are not logged, like typing in the document\r\n        this.stateIsDirty = false\r\n\r\n        this.logEvent({'type': 'session_start'})\r\n    }\r\n\r\n    logEvent(event) {\r\n        if (!EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY.includes(event.type)) {\r\n            this.stateIsDirty = true\r\n        }\r\n\r\n        if (event.type === 'save') {\r\n            this.stateIsDirty = false\r\n        }\r\n\r\n        this.getLog(log => {\r\n            if (log.events === undefined) {\r\n                log.events = {}\r\n            }\r\n    \r\n            if (log.events[event.type] === undefined) {\r\n                log.events[event.type] = []\r\n            }\r\n            event.timestamp = new Date()\r\n            log.events[event.type].push(event)\r\n            this.setLog(log)\r\n\r\n            this.logToConsole(\"Logging event: \" + JSON.stringify(event))\r\n        })\r\n    }\r\n\r\n    // keep a history of the save states so that we can look back at how the project developed\r\n    logSaveState(save) {\r\n        this.getLog(log => {\r\n            if (log.saves === undefined) {\r\n                log.saves = []\r\n            }\r\n\r\n            // don't store this save if we have stored a save <3 minutes ago\r\n            // to prevent multiple clicks of the save button taking up lots of space\r\n            const timestamp = new Date()\r\n            const THREE_MINUTES = 3 * 60 * 1000; // ms\r\n            if (!log.saves.find(save => (timestamp - save.timestamp < THREE_MINUTES))) {\r\n                log.saves.push({\r\n                    timestamp: timestamp,\r\n                    ...save,\r\n                })\r\n                this.setLog(log)\r\n            }\r\n        })\r\n    }\r\n\r\n    getLog(callback) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then((project) => {\r\n                callback(project.log ? project.log : {})\r\n            })\r\n    }\r\n\r\n    setLog(log) {\r\n        db.table('projects')\r\n            .update(this.db_id, { log: log })\r\n            .catch(err => {\r\n                toast.error('Logging error: ' + err)\r\n                console.log('Logging error: ' + err)\r\n            })\r\n    }\r\n\r\n    logToConsole(msg) {\r\n        if (this.shouldLogToConsole) {\r\n            console.log(msg);\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport { Text } from 'slate';\r\nimport Html from 'slate-html-serializer'\r\nimport Logger from './logging'\r\nimport db from './db.js'\r\nimport { toast } from 'react-toastify';\r\nimport { pdf, Document, Page, Text as PdfText, StyleSheet, Font } from '@react-pdf/renderer';\r\nimport CrimsonText from './assets/CrimsonText-Regular.ttf'\r\nimport CrimsonTextBold from './assets/CrimsonText-Bold.ttf'\r\n\r\nexport default class SharedState {\r\n    constructor(db_id, params) {      \r\n        this.logger = new Logger(db_id, params)\r\n        this.condition = params.condition;\r\n        this.params = params;\r\n        \r\n        this.node_id_counter = 0;\r\n        this.slate_id_counter = 10\r\n        this.map = {};\r\n        this.map_recycle_bin = {};\r\n        this.db_id = db_id\r\n\r\n        // this.editor_ref and this.graphPane set in the editor and graphpane\r\n        this.editor_ref = undefined;\r\n        this.graphPane = undefined;\r\n\r\n        // log entire document content every 30 seconds\r\n        this.intervalLogger = window.setInterval(() => {\r\n            this.logger.logEvent({'type': 'document_content_detailed', 'content': this.getEditor().getValue()});\r\n            this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\r\n        }, 30000);\r\n        \r\n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\r\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\r\n        this.save = this.save.bind(this)\r\n        this.exportPDF = this.exportPDF.bind(this)\r\n\r\n        // when the tab is closed, if the document has been edited, warn before closing\r\n        window.onbeforeunload = (e) => {\r\n            if (process.env.NODE_ENV !== 'development' && this.getStateIsDirty()) { // disable in development for webpack hot reloading\r\n                e.preventDefault()\r\n                e.returnValue = '' // for Chrome\r\n            }\r\n        }\r\n    }\r\n\r\n    // called by editor once the database saved value has been set as the document.value\r\n    editorHasLoaded() {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\r\n                this.map = project.map ? this.mapFromJSON(project.map) : {}\r\n                this.getEditor().mapHasLoaded()\r\n                this.projectName = project.name\r\n                document.title = this.projectName + \" - Write Reason\"\r\n            })\r\n        \r\n        this.lastSavedDocumentState = this.getEditor().getValue().document // editor is definitely not dirty right now\r\n    }\r\n\r\n    save() {\r\n        const changes = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        db.table('projects')\r\n            .update(this.db_id, changes)\r\n            .then((idExists) => {\r\n                if (!idExists) {\r\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\r\n                    console.log(message)\r\n                    toast.error(message)\r\n                } else {\r\n                    toast.info('Changes saved!')\r\n                    this.lastSavedDocumentState = this.getEditor().getValue().document\r\n                    this.logger.logSaveState(changes)\r\n                }\r\n            }).catch(err => {\r\n                toast.error('Save error: ' + err.toString())\r\n            })\r\n            \r\n        this.logger.logEvent({'type': 'save'})\r\n    }\r\n\r\n    getStateIsDirty() {\r\n        return this.logger.stateIsDirty || (\r\n            this.getEditor() && this.getEditor().getValue() && this.getEditor().getValue().document !== this.lastSavedDocumentState\r\n        ) \r\n    }\r\n\r\n    getSavedDocValue = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.doc_value)\r\n            })\r\n    }\r\n\r\n    getSavedGraph = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.graph_value)\r\n            })\r\n    }\r\n\r\n    mapToJSON() {\r\n        var mapJson = {}\r\n        const document = this.getEditor().value.document\r\n        for (const id in this.map) {\r\n            let doc_nodes = {};\r\n            ['section', 'long', 'short'].forEach(part => {\r\n                const docNodeObjects = this.getDocNodes(id)\r\n                if (docNodeObjects) {\r\n                    if (docNodeObjects[part]) {\r\n                        const path = document.getPath(docNodeObjects[part])\r\n                        doc_nodes[part] = path.toArray()\r\n                    }\r\n                } \r\n            })\r\n\r\n            mapJson[id] = {\r\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\r\n                doc_nodes: doc_nodes\r\n            }\r\n        }\r\n\r\n        return mapJson\r\n    }\r\n\r\n    mapFromJSON(json) {\r\n        this.map = {}\r\n        for (const id in json) {\r\n            if (json[id].graph_node) {\r\n                const graphNode = this.graphPane.getNodeById(id)\r\n                if (graphNode) {\r\n                    this.addGraphMapping(id, graphNode)\r\n                } else {\r\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\r\n                }\r\n            }\r\n\r\n            if (json[id].doc_nodes) {\r\n                for (const part in json[id].doc_nodes) {\r\n                    const path = json[id].doc_nodes[part]\r\n                    \r\n                    const document = this.getEditor().value.document\r\n                    if (document.hasNode(path)) {\r\n                        this.setLinkMapping(id, document.getNode(path), part)\r\n                    } else {\r\n                        console.log(document);\r\n                        \r\n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.map\r\n    }\r\n\r\n    downloadExperimentData() {\r\n        this.logger.getLog(log => {\r\n            const element = document.createElement(\"a\");\r\n            const data = {\r\n                params: this.params,\r\n                argument: this.getArgumentMarkdown(),\r\n                logs: log\r\n            }\r\n            const file = new Blob([JSON.stringify(data, null, 2)], {type: 'text/plain'});\r\n    \r\n            element.href = URL.createObjectURL(file);\r\n            element.download = this.logger.getExperimentId() + \".json\";\r\n            document.body.appendChild(element); // Required for this to work in FireFox\r\n            element.click();\r\n        })\r\n    }\r\n\r\n    getArgumentHTML() {\r\n        const parentStyleIs = (node, styleToCheck) => {\r\n            const parent = this.getEditor().value.document.getParent(node.key)\r\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\r\n        }\r\n\r\n        const RULES = [\r\n            {\r\n                serialize: (node, children) => {\r\n                    if ([\"block\", \"inline\"].includes(node.object)) {\r\n                        switch(node.type) {\r\n                            case 'paragraph':\r\n                            case '':\r\n                                return <p>{children}</p>\r\n\r\n                            case 'heading':\r\n                                return <h2>{children}</h2>\r\n                            \r\n                            case 'section':\r\n                                return <div>{children}</div>\r\n                            \r\n                            case 'body':\r\n                                if (parentStyleIs(node, \"Heading only\")) {\r\n                                    return <p></p>\r\n                                } else {\r\n                                    return <p>{children}</p>\r\n                                }\r\n\r\n                            case 'link':\r\n                                if (node.object === \"inline\") {\r\n                                    return <span>{children}</span>\r\n                                } else {\r\n                                    if (parentStyleIs(node, \"Body only\")) {\r\n                                        return <p></p>\r\n                                    } else {\r\n                                        return <h2>{children}</h2>\r\n                                    }\r\n                                }\r\n\r\n                            default:\r\n                                return undefined\r\n                        }\r\n                    } else if(node.object === 'string') {\r\n                        return node.text\r\n                    }\r\n                } \r\n            }\r\n        ]\r\n\r\n        const serializer = new Html({rules: RULES})\r\n        return serializer.serialize(this.getEditor().value)\r\n    }\r\n\r\n    exportPDF() {\r\n        this.logger.getLog(log => {\r\n            const element = document.createElement(\"a\");\r\n            this.getReactPdfDocument().then(file => {            \r\n                element.href = URL.createObjectURL(file);\r\n                element.download = this.projectName + \".pdf\";\r\n                document.body.appendChild(element); // Required for this to work in FireFox\r\n                element.click();\r\n            })\r\n        })\r\n    }\r\n\r\n    getReactPdfDocument() {\r\n        const markdown = this.getArgumentMarkdown()\r\n\r\n        Font.register({family: 'Crimson Text', fonts: [\r\n            {src: CrimsonText},\r\n            {src: CrimsonTextBold, fontWeight: 800}\r\n        ]})\r\n\r\n        const styles = StyleSheet.create({\r\n            page: {\r\n                padding: 80\r\n            },\r\n            text: {\r\n                fontFamily: \"Crimson Text\",\r\n                width: \"100%\",\r\n                fontSize: \"12pt\",\r\n                paddingBottom: 8,\r\n            },\r\n            heading: {\r\n                fontFamily: \"Crimson Text\",\r\n                textDecoration: \"underline\",\r\n                fontWeight: 800,\r\n                width: \"100%\",\r\n                fontSize: \"12pt\"\r\n            }\r\n        })\r\n\r\n        const document = (\r\n            <Document>\r\n                <Page style={styles.page}>\r\n                    {markdown.split('\\n').map(line => {                        \r\n                        if (line.startsWith('##')) { // markdown heading\r\n                            line = line.substring('##'.length)\r\n                            return <PdfText style={styles.heading}>{line}</PdfText>\r\n                        }\r\n\r\n                        return <PdfText style={styles.text}>{line}</PdfText>\r\n                        }\r\n                    )}\r\n                </Page>\r\n            </Document>\r\n        )\r\n        return pdf(document).toBlob()\r\n    }\r\n\r\n    getArgumentMarkdown() {\r\n        var output = this.getArgumentHTML()\r\n        \r\n        var tagReplacements = [\r\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\r\n\r\n            {regex: /<p>/g},\r\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\r\n            {regex: /<div>/g},\r\n            {regex: /<\\/div>/g},\r\n            {regex: /<span>/g},\r\n            {regex: /<\\/span>/g},\r\n            {regex: /<h2>/g, replace: \"## \"},\r\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\r\n        ]\r\n        tagReplacements.forEach((replacement) => {\r\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\r\n        })\r\n\r\n        // unescape HTML entities, eg replace '&amp' with '&'\r\n        var element = document.createElement(\"span\")\r\n        element.innerHTML = output\r\n        output = element.innerText\r\n\r\n        return output\r\n    }\r\n\r\n    finishCondition() {\r\n        window.onbeforeunload = undefined // remove the warning about closing the tab\r\n        window.clearInterval(this.intervalLogger)\r\n    }\r\n\r\n    getEditor() {\r\n        return this.editor_ref.current;\r\n    }\r\n\r\n    getNodeId() {\r\n        this.node_id_counter++;\r\n        return this.node_id_counter;\r\n    }\r\n\r\n    canAddLinkAtSelection() {\r\n        const value = this.getEditor().value;\r\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\r\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\r\n        return !is_in_linked_block && !is_in_linked_inline;\r\n    }\r\n\r\n    addLinkAtSelection(id, graph_node) {\r\n        this.getEditor().wrapLinkAtSelection(id);\r\n        this.addGraphMapping(id, graph_node);\r\n    }\r\n\r\n    addGraphMapping(id, graph_node) {\r\n        graph_node.setIsOnGraph(true);\r\n        this.map[id] = { graph_node: graph_node };\r\n    }\r\n\r\n    setLinkMapping(id, doc_node, long_or_short) {\r\n        if (!this.map[id]) {\r\n            // uh oh, this should exist\r\n            this.map[id] = {}\r\n\r\n            // maybe the mapping was deleted and re-added with ctrl-Z\r\n            // if so, hopefully it's stored as recently deleted\r\n            this.checkRecycleBinForGraphNode(id)\r\n        }\r\n\r\n        if (this.map[id].doc_nodes === undefined) {\r\n            this.map[id].doc_nodes = {};\r\n        }\r\n        this.map[id].doc_nodes[long_or_short] = doc_node;\r\n    }\r\n\r\n    getGraphNodeAndDocNode(id) {\r\n        return this.map[id];\r\n    }\r\n\r\n    checkRecycleBinForGraphNode(id) {\r\n        if (!this.map[id]) {\r\n            this.map[id] = {}\r\n        }\r\n\r\n        if (this.map[id].graph_node) {\r\n            // no need to restore\r\n            return;\r\n        }\r\n\r\n        const prev_version = this.map_recycle_bin[id]\r\n        if (prev_version && prev_version.graph_node) {\r\n            console.log('restored from recycle');\r\n            \r\n            this.addGraphMapping(id, prev_version.graph_node)\r\n        }\r\n    }\r\n\r\n    getGraphNode(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.graph_node;\r\n        }\r\n    }\r\n\r\n    removeGraphNode(id) {\r\n        if (this.getDocNodes(id)) {\r\n            Object.values(this.getDocNodes(id)).forEach(node => {\r\n                this.getEditor().removeGraphLink(node);\r\n            })\r\n            this.map[id] = undefined;\r\n        }\r\n    }\r\n\r\n    removeDocNode(id) {\r\n        var map = this.getGraphNodeAndDocNode(id)\r\n        if (map) {\r\n            if (map.graph_node) {\r\n                map.graph_node.setIsOnGraph(false);\r\n            }\r\n            \r\n            this.map_recycle_bin[id] = this.map[id]\r\n            this.map[id] = undefined\r\n        }\r\n    }\r\n\r\n    getDocNodes(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.doc_nodes;\r\n        }\r\n    }\r\n\r\n    getDocNodeShortText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.short;\r\n        }\r\n    }\r\n\r\n    getDocNodeLongText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.long;\r\n        }\r\n    }\r\n\r\n    getDocNodeRef(id, long_or_short) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map && map.doc_link_node) {\r\n            return map.doc_link_node[long_or_short].current;\r\n        }\r\n    }\r\n\r\n    getAllDocNodeRefs(id) {\r\n        var docNodes = [];\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\r\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\r\n                    docNodes.push(map.doc_link_node[long_or_short].current)\r\n                }\r\n            })\r\n        }\r\n        return docNodes;\r\n    }\r\n\r\n    registerLinkNode(id, ref, long_or_short) {\r\n        if (this.map[id].doc_link_node === undefined) {\r\n            this.map[id].doc_link_node = {};\r\n        }\r\n        this.map[id].doc_link_node[long_or_short] = ref;\r\n    }\r\n\r\n    // check whether a graph node's doc node still exists\r\n    updateIsOnGraphStatus(id) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        if (!docNode) {\r\n            return false\r\n        }\r\n\r\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\r\n            // tell the graph node that there is no doc node any more, for whatever reason\r\n            this.removeDocNode(id)\r\n            return false\r\n        }\r\n\r\n        return true\r\n    }\r\n\r\n    updateDocShortText(id, newText) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        \r\n        if (docNode) {\r\n            var editor = this.getEditor();\r\n\r\n            if (this.updateIsOnGraphStatus(id)) {\r\n                // replace any text with newText\r\n                docNode.nodes.forEach(child => {\r\n                    editor.removeNodeByKey(child.key);\r\n                });\r\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\r\n            }\r\n        }\r\n    }\r\n\r\n    updateGraphShortText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateShortText(newText);            \r\n        }\r\n    }\r\n\r\n    updateGraphLongText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateLongText(newText);            \r\n        }\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './LoadProject.css'\r\nimport db from '../../db.js'\r\nimport ProjectList from './ProjectsList.js'\r\nimport SharedState from '../../shared_state.js';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class LoadProject extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            projects: []\r\n        };\r\n        this.addProject = this.addProject.bind(this)\r\n        this.deleteProject = this.deleteProject.bind(this)\r\n        this.loadProject = this.loadProject.bind(this)\r\n        this.renameProject = this.renameProject.bind(this)\r\n        this.duplicateProject = this.duplicateProject.bind(this)\r\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\r\n        \r\n        document.title = \"Write Reason\"\r\n\r\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\r\n        if (process.env.NODE_ENV === 'development' && this.props.autoload) {\r\n            this.loadProject(this.props.autoload)\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (process.env.NODE_ENV !== 'development' || !this.props.autoload) {\r\n            this.updateProjectsFromDb()\r\n        }\r\n    }\r\n\r\n    updateProjectsFromDb() {\r\n        // todo - only retrieve relevant rows from projects table?\r\n        db.table('projects')\r\n            .toArray(projects => {\r\n                this.setState({ projects })\r\n            }).catch(err => {\r\n                toast.error(\"Error when loading projects: \" + err)\r\n            })\r\n    }\r\n\r\n    loadProject(id) {\r\n        const params = { condition: 'graph' }\r\n        const sharedState = new SharedState(id, params)\r\n        this.props.transitionToEditor(sharedState)\r\n    }\r\n\r\n    addProject() {\r\n        const project = {name: window.prompt('Name your project', 'New project')}\r\n        if (project.name) {\r\n            db.table('projects')\r\n                .add(project)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                });\r\n        }\r\n    }\r\n\r\n    renameProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                const newName = window.prompt('Set a new project name', project.name)\r\n                if (newName) {\r\n                    db.table('projects')\r\n                        .update(id, { name: newName })\r\n                        .then(() => {\r\n                            this.updateProjectsFromDb()\r\n                        })\r\n                }\r\n            });\r\n    }\r\n\r\n    duplicateProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                project.name += ' (copy)'\r\n                delete project.id // set a new one automatically\r\n                db.table('projects')\r\n                    .add(project)\r\n                    .then(() => {\r\n                        this.updateProjectsFromDb()\r\n                    });\r\n            })\r\n    }\r\n\r\n    deleteProject(id) {\r\n        if (window.confirm('Are you sure you want to delete this project? This cannot be undone.')) {\r\n            db.table('projects')\r\n                .delete(id)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                })\r\n        }\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n            <div className=\"load-project\">\r\n                <button className=\"pure-button button-primary\" onClick={this.addProject}>New project</button>\r\n                <div className=\"load-project-table\">\r\n                    {this.state.projects && this.state.projects.length > 0 && <ProjectList projects={this.state.projects}\r\n                        deleteProject={this.deleteProject}\r\n                        loadProject={this.loadProject}\r\n                        renameProject={this.renameProject}\r\n                        duplicateProject={this.duplicateProject}\r\n                    />}\r\n                </div>\r\n            </div>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react';\r\nimport './ExperimentalControls.css';\r\n\r\nexport default class ExperimentControls extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"experiment-controls\">\r\n                <button onClick={this.props.backToMenu}>Back</button>\r\n                <button onClick={this.props.sharedState.exportPDF}>Export PDF</button>\r\n                <button onClick={this.props.sharedState.save}>Save</button>\r\n            </div>\r\n        );\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport Logo from '../../assets/logo.png'\r\nimport YouTube from 'react-youtube'\r\n\r\nexport default class IntroSection extends Component {\r\n    \r\n    render() {\r\n        return (\r\n            <div className='intro-section'>\r\n                <img src={Logo} className='logo' alt=\"Write Reason\"/>\r\n                <p className='privacy-notice'><b>Privacy notice</b>: This webpage simply downloads the Write Reason application to your browser. Once loaded, \r\n                    everything runs locally in your browser, and no data is sent back to the server automatically.</p>\r\n                <YouTube videoId='W5uo2FBUI7c' opts={{\r\n                    playerVars: {\r\n                        modestbranding: 1,\r\n                    }\r\n                }}/>\r\n            </div>\r\n        );\r\n      }\r\n}","/* eslint-disable no-fallthrough */\r\n/* eslint-disable default-case */\r\nimport React, { Component } from 'react';\r\nimport './App.css';\r\nimport DocPane from './components/doc/DocPane.js';\r\nimport GraphPane from './components/graph/GraphPane.js';\r\nimport SplitPane from 'react-split-pane';\r\nimport LoadProject from './components/loadproject/LoadProject.js';\r\nimport { DndProvider } from 'react-dnd'\r\nimport Backend from 'react-dnd-html5-backend'\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport SaveButton from './components/experiment/SaveButton';\r\nimport IntroSection from './components/loadproject/IntroSection';\r\n\r\n\r\nexport default class App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            phase: \"loadproject\",\r\n            params: undefined\r\n        }\r\n\r\n        this.transitionToEditor = this.transitionToEditor.bind(this)\r\n        this.transitionToMenu = this.transitionToMenu.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getStorageUsed()\r\n    }\r\n\r\n    transitionToEditor(newSharedState) {\r\n        this.setState({ \r\n            sharedState: newSharedState,\r\n            phase: \"editor\"\r\n        })\r\n    }\r\n\r\n    transitionToMenu() {\r\n        if (this.state.sharedState) {\r\n            this.state.sharedState.finishCondition()\r\n        }\r\n        this.setState({\r\n            sharedState: undefined,\r\n            phase: \"loadproject\"\r\n        })\r\n    }\r\n\r\n    getStorageUsed() {\r\n        navigator.storage.estimate().then(estimate => {\r\n            this.setState({ storageUsed: (estimate.usage / estimate.quota * 100).toPrecision(2) })\r\n        });\r\n    }\r\n\r\n    render() {\r\n        switch(this.state.phase) {\r\n            case \"loadproject\":\r\n                return (\r\n                    <>\r\n                        <IntroSection />\r\n                        <LoadProject transitionToEditor={this.transitionToEditor} autoload={false} />\r\n                        {this.state.storageUsed && <footer>Storage used: {this.state.storageUsed}%</footer>}\r\n                    </>\r\n                )\r\n            case \"editor\":\r\n                return (\r\n                    <div className=\"App\">\r\n                        <DndProvider backend={Backend}>\r\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\r\n                                <DocPane sharedState={this.state.sharedState} />\r\n                                <GraphPane sharedState={this.state.sharedState} />\r\n                            </SplitPane>\r\n                            <SaveButton sharedState={this.state.sharedState} backToMenu={this.transitionToMenu} />\r\n                        </DndProvider>\r\n                        <ToastContainer\r\n                            position=\"bottom-center\"\r\n                            autoClose={5000}\r\n                            hideProgressBar\r\n                            newestOnTop={false}\r\n                            closeOnClick\r\n                            rtl={false}\r\n                            pauseOnFocusLoss\r\n                            draggable={false}\r\n                            pauseOnHover\r\n                        />\r\n                    </div>\r\n                );\r\n            \r\n            case \"reset\":\r\n                // hacky way to destroy and recreate all components\r\n                window.setTimeout(() => this.setState({phase: \"editor\"}), 0.1)\r\n                return (\r\n                    <p>...</p>\r\n                )\r\n        }\r\n    }\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}