{"version":3,"sources":["components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","components/loadproject/ProjectsList.js","logging.js","shared_state.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","App.js","serviceWorker.js","index.js"],"names":["OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","div","document","createElement","classList","add","appendChild","this","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","e","remove","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","id","node","insertSectionBlock","text","longText","logger","logEvent","link","Block","create","type","data","node_id","nodes","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","handleMouseUp","clickedNode","resetPos","getGraphNode","value","focus","getParent","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","get","deleteNode","old","new","setNodeByKey","key","newStyle","moveToRangeOfNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","wrapBlockByKey","removeNodeByKey","insertInline","insertText","convertToInline","querySelector","removeDocNode","LinkNode","props","state","hover","externalHover","setHover","bind","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","onContextMenu","Component","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","graphNode","addGraphNode","position","moveTo","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","blockTarget","innerDiv","mouse","getClientOffset","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","onMouseOver","onMouseUp","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","map","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","code","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","moveToStartOfNode","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","getNodesAtRange","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","moveBackward","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","t","n","r","s","o","u","require","a","i","f","Error","l","exports","call","1","module","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","toString","ids","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","keys","Array","isArray","Object","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","show","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","finishEditing","newValue","substring","removeChild","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","selected_option","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","isOnGraph","getNodeId","translate","arrow_hitbox","radius","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","doNotDeleteIfEmptyText","editText","setIsOnGraph","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","blur","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","size","delete_if_empty_text","textarea","screen_coords","display","scrollHeight","save_changes","updateDocShortText","save_and_hide","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","graphPane","$el","panZoom","zoomMin","zoomMax","root_point","doc","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","setAttribute","loadNodesFromJSON","getNodeById","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","el","db","Dexie","version","stores","projects","FilesList","project","onClick","loadProject","renameProject","duplicateProject","deleteProject","Logger","shouldLogToConsole","conditions","logToConsole","JSON","stringify","getLog","events","timestamp","Date","setLog","parse","retrieveLog","localStorage","setItem","getStorageString","msg","Number","SharedState","db_id","onDataLoad","then","doc_value","graph_value","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getEditor","getArgumentMarkdown","downloadExperimentData","save","mapFromJSON","changes","mapToJSON","idExists","info","message","catch","err","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","argument","logs","getExperimentData","file","Blob","href","URL","createObjectURL","download","getExperimentId","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","regex","replacement","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LoadProject","addProject","updateProjectsFromDb","autoload","transitionToEditor","prompt","newName","ExperimentControls","backToMenu","App","phase","transitionToMenu","newSharedState","finishCondition","DndProvider","backend","Backend","defaultSize","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover","Boolean","location","hostname","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.875b720f.chunk.js","sourcesContent":["export default class OptionPopup {\r\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\r\n        var div = document.createElement(\"div\");\r\n        div.classList.add(\"option-popup-div\");\r\n        div.appendChild(this.generateTable(entries, div, callback, selected));\r\n        div.style.left = x + \"px\";\r\n        div.style.top = y + \"px\";\r\n\r\n        if (parent === undefined) {\r\n            parent = document.getElementById(\"graph\");\r\n        }\r\n        parent.appendChild(div);\r\n\r\n        // prevent the popup from showing up partially offscreen\r\n        const rect = div.getBoundingClientRect()\r\n        if (rect.right > window.innerWidth) {\r\n            div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\r\n        }\r\n        if (rect.bottom > window.innerHeight) {\r\n            div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\r\n        }\r\n\r\n        if (shouldHideOnClickOutside) {\r\n            setTimeout(() => this.hideOnClickOutside(div), 0.01);\r\n        }\r\n    }\r\n\r\n    generateTable(entries, div, callback, selected) {\r\n        var table = document.createElement(\"table\");\r\n        entries.forEach(entry => {\r\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\r\n\r\n            var row = table.insertRow();\r\n            row.classList.add(\"option-row\");\r\n            if (entry.name === selected) {\r\n                row.classList.add(\"option-row-selected\");\r\n            }\r\n\r\n            const selectItem = (e) => {\r\n                if (entry.isClickable) {                    \r\n                    callback(entry);\r\n                    div.remove();\r\n                }\r\n            }\r\n\r\n            var colourCell = row.insertCell();\r\n            colourCell.textContent = entry.symbol;\r\n            colourCell.style.color = entry.colour;\r\n            colourCell.style.fontSize = \"150%\";\r\n            colourCell.style.padding = '10px'\r\n            \r\n            var nameCell = row.insertCell();\r\n            nameCell.classList.add('option-cell')\r\n            nameCell.textContent = entry.name\r\n\r\n            colourCell.addEventListener('click', selectItem)\r\n            nameCell.addEventListener('click', selectItem)\r\n\r\n            if (entry.buttons) {\r\n                entry.buttons.forEach(buttonEntry => {\r\n                    var buttonCell = row.insertCell()\r\n                    var button = document.createElement('BUTTON')\r\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\r\n                    button.className = \"pure-button\"\r\n                    button.style.padding = \"0px 10px 0px 10px\"\r\n                    buttonCell.appendChild(button)\r\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \r\n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row})\r\n                })\r\n            }\r\n        });\r\n\r\n        return table;\r\n    }\r\n\r\n    hideOnClickOutside(element) {\r\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\r\n\r\n        const outsideClickListener = event => {\r\n            if (!element.contains(event.target) && isVisible(element)) {\r\n              element.remove();\r\n              removeClickListener()\r\n            }\r\n        }\r\n    \r\n        const removeClickListener = () => {\r\n            document.removeEventListener('click', outsideClickListener)\r\n        }\r\n    \r\n        document.addEventListener('click', outsideClickListener)\r\n        document.addEventListener('contextmenu', outsideClickListener)\r\n    }\r\n}","import { Block, Text } from 'slate';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default function GraphPlugin(options) {\r\n    return {\r\n        onMouseUp(event, editor, next) {\r\n            var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n            if (draggedNode) {\r\n                draggedNode.resetPos();\r\n\r\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n                    toast.error('You can\\'t add the same node twice!')\r\n                    console.log('Duplicate - editor')\r\n                } else {\r\n                    const target = editor.findEventRange(event)\r\n                    if (target) {\r\n                        editor.select(target)\r\n\r\n                        // prevent insertion inside an inline link\r\n                        // (insertion inside a section is fixed by schema)\r\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\r\n                        if (linkNode) {\r\n                            editor.moveToEndOfNode(linkNode)\r\n                        }\r\n\r\n                        addSection(draggedNode, editor)\r\n                    }\r\n                }\r\n            }\r\n            next();\r\n        },\r\n        \r\n        onBlur(event, editor, next) {\r\n            editor.deselect();\r\n            next();\r\n        },\r\n\r\n        commands: {\r\n            removeGraphLink(editor, node) {\r\n                const document = editor.value.document\r\n                if (!document.hasNode(node.key)) {\r\n                    console.log('couldnt remove graph link, node doesnt exist');\r\n                    \r\n                    return\r\n                }\r\n\r\n                if (node.type === \"section\") {\r\n                    // move the children out from inside this section to be after it\r\n                    const section_index = editor.value.document.nodes.indexOf(node)\r\n                    if (section_index !== -1) {\r\n                        var child_index = 0;\r\n                        node.nodes.forEach(child => {\r\n                            if (!document.hasNode(child.key)) {\r\n                                return\r\n                            }\r\n\r\n                            const nodeStyle = node.data.get(\"nodeStyle\")\r\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\r\n                                editor.removeNodeByKey(child.key)\r\n                            } else {\r\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + child_index + 1)\r\n                            }\r\n                            child_index ++\r\n                        });\r\n                    }\r\n                    editor.removeNodeByKey(node.key)\r\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \r\n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\r\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\r\n\r\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\r\n\r\n    editor.getSharedState().logger.logEvent({\r\n        'type': 'doc_create_from_node', \r\n        'node_id': draggedNode.id, \r\n        'short_text': draggedNode.text, \r\n        'long_text': draggedNode.longText\r\n    });\r\n}\r\n\r\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\r\n    var link = Block.create({\r\n        type: 'link',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: text})]\r\n    })\r\n\r\n    var body = Block.create({\r\n        type: 'body',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: longText})]\r\n    })\r\n\r\n    var section = Block.create({\r\n        type: 'section',\r\n        data: {node_id: id, nodeStyle: initialNodeStyle},\r\n        nodes: [link, body]\r\n    })    \r\n    \r\n    editor.insertBlock(section);\r\n    editor.moveToEndOfNode(section)\r\n\r\n    return section\r\n}\r\n\r\nexport function handleMouseUp(editor, clickedNode) {\r\n    var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n    if (draggedNode) {\r\n        draggedNode.resetPos();\r\n\r\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n            toast.error('You can\\'t add the same node twice!')\r\n            console.log('Duplicate - node');\r\n            \r\n        } else {\r\n            const { value } = editor\r\n            const { document } = value\r\n            editor.focus()\r\n\r\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\r\n                clickedNode = document.getParent(clickedNode);\r\n            }\r\n\r\n            editor.moveToEndOfNode(clickedNode);\r\n\r\n            addSection(draggedNode, editor);\r\n\r\n            editor.getSharedState().draggedNode = false;\r\n            return true;\r\n        }\r\n    }\r\n}","import { Block } from 'slate';\r\nimport OptionPopup from '../graph/OptionPopup.js'\r\nimport { insertSectionBlock } from './GraphPlugin.js';\r\n\r\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\r\n    var entries = [\r\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"⌶\"},\r\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"▤\"},\r\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"▔\"},\r\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"▂\"},\r\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n    ]\r\n\r\n    if (entriesToHide) {\r\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    const onOptionSelect = (selectedEntry) => {\r\n        const selected = selectedEntry.name\r\n        if (selected === \"Delete\") {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_delete\",\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n            deleteNode(node, editor);\r\n        } else {\r\n            var nodeStyle = node.data.get(\"nodeStyle\")\r\n            if (!nodeStyle) {\r\n                nodeStyle = \"Inline\"\r\n            }\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_change_format\",\r\n                old: nodeStyle,\r\n                new: selected,\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n\r\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\r\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\r\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\r\n                convertFromInline(node, editor, selected)\r\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\r\n                convertToInline(node, editor, selected)\r\n            }\r\n        }\r\n    }\r\n\r\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\r\n}\r\n\r\nexport function deleteNode(node, editor) {\r\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\r\n\r\n    editor.removeNodeByKey(node.key)\r\n}\r\n\r\nfunction convertFromInline(node, editor, newStyle) {\r\n    editor.moveToRangeOfNode(node);\r\n    const parent = editor.value.document.getParent(node.key)\r\n    if (parent && parent.text === node.text) {\r\n        editor.moveToRangeOfNode(parent)\r\n    }\r\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, \"\", newStyle)    \r\n}\r\n\r\nfunction convertToInline(node, editor) {\r\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\r\n    // need to get 0th child because previous of section is the body inside it\r\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\r\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\r\n\r\n    const getEmptyParagraph = () => Block.create({\r\n        type: 'paragraph'\r\n    })\r\n\r\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\r\n    if (!prev && !next) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n\r\n    editor.moveToRangeOfNode(node)\r\n\r\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\r\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\r\n        editor.wrapBlockByKey(node.key, \"paragraph\")\r\n        editor.removeNodeByKey(node.key)\r\n    } else {\r\n        editor.removeNodeByKey(node.key)\r\n    }\r\n\r\n    editor.insertInline({\r\n            type: \"link\",\r\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\r\n        })\r\n        .insertText(shortText)\r\n}\r\n\r\nexport const getNodeStyleClass = (verbose) => {\r\n    switch (verbose) {\r\n        case \"Heading only\":\r\n            return \" hide-body\"\r\n\r\n        case \"Body only\":\r\n            return \" hide-heading\"\r\n    \r\n        default:\r\n            return \"\";\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport { showNodeSwitchMenu } from '../NodeSwitch';\r\n\r\nclass LinkNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        \r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_cursor\", cursorInside)\r\n        }\r\n        \r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"node-link\" + hoverClass;\r\n\r\n        if (this.props.linkStyle === \"heading\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    <u><b>{this.props.children}</b></u>\r\n                </p>\r\n            );\r\n\r\n        } else if (this.props.linkStyle === \"inline\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}\r\n                        onMouseEnter={() => this.setHover(true)} \r\n                        onMouseLeave={() => this.setHover(false)}\r\n                        onContextMenu={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nexport default LinkNode;","import React, { Component } from 'react';\r\n\r\nexport default class BodyNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n        this.selectNode = props.selectNode;\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\r\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\r\n\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"body_cursor\", cursorInside);\r\n            node.setHoverer(\"body_mouse\", this.state.hover);\r\n        }\r\n\r\n        if (this.props.isEmpty) {\r\n                return (\r\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\r\n                        Type some text...{this.props.children}\r\n                    </p>\r\n                );\r\n        } else {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","export const ItemTypes = {\r\n    BLOCK: \"block\",\r\n}","import { DragSource } from 'react-dnd';\r\nimport { ItemTypes } from '../../dragtypes';\r\nimport { addSection } from './GraphPlugin.js'\r\n\r\nconst blockSource = {\r\n    canDrag(props) {\r\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\r\n        return props.editor.value.selection.isCollapsed\r\n    },\r\n\r\n    beginDrag(props) {\r\n      // Return the data describing the dragged item\r\n      const item = { id: props.node.id, node: props.node }\r\n      return item\r\n    },\r\n\r\n    endDrag(props, monitor, component) {\r\n        if (!monitor.didDrop()) {            \r\n            return\r\n        }\r\n\r\n        const dropResult = monitor.getDropResult()\r\n        const sharedState = props.editor.getSharedState()\r\n\r\n        if (dropResult.droppedOnGraph) {\r\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\r\n            const draggedNode = {\r\n                id: graphNode.id,\r\n                node: graphNode,\r\n                text: \"\",\r\n                longText: props.node.text\r\n            }\r\n            props.editor.moveTo(props.node.key)\r\n            \r\n            addSection(draggedNode, props.editor, \"Body only\")\r\n            props.editor.removeNodeByKey(props.node.key)\r\n        } else {\r\n            const document = props.editor.value.document;\r\n            const blockParent = document.getParent(props.node.key);\r\n            const blockIndex = blockParent.nodes.indexOf(props.node);\r\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\r\n\r\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\r\n\r\n            sharedState.logger.logEvent({\r\n                'type': 'reorder',\r\n                'id': props.node.data.get('node_id'),\r\n                'old_index': blockIndex,\r\n                'new_index': dropResult.indexDroppedOn + indexShift,\r\n            });\r\n        }\r\n    },\r\n  }\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDragSource: connect.dragSource(),\r\n        dragPreview: connect.dragPreview(),\r\n        isDragging: monitor.isDragging(),\r\n    }\r\n}\r\n\r\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\r\nimport { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst blockTarget = {\r\n    hover(props, monitor, component) {\r\n        const mouse = monitor.getClientOffset();\r\n\r\n        // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\r\n        const outerDiv = ReactDOM.findDOMNode(component)        \r\n        const outerRect = outerDiv.getBoundingClientRect()\r\n        \r\n        var innerDiv;\r\n        for (let item of outerDiv.children) {\r\n            if (item.classList.contains('plain-block') || item.classList.contains('section')) {\r\n                innerDiv = item;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!innerDiv) {\r\n            console.log('error: couldn\\'t find the inner div!');\r\n            return\r\n        }\r\n        const innerRect = innerDiv.getBoundingClientRect()       \r\n    \r\n        // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\r\n        const offset = (innerRect.y - outerRect.y)\r\n        var newState = false\r\n        if (mouse.y + offset > (innerRect.y + innerRect.height / 2)) {\r\n            newState = true\r\n        }\r\n        if (component.state.overHalf !== newState) {\r\n            component.setState({overHalf: newState});\r\n        }\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        const document = props.editor.value.document;\r\n        const blockParent = document.getParent(props.node.key);\r\n        const blockIndex = blockParent.nodes.indexOf(props.node);\r\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        isOver: monitor.isOver(),\r\n        isOverCurrent: monitor.isOver({ shallow: true }),\r\n        canDrop: monitor.canDrop(),\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\nimport { showNodeSwitchMenu, getNodeStyleClass } from '../NodeSwitch';\r\n\r\nclass SectionNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"section_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\r\n\r\n        const value = this.props.editor.value\r\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\r\n\r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\r\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\r\n        \r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}}\r\n                        onContextMenu={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}\r\n                        ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(SectionNode))","\r\nimport { getEventTransfer } from 'slate-react';\r\n\r\nexport default function LoggingPlugin(options) {\r\n    return {\r\n        onCopy(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"copy\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onCut(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"cut\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            var transfer = getEventTransfer(event);\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"paste\",\r\n                paste_type: transfer.type,\r\n                content: transfer.fragment ? transfer.fragment.text : \"\",\r\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\r\n            });\r\n            \r\n            next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\n\r\nclass PlainBlockNode extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            hover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\r\n\r\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)}\r\n                        ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\r\nimport { cx, css } from 'emotion'\r\n\r\nexport const Button = React.forwardRef(\r\n  ({ className, active, reversed, ...props }, ref) => (\r\n    <span\r\n      {...props}\r\n      ref={ref}\r\n      className={cx(\r\n        className,\r\n        css`\r\n          cursor: pointer;\r\n          color: ${reversed\r\n            ? active ? 'white' : '#aaa'\r\n            : active ? 'black' : '#ccc'};\r\n        `\r\n      )}\r\n    />\r\n  )\r\n)\r\n\r\nexport const EditorValue = React.forwardRef(\r\n  ({ className, value, ...props }, ref) => {\r\n    const textLines = value.document.nodes\r\n      .map(node => node.text)\r\n      .toArray()\r\n      .join('\\n')\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        {...props}\r\n        className={cx(\r\n          className,\r\n          css`\r\n            margin: 30px -20px 0;\r\n          `\r\n        )}\r\n      >\r\n        <div\r\n          className={css`\r\n            font-size: 14px;\r\n            padding: 5px 20px;\r\n            color: #404040;\r\n            border-top: 2px solid #eeeeee;\r\n            background: #f8f8f8;\r\n          `}\r\n        >\r\n          Slate's value as text\r\n        </div>\r\n        <div\r\n          className={css`\r\n            color: #404040;\r\n            font: 12px monospace;\r\n            white-space: pre-wrap;\r\n            padding: 10px 20px;\r\n            div {\r\n              margin: 0 0 0.5em;\r\n            }\r\n          `}\r\n        >\r\n          {textLines}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\n\r\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\r\n  <span\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      'material-icons',\r\n      className,\r\n      css`\r\n        font-size: 18px;\r\n        vertical-align: text-bottom;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        white-space: pre-wrap;\r\n        margin: 0 -20px 10px;\r\n        padding: 10px 20px;\r\n        font-size: 14px;\r\n        background: #f8f8e8;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        & > * {\r\n          display: inline-block;\r\n        }\r\n\r\n        & > * + * {\r\n          margin-left: 15px;\r\n        }\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\r\n  <Menu\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        position: relative;\r\n        padding: 1px 18px 17px;\r\n        margin: 0 -20px;\r\n        border-bottom: 2px solid #eee;\r\n        margin-bottom: 20px;\r\n      `\r\n    )}\r\n  />\r\n))","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { css } from 'emotion'\r\nimport { Button, Icon, Menu } from './SlateComponents.js'\r\n\r\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\r\n\r\nconst MarkButton = ({ editor, type, icon }) => {\r\n  const { value } = editor\r\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\r\n  return (\r\n    <Button\r\n      reversed\r\n      active={isActive}\r\n      onMouseDown={event => {\r\n        event.preventDefault()\r\n        editor.setBlocks((isActive ? \"paragraph\" : type))\r\n\r\n        editor.getSharedState().logger.logEvent({\r\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\r\n      });\r\n      }}\r\n    >\r\n      <Icon>{icon}</Icon>\r\n    </Button>\r\n  )\r\n}\r\n\r\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\r\n  const root = window.document.getElementById('root')\r\n  return ReactDOM.createPortal(\r\n    <Menu\r\n      ref={ref}\r\n      className={css`\r\n        padding: 8px 7px 6px;\r\n        position: absolute;\r\n        z-index: 1;\r\n        top: -10000px;\r\n        left: -10000px;\r\n        margin-top: -6px;\r\n        opacity: 0;\r\n        background-color: #222;\r\n        border-radius: 4px;\r\n        transition: opacity 0.25s;\r\n      `}\r\n    >\r\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\r\n    </Menu>,\r\n    root\r\n  )\r\n})\r\n\r\n\r\nclass HoveringMenu extends React.Component {\r\n\r\n  menuRef = React.createRef()\r\n\r\n  componentDidMount = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  componentDidUpdate = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  updateMenu = () => {\r\n    const menu = this.menuRef.current\r\n    if (!menu) return\r\n\r\n    const value = this.props.editor.value\r\n    const { fragment, selection } = value\r\n\r\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\r\n      menu.removeAttribute('style')\r\n      return\r\n    }\r\n\r\n    const native = window.getSelection()\r\n    const range = native.getRangeAt(0)\r\n    const rect = range.getBoundingClientRect()\r\n    menu.style.opacity = 1\r\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\r\n\r\n    menu.style.left = `${rect.left +\r\n      window.pageXOffset -\r\n      menu.offsetWidth / 2 +\r\n      rect.width / 2}px`\r\n  }\r\n\r\n  render = (props, editor, next) => {\r\n    return (\r\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default function HoveringMenuPlugin(options) {\r\n    return {\r\n        renderEditor (props, editor, next) {\r\n            const children = next()\r\n            return (\r\n              <React.Fragment>\r\n                {children}\r\n                <HoveringMenu editor={editor} />\r\n              </React.Fragment>\r\n            )\r\n          },\r\n\r\n        renderBlock (props, editor, next) {\r\n            switch (props.node.type) {\r\n            case 'heading':\r\n                return <u><b>{props.children}</b></u>\r\n            default:\r\n                return next()\r\n            }\r\n        },\r\n    }\r\n}","import { Block, Text } from 'slate';\r\n\r\nexport const schema = {\r\n    inlines: {\r\n        link: {\r\n            parent: [{type: ''}, {type: 'paragraph'}],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'parent_type_invalid':\r\n                        editor.unwrapInlineByKey(error.node.key)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled link inline err \" + error);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    blocks: {\r\n        section: {\r\n            parent: {object: \"document\"},\r\n            nodes: [\r\n                {\r\n                    match: {type: 'link'},\r\n                    min: 1,\r\n                    max: 1,\r\n                },\r\n                {\r\n                    match: {type: 'body'},\r\n                    min: 1,\r\n                    max: 1,\r\n                }\r\n            ],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'child_max_invalid':\r\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \r\n                        // this can happen if the enter key is pressed (splits the current node)\r\n                        moveBlockAfterSection(editor, error.child, error.node)\r\n                        editor.setNodeByKey(error.child.key, 'paragraph')\r\n                        return\r\n\r\n                    case 'child_type_invalid':\r\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \r\n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\r\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\r\n                            if (linkNode) {\r\n                                const textNode = linkNode.getLastText()\r\n                                const offset = textNode.text ? textNode.text.length : 0\r\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\r\n                            } else {\r\n                                addMissing(editor, error, \"link\", error.child.text)\r\n                            }\r\n                        }\r\n\r\n                        editor.removeNodeByKey(error.child.key)\r\n                        \r\n                        return\r\n                    \r\n                    case 'child_min_invalid':\r\n                        var hasChildTypes = [];\r\n                        error.node.nodes.forEach(node => {\r\n                            hasChildTypes.push(node.type)\r\n                        })\r\n                        \r\n                        if (!hasChildTypes.includes(\"link\")) {\r\n                            addMissing(editor, error, \"link\")\r\n                        }\r\n\r\n                        if (!hasChildTypes.includes(\"body\")) {\r\n                            addMissing(editor, error, \"body\")\r\n                        }\r\n\r\n                        return\r\n                    \r\n                    case 'parent_object_invalid':\r\n                        // a section has ended up inside another section - shift it out\r\n                        moveBlockAfterSection(editor, error.node, error.parent)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled section schema err \" + error);\r\n                        \r\n                        return\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\r\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\r\n    if (sectionIndex === -1) {\r\n        return\r\n    }\r\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\r\n}\r\n\r\nfunction addMissing(editor, error, nodeType, text=\"\") {\r\n    const node_id = error.node.data.get(\"node_id\")\r\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\r\n    if (!text) {\r\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\r\n    }\r\n    const index = nodeType === \"link\" ? 0 : 1\r\n\r\n    addBlock(editor, error.node, nodeType, index, node_id, text)\r\n}\r\n\r\nfunction addBlock(editor, parent, nodeType, index, id, text) {\r\n    var block = Block.create({\r\n        type: nodeType,\r\n        data: {node_id: id},\r\n        nodes: [Text.create({'text': text})]\r\n    })\r\n    editor.insertNodeByKey(parent.key, index, block);\r\n    \r\n}","import React from 'react';\r\nimport { Editor } from 'slate-react';\r\nimport { Value } from 'slate';\r\nimport NodePlugin from './NodePlugin.js';\r\nimport GraphPlugin from './GraphPlugin.js';\r\nimport LoggingPlugin from './LoggingPlugin.js';\r\nimport ReorderPlugin from './ReorderPlugin.js';\r\nimport HoveringMenu from './HoveringMenu.js';\r\nimport { schema } from './Schema.js'\r\n\r\nconst plugins = {\r\n    'graph': [\r\n        LoggingPlugin(),\r\n        GraphPlugin(),\r\n        NodePlugin(),\r\n        ReorderPlugin(),\r\n    ],\r\n    'plain': [\r\n        LoggingPlugin(),\r\n        HoveringMenu(),\r\n    ]\r\n};\r\n\r\nconst emptyValue = Value.fromJSON({\r\n    document: {\r\n        nodes: [\r\n            {\r\n                object: 'block',\r\n                type: 'paragraph',\r\n                nodes: [\r\n                    {\r\n                        object: 'text',\r\n                        text: '',\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n    },\r\n});\r\n\r\nclass DocEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.props.sharedState.editor_ref = React.createRef();\r\n    }\r\n\r\n    componentDidMount() {\r\n        const sharedState = this.props.sharedState\r\n        sharedState.getSavedDocValue((savedValue) => {\r\n            this.setState({\r\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\r\n            }, sharedState.editorHasLoaded)\r\n        })\r\n    }\r\n\r\n    state = {\r\n        value: undefined, // don't display editor until the db's saved document loads\r\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\r\n    }\r\n    \r\n    queries = {\r\n        getSharedState: () => {\r\n            return this.props.sharedState;\r\n        },\r\n        getValue: () => {\r\n            return this.state.value;\r\n        },\r\n        mapHasLoaded: () => {\r\n            this.setState({ mapHasLoaded: true })\r\n        }\r\n    }\r\n\r\n    onChange = ({ value }) => {\r\n        this.setState({ value })\r\n    }\r\n\r\n    render() {\r\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\r\n\r\n        if (this.state.value !== undefined) {\r\n            return <Editor\r\n                className={\"slate-editor\" + plainClass}\r\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\r\n                ref={this.props.sharedState.editor_ref}\r\n                schema={schema}\r\n                plugins={plugins[this.props.sharedState.condition]}\r\n                queries={this.queries}\r\n                value={this.state.value}\r\n                onChange={this.onChange}\r\n                placeholder=\"Write your document here...\"\r\n                spellCheck={false}\r\n            />\r\n        } else {\r\n            return <p></p>\r\n        }\r\n    }\r\n}\r\n\r\nexport default DocEditor;","import SVG from 'svg.js';\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\n(function e(t, n, r) {\r\n    function s(o, u) {\r\n        if (!n[o]) {\r\n            if (!t[o]) {\r\n                // eslint-disable-next-line no-sequences\r\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\r\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\r\n                var n = t[o][1][e];return s(n ? n : e);\r\n            }, l, l.exports, e, t, n, r);\r\n        }return n[o].exports;\r\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\r\n        s(r[o]);\r\n    }return s;\r\n})({ 1: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Id = require(\"idy\"),\r\n            SetOrGet = require(\"set-or-get\"),\r\n            IterateObject = require(\"iterate-object\"),\r\n            Deffy = require(\"deffy\");\r\n\r\n        // Internal cache\r\n        var _connections = {},\r\n            _betweenTwoBubbles = {},\r\n            container = null,\r\n            markers = null;\r\n\r\n        function delete_connectable(con) {\r\n            con.line.remove();\r\n            con.marker.remove();\r\n\r\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\r\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\r\n\r\n            var toString = function() {\r\n                var ids = [con.source.id(), con.target.id()],\r\n                    id1 = ids.join(\"->\"),\r\n                    id2 = ids.reverse().join(\"->\");\r\n\r\n                con._ = con.id = id1;\r\n\r\n                if (_betweenTwoBubbles[id2]) {\r\n                    con._ = id2;\r\n                    return id2;\r\n                }\r\n\r\n                con.id = id1;\r\n                return id1;\r\n            }\r\n\r\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\r\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\r\n        }\r\n\r\n        /**\r\n         * connectable\r\n         * Connects two elements.\r\n         *\r\n         * @name connectable\r\n         * @function\r\n         * @param {Object} options An object containing the following fields:\r\n         *\r\n         *  - `container` (SVGElement): The line elements container.\r\n         *  - `markers` (SVGElement): The marker elements container.\r\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\r\n         *\r\n         * @param {SVGElement} elmTarget The target SVG element.\r\n         * @return {Object} The connectable object containing:\r\n         *\r\n         *  - `source` (SVGElement): The source element.\r\n         *  - `target` (SVGElement): The target element.\r\n         *  - `line` (SVGElement): The line element.\r\n         *  - `marker` (SVGElement): The marker element.\r\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\r\n         *  - [`update` (Function)](#update)\r\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\r\n         */\r\n        function connectable(options, elmTarget) {\r\n\r\n            var con = {};\r\n\r\n            if (elmTarget === undefined) {\r\n                elmTarget = options;\r\n                options = {};\r\n            }\r\n\r\n            container = options.container || container;\r\n            var elmSource = this;\r\n            markers = options.markers || markers;\r\n\r\n            options.k = options.k || 100;\r\n            options.kk = options.kk || 10;\r\n\r\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\r\n                markerId = \"triangle-\" + Id(),\r\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\r\n            \r\n            if (options.specialCoords) {\r\n                line.addClass('connector-line');\r\n            }\r\n\r\n            marker.attr({\r\n                id: markerId,\r\n                viewBox: \"0 0 10 10\",\r\n                refX: \"0\",\r\n                refY: \"5\",\r\n                markerUnits: \"strokeWidth\",\r\n                markerWidth: \"4\",\r\n                markerHeight: \"5\"\r\n            });\r\n\r\n            marker.path().attr({\r\n                d: \"M 0 0 L 10 5 L 0 10 z\"\r\n            });\r\n\r\n            // Append the SVG elements\r\n            con.source = elmSource;\r\n            con.target = elmTarget;\r\n            con.line = line;\r\n            con.marker = marker;\r\n\r\n\r\n            if (options.specialCoords) {\r\n                // remove this when node is deleted\r\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\r\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\r\n            }\r\n\r\n            SetOrGet(_connections, con.source.id(), []).push(con);\r\n            SetOrGet(_connections, con.target.id(), []).push(con);\r\n\r\n            SetOrGet(_betweenTwoBubbles, {\r\n                toString: function toString() {\r\n                    var ids = [con.source.id(), con.target.id()],\r\n                        id1 = ids.join(\"->\"),\r\n                        id2 = ids.reverse().join(\"->\");\r\n\r\n                    con._ = con.id = id1;\r\n\r\n                    if (_betweenTwoBubbles[id2]) {\r\n                        con._ = id2;\r\n                        return id2;\r\n                    }\r\n\r\n                    con.id = id1;\r\n                    return id1;\r\n                }\r\n            }, []).push(con);\r\n            \r\n\r\n            /**\r\n             * computeLineCoordinates\r\n             * The function that computes the new coordinates.\r\n             * It can be overriden with a custom function.\r\n             *\r\n             * @name computeLineCoordinates\r\n             * @function\r\n             * @param {Connectable} con The connectable instance.\r\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\r\n             */\r\n            con.computeLineCoordinates = function (cons) {\r\n\r\n                var output = [],\r\n                    l = cons.length;\r\n\r\n                IterateObject(cons, function (con, i) {\r\n\r\n                    var sT = con.source.transform(),\r\n                        tT = con.target.transform(),\r\n                        sB = con.source.bbox(),\r\n                        tB = con.target.bbox(),\r\n                        x1 = sT.x + sB.width / 2,\r\n                        y1 = sT.y + sB.height / 2,\r\n                        x2 = tT.x + tB.width / 2,\r\n                        y2 = tT.y + tB.height / 2,\r\n                        cx = (x1 + x2) / 2,\r\n                        cy = (y1 + y2) / 2,\r\n                        dx = Math.abs((x1 - x2) / 2),\r\n                        dy = Math.abs((y1 - y2) / 2),\r\n                        dd = null,\r\n                        out = {\r\n                        x1: x1,\r\n                        y1: y1,\r\n                        x2: x2,\r\n                        y2: y2,\r\n                        ex: x1,\r\n                        ey: y1\r\n                    };\r\n\r\n                    if (i !== (l - 1) / 2) {\r\n                        dd = Math.sqrt(dx * dx + dy * dy);\r\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                    }\r\n                    output.push(out);\r\n                });\r\n\r\n                return output;\r\n            };\r\n\r\n            if (options.specialCoords) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var sT = con.source.transform(),\r\n                            tT = con.target.transform(),\r\n                            sB = con.source.bbox(),\r\n                            tB = con.target.bbox(),\r\n                            x1 = sT.x + sB.width / 2,\r\n                            y1 = sT.y + sB.height / 2 - 20;\r\n\r\n                        var xDiff = sT.x - tT.x;\r\n                        var yDiff = sT.y - tT.y;\r\n                        var x2, y2;\r\n                        if (Math.abs(xDiff) > Math.abs(yDiff)) {\r\n                            y2 = tT.y + tB.height / 2 - 20;\r\n                            if (xDiff < 0) {\r\n                                x2 = tT.x - 10;\r\n                            } else {\r\n                                x2 = tT.x + tB.width - 30;\r\n                            }\r\n                        } else {\r\n                            x2 = tT.x + tB.width / 2 - 20;\r\n                            if (yDiff < 0) {\r\n                                y2 = tT.y - 10;\r\n                            } else {\r\n                                y2 = tT.y + tB.height - 30;\r\n                            }\r\n                        }\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dx = Math.abs((x1 - x2) / 2),\r\n                            dy = Math.abs((y1 - y2) / 2),\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (i !== (l - 1) / 2) {\r\n                            dd = Math.sqrt(dx * dx + dy * dy);\r\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                        }\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            if (options.padEllipse) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\r\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\r\n                            xR1,\r\n                            xR2,\r\n                            yR1,\r\n                            yR2,\r\n                            sT = con.source.transform(),\r\n                            tT = con.target.transform()\r\n\r\n                        if (elmS.tagName === \"circle\") {\r\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\r\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\r\n                        } else {\r\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\r\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\r\n\r\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\r\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\r\n                        }\r\n\r\n                        // Get centers\r\n                        var sx = sT.x + xR1 / 2,\r\n                            sy = sT.y + yR1 / 2,\r\n                            tx = tT.x + xR2 / 2,\r\n                            ty = tT.y + yR2 / 2\r\n\r\n                        // Calculate distance from source center to target center\r\n                        ,\r\n                            dx = tx - sx,\r\n                            dy = ty - sy,\r\n                            d = Math.sqrt(dx * dx + dy * dy)\r\n\r\n                        // Construct unit vector between centers\r\n                        ,\r\n                            ux = dx / d,\r\n                            uy = dy / d\r\n\r\n                        // Point on source circle\r\n                        ,\r\n                            cx1 = sx + xR1 * ux,\r\n                            cy1 = sy + yR1 * uy\r\n\r\n                        // Point on target circle\r\n                        ,\r\n                            cx2 = sx + (d - xR2 - 5) * ux,\r\n                            cy2 = sy + (d - yR2 - 5) * uy;\r\n\r\n                        var x1 = cx1 + xR1 / 2,\r\n                            y1 = cy1 + yR1 / 2,\r\n                            x2 = cx2 + xR2 / 2,\r\n                            y2 = cy2 + yR2 / 2\r\n                        // TODO\r\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\r\n                        //  , angle = 0\r\n                        ;\r\n\r\n                        //if (i !== (l - 1) / 2) {\r\n                        //    angle = step * (i + 1);\r\n                        //}\r\n\r\n\r\n                        //var xC1 = (sT.x + xR1)\r\n                        //  , yC1 = (sT.y + yR1)\r\n                        //  , xC2 = (tT.y + xR2)\r\n                        //  , yC2 = (tT.y + yR2)\r\n                        //  , ddx1 = x1 - xC1\r\n                        //  , ddy1 = y1 - yC1\r\n                        //  , ddx2 = x2 - xC2\r\n                        //  , ddy2 = y2 - yC2\r\n                        //  , cosAngle = Math.cos(angle)\r\n                        //  , sinAngle = Math.sin(angle)\r\n                        //  , cosAngleM = Math.cos(-angle)\r\n                        //  , sinAngleM = Math.sin(-angle)\r\n                        //  ;\r\n\r\n                        // TODO This should change the points to arrange them on the circle\r\n                        //\r\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\r\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\r\n\r\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\r\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\r\n\r\n                        // ===================\r\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\r\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\r\n\r\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\r\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (isNaN(out.x1)) {\r\n                            out.x1 = sT.x + xR1 * 2;\r\n                            out.y1 = sT.y + yR1 / 2;\r\n                            out.x2 = sT.x;\r\n                            out.y2 = out.y1;\r\n                            out.ex = (out.x1 + out.x2) / 2;\r\n                            out.ey = out.y1 - options.kk * (i + 1);\r\n                        } else {\r\n                            dx = Math.abs((x1 - x2) / 2);\r\n                            dy = Math.abs((y1 - y2) / 2);\r\n\r\n                            if (i !== (l - 1) / 2) {\r\n                                dd = Math.sqrt(dx * dx + dy * dy);\r\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                            }\r\n                        }\r\n\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            elmSource.cons = elmSource.cons || [];\r\n            elmSource.cons.push(con);\r\n\r\n            /**\r\n             * update\r\n             * Updates the line coordinates.\r\n             *\r\n             * @name update\r\n             * @function\r\n             * @return {undefined}\r\n             */\r\n            con.update = function () {\r\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\r\n                    results = con.computeLineCoordinates(cons);\r\n\r\n                IterateObject(results, function (r, i) {\r\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\r\n                });\r\n            };\r\n\r\n            con.update();\r\n            elmSource.on(\"dragmove\", con.update);\r\n            elmTarget.on(\"dragmove\", con.update);\r\n\r\n            /**\r\n             * setLineColor\r\n             * Sets the line color.\r\n             *\r\n             * @name setLineColor\r\n             * @function\r\n             * @param {String} color The new color.\r\n             * @param {Connectable} c The connectable instance.\r\n             * @return {undefined}\r\n             */\r\n            con.setLineColor = function (color, c) {\r\n                c = c || this;\r\n                c.line.stroke(color);\r\n                c.marker.fill(color);\r\n            };\r\n\r\n            return con;\r\n        }\r\n\r\n        if (typeof SVG === \"function\") {\r\n            SVG.extend(SVG.Element, {\r\n                connectable: connectable,\r\n                delete_connectable: delete_connectable\r\n            });\r\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\r\n            throw new Error(\"SVG.js is not loaded but it is required.\");\r\n        }\r\n\r\n        module.exports = connectable;\r\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Typpy = require(\"typpy\");\r\n\r\n        /**\r\n         * Deffy\r\n         * Computes a final value by providing the input and default values.\r\n         *\r\n         * @name Deffy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Anything|Function} def The default value or a function getting the\r\n         * input value as first argument.\r\n         * @param {Object|Boolean} options The `empty` value or an object containing\r\n         * the following fields:\r\n         *\r\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\r\n         *\r\n         * @return {Anything} The computed value.\r\n         */\r\n        function Deffy(input, def, options) {\r\n\r\n            // Default is a function\r\n            if (typeof def === \"function\") {\r\n                return def(input);\r\n            }\r\n\r\n            options = Typpy(options) === \"boolean\" ? {\r\n                empty: options\r\n            } : {\r\n                empty: false\r\n            };\r\n\r\n            // Handle empty\r\n            if (options.empty) {\r\n                return input || def;\r\n            }\r\n\r\n            // Return input\r\n            if (Typpy(input) === Typpy(def)) {\r\n                return input;\r\n            }\r\n\r\n            // Return the default\r\n            return def;\r\n        }\r\n\r\n        module.exports = Deffy;\r\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\r\n        /**\r\n         * Typpy\r\n         * Gets the type of the input value or compares it\r\n         * with a provided type.\r\n         *\r\n         * Usage:\r\n         *\r\n         * ```js\r\n         * Typpy({}) // => \"object\"\r\n         * Typpy(42, Number); // => true\r\n         * Typpy.get([], \"array\"); => true\r\n         * ```\r\n         *\r\n         * @name Typpy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {String|Boolean} It returns `true` if the\r\n         * input has the provided type `target` (if was provided),\r\n         * `false` if the input type does *not* have the provided type\r\n         * `target` or the stringified type of the input (always lowercase).\r\n         */\r\n        function Typpy(input, target) {\r\n            if (arguments.length === 2) {\r\n                return Typpy.is(input, target);\r\n            }\r\n            return Typpy.get(input, true);\r\n        }\r\n\r\n        /**\r\n         * Typpy.is\r\n         * Checks if the input value has a specified type.\r\n         *\r\n         * @name Typpy.is\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {Boolean} `true`, if the input has the same\r\n         * type with the target or `false` otherwise.\r\n         */\r\n        Typpy.is = function (input, target) {\r\n            return Typpy.get(input, typeof target === \"string\") === target;\r\n        };\r\n\r\n        /**\r\n         * Typpy.get\r\n         * Gets the type of the input value. This is used internally.\r\n         *\r\n         * @name Typpy.get\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Boolean} str A flag to indicate if the return value\r\n         * should be a string or not.\r\n         * @return {Constructor|String} The input value constructor\r\n         * (if any) or the stringified type (always lowercase).\r\n         */\r\n        Typpy.get = function (input, str) {\r\n\r\n            if (typeof input === \"string\") {\r\n                return str ? \"string\" : String;\r\n            }\r\n\r\n            if (null === input) {\r\n                return str ? \"null\" : null;\r\n            }\r\n\r\n            if (undefined === input) {\r\n                return str ? \"undefined\" : undefined;\r\n            }\r\n\r\n            // eslint-disable-next-line no-self-compare\r\n            if (input !== input) {\r\n                return str ? \"nan\" : NaN;\r\n            }\r\n\r\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\r\n        };\r\n\r\n        module.exports = Typpy;\r\n    }, {}], 4: [function (require, module, exports) {\r\n        /**\r\n         * Idy\r\n         * Generates a random id and potentially unique.\r\n         *\r\n         * @name Idy\r\n         * @function\r\n         * @param {Number} length The id length (default: 10).\r\n         * @return {String} The generated id.\r\n         */\r\n        function Idy(length) {\r\n            length = length || 10;\r\n            return Math.random().toString(35).substr(2, length);\r\n        }\r\n\r\n        module.exports = Idy;\r\n    }, {}], 5: [function (require, module, exports) {\r\n        /**\r\n         * IterateObject\r\n         * Iterates an object. Note the object field order may differ.\r\n         *\r\n         * @name IterateObject\r\n         * @function\r\n         * @param {Object} obj The input object.\r\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\r\n         * @return {Function} The `IterateObject` function.\r\n         */\r\n        function IterateObject(obj, fn) {\r\n            var i = 0,\r\n                keys = [];\r\n\r\n            if (Array.isArray(obj)) {\r\n                for (; i < obj.length; ++i) {\r\n                    if (fn(obj[i], i, obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                keys = Object.keys(obj);\r\n                for (; i < keys.length; ++i) {\r\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        module.exports = IterateObject;\r\n    }, {}], 6: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Deffy = require(\"deffy\");\r\n\r\n        /**\r\n         * SetOrGet\r\n         * Sets or gets an object field value.\r\n         *\r\n         * @name SetOrGet\r\n         * @function\r\n         * @param {Object|Array} input The cache/input object.\r\n         * @param {String|Number} field The field you want to update/create.\r\n         * @param {Object|Array} def The default value.\r\n         * @return {Object|Array} The field value.\r\n         */\r\n        function SetOrGet(input, field, def) {\r\n            return input[field] = Deffy(input[field], def);\r\n        }\r\n\r\n        module.exports = SetOrGet;\r\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\r\n        arguments[4][2][0].apply(exports, arguments);\r\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\r\n        arguments[4][3][0].apply(exports, arguments);\r\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\r\nimport LinkNode from './nodes/LinkNode.js'\r\nimport BodyNode from './nodes/BodyNode.js'\r\nimport SectionNode from './nodes/SectionNode.js'\r\nimport { Block } from 'slate'\r\nimport { getEventTransfer } from 'slate-react';\r\nimport { deleteNode } from './NodeSwitch.js'\r\n\r\nexport default function LinkPlugin(options) {\r\n    return {\r\n        commands: {\r\n            wrapLinkAtSelection(editor, node_id) {\r\n                return editor.wrapInline({\r\n                    type: \"link\",\r\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\r\n                });\r\n            }\r\n        },\r\n\r\n        renderInline(props, editor, next) {\r\n            if (props.node.type === 'link') {\r\n                var { ref, id } = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        renderBlock(props, editor, next) {\r\n            var refAndId;\r\n\r\n            if (props.node.type === 'body') {\r\n                refAndId = getRefAndId(props, editor, \"long\");\r\n\r\n                // set up the placeholder text to only appear when the body is empty and no text is selected\r\n                var isEmpty = !props.node.text\r\n\r\n                var selectNode = () => {\r\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\r\n                }\r\n\r\n                return <BodyNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                            isEmpty={isEmpty}\r\n                            selectNode={selectNode}\r\n                        />\r\n\r\n            } else if (props.node.type === 'link') {\r\n                refAndId = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            linkStyle=\"heading\"\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                        />\r\n\r\n            } else if (props.node.type === 'section') {\r\n                refAndId = getRefAndId(props, editor, \"section\");\r\n\r\n                return <SectionNode\r\n                    ref={refAndId.ref}\r\n                    {...props}\r\n                    sharedState={editor.getSharedState()}\r\n                    nodeId={refAndId.id}\r\n                />\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        onDrop(event, editor, next) {\r\n            // suppress drop events\r\n            // do not call next()\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\r\n\r\n            var transfer = getEventTransfer(event);\r\n\r\n            if (transfer.type === \"fragment\") {\r\n\r\n                // if pasting into a link or body, just paste plain text, not a fragment\r\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\r\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\r\n                    editor.insertText(textNoNewlines)\r\n\r\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\r\n                    return\r\n                }\r\n\r\n                const fragmentInlines = getLinkInlines(transfer.fragment)\r\n\r\n                if (fragmentInlines) {\r\n                    const docInlines = getLinkInlines(editor.value.document)\r\n                    const usedIds = []\r\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\r\n                    \r\n                    // let the paste happen so we can operate on the document instead of inline\r\n                    next()\r\n\r\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\r\n                    fragmentInlines.forEach(inline => {\r\n                        usedIds.forEach(usedId => {\r\n                            const id = inline.data.get(\"node_id\")\r\n                            if (usedId.id === id) {\r\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\r\n                                inlinesWithId.forEach(inlineWithId => {\r\n                                    if (inlineWithId.key !== usedId.key) {\r\n                                        editor.unwrapInlineByKey(inlineWithId.key)\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                }\r\n            } else {\r\n                next()\r\n            }\r\n        },\r\n\r\n        onChange(editor, next) {\r\n            // update all node texts (both link and body)\r\n            const sharedState = editor.getSharedState();\r\n            [\r\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\r\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\r\n            ].forEach( update =>\r\n                editor.value.blocks.forEach(block => {\r\n                    const updateText = (linkNode) => {\r\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\r\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\r\n                        const id = linkNode.data.get('node_id')\r\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\r\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\r\n                            deleteNode(linkNode, editor)\r\n                        } else {\r\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\r\n                        }\r\n                    }\r\n\r\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\r\n                    linkNodes.forEach(updateText)\r\n\r\n                    if (block.type === update.nodeType) {\r\n                        updateText(block)\r\n                    }\r\n                })\r\n            )\r\n\r\n            next()\r\n        },\r\n\r\n        onKeyDown(e, editor, next) {\r\n            const { value } = editor\r\n            const { document, selection, startBlock} = value\r\n            const { start, end } = selection\r\n\r\n            // if a whole section (block or inline) is deleted, tell the graph node\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\r\n                document.getNodesAtRange(selection).forEach(node => {\r\n                    if (node.type === 'section' || node.type === 'link') {\r\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\r\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\r\n                        setTimeout(() => {\r\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\r\n                        }, 0)\r\n                    }\r\n                })\r\n            }\r\n\r\n            // prevent delete key from merging body and link blocks with next\r\n            if (e.key === \"Delete\") {\r\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\r\n                    const nextBlock = document.getNextBlock(start.key)\r\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\r\n                        editor.moveToStartOfNode(nextBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                \r\n            }\r\n\r\n            // prevent backspace from merging body and link blocks with previous\r\n            if (e.key === 'Backspace') {\r\n                const prevBlock = document.getPreviousBlock(start.key)\r\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\r\n                    if (prevBlock) {\r\n                        editor.moveToEndOfNode(prevBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        } else if (prevBlock.text === \"\") {\r\n                            editor.removeNodeByKey(prevBlock.key)\r\n                         }\r\n                    }\r\n                    return editor\r\n                }\r\n            }\r\n\r\n            if (e.key === 'Enter') {\r\n                if (value.inlines.some(inline => inline.type === 'link')) {\r\n                    return // do nothing to avoid splitting the link\r\n                }\r\n\r\n                // when enter is pressed inside a link *block* (not inline), just go to body\r\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\r\n                    // unless the offset is 0, in which case insert a block before and go to that\r\n                    if (start.offset === 0) {\r\n                        const blockToInsert = Block.create({object: 'block', type: ''})\r\n                        const section = document.getParent(startBlock.key);\r\n                        const sectionParent = document.getParent(section.key);                    \r\n                        const sectionIndex = sectionParent.nodes.indexOf(section);\r\n\r\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\r\n                        return editor.moveBackward(1)\r\n                    } else {\r\n                        const nextBlock = document.getNextBlock(start.key)\r\n                        if (nextBlock) {\r\n                            return editor.moveToStartOfNode(nextBlock);\r\n                        } else {\r\n                            return editor.moveToEndOfNode(startBlock);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // prevent the cursor disappearing when navigating into the body placeholder text\r\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\r\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\r\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\r\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\r\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\r\n                    // its hard to work out how many lines of text there so use an estimate\r\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\r\n                        editor.moveToEndOfNode(relevantBlock)\r\n                        e.preventDefault()\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent tab from taking focus from the editor\r\n            if (e.key === 'Tab') {\r\n                e.preventDefault()\r\n            }\r\n\r\n            return next()\r\n        }\r\n    }\r\n\r\n    function getRefAndId(props, editor, long_or_short) {\r\n        var id = props.node.data.get(\"node_id\");\r\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\r\n        var ref = React.createRef();\r\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\r\n        return { ref, id };\r\n    }\r\n}","import React from 'react';\r\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\r\n\r\nexport default function ReorderPlugin(options) {\r\n    return {\r\n        renderBlock(props, editor, next) {            \r\n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\r\n                return <PlainBlockNode {...props}/>\r\n            }\r\n            \r\n            return next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './DocPane.css';\r\nimport DocEditor from './DocEditor.js'\r\n\r\nclass DocPane extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"pane doc\">\r\n                <DocEditor sharedState={this.props.sharedState} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\r\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\r\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\r\n\r\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\r\n\r\nconst COLOURS = [\r\n    'red',\r\n    'goldenrod',\r\n    'green',\r\n    'aqua',\r\n    'blue',\r\n    'fuchsia',\r\n    'purple',\r\n    'saddlebrown'\r\n]\r\n\r\nvar DEFAULT_ARROW_OPTIONS = [\r\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"→\"},\r\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"→\"},\r\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"→\"},\r\n];\r\n\r\nexport default class MouseFollower {\r\n    constructor(shared_state, svg, connectables_container, markers, links) {\r\n        this.shared_state = shared_state;\r\n        this.drawing_arrow_from = false;\r\n        this.connector = undefined;\r\n        this.connectables_container = connectables_container;\r\n        this.markers = markers;\r\n        this.links = links;\r\n\r\n        this.arrow_id_counter = 0\r\n\r\n        this.completed_arrows = []\r\n\r\n        this.mouse_rect = svg.group();\r\n        window.addEventListener('mousemove', e => {\r\n            var point = svg.point(e.clientX, e.clientY);\r\n            this.mouse_rect.move(point.x, point.y);\r\n            \r\n            if (typeof(this.connector) !== 'undefined') {\r\n                this.connector.update();\r\n            }\r\n        });\r\n\r\n        // cancel arrows if they don't end on a node\r\n        window.addEventListener('mouseup', (e) => {\r\n            if (this.drawing_arrow_from) {\r\n                e.preventDefault();\r\n                this.stop_drawing_arrow();\r\n            }\r\n        });\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            arrows: this.completed_arrows,\r\n            arrow_id_counter: this.arrow_id_counter,\r\n            arrowOptions: this.arrowOptions,\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\r\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\r\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\r\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\r\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\r\n\r\n        return mf\r\n    }\r\n\r\n    // draw all the arrows in this.completed_arrows\r\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\r\n    draw_loaded_arrows(get_node) {\r\n        this.completed_arrows.forEach(arrow => {\r\n            const originNode = get_node(arrow.origin)\r\n            const destinationNode = get_node(arrow.destination)\r\n\r\n            if (!originNode) {\r\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\r\n                return\r\n            }\r\n\r\n            if (!destinationNode) {\r\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\r\n                return\r\n            }\r\n\r\n            const connector = this.draw_arrow(\r\n                originNode,\r\n                destinationNode,\r\n                arrow.colour\r\n            )\r\n            this.add_context_menu_to_arrow(connector, arrow)\r\n        })\r\n    }\r\n\r\n    update_source(new_source) {\r\n        if (typeof(this.connector) === 'undefined') {\r\n            this.connector = new_source.connectable({\r\n                container: this.connectables_container,\r\n                markers: this.markers\r\n            }, this.mouse_rect);\r\n        } else {\r\n            this.connector.marker.show();\r\n            this.connector.line.show();\r\n\r\n            this.connector.target = this.mouse_rect;\r\n            this.connector.source = new_source;\r\n            this.connector.update();\r\n        }\r\n        if (this.connector) {\r\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (typeof(this.connector) !== 'undefined') {\r\n            this.connector.target = this.connector.source;\r\n            this.connector.marker.hide();\r\n            this.connector.line.hide();\r\n        }\r\n    }\r\n\r\n    start_arrow(source_node) {\r\n        this.drawing_arrow_from = source_node;\r\n        if (this.connector) {\r\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    draw_arrow(origin, destination, colour) {\r\n        var connector = origin.group.connectable({\r\n            container: this.links,\r\n            markers: this.markers,\r\n            specialCoords: true\r\n        }, destination.group);\r\n        connector.setLineColor(colour);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n\r\n        return connector\r\n    }\r\n\r\n    add_context_menu_to_arrow(connector, arrowObject) {\r\n        const show_context_menu = e => {\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\r\n                arrowObject.colour = new_colour\r\n            }, arrowObject);\r\n            e.preventDefault();\r\n        };\r\n        connector.line.on(\"click\", show_context_menu);\r\n        connector.line.on(\"contextmenu\", show_context_menu);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n\r\n        // detect if the user changes the colour of this arrow\r\n        window.addEventListener('colourchange', (e) => {\r\n            if (e.detail.oldColour === arrowObject.colour) {\r\n                connector.setLineColor(e.detail.newColour)\r\n                arrowObject.colour = e.detail.newColour\r\n            }\r\n        })\r\n\r\n        // detect if all arrows of this colour were deleted\r\n        window.addEventListener('arrowdelete', (e) => {\r\n            if (e.detail.colour === arrowObject.colour) {\r\n                this.remove_arrow(connector, arrowObject)\r\n            }\r\n        })\r\n    }\r\n\r\n    complete_arrow(end_node) {\r\n        // no arrows to self\r\n        if (end_node === this.drawing_arrow_from) {\r\n            this.stop_drawing_arrow();\r\n            return;\r\n        }\r\n\r\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\r\n\r\n        var c1 = this.drawing_arrow_from.group.getScreenCoords();\r\n        var c2 = end_node.group.getScreenCoords();\r\n        var midpoint = [(c1.x + c2.x) / 2, (c1.y + c2.y) / 2]\r\n\r\n        // only add the arrow to the list of completed arrows once a colour is selected\r\n        // to prevent weird states being saved and loaded\r\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\r\n        const colourWasSelected = (colour) => {\r\n            const id = this.getNewId()\r\n            const arrowObject = {\r\n                id: id,\r\n                origin: drawing_arrow_from_id,\r\n                destination: end_node.id,\r\n                colour: colour,\r\n            }\r\n            this.completed_arrows.push(arrowObject)\r\n\r\n            this.add_context_menu_to_arrow(connector, arrowObject)\r\n        }\r\n\r\n        this.edit_connector_type(connector, midpoint[0], midpoint[1], false, colourWasSelected);\r\n\r\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\r\n        this.stop_drawing_arrow();\r\n    }\r\n\r\n    getArrowByID(id) {\r\n        return this.completed_arrows.find(arrow => arrow.id === id)\r\n    }\r\n\r\n    getNewId() {\r\n        this.arrow_id_counter++\r\n        return this.arrow_id_counter\r\n    }\r\n\r\n    changeArrowColour(entry, direction) {\r\n        const oldColour = entry.colour\r\n        var newColour = this.getNextAvailableColour(entry, direction)\r\n        if (!newColour) {\r\n            return\r\n        }\r\n        entry.colour = newColour\r\n\r\n        window.dispatchEvent(new CustomEvent('colourchange', {\r\n            detail: {\r\n                oldColour: oldColour,\r\n                newColour: newColour,\r\n            }\r\n        }))\r\n\r\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\r\n\r\n        return newColour\r\n    }\r\n\r\n    getNextAvailableColour(entry, direction) {\r\n        // find all the colours which are not used by arrowOptions other than this one\r\n        const availableColours = COLOURS.filter(colour => \r\n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\r\n        )\r\n\r\n        if (!availableColours) {\r\n            return undefined\r\n        } else {\r\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\r\n            if (thisColourIndex !== -1) {\r\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\r\n                if (nextIndex < 0) {\r\n                    nextIndex = availableColours.length - 1\r\n                }\r\n                return availableColours[nextIndex]\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrowOptions() {\r\n        const clickEditButton = (e, params) => {\r\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\r\n\r\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\r\n\r\n            transientEntry.isClickable = false\r\n\r\n            var editButton = buttonCell.children[0]\r\n\r\n            const finishEditing = () => {\r\n                var newValue = input.value\r\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\r\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\r\n                }\r\n                \r\n                nameCell.removeChild(input)\r\n\r\n                if (newValue) {\r\n                    underlyingEntry.name = newValue\r\n                    nameCell.textContent = newValue\r\n                }\r\n\r\n                transientEntry.isClickable = true\r\n\r\n                colourCell.textContent = colourButton.textContent\r\n                colourCell.style.color = colourButton.style.color\r\n                \r\n                editButton.classList.remove('pure-button-active')\r\n                editButton.onclick = (e) => clickEditButton(e, params)\r\n            }\r\n\r\n            editButton.classList.add('pure-button-active')\r\n            editButton.onclick = finishEditing\r\n\r\n            var input = document.createElement(\"input\")\r\n            \r\n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\r\n            input.value = nameCell.textContent\r\n            input.addEventListener('keyup', (e) => {\r\n                if (e.key === 'Enter' && input.value) {\r\n                    finishEditing()\r\n                }\r\n            })\r\n            input.addEventListener('blur', (e) => {\r\n                if (input.value) {\r\n                    finishEditing()\r\n                }\r\n            })\r\n\r\n            nameCell.textContent = \"\"\r\n            nameCell.appendChild(input)\r\n\r\n            var colourButton = document.createElement(\"button\")\r\n            colourButton.className = 'pure-button'\r\n            colourButton.textContent = colourCell.textContent\r\n            colourCell.textContent = \"\"\r\n            colourCell.appendChild(colourButton)\r\n            colourButton.style.color = colourCell.style.color\r\n            colourButton.style.padding = 0\r\n            colourButton.addEventListener(\"click\", () => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\r\n                transientEntry.colour = underlyingEntry.colour\r\n            })\r\n            colourButton.addEventListener(\"contextmenu\", (e) => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\r\n                transientEntry.colour = underlyingEntry.colour\r\n                e.preventDefault()\r\n            })\r\n\r\n            input.focus()\r\n        }\r\n\r\n        const clickDeleteArrowTypeButton = (e, params) => {\r\n            var { row, underlyingEntries, underlyingEntry, transientEntry } = params\r\n            transientEntry.isClickable = false\r\n            \r\n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\r\n                // remove from underlyingEntries\r\n                var index = underlyingEntries.indexOf(underlyingEntry)\r\n                if (index !== -1) {\r\n                    underlyingEntries.splice(index, 1)\r\n                }\r\n\r\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\r\n                setTimeout(() => row.parentNode.removeChild(row), 0)\r\n\r\n                // tell all arrows of this colour to delete themselves\r\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\r\n                    detail: {\r\n                        colour: underlyingEntry.colour,\r\n                    }\r\n                }))\r\n\r\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour});\r\n            }\r\n        }\r\n\r\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\r\n            var entryWithButtons = {...entry}\r\n            entryWithButtons.buttons = [\r\n                {\r\n                    className: 'edit-icon',\r\n                    click: clickEditButton,\r\n                    underlyingEntry: entry,\r\n                },\r\n                {\r\n                    className: 'delete-icon',\r\n                    click: clickDeleteArrowTypeButton,\r\n                    underlyingEntry: entry,\r\n                    underlyingEntries: this.arrowOptions,\r\n                }\r\n            ]\r\n            return entryWithButtons\r\n        })\r\n        \r\n        return [\r\n            ...arrowOptionsWithButtons,\r\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\r\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n        ]\r\n    }\r\n\r\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\r\n        var prev_selected = undefined;\r\n        \r\n        const arrowOptions = this.getArrowOptions()\r\n\r\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\r\n        prev_selected = prev_selected ? prev_selected.name : undefined\r\n\r\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\r\n            if (selected_option.name === \"Delete\") {\r\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\r\n                this.remove_arrow(connector, arrowObject);\r\n            } if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\r\n                const colour = this.getNextAvailableColour(null, 1)\r\n\r\n                if (!colour) {\r\n                    toast.error(\"Maximum number of arrow types reached!\")\r\n                } else {\r\n                    this.arrowOptions.push({\r\n                        'name': 'New relation',\r\n                        'colour': colour,\r\n                        'symbol': \"→\",\r\n                    })\r\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\r\n\r\n                    // open a new option popup to allow the user to select the new arrow type and edit it\r\n                    this.edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject)\r\n                }\r\n            } else {\r\n                connector.setLineColor(selected_option.colour);\r\n                this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\r\n\r\n                if (onColourSelected) {\r\n                    onColourSelected(selected_option.colour)\r\n                }\r\n            }\r\n        }, prev_selected);\r\n    }\r\n\r\n    remove_arrow(connector, arrowObject) {\r\n        connector.line.node.instance.delete_connectable(connector);\r\n\r\n        if (arrowObject) {\r\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \r\n        }\r\n    }\r\n\r\n    stop_drawing_arrow() {\r\n        this.drawing_arrow_from = false;\r\n        this.hide();\r\n    }\r\n}","import OptionPopup from \"./OptionPopup\";\r\n\r\nvar ARROW_HITBOX_MARGIN = 20;\r\n\r\nclass GraphNode {\r\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList) {\r\n        var { shortText, x, y, width, height, id, isOnGraph, longText } = params\r\n        this.id = id ? id : shared_state.getNodeId();\r\n\r\n        this.getNodesList = getNodesList;\r\n        \r\n        this.group = nodes.group().translate(x, y);\r\n\r\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\r\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0);\r\n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\r\n        this.text = this.group.text(\"\").addClass('node-text');\r\n        this.updateShortText(shortText)\r\n        this.updateLongText(longText)\r\n\r\n        this.setupRectDragging(this.rect, shared_state);\r\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\r\n        const complete_arrow = (e) => {\r\n            if (mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.complete_arrow(this);\r\n            }\r\n        };\r\n        this.rect.on('mouseup', complete_arrow);\r\n        this.text.on('mouseup', complete_arrow);\r\n\r\n        this.setupHover(shared_state);\r\n        this.setupContextMenu(shared_state);\r\n\r\n        if (focus_text_area) {\r\n            console.log(params.doNotDeleteIfEmptyText);\r\n            \r\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\r\n        }\r\n        \r\n        this.setIsOnGraph(isOnGraph);\r\n\r\n        shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\r\n    }\r\n\r\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList) {\r\n        var params = json\r\n        params.x = json.screenCoords.x\r\n        params.y = json.screenCoords.y\r\n        params.width = 100\r\n        params.height = 50\r\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList)\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            id: this.id,\r\n            shortText: this.shortText,\r\n            longText: this.longText,\r\n            screenCoords: this.group.getScreenCoords(),\r\n            isOnGraph: this.isOnGraph,\r\n        }\r\n    }\r\n\r\n    setIsOnGraph(newVal) {\r\n        this.isOnGraph = newVal;\r\n        if (this.isOnGraph) {\r\n            this.rect.addClass(\"node-on-graph\");\r\n        } else {\r\n            this.rect.removeClass(\"node-on-graph\");\r\n        }\r\n    }\r\n\r\n    setupContextMenu(shared_state) {\r\n        var showOptionMenu = e => {\r\n            e.preventDefault();\r\n            \r\n            var entries = [\r\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n            ]\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\r\n                if (selected_option.name === \"Delete\") {\r\n                    this.delete(shared_state);\r\n                }\r\n            });\r\n            \r\n            return false;\r\n        };\r\n        this.rect.on('contextmenu', showOptionMenu);\r\n        this.text.on('contextmenu', showOptionMenu);\r\n    }\r\n\r\n    setupHover(shared_state) {\r\n        this.hoverers = []\r\n\r\n        const startHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, true);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\r\n            });\r\n        };\r\n        const endHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, false);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\r\n            });\r\n        };\r\n        this.rect.on('mouseenter', startHover);\r\n        this.text.on('mouseenter', startHover);\r\n        this.rect.on('mouseleave', endHover);\r\n        this.text.on('mouseleave', endHover);\r\n    }\r\n\r\n    setHoverer(hoverer, isHovering) {\r\n        if (isHovering) {\r\n            if (!this.hoverers.includes(hoverer)) {\r\n                this.hoverers.push(hoverer)\r\n            }\r\n        } else {\r\n            // remove the hoverer\r\n            var index = this.hoverers.indexOf(hoverer);\r\n            if (index !== -1) this.hoverers.splice(index, 1);\r\n        }\r\n\r\n        this.setHovered(this.hoverers.length > 0)\r\n    }\r\n\r\n    setHovered(isHovered) {        \r\n        if (isHovered) {\r\n            this.rect.addClass(\"hovered\");\r\n        } else {\r\n            this.rect.removeClass(\"hovered\");\r\n        }\r\n    }\r\n\r\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\r\n    // but we only want to make the node itself draggable\r\n    // so we need to intercept drag events on the rect, and move the entire group instead!\r\n    setupRectDragging(rect, shared_state) {\r\n        this.setupGroupDragging(rect, shared_state, rect);\r\n        this.setupGroupDragging(this.text, shared_state, rect, true);\r\n        \r\n        this.text.click((e) => e.preventDefault());\r\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\r\n        rect.click(edit_text_if_not_just_dropped);\r\n        this.text.click(edit_text_if_not_just_dropped);\r\n    }\r\n\r\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\r\n        rect.draggy(); // setup dragging on the rect\r\n        rect.on('mousedown', (e) => {\r\n            e.stopPropagation(); // don't pan when moving a node\r\n        });\r\n        just_dropped_obj.just_dropped = false;\r\n        rect.on('dragstart', (e) => {\r\n            var start_x = this.group.x();\r\n            var start_y = this.group.y();\r\n            document.activeElement.blur();\r\n            shared_state.draggedNode = {\r\n                id: this.id,\r\n                text: this.getShortText(),\r\n                longText: this.getLongText(),\r\n                resetPos: () => {\r\n                    this.group.move(start_x, start_y);\r\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n                },\r\n                node: this\r\n            };\r\n            rect.off('dragmove');\r\n            rect.on('dragmove', (e) => {\r\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\r\n                if (center) {\r\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n                } else {\r\n                    rect.x(0);\r\n                    rect.y(0);\r\n                }\r\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n            });\r\n            rect.off('dragend');\r\n            rect.on('dragend', (e) => {\r\n                // prevent the textarea showing\r\n                // unless the drag amount was zero or just a tiny accidental drag\r\n                var x_diff = (this.group.x() - start_x);\r\n                var y_diff = (this.group.y() - start_y);\r\n                var nudge = 10;\r\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\r\n                    just_dropped_obj.just_dropped = true;\r\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\r\n                }\r\n                shared_state.draggedNode = false;\r\n            });\r\n        });\r\n    }\r\n\r\n    // click/drag events on the arrow hitbox should start the arrow creation process\r\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\r\n        arrow_hitbox.on('mousemove', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.update_source(this.group);\r\n            }\r\n        });\r\n        arrow_hitbox.on('mouseleave', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.hide();\r\n            }\r\n        });\r\n        arrow_hitbox.on('mousedown', (e) => {\r\n            mouse_follower.start_arrow(this);\r\n            e.stopPropagation(); // don't pan when dragging an arrow\r\n        });\r\n    }\r\n\r\n    updateShortText(newShortText) {\r\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\r\n        \r\n        const CHARS_PER_LINE = 21;\r\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\r\n\r\n        this.text.text(formattedText.join(\"\\n\"));\r\n        this.resizeRect(formattedText.length);\r\n    }\r\n\r\n    updateLongText(newLongText) {\r\n        this.longText = newLongText;\r\n    }\r\n\r\n    splitIntoLines(charsPerLine, text) {\r\n        var formattedText = [];\r\n        var line = \"\";\r\n        text.split(\" \").forEach(word => {\r\n            var segments = [];\r\n            if (word.length > charsPerLine) {\r\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\r\n                    if (segments.length > 0) {\r\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\r\n                    }\r\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\r\n                }\r\n            }\r\n            else {\r\n                segments = [word];\r\n            }\r\n            segments.forEach(segment => {\r\n                if ((line + segment).length < charsPerLine) {\r\n                    var space = line.length > 0 ? \" \" : \"\";\r\n                    line += space + segment;\r\n                }\r\n                else {\r\n                    formattedText.push(line);\r\n                    line = segment;\r\n                }\r\n            });\r\n        });\r\n        formattedText.push(line);\r\n        return formattedText;\r\n    }\r\n\r\n    // resize the rect so that the text fits on it\r\n    resizeRect(numLinesOfText) {\r\n        this.rect.width(200);\r\n        this.rect.height(numLinesOfText * 21 + 20);\r\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n\r\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\r\n\r\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n    }\r\n\r\n    getShortText() {\r\n        return this.shortText;\r\n    }\r\n\r\n    getLongText() {\r\n        return this.longText;\r\n    }\r\n\r\n    editText(shared_state, delete_if_empty_text = false) {\r\n        document.activeElement.blur(); // remove focus from everything\r\n\r\n        var textarea = document.querySelector('#nodeedit');\r\n        textarea.value = this.getShortText();\r\n\r\n        var screen_coords = this.group.getScreenCoords();\r\n        textarea.style.left = screen_coords.x + \"px\";\r\n        textarea.style.top = screen_coords.y + \"px\";\r\n        textarea.style.display = \"inline-block\";\r\n        textarea.focus();\r\n\r\n        textarea.style.width = \"180px\";\r\n        textarea.style.height = 'auto';\r\n        textarea.style.height = (textarea.scrollHeight) + 'px';\r\n\r\n        this.text.hide();\r\n\r\n        var save_changes = () => {\r\n            this.updateShortText(textarea.value);\r\n            shared_state.updateDocShortText(this.id, this.getShortText());\r\n        };\r\n        var save_and_hide = () => {\r\n            save_changes();\r\n            textarea.style.display = \"none\";\r\n            if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\r\n                this.delete(shared_state);\r\n            }\r\n            this.text.show();\r\n            this.updateShortText(this.shortText);\r\n\r\n            shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\r\n        };\r\n        textarea.onblur = save_and_hide;\r\n        textarea.onkeyup = (e) => {\r\n            if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\r\n                e.preventDefault();\r\n                document.activeElement.blur();\r\n            } else {\r\n                save_changes();\r\n            }\r\n        };\r\n    }\r\n\r\n    delete(shared_state) {\r\n        shared_state.removeGraphNode(this.id);\r\n        \r\n        // remove from the list of nodes (used for saving)\r\n        const nodesList = this.getNodesList()\r\n        var index = nodesList.indexOf(this);\r\n        if (index !== -1) {\r\n            nodesList.splice(index, 1)\r\n        } else {\r\n            console.log('node not found in this.nodesList when deleting');\r\n        }        \r\n\r\n        this.group.remove();\r\n\r\n        // delete arrows\r\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\r\n\r\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\r\n    }\r\n}\r\n\r\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst graphTarget = {\r\n    canDrop(props, monitor) {\r\n        const item = monitor.getItem()\r\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\r\nimport './GraphPane.css';\r\nimport SVG from 'svg.js';\r\nimport 'svg.panzoom.js';\r\nimport 'svg.draggy.js';\r\nimport './svg.connectable.js';\r\nimport MouseFollower from './MouseFollower.js';\r\nimport GraphNode from './GraphNode.js';\r\nimport DropifyGraphPane from './DropifyGraphPane.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nclass GraphPane extends React.Component {\r\n    componentDidMount() {\r\n        this.props.sharedState.getSavedGraph((json) => {\r\n            this.nodesList = [];\r\n\r\n            this.props.sharedState.graphPane = this;\r\n\r\n            this.$el = document.querySelector(\"#graph\")\r\n\r\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 1, zoomMax: 1 }); // just pan, no zoom\r\n\r\n            SVG.extend(SVG.Element, {\r\n                getScreenCoords: function () {\r\n                    var root_point = this.doc().node.getBoundingClientRect();\r\n                    var point = this.point(0, 0);\r\n                    return {\r\n                        x: -point.x - root_point.left,\r\n                        y: -point.y - root_point.top\r\n                    };\r\n                }\r\n            })\r\n\r\n            var links = svg.group();\r\n            var markers = svg.group();\r\n            var nodes = svg.group();\r\n\r\n            const json_connections = json ? json.connections : undefined\r\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\r\n            this.mouse_follower = mouse_follower\r\n\r\n            // add new nodes on mouse click\r\n            svg.on('dblclick', (e) => {\r\n                // only clicks on background and not when dragging\r\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\r\n                    return;\r\n                }\r\n\r\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n            });\r\n\r\n            this.setupTextDropping(svg, nodes, mouse_follower);\r\n\r\n            svg.on('panStart', (e) => {\r\n                document.activeElement.blur();\r\n            });\r\n\r\n            var textarea = document.querySelector('#nodeedit');\r\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\r\n            textarea.addEventListener(\"input\", (e) => {\r\n                textarea.style.height = 'auto';\r\n                textarea.style.height = (textarea.scrollHeight) + 'px';\r\n            });\r\n\r\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\r\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\r\n            }\r\n            if (json && json.nodes) {\r\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\r\n            }\r\n\r\n            this.getNodeById = this.getNodeById.bind(this)\r\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\r\n\r\n            if (!this.nodesList) {\r\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\r\n            }\r\n        })\r\n\r\n        // temp\r\n        // this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"Radical\", 1200, 300, false);\r\n    }\r\n\r\n    getNodeById(id) {\r\n        return this.nodesList.find(node => node.id.toString() === id.toString())\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            nodes: this.nodesList.map(node => node.toJSON()),\r\n            connections: this.mouse_follower.toJSON()\r\n        }\r\n    }\r\n\r\n    loadNodesFromJSON(json, mouse_follower, nodes) {\r\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList))\r\n    }\r\n\r\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\r\n        this.noNodesIndicator = svg.text(\"Double click to add a node\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\r\n        this.noNodesIndicator.on('dblclick', (e) => {\r\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n        });\r\n    }\r\n\r\n    setupTextDropping(svg, nodes, mouse_follower) {\r\n        this.$el.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        this.$el.addEventListener(\"drop\", (e) => {\r\n            e.preventDefault();\r\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\r\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\r\n            }\r\n            \r\n            var data = e.dataTransfer.getData(\"Text\");\r\n\r\n            if (data.includes('\\n')) {\r\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\r\n                return\r\n            }\r\n\r\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\r\n                toast.error('You can\\'t add the same node to the graph twice!')\r\n                return\r\n            }\r\n\r\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, e.clientX, e.clientY, false);\r\n            this.props.sharedState.addLinkAtSelection(node.id, node);\r\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\r\n            document.activeElement.blur();\r\n        });\r\n    }\r\n\r\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false) {\r\n        var point = svg.point(x, y);\r\n        const params = {\r\n            shortText: text,\r\n            longText: \"\", \r\n            x: point.x,\r\n            y: point.y,\r\n            width: 100,\r\n            height: 80,\r\n            isOnGraph: false,\r\n            id: undefined, // set automatically\r\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\r\n        }\r\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList);\r\n        this.nodesList.push(node);\r\n\r\n        if (this.noNodesIndicator) {\r\n            this.noNodesIndicator.hide();\r\n        }\r\n\r\n        return node;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.$el.somePlugin('destroy');\r\n    }\r\n\r\n    render() {\r\n        return this.props.connectDropTarget(\r\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\r\n                <textarea id='nodeedit'></textarea>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\r\n\r\nconst db = new Dexie('writeReasonDb');\r\ndb.version(1).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\r\n\r\nexport default db;","import React, { Component } from 'react';\r\n\r\nexport default class FilesList extends Component {\r\n    \r\n    render() {\r\n        return (\r\n            <table className='pure-table'>\r\n                <thead>\r\n                    <tr>\r\n                        <th>ID</th>\r\n                        <th>Name</th>\r\n                        <th></th>\r\n                        <th></th>\r\n                        <th></th>\r\n                        <th></th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {\r\n                        this.props.projects.map(project => <tr key={project.id.toString()}>\r\n                            <td>{project.id}</td>\r\n                            <td>{project.name}</td>\r\n                            <td><button className=\"pure-button\" onClick={() => this.props.loadProject(project.id)}>Open</button></td>\r\n                            <td><button className=\"pure-button\" onClick={() => this.props.renameProject(project.id)}>Rename</button></td>\r\n                            <td><button className=\"pure-button\" onClick={() => this.props.duplicateProject(project.id)}>Duplicate</button></td>\r\n                            <td><button className=\"pure-button\" onClick={() => this.props.deleteProject(project.id)}>Delete</button></td>\r\n                        </tr>)\r\n                    }\r\n                </tbody>\r\n            </table>\r\n        );\r\n      }\r\n}","export default class Logger {\r\n    shouldLogToConsole = false;\r\n\r\n    constructor(id, params) {\r\n        this.id = id;\r\n        this.conditions = params;\r\n        this.logToConsole(\"Logging begin, id \" + id + \"\\nParams \" + JSON.stringify(params, null, 1));\r\n    }\r\n\r\n    getExperimentData() {\r\n        return this.getLog();\r\n    }\r\n\r\n    getExperimentId() {\r\n        return this.id\r\n    }\r\n\r\n    // Generate an ID from the current time to avoid collision\r\n    static getNewId() {\r\n        return Number(new Date()).toString(36);\r\n    }\r\n\r\n    logEvent(event) {\r\n        var log = this.getLog();\r\n        if (log.events === undefined) {\r\n            log.events = {};\r\n        }\r\n\r\n        if (log.events[event.type] === undefined) {\r\n            log.events[event.type] = [];\r\n        }\r\n        event.timestamp = new Date();\r\n        log.events[event.type].push(event);\r\n        this.setLog(log);\r\n\r\n        this.logToConsole(\"Logging event: \" + JSON.stringify(event));\r\n    }\r\n\r\n    static retrieveLog(id) {\r\n        return localStorage.getItem(Logger.getStorageString(id));\r\n    }\r\n\r\n    getLog() {\r\n        var log = JSON.parse(Logger.retrieveLog(this.id));\r\n        if (!log || log === undefined) {\r\n            log = {}\r\n        }\r\n        return log;\r\n    }\r\n\r\n    setLog(log) {\r\n        localStorage.setItem(Logger.getStorageString(this.id), JSON.stringify(log));\r\n    }\r\n\r\n    static getStorageString(id) {\r\n        return \"log_\" + id;\r\n    }\r\n\r\n    logToConsole(msg) {\r\n        if (this.shouldLogToConsole) {\r\n            console.log(msg);\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport { Text } from 'slate';\r\nimport Html from 'slate-html-serializer'\r\nimport Logger from './logging'\r\nimport db from './db.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class SharedState {\r\n    constructor(db_id, params) {      \r\n        this.logger = new Logger(Logger.getNewId(), params)\r\n        this.condition = params.condition;\r\n        this.params = params;\r\n        \r\n        this.node_id_counter = 0;\r\n        this.slate_id_counter = 10\r\n        this.map = {};\r\n        this.map_recycle_bin = {};\r\n        this.db_id = db_id\r\n\r\n        // this.editor_ref and this.graphPane set in the editor and graphpane\r\n        this.editor_ref = undefined;\r\n        this.graphPane = undefined;\r\n\r\n        // log entire document content every 30 seconds\r\n        this.intervalLogger = window.setInterval(() => {\r\n            this.logger.logEvent({'type': 'document_content_detailed', 'content': this.getEditor().getValue()});\r\n            this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\r\n        }, 30000);\r\n        \r\n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\r\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\r\n        this.save = this.save.bind(this)\r\n    }\r\n\r\n    // called by editor once the database saved value has been set as the document.value\r\n    editorHasLoaded() {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\r\n                this.map = project.map ? this.mapFromJSON(project.map) : {}\r\n                this.getEditor().mapHasLoaded()\r\n            })\r\n    }\r\n\r\n    save() {\r\n        const changes = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        db.table('projects')\r\n            .update(this.db_id, changes)\r\n            .then((idExists) => {\r\n                if (!idExists) {\r\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\r\n                    console.log(message)\r\n                    toast.error(message)\r\n                } else {\r\n                    toast.info('Changes saved!')\r\n                }\r\n            }).catch(err => {\r\n                toast.error('Save error: ' + err.toString())\r\n            })\r\n    }\r\n\r\n    getSavedDocValue = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.doc_value)\r\n            })\r\n    }\r\n\r\n    getSavedGraph = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.graph_value)\r\n            })\r\n    }\r\n\r\n    mapToJSON() {\r\n        var mapJson = {}\r\n        const document = this.getEditor().value.document\r\n        for (const id in this.map) {\r\n            let doc_nodes = {};\r\n            ['section', 'long', 'short'].forEach(part => {\r\n                const docNodeObjects = this.getDocNodes(id)\r\n                if (docNodeObjects) {\r\n                    if (docNodeObjects[part]) {\r\n                        const path = document.getPath(docNodeObjects[part])\r\n                        doc_nodes[part] = path.toArray()\r\n                    }\r\n                } \r\n            })\r\n\r\n            mapJson[id] = {\r\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\r\n                doc_nodes: doc_nodes\r\n            }\r\n        }\r\n\r\n        return mapJson\r\n    }\r\n\r\n    mapFromJSON(json) {\r\n        this.map = {}\r\n        for (const id in json) {\r\n            if (json[id].graph_node) {\r\n                const graphNode = this.graphPane.getNodeById(id)\r\n                if (graphNode) {\r\n                    this.addGraphMapping(id, graphNode)\r\n                } else {\r\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\r\n                }\r\n            }\r\n\r\n            if (json[id].doc_nodes) {\r\n                for (const part in json[id].doc_nodes) {\r\n                    const path = json[id].doc_nodes[part]\r\n                    \r\n                    const document = this.getEditor().value.document\r\n                    if (document.hasNode(path)) {\r\n                        this.setLinkMapping(id, document.getNode(path), part)\r\n                    } else {\r\n                        console.log(document);\r\n                        \r\n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.map\r\n    }\r\n\r\n    downloadExperimentData() {\r\n        const element = document.createElement(\"a\");\r\n        const data = {\r\n            params: this.params,\r\n            argument: this.getArgumentMarkdown(),\r\n            logs: this.logger.getExperimentData()\r\n        }\r\n        const file = new Blob([JSON.stringify(data, null, 2)], {type: 'text/plain'});\r\n\r\n        element.href = URL.createObjectURL(file);\r\n        element.download = this.logger.getExperimentId() + \".json\";\r\n        document.body.appendChild(element); // Required for this to work in FireFox\r\n        element.click();\r\n    }\r\n\r\n    getArgumentMarkdown() {\r\n        const parentStyleIs = (node, styleToCheck) => {\r\n            const parent = this.getEditor().value.document.getParent(node.key)\r\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\r\n        }\r\n\r\n        const RULES = [\r\n            {\r\n                serialize: (node, children) => {\r\n                    if ([\"block\", \"inline\"].includes(node.object)) {\r\n                        switch(node.type) {\r\n                            case 'paragraph':\r\n                            case '':\r\n                                return <p>{children}</p>\r\n\r\n                            case 'heading':\r\n                                return <h2>{children}</h2>\r\n                            \r\n                            case 'section':\r\n                                return <div>{children}</div>\r\n                            \r\n                            case 'body':\r\n                                if (parentStyleIs(node, \"Heading only\")) {\r\n                                    return <p></p>\r\n                                } else {\r\n                                    return <p>{children}</p>\r\n                                }\r\n\r\n                            case 'link':\r\n                                if (node.object === \"inline\") {\r\n                                    return <span>{children}</span>\r\n                                } else {\r\n                                    if (parentStyleIs(node, \"Body only\")) {\r\n                                        return <p></p>\r\n                                    } else {\r\n                                        return <h2>{children}</h2>\r\n                                    }\r\n                                }\r\n\r\n                            default:\r\n                                return undefined;\r\n                        }\r\n                    }\r\n                } \r\n            }\r\n        ]\r\n\r\n        const serializer = new Html({rules: RULES})\r\n        var output = serializer.serialize(this.getEditor().value)\r\n        \r\n        var tagReplacements = [\r\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\r\n\r\n            {regex: /<p>/g},\r\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\r\n            {regex: /<div>/g},\r\n            {regex: /<\\/div>/g},\r\n            {regex: /<span>/g},\r\n            {regex: /<\\/span>/g},\r\n            {regex: /<h2>/g, replace: \"## \"},\r\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\r\n        ]\r\n        tagReplacements.forEach((replacement) => {\r\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\r\n        })\r\n        return output\r\n    }\r\n\r\n    finishCondition() {\r\n        window.clearInterval(this.intervalLogger)\r\n    }\r\n\r\n    getEditor() {\r\n        return this.editor_ref.current;\r\n    }\r\n\r\n    getNodeId() {\r\n        this.node_id_counter++;\r\n        return this.node_id_counter;\r\n    }\r\n\r\n    canAddLinkAtSelection() {\r\n        const value = this.getEditor().value;\r\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\r\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\r\n        return !is_in_linked_block && !is_in_linked_inline;\r\n    }\r\n\r\n    addLinkAtSelection(id, graph_node) {\r\n        this.getEditor().wrapLinkAtSelection(id);\r\n        this.addGraphMapping(id, graph_node);\r\n    }\r\n\r\n    addGraphMapping(id, graph_node) {\r\n        graph_node.setIsOnGraph(true);\r\n        this.map[id] = { graph_node: graph_node };\r\n    }\r\n\r\n    setLinkMapping(id, doc_node, long_or_short) {\r\n        if (!this.map[id]) {\r\n            // uh oh, this should exist\r\n            this.map[id] = {}\r\n\r\n            // maybe the mapping was deleted and re-added with ctrl-Z\r\n            // if so, hopefully it's stored as recently deleted\r\n            this.checkRecycleBinForGraphNode(id)\r\n        }\r\n\r\n        if (this.map[id].doc_nodes === undefined) {\r\n            this.map[id].doc_nodes = {};\r\n        }\r\n        this.map[id].doc_nodes[long_or_short] = doc_node;\r\n    }\r\n\r\n    getGraphNodeAndDocNode(id) {\r\n        return this.map[id];\r\n    }\r\n\r\n    checkRecycleBinForGraphNode(id) {\r\n        if (!this.map[id]) {\r\n            this.map[id] = {}\r\n        }\r\n\r\n        if (this.map[id].graph_node) {\r\n            // no need to restore\r\n            return;\r\n        }\r\n\r\n        const prev_version = this.map_recycle_bin[id]\r\n        if (prev_version && prev_version.graph_node) {\r\n            console.log('restored from recycle');\r\n            \r\n            this.addGraphMapping(id, prev_version.graph_node)\r\n        }\r\n    }\r\n\r\n    getGraphNode(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.graph_node;\r\n        }\r\n    }\r\n\r\n    removeGraphNode(id) {\r\n        if (this.getDocNodes(id)) {\r\n            Object.values(this.getDocNodes(id)).forEach(node => {\r\n                this.getEditor().removeGraphLink(node);\r\n            })\r\n            this.map[id] = undefined;\r\n        }\r\n    }\r\n\r\n    removeDocNode(id) {\r\n        var map = this.getGraphNodeAndDocNode(id)\r\n        if (map) {\r\n            if (map.graph_node) {\r\n                map.graph_node.setIsOnGraph(false);\r\n            }\r\n            \r\n            this.map_recycle_bin[id] = this.map[id]\r\n            this.map[id] = undefined\r\n        }\r\n    }\r\n\r\n    getDocNodes(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.doc_nodes;\r\n        }\r\n    }\r\n\r\n    getDocNodeShortText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.short;\r\n        }\r\n    }\r\n\r\n    getDocNodeLongText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.long;\r\n        }\r\n    }\r\n\r\n    getDocNodeRef(id, long_or_short) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map && map.doc_link_node) {\r\n            return map.doc_link_node[long_or_short].current;\r\n        }\r\n    }\r\n\r\n    getAllDocNodeRefs(id) {\r\n        var docNodes = [];\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\r\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\r\n                    docNodes.push(map.doc_link_node[long_or_short].current)\r\n                }\r\n            })\r\n        }\r\n        return docNodes;\r\n    }\r\n\r\n    registerLinkNode(id, ref, long_or_short) {\r\n        if (this.map[id].doc_link_node === undefined) {\r\n            this.map[id].doc_link_node = {};\r\n        }\r\n        this.map[id].doc_link_node[long_or_short] = ref;\r\n    }\r\n\r\n    // check whether a graph node's doc node still exists\r\n    updateIsOnGraphStatus(id) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        if (!docNode) {\r\n            return false\r\n        }\r\n\r\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\r\n            // tell the graph node that there is no doc node any more, for whatever reason\r\n            this.removeDocNode(id)\r\n            return false\r\n        }\r\n\r\n        return true\r\n    }\r\n\r\n    updateDocShortText(id, newText) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        \r\n        if (docNode) {\r\n            var editor = this.getEditor();\r\n\r\n            if (this.updateIsOnGraphStatus(id)) {\r\n                // replace any text with newText\r\n                docNode.nodes.forEach(child => {\r\n                    editor.removeNodeByKey(child.key);\r\n                });\r\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\r\n            }\r\n        }\r\n    }\r\n\r\n    updateGraphShortText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateShortText(newText);            \r\n        }\r\n    }\r\n\r\n    updateGraphLongText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateLongText(newText);            \r\n        }\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './LoadProject.css'\r\nimport db from '../../db.js'\r\nimport ProjectList from './ProjectsList.js'\r\nimport SharedState from '../../shared_state.js';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class LoadProject extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            projects: []\r\n        };\r\n        this.addProject = this.addProject.bind(this)\r\n        this.deleteProject = this.deleteProject.bind(this)\r\n        this.loadProject = this.loadProject.bind(this)\r\n        this.renameProject = this.renameProject.bind(this)\r\n        this.duplicateProject = this.duplicateProject.bind(this)\r\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\r\n        \r\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\r\n        if (this.props.autoload) {\r\n            this.loadProject(this.props.autoload)\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (!this.props.autoload) {\r\n            this.updateProjectsFromDb()\r\n        }\r\n    }\r\n\r\n    updateProjectsFromDb() {\r\n        // todo - only retrieve relevant rows from projects table?\r\n        db.table('projects')\r\n            .toArray(projects => {\r\n                this.setState({ projects })\r\n            }).catch(err => {\r\n                toast.error(\"Error when loading projects: \" + err)\r\n            })\r\n    }\r\n\r\n    loadProject(id) {\r\n        const params = { condition: 'graph' }\r\n        const sharedState = new SharedState(id, params)\r\n        this.props.transitionToEditor(sharedState)\r\n    }\r\n\r\n    addProject() {\r\n        const project = {name: window.prompt('Name your project', 'New project')}\r\n        if (project.name) {\r\n            db.table('projects')\r\n                .add(project)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                });\r\n        }\r\n    }\r\n\r\n    renameProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                const newName = window.prompt('Set a new project name', project.name)\r\n                if (newName) {\r\n                    db.table('projects')\r\n                        .update(id, { name: newName })\r\n                        .then(() => {\r\n                            this.updateProjectsFromDb()\r\n                        })\r\n                }\r\n            });\r\n    }\r\n\r\n    duplicateProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                project.name += ' (copy)'\r\n                delete project.id // set a new one automatically\r\n                db.table('projects')\r\n                    .add(project)\r\n                    .then(() => {\r\n                        this.updateProjectsFromDb()\r\n                    });\r\n            })\r\n    }\r\n\r\n    deleteProject(id) {\r\n        db.table('projects')\r\n            .delete(id)\r\n            .then(() => {\r\n                this.updateProjectsFromDb()\r\n            })\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n            <div className=\"load-project\">\r\n                <ProjectList projects={this.state.projects}\r\n                    deleteProject={this.deleteProject}\r\n                    loadProject={this.loadProject}\r\n                    renameProject={this.renameProject}\r\n                    duplicateProject={this.duplicateProject}\r\n                />\r\n                <p>\r\n                    <button className=\"pure-button pure-button-primary\" onClick={this.addProject}>New project</button>\r\n                </p>\r\n            </div>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react';\r\nimport './ExperimentalControls.css';\r\n\r\nexport default class ExperimentControls extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"experiment-controls\">\r\n                <button onClick={this.props.backToMenu}>Back</button>\r\n                <button onClick={this.props.sharedState.save}>Save</button>\r\n            </div>\r\n        );\r\n    }\r\n}","/* eslint-disable no-fallthrough */\r\n/* eslint-disable default-case */\r\nimport React, { Component } from 'react';\r\nimport './App.css';\r\nimport DocPane from './components/doc/DocPane.js';\r\nimport GraphPane from './components/graph/GraphPane.js';\r\nimport SplitPane from 'react-split-pane';\r\nimport LoadProject from './components/loadproject/LoadProject.js';\r\nimport { DndProvider } from 'react-dnd'\r\nimport Backend from 'react-dnd-html5-backend'\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport SaveButton from './components/experiment/SaveButton';\r\n\r\n\r\nexport default class App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            phase: \"loadproject\",\r\n            params: undefined\r\n        }\r\n\r\n        this.transitionToEditor = this.transitionToEditor.bind(this)\r\n        this.transitionToMenu = this.transitionToMenu.bind(this)\r\n    }\r\n\r\n    transitionToEditor(newSharedState) {\r\n        this.setState({ \r\n            sharedState: newSharedState,\r\n            phase: \"editor\"\r\n        })\r\n    }\r\n\r\n    transitionToMenu() {\r\n        if (this.state.sharedState) {\r\n            this.state.sharedState.finishCondition()\r\n        }\r\n        this.setState({\r\n            sharedState: undefined,\r\n            phase: \"loadproject\"\r\n        })\r\n    }\r\n\r\n    render() {\r\n        switch(this.state.phase) {\r\n            case \"loadproject\":\r\n                return (\r\n                    <LoadProject transitionToEditor={this.transitionToEditor} autoload={false} />\r\n                )\r\n            case \"editor\":\r\n                return (\r\n                    <div className=\"App\">\r\n                        <DndProvider backend={Backend}>\r\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\r\n                                <DocPane sharedState={this.state.sharedState} />\r\n                                <GraphPane sharedState={this.state.sharedState} />\r\n                            </SplitPane>\r\n                            <SaveButton sharedState={this.state.sharedState} backToMenu={this.transitionToMenu} />\r\n                        </DndProvider>\r\n                        <ToastContainer\r\n                            position=\"bottom-center\"\r\n                            autoClose={5000}\r\n                            hideProgressBar\r\n                            newestOnTop={false}\r\n                            closeOnClick\r\n                            rtl={false}\r\n                            pauseOnFocusLoss\r\n                            draggable={false}\r\n                            pauseOnHover\r\n                        />\r\n                    </div>\r\n                );\r\n            \r\n            case \"reset\":\r\n                // hacky way to destroy and recreate all components\r\n                window.setTimeout(() => this.setState({phase: \"editor\"}), 0.1)\r\n                return (\r\n                    <p>...</p>\r\n                )\r\n        }\r\n    }\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}