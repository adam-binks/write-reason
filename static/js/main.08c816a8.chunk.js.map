{"version":3,"sources":["assets/CrimsonText-Regular.ttf","assets/CrimsonText-Bold.ttf","assets/logo.png","assets/instructions.mp4","assets/thumbnail.png","components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/StyleButton.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","components/loadproject/ProjectsList.js","logging.js","shared_state.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","components/loadproject/IntroSection.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","this","hidePopup","bind","div","document","createElement","classList","add","appendChild","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","e","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","remove","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","id","node","insertSectionBlock","text","longText","logger","logEvent","removeFirstNode","value","nodes","size","link","Block","create","type","data","node_id","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","removeNodeByKey","get","key","handleMouseUp","clickedNode","resetPos","getGraphNode","focus","getParent","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","deleteNode","old","new","setNodeByKey","newStyle","moveToRangeOfNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","getEmptyParagraph","wrapBlockByKey","insertInline","insertText","convertToInline","querySelector","removeDocNode","StyleButton","props","show","onClick","Component","LinkNode","state","hover","externalHover","setHover","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","graphNode","addGraphNode","position","moveTo","blur","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","blockTarget","innerDiv","mouse","getClientOffset","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","onMouseOver","onMouseUp","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","map","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","code","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","destOffset","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","moveToStartOfNode","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","moveBackward","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","t","n","r","s","o","u","require","a","i","f","Error","l","call","1","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","toString","ids","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","x2centre","grad","vals","rightLeftCalc","topBotCalc","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","keys","Array","isArray","Object","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","updateName","newValue","substring","finishEditing","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","removeChild","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","setArrowColour","selected_option","newRelation","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","isOnGraph","getNodeId","translate","dropShadow","radius","arrow_hitbox","editRect","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","editText","doNotDeleteIfEmptyText","setIsOnGraph","isFromJSON","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","rectHeight","delete_if_empty_text","textarea","preEditText","screen_coords","display","scrollHeight","save_changes","updateDocShortText","save_and_hide","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","graphPane","$el","panZoom","zoomMin","zoomMax","root_point","doc","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","setAttribute","loadNodesFromJSON","getNodeById","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","el","db","Dexie","version","stores","projects","ProjectsList","project","role","aria-label","loadProject","renameProject","duplicateProject","deleteProject","EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY","Logger","db_id","shouldLogToConsole","conditions","logToConsole","JSON","stringify","stateIsDirty","getLog","events","timestamp","Date","setLog","save","saves","then","catch","err","msg","SharedState","onDataLoad","doc_value","graph_value","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getEditor","getArgumentMarkdown","downloadExperimentData","exportPDF","onbeforeunload","getStateIsDirty","returnValue","mapFromJSON","projectName","title","lastSavedDocumentState","changes","mapToJSON","idExists","info","logSaveState","message","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","argument","logs","file","Blob","href","URL","createObjectURL","download","getExperimentId","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","getReactPdfDocument","markdown","Font","register","family","fonts","src","CrimsonText","CrimsonTextBold","fontWeight","styles","StyleSheet","page","fontFamily","paddingBottom","heading","textDecoration","startsWith","pdf","toBlob","getArgumentHTML","regex","replacement","innerText","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LoadProject","addProject","updateProjectsFromDb","transitionToEditor","prompt","newName","ExperimentControls","backToMenu","IntroSection","Logo","alt","Video","poster","Thumbnail","App","phase","transitionToMenu","getStorageUsed","newSharedState","finishCondition","navigator","storage","estimate","storageUsed","usage","quota","toPrecision","autoload","DndProvider","backend","Backend","defaultSize","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","process","fetch","response","contentType","headers","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.08c816a8.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Regular.62f10d46.ttf\";","module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Bold.89b16aa6.ttf\";","module.exports = __webpack_public_path__ + \"static/media/logo.09afe702.png\";","module.exports = __webpack_public_path__ + \"static/media/instructions.e7449ed9.mp4\";","module.exports = \"data:image/png;base64,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\"","export default class OptionPopup {\r\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\r\n        this.hidePopup = this.hidePopup.bind(this)\r\n\r\n        this.div = document.createElement(\"div\");\r\n        this.div.classList.add(\"option-popup-div\");\r\n        this.div.appendChild(this.generateTable(entries, callback, selected));\r\n        this.div.style.left = x + \"px\";\r\n        this.div.style.top = y + \"px\";\r\n\r\n        if (parent === undefined) {\r\n            parent = document.getElementById(\"graph\");\r\n        }\r\n        parent.appendChild(this.div);\r\n\r\n        // prevent the popup from showing up partially offscreen\r\n        const rect = this.div.getBoundingClientRect()\r\n        if (rect.right > window.innerWidth) {\r\n            this.div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\r\n        }\r\n        if (rect.bottom > window.innerHeight) {\r\n            this.div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\r\n        }\r\n\r\n        if (shouldHideOnClickOutside) {\r\n            setTimeout(() => this.hideOnClickOutside(this.div), 0.01);\r\n        }\r\n    }\r\n\r\n    generateTable(entries, callback, selected) {\r\n        var table = document.createElement(\"table\");\r\n        entries.forEach(entry => {\r\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\r\n\r\n            var row = table.insertRow();\r\n            row.classList.add(\"option-row\");\r\n            if (entry.name === selected) {\r\n                row.classList.add(\"option-row-selected\");\r\n            }\r\n\r\n            const selectItem = (e) => {\r\n                if (entry.isClickable) {                    \r\n                    callback(entry);\r\n                    this.hidePopup();\r\n                }\r\n            }\r\n\r\n            var colourCell = row.insertCell();\r\n            colourCell.textContent = entry.symbol;\r\n            colourCell.style.color = entry.colour;\r\n            colourCell.style.fontSize = \"150%\";\r\n            colourCell.style.padding = '10px'\r\n            \r\n            var nameCell = row.insertCell();\r\n            nameCell.classList.add('option-cell')\r\n            nameCell.textContent = entry.name\r\n\r\n            colourCell.addEventListener('click', selectItem)\r\n            nameCell.addEventListener('click', selectItem)\r\n\r\n            if (entry.buttons) {\r\n                entry.buttons.forEach(buttonEntry => {\r\n                    var buttonCell = row.insertCell()\r\n                    var button = document.createElement('BUTTON')\r\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\r\n                    button.className = \"pure-button\"\r\n                    button.style.padding = \"0px 10px 0px 10px\"\r\n                    buttonCell.appendChild(button)\r\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \r\n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row, selected: entry.name === selected,\r\n                            hidePopup: this.hidePopup})\r\n                })\r\n            }\r\n        });\r\n\r\n        return table;\r\n    }\r\n\r\n    hidePopup() {\r\n        this.div.remove()\r\n    }\r\n\r\n    hideOnClickOutside(element) {\r\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\r\n\r\n        const outsideClickListener = event => {\r\n            if (!element.contains(event.target) && isVisible(element)) {\r\n              element.remove();\r\n              removeClickListener()\r\n            }\r\n        }\r\n    \r\n        const removeClickListener = () => {\r\n            document.removeEventListener('click', outsideClickListener)\r\n        }\r\n    \r\n        document.addEventListener('click', outsideClickListener)\r\n        document.addEventListener('contextmenu', outsideClickListener)\r\n    }\r\n}","import { Block, Text } from 'slate';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default function GraphPlugin(options) {\r\n    return {\r\n        onMouseUp(event, editor, next) {\r\n            var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n            if (draggedNode) {\r\n                draggedNode.resetPos();\r\n\r\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n                    toast.error('You can\\'t add the same node twice!')\r\n                    console.log('Duplicate - editor')\r\n                } else {\r\n                    const target = editor.findEventRange(event)\r\n                    if (target) {\r\n                        editor.select(target)\r\n\r\n                        // prevent insertion inside an inline link\r\n                        // (insertion inside a section is fixed by schema)\r\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\r\n                        if (linkNode) {\r\n                            editor.moveToEndOfNode(linkNode)\r\n                        }\r\n\r\n                        addSection(draggedNode, editor)\r\n                    }\r\n                }\r\n            }\r\n            next();\r\n        },\r\n        \r\n        onBlur(event, editor, next) {\r\n            editor.deselect();\r\n            next();\r\n        },\r\n\r\n        commands: {\r\n            removeGraphLink(editor, node) {\r\n                const document = editor.value.document\r\n                if (!document.hasNode(node.key)) {\r\n                    console.log('couldnt remove graph link, node doesnt exist');\r\n                    \r\n                    return\r\n                }\r\n\r\n                if (node.type === \"section\") {\r\n                    // move the children out from inside this section to be after it\r\n                    const section_index = editor.value.document.nodes.indexOf(node)\r\n                    if (section_index !== -1) {\r\n                        var child_index = 0;\r\n                        node.nodes.forEach(child => {\r\n                            if (!document.hasNode(child.key)) {\r\n                                return\r\n                            }\r\n\r\n                            const nodeStyle = node.data.get(\"nodeStyle\")\r\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\r\n                                editor.removeNodeByKey(child.key)\r\n                            } else {\r\n                                // offset varies because the link node has already been removed if body only\r\n                                const destOffset = (child_index === 1 && nodeStyle === \"Body only\") ? 1 : child_index + 1\r\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + destOffset)\r\n                            }\r\n\r\n                            child_index++\r\n                        });\r\n                    }\r\n                    editor.removeNodeByKey(node.key)\r\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \r\n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\r\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\r\n\r\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\r\n\r\n    editor.getSharedState().logger.logEvent({\r\n        'type': 'doc_create_from_node', \r\n        'node_id': draggedNode.id, \r\n        'short_text': draggedNode.text, \r\n        'long_text': draggedNode.longText\r\n    });\r\n}\r\n\r\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\r\n    // if its an empty document, prevent a blank node being shown above the section added\r\n    const removeFirstNode = editor.value.document.nodes.size === 1 && editor.value.document.text === \"\"\r\n    \r\n    var link = Block.create({\r\n        type: 'link',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: text})]\r\n    })\r\n\r\n    var body = Block.create({\r\n        type: 'body',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: longText})]\r\n    })\r\n\r\n    var section = Block.create({\r\n        type: 'section',\r\n        data: {node_id: id, nodeStyle: initialNodeStyle},\r\n        nodes: [link, body]\r\n    })\r\n\r\n    editor.insertBlock(section);\r\n    editor.moveToEndOfNode(section)\r\n\r\n    if (removeFirstNode) {\r\n        editor.removeNodeByKey(editor.value.document.nodes.get(0).key)\r\n    }\r\n\r\n    return section\r\n}\r\n\r\nexport function handleMouseUp(editor, clickedNode) {\r\n    var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n    if (draggedNode) {\r\n        draggedNode.resetPos();\r\n\r\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n            toast.error('You can\\'t add the same node twice!')\r\n            console.log('Duplicate - node');\r\n            \r\n        } else {\r\n            const { value } = editor\r\n            const { document } = value\r\n            editor.focus()\r\n\r\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\r\n                clickedNode = document.getParent(clickedNode);\r\n            }\r\n\r\n            editor.moveToEndOfNode(clickedNode);\r\n\r\n            addSection(draggedNode, editor);\r\n\r\n            editor.getSharedState().draggedNode = false;\r\n            return true;\r\n        }\r\n    }\r\n}","import { Block } from 'slate';\r\nimport OptionPopup from '../graph/OptionPopup.js'\r\nimport { insertSectionBlock } from './GraphPlugin.js';\r\n\r\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\r\n    var entries = [\r\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"\"},\r\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"\"},\r\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"\"},\r\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"\"},\r\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\r\n    ]\r\n\r\n    if (entriesToHide) {\r\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    const onOptionSelect = (selectedEntry) => {\r\n        const selected = selectedEntry.name\r\n        if (selected === \"Delete\") {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_delete\",\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n            deleteNode(node, editor);\r\n        } else {\r\n            var nodeStyle = node.data.get(\"nodeStyle\")\r\n            if (!nodeStyle) {\r\n                nodeStyle = \"Inline\"\r\n            }\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_change_format\",\r\n                old: nodeStyle,\r\n                new: selected,\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n\r\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\r\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\r\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\r\n                convertFromInline(node, editor, selected)\r\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\r\n                convertToInline(node, editor, selected)\r\n            }\r\n        }\r\n    }\r\n\r\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\r\n}\r\n\r\nexport function deleteNode(node, editor) {\r\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\r\n\r\n    editor.removeNodeByKey(node.key)\r\n\r\n    if (editor.value.document.nodes.size === 0) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n}\r\n\r\nfunction convertFromInline(node, editor, newStyle) {\r\n    editor.moveToRangeOfNode(node);\r\n    const parent = editor.value.document.getParent(node.key)\r\n    if (parent && parent.text === node.text) {\r\n        editor.moveToRangeOfNode(parent)\r\n    }\r\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, \"\", newStyle)    \r\n}\r\n\r\nfunction getEmptyParagraph() {\r\n    return Block.create({\r\n        type: 'paragraph'\r\n    })\r\n}\r\n\r\nfunction convertToInline(node, editor) {\r\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\r\n    // need to get 0th child because previous of section is the body inside it\r\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\r\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\r\n\r\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\r\n    if (!prev && !next) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n\r\n    editor.moveToRangeOfNode(node)\r\n\r\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\r\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\r\n        editor.wrapBlockByKey(node.key, \"paragraph\")\r\n        editor.removeNodeByKey(node.key)\r\n    } else {\r\n        editor.removeNodeByKey(node.key)\r\n    }\r\n\r\n    editor.insertInline({\r\n            type: \"link\",\r\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\r\n        })\r\n        .insertText(shortText)\r\n}\r\n\r\nexport const getNodeStyleClass = (verbose) => {\r\n    switch (verbose) {\r\n        case \"Heading only\":\r\n            return \" hide-body\"\r\n\r\n        case \"Body only\":\r\n            return \" hide-heading\"\r\n    \r\n        default:\r\n            return \"\";\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport { showNodeSwitchMenu } from './NodeSwitch';\r\n\r\nexport default class StyleButton extends Component {\r\n    render() {\r\n        return (<button \r\n                    className={'style-button pure-button '\r\n                                 + ((this.props.nodeStyle === 'section') ? 'style-button-section' : 'style-button-inline')\r\n                                 + (this.props.show ? \"\" : \" not-visible\")}\r\n                    onClick={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\r\n                        <p className='eye-icon'></p>\r\n                </button>)\r\n    }\r\n}","import React, { Component } from 'react'\r\nimport StyleButton from '../StyleButton'\r\n\r\nexport default class LinkNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        \r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_cursor\", cursorInside)\r\n        }\r\n        \r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"node-link\" + hoverClass;\r\n\r\n        if (this.props.linkStyle === \"heading\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    <u><b>{this.props.children}</b></u>\r\n                </p>\r\n            );\r\n\r\n        } else if (this.props.linkStyle === \"inline\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}\r\n                        onMouseEnter={() => this.setHover(true)} \r\n                        onMouseLeave={() => this.setHover(false)}>\r\n                    {this.props.children}\r\n                    <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='inline' show={this.state.hover} />\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","import React, { Component } from 'react';\r\n\r\nexport default class BodyNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n        this.selectNode = props.selectNode;\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\r\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\r\n\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"body_cursor\", cursorInside);\r\n            node.setHoverer(\"body_mouse\", this.state.hover);\r\n        }\r\n\r\n        if (this.props.isEmpty) {\r\n                return (\r\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\r\n                        Type some text...{this.props.children}\r\n                    </p>\r\n                );\r\n        } else {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","export const ItemTypes = {\r\n    BLOCK: \"block\",\r\n}","import { DragSource } from 'react-dnd';\r\nimport { ItemTypes } from '../../dragtypes';\r\nimport { addSection } from './GraphPlugin.js'\r\n\r\nconst blockSource = {\r\n    canDrag(props) {\r\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\r\n        return props.editor.value.selection.isCollapsed\r\n    },\r\n\r\n    beginDrag(props) {\r\n      // Return the data describing the dragged item\r\n      const item = { id: props.node.id, node: props.node }\r\n      return item\r\n    },\r\n\r\n    endDrag(props, monitor, component) {\r\n        if (!monitor.didDrop()) {            \r\n            return\r\n        }\r\n\r\n        const dropResult = monitor.getDropResult()\r\n        const sharedState = props.editor.getSharedState()\r\n\r\n        if (dropResult.droppedOnGraph) {\r\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\r\n            const draggedNode = {\r\n                id: graphNode.id,\r\n                node: graphNode,\r\n                text: \"\",\r\n                longText: props.node.text\r\n            }\r\n            props.editor.moveTo(props.node.key)\r\n            \r\n            addSection(draggedNode, props.editor, \"Body only\")\r\n            props.editor.removeNodeByKey(props.node.key)\r\n            props.editor.blur()\r\n        } else {\r\n            const document = props.editor.value.document;\r\n            const blockParent = document.getParent(props.node.key);\r\n            const blockIndex = blockParent.nodes.indexOf(props.node);\r\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\r\n\r\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\r\n\r\n            sharedState.logger.logEvent({\r\n                'type': 'reorder',\r\n                'id': props.node.data.get('node_id'),\r\n                'old_index': blockIndex,\r\n                'new_index': dropResult.indexDroppedOn + indexShift,\r\n            });\r\n        }\r\n    },\r\n  }\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDragSource: connect.dragSource(),\r\n        dragPreview: connect.dragPreview(),\r\n        isDragging: monitor.isDragging(),\r\n    }\r\n}\r\n\r\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\r\nimport { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst blockTarget = {\r\n    hover(props, monitor, component) {\r\n        const mouse = monitor.getClientOffset();\r\n\r\n        // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\r\n        const outerDiv = ReactDOM.findDOMNode(component)        \r\n        const outerRect = outerDiv.getBoundingClientRect()\r\n        \r\n        var innerDiv;\r\n        for (let item of outerDiv.children) {\r\n            if (item.classList.contains('plain-block') || item.classList.contains('section')) {\r\n                innerDiv = item;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!innerDiv) {\r\n            console.log('error: couldn\\'t find the inner div!');\r\n            return\r\n        }\r\n        const innerRect = innerDiv.getBoundingClientRect()       \r\n    \r\n        // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\r\n        const offset = (innerRect.y - outerRect.y)\r\n        var newState = false\r\n        if (mouse.y + offset > (innerRect.y + innerRect.height / 2)) {\r\n            newState = true\r\n        }\r\n        if (component.state.overHalf !== newState) {\r\n            component.setState({overHalf: newState});\r\n        }\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        const document = props.editor.value.document;\r\n        const blockParent = document.getParent(props.node.key);\r\n        const blockIndex = blockParent.nodes.indexOf(props.node);\r\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        isOver: monitor.isOver(),\r\n        isOverCurrent: monitor.isOver({ shallow: true }),\r\n        canDrop: monitor.canDrop(),\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\nimport { getNodeStyleClass } from '../NodeSwitch';\r\nimport StyleButton from '../StyleButton';\r\n\r\nclass SectionNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"section_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\r\n\r\n        const value = this.props.editor.value\r\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\r\n\r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\r\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}}\r\n                        ref={connectDragSource}>\r\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='section' show={this.state.hover} />}\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(SectionNode))","\r\nimport { getEventTransfer } from 'slate-react';\r\n\r\nexport default function LoggingPlugin(options) {\r\n    return {\r\n        onCopy(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"copy\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onCut(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"cut\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            var transfer = getEventTransfer(event);\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"paste\",\r\n                paste_type: transfer.type,\r\n                content: transfer.fragment ? transfer.fragment.text : \"\",\r\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\r\n            });\r\n            \r\n            next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\n\r\nclass PlainBlockNode extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            hover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\r\n\r\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'>\r\n                {(isOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} \r\n                        onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node) && this.setState({hover: false})}} \r\n                        onMouseEnter={() => this.setHover(true)} onMouseOver={() => this.setHover(true)} onMouseLeave={() => this.setHover(false)}\r\n                        ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(isOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                {(this.state.hover && this.props.editor.getSharedState().draggedNode) && <div className=\"drop-indicator\" />}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\r\nimport { cx, css } from 'emotion'\r\n\r\nexport const Button = React.forwardRef(\r\n  ({ className, active, reversed, ...props }, ref) => (\r\n    <span\r\n      {...props}\r\n      ref={ref}\r\n      className={cx(\r\n        className,\r\n        css`\r\n          cursor: pointer;\r\n          color: ${reversed\r\n            ? active ? 'white' : '#aaa'\r\n            : active ? 'black' : '#ccc'};\r\n        `\r\n      )}\r\n    />\r\n  )\r\n)\r\n\r\nexport const EditorValue = React.forwardRef(\r\n  ({ className, value, ...props }, ref) => {\r\n    const textLines = value.document.nodes\r\n      .map(node => node.text)\r\n      .toArray()\r\n      .join('\\n')\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        {...props}\r\n        className={cx(\r\n          className,\r\n          css`\r\n            margin: 30px -20px 0;\r\n          `\r\n        )}\r\n      >\r\n        <div\r\n          className={css`\r\n            font-size: 14px;\r\n            padding: 5px 20px;\r\n            color: #404040;\r\n            border-top: 2px solid #eeeeee;\r\n            background: #f8f8f8;\r\n          `}\r\n        >\r\n          Slate's value as text\r\n        </div>\r\n        <div\r\n          className={css`\r\n            color: #404040;\r\n            font: 12px monospace;\r\n            white-space: pre-wrap;\r\n            padding: 10px 20px;\r\n            div {\r\n              margin: 0 0 0.5em;\r\n            }\r\n          `}\r\n        >\r\n          {textLines}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\n\r\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\r\n  <span\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      'material-icons',\r\n      className,\r\n      css`\r\n        font-size: 18px;\r\n        vertical-align: text-bottom;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        white-space: pre-wrap;\r\n        margin: 0 -20px 10px;\r\n        padding: 10px 20px;\r\n        font-size: 14px;\r\n        background: #f8f8e8;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        & > * {\r\n          display: inline-block;\r\n        }\r\n\r\n        & > * + * {\r\n          margin-left: 15px;\r\n        }\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\r\n  <Menu\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        position: relative;\r\n        padding: 1px 18px 17px;\r\n        margin: 0 -20px;\r\n        border-bottom: 2px solid #eee;\r\n        margin-bottom: 20px;\r\n      `\r\n    )}\r\n  />\r\n))","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { css } from 'emotion'\r\nimport { Button, Icon, Menu } from './SlateComponents.js'\r\n\r\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\r\n\r\nconst MarkButton = ({ editor, type, icon }) => {\r\n  const { value } = editor\r\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\r\n  return (\r\n    <Button\r\n      reversed\r\n      active={isActive}\r\n      onMouseDown={event => {\r\n        event.preventDefault()\r\n        editor.setBlocks((isActive ? \"paragraph\" : type))\r\n\r\n        editor.getSharedState().logger.logEvent({\r\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\r\n      });\r\n      }}\r\n    >\r\n      <Icon>{icon}</Icon>\r\n    </Button>\r\n  )\r\n}\r\n\r\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\r\n  const root = window.document.getElementById('root')\r\n  return ReactDOM.createPortal(\r\n    <Menu\r\n      ref={ref}\r\n      className={css`\r\n        padding: 8px 7px 6px;\r\n        position: absolute;\r\n        z-index: 1;\r\n        top: -10000px;\r\n        left: -10000px;\r\n        margin-top: -6px;\r\n        opacity: 0;\r\n        background-color: #222;\r\n        border-radius: 4px;\r\n        transition: opacity 0.25s;\r\n      `}\r\n    >\r\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\r\n    </Menu>,\r\n    root\r\n  )\r\n})\r\n\r\n\r\nclass HoveringMenu extends React.Component {\r\n\r\n  menuRef = React.createRef()\r\n\r\n  componentDidMount = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  componentDidUpdate = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  updateMenu = () => {\r\n    const menu = this.menuRef.current\r\n    if (!menu) return\r\n\r\n    const value = this.props.editor.value\r\n    const { fragment, selection } = value\r\n\r\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\r\n      menu.removeAttribute('style')\r\n      return\r\n    }\r\n\r\n    const native = window.getSelection()\r\n    const range = native.getRangeAt(0)\r\n    const rect = range.getBoundingClientRect()\r\n    menu.style.opacity = 1\r\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\r\n\r\n    menu.style.left = `${rect.left +\r\n      window.pageXOffset -\r\n      menu.offsetWidth / 2 +\r\n      rect.width / 2}px`\r\n  }\r\n\r\n  render = (props, editor, next) => {\r\n    return (\r\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default function HoveringMenuPlugin(options) {\r\n    return {\r\n        renderEditor (props, editor, next) {\r\n            const children = next()\r\n            return (\r\n              <React.Fragment>\r\n                {children}\r\n                <HoveringMenu editor={editor} />\r\n              </React.Fragment>\r\n            )\r\n          },\r\n\r\n        renderBlock (props, editor, next) {\r\n            switch (props.node.type) {\r\n            case 'heading':\r\n                return <u><b>{props.children}</b></u>\r\n            default:\r\n                return next()\r\n            }\r\n        },\r\n    }\r\n}","import { Block, Text } from 'slate';\r\n\r\nexport const schema = {\r\n    inlines: {\r\n        link: {\r\n            parent: [{type: ''}, {type: 'paragraph'}],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'parent_type_invalid':\r\n                        editor.unwrapInlineByKey(error.node.key)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled link inline err \" + error);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    blocks: {\r\n        section: {\r\n            parent: {object: \"document\"},\r\n            nodes: [\r\n                {\r\n                    match: {type: 'link'},\r\n                    min: 1,\r\n                    max: 1,\r\n                },\r\n                {\r\n                    match: {type: 'body'},\r\n                    min: 1,\r\n                    max: 1,\r\n                }\r\n            ],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'child_max_invalid':\r\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \r\n                        // this can happen if the enter key is pressed (splits the current node)\r\n                        moveBlockAfterSection(editor, error.child, error.node)\r\n                        editor.setNodeByKey(error.child.key, 'paragraph')\r\n                        return\r\n\r\n                    case 'child_type_invalid':\r\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \r\n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\r\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\r\n                            if (linkNode) {\r\n                                const textNode = linkNode.getLastText()\r\n                                const offset = textNode.text ? textNode.text.length : 0\r\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\r\n                            } else {\r\n                                addMissing(editor, error, \"link\", error.child.text)\r\n                            }\r\n                        }\r\n\r\n                        editor.removeNodeByKey(error.child.key)\r\n                        \r\n                        return\r\n                    \r\n                    case 'child_min_invalid':\r\n                        var hasChildTypes = [];\r\n                        error.node.nodes.forEach(node => {\r\n                            hasChildTypes.push(node.type)\r\n                        })\r\n                        \r\n                        if (!hasChildTypes.includes(\"link\")) {\r\n                            addMissing(editor, error, \"link\")\r\n                        }\r\n\r\n                        if (!hasChildTypes.includes(\"body\")) {\r\n                            addMissing(editor, error, \"body\")\r\n                        }\r\n\r\n                        return\r\n                    \r\n                    case 'parent_object_invalid':\r\n                        // a section has ended up inside another section - shift it out\r\n                        moveBlockAfterSection(editor, error.node, error.parent)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled section schema err \" + error);\r\n                        \r\n                        return\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\r\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\r\n    if (sectionIndex === -1) {\r\n        return\r\n    }\r\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\r\n}\r\n\r\nfunction addMissing(editor, error, nodeType, text=\"\") {\r\n    const node_id = error.node.data.get(\"node_id\")\r\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\r\n    if (!text) {\r\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\r\n    }\r\n    const index = nodeType === \"link\" ? 0 : 1\r\n\r\n    addBlock(editor, error.node, nodeType, index, node_id, text)\r\n}\r\n\r\nfunction addBlock(editor, parent, nodeType, index, id, text) {\r\n    var block = Block.create({\r\n        type: nodeType,\r\n        data: {node_id: id},\r\n        nodes: [Text.create({'text': text})]\r\n    })\r\n    editor.insertNodeByKey(parent.key, index, block);\r\n    \r\n}","import React from 'react';\r\nimport { Editor } from 'slate-react';\r\nimport { Value } from 'slate';\r\nimport NodePlugin from './NodePlugin.js';\r\nimport GraphPlugin from './GraphPlugin.js';\r\nimport LoggingPlugin from './LoggingPlugin.js';\r\nimport ReorderPlugin from './ReorderPlugin.js';\r\nimport HoveringMenu from './HoveringMenu.js';\r\nimport { schema } from './Schema.js'\r\n\r\nconst plugins = {\r\n    'graph': [\r\n        LoggingPlugin(),\r\n        GraphPlugin(),\r\n        NodePlugin(),\r\n        ReorderPlugin(),\r\n    ],\r\n    'plain': [\r\n        LoggingPlugin(),\r\n        HoveringMenu(),\r\n    ]\r\n};\r\n\r\nconst emptyValue = Value.fromJSON({\r\n    document: {\r\n        nodes: [\r\n            {\r\n                object: 'block',\r\n                type: 'paragraph',\r\n                nodes: [\r\n                    {\r\n                        object: 'text',\r\n                        text: '',\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n    },\r\n});\r\n\r\nclass DocEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.props.sharedState.editor_ref = React.createRef();\r\n    }\r\n\r\n    componentDidMount() {\r\n        const sharedState = this.props.sharedState\r\n        sharedState.getSavedDocValue((savedValue) => {\r\n            this.setState({\r\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\r\n            }, sharedState.editorHasLoaded)\r\n        })\r\n    }\r\n\r\n    state = {\r\n        value: undefined, // don't display editor until the db's saved document loads\r\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\r\n    }\r\n    \r\n    queries = {\r\n        getSharedState: () => {\r\n            return this.props.sharedState;\r\n        },\r\n        getValue: () => {\r\n            return this.state.value;\r\n        },\r\n        mapHasLoaded: () => {\r\n            this.setState({ mapHasLoaded: true })\r\n        }\r\n    }\r\n\r\n    onChange = ({ value }) => {\r\n        this.setState({ value })\r\n    }\r\n\r\n    render() {\r\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\r\n\r\n        if (this.state.value !== undefined) {\r\n            return <Editor\r\n                className={\"slate-editor\" + plainClass}\r\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\r\n                ref={this.props.sharedState.editor_ref}\r\n                schema={schema}\r\n                plugins={plugins[this.props.sharedState.condition]}\r\n                queries={this.queries}\r\n                value={this.state.value}\r\n                onChange={this.onChange}\r\n                placeholder=\"Write your document here...\"\r\n                spellCheck={true}\r\n            />\r\n        } else {\r\n            return <p></p>\r\n        }\r\n    }\r\n}\r\n\r\nexport default DocEditor;","import SVG from 'svg.js';\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\n(function e(t, n, r) {\r\n    function s(o, u) {\r\n        if (!n[o]) {\r\n            if (!t[o]) {\r\n                // eslint-disable-next-line no-sequences\r\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\r\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\r\n                var n = t[o][1][e];return s(n ? n : e);\r\n            }, l, l.exports, e, t, n, r);\r\n        }return n[o].exports;\r\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\r\n        s(r[o]);\r\n    }return s;\r\n})({ 1: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Id = require(\"idy\"),\r\n            SetOrGet = require(\"set-or-get\"),\r\n            IterateObject = require(\"iterate-object\"),\r\n            Deffy = require(\"deffy\");\r\n\r\n        // Internal cache\r\n        var _connections = {},\r\n            _betweenTwoBubbles = {},\r\n            container = null,\r\n            markers = null;\r\n\r\n        function delete_connectable(con) {\r\n            con.line.remove();\r\n            con.marker.remove();\r\n\r\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\r\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\r\n\r\n            var toString = function() {\r\n                var ids = [con.source.id(), con.target.id()],\r\n                    id1 = ids.join(\"->\"),\r\n                    id2 = ids.reverse().join(\"->\");\r\n\r\n                con._ = con.id = id1;\r\n\r\n                if (_betweenTwoBubbles[id2]) {\r\n                    con._ = id2;\r\n                    return id2;\r\n                }\r\n\r\n                con.id = id1;\r\n                return id1;\r\n            }\r\n\r\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\r\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\r\n        }\r\n\r\n        /**\r\n         * connectable\r\n         * Connects two elements.\r\n         *\r\n         * @name connectable\r\n         * @function\r\n         * @param {Object} options An object containing the following fields:\r\n         *\r\n         *  - `container` (SVGElement): The line elements container.\r\n         *  - `markers` (SVGElement): The marker elements container.\r\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\r\n         *\r\n         * @param {SVGElement} elmTarget The target SVG element.\r\n         * @return {Object} The connectable object containing:\r\n         *\r\n         *  - `source` (SVGElement): The source element.\r\n         *  - `target` (SVGElement): The target element.\r\n         *  - `line` (SVGElement): The line element.\r\n         *  - `marker` (SVGElement): The marker element.\r\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\r\n         *  - [`update` (Function)](#update)\r\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\r\n         */\r\n        function connectable(options, elmTarget) {\r\n\r\n            var con = {};\r\n\r\n            if (elmTarget === undefined) {\r\n                elmTarget = options;\r\n                options = {};\r\n            }\r\n\r\n            container = options.container || container;\r\n            var elmSource = this;\r\n            markers = options.markers || markers;\r\n\r\n            options.k = options.k || 100;\r\n            options.kk = options.kk || 10;\r\n\r\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\r\n                markerId = \"triangle-\" + Id(),\r\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\r\n            \r\n            if (options.specialCoords) {\r\n                line.addClass('connector-line');\r\n            }\r\n\r\n            marker.attr({\r\n                id: markerId,\r\n                viewBox: \"0 0 10 10\",\r\n                refX: \"0\",\r\n                refY: \"5\",\r\n                markerUnits: \"strokeWidth\",\r\n                markerWidth: \"4\",\r\n                markerHeight: \"5\"\r\n            });\r\n\r\n            marker.path().attr({\r\n                d: \"M 0 0 L 10 5 L 0 10 z\"\r\n            });\r\n\r\n            // Append the SVG elements\r\n            con.source = elmSource;\r\n            con.target = elmTarget;\r\n            con.line = line;\r\n            con.marker = marker;\r\n\r\n\r\n            if (options.specialCoords) {\r\n                // remove this when node is deleted\r\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\r\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\r\n            }\r\n\r\n            SetOrGet(_connections, con.source.id(), []).push(con);\r\n            SetOrGet(_connections, con.target.id(), []).push(con);\r\n\r\n            SetOrGet(_betweenTwoBubbles, {\r\n                toString: function toString() {\r\n                    var ids = [con.source.id(), con.target.id()],\r\n                        id1 = ids.join(\"->\"),\r\n                        id2 = ids.reverse().join(\"->\");\r\n\r\n                    con._ = con.id = id1;\r\n\r\n                    if (_betweenTwoBubbles[id2]) {\r\n                        con._ = id2;\r\n                        return id2;\r\n                    }\r\n\r\n                    con.id = id1;\r\n                    return id1;\r\n                }\r\n            }, []).push(con);\r\n            \r\n\r\n            /**\r\n             * computeLineCoordinates\r\n             * The function that computes the new coordinates.\r\n             * It can be overriden with a custom function.\r\n             *\r\n             * @name computeLineCoordinates\r\n             * @function\r\n             * @param {Connectable} con The connectable instance.\r\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\r\n             */\r\n            con.computeLineCoordinates = function (cons) {\r\n\r\n                var output = [],\r\n                    l = cons.length;\r\n\r\n                IterateObject(cons, function (con, i) {\r\n\r\n                    var sT = con.source.transform(),\r\n                        tT = con.target.transform(),\r\n                        sB = con.source.bbox(),\r\n                        tB = con.target.bbox(),\r\n                        x1 = sT.x + sB.width / 2,\r\n                        y1 = sT.y + sB.height / 2,\r\n                        x2 = tT.x + tB.width / 2,\r\n                        y2 = tT.y + tB.height / 2,\r\n                        cx = (x1 + x2) / 2,\r\n                        cy = (y1 + y2) / 2,\r\n                        dx = Math.abs((x1 - x2) / 2),\r\n                        dy = Math.abs((y1 - y2) / 2),\r\n                        dd = null,\r\n                        out = {\r\n                        x1: x1,\r\n                        y1: y1,\r\n                        x2: x2,\r\n                        y2: y2,\r\n                        ex: x1,\r\n                        ey: y1\r\n                    };\r\n\r\n                    if (i !== (l - 1) / 2) {\r\n                        dd = Math.sqrt(dx * dx + dy * dy);\r\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                    }\r\n                    output.push(out);\r\n                });\r\n\r\n                return output;\r\n            };\r\n\r\n            if (options.specialCoords) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var sT = con.source.transform(),\r\n                            tT = con.target.transform(),\r\n                            sB = con.source.bbox(),\r\n                            tB = con.target.bbox(),\r\n                            x1 = sT.x + sB.width / 2,\r\n                            y1 = sT.y + sB.height / 2 - 20;\r\n\r\n                        var xDiff = sT.x - tT.x;\r\n                        var yDiff = sT.y - tT.y;\r\n                        var x2, y2;\r\n\r\n                        var x2centre = tT.x + tB.width / 2\r\n                        var y2centre = tT.y + tB.height / 2\r\n\r\n                        var grad = (y2centre - y1) / ((x2centre - x1) === 0 ? 0.0000001 : (x2centre - x1))\r\n\r\n                        if (grad === 0) {\r\n                            grad = 0.0000001\r\n                        }\r\n\r\n                        var left = tT.x - 10\r\n                        var right = tT.x + tB.width - 30\r\n                        var top = tT.y - 10\r\n                        var bottom = tT.y + tB.height - 30\r\n                        \r\n                        var rightLeftCalc = () => {\r\n                            var x2 = xDiff < 0 ? left : right\r\n                            return { \r\n                                x: x2,\r\n                                y: ((x2 - x1) * grad) + y1\r\n                            }\r\n                        }\r\n\r\n                        var topBotCalc = () => {\r\n                            var y2 = yDiff < 0 ? top : bottom\r\n                            return {\r\n                                x: ((y2 - y1) * (1/grad)) + x1,\r\n                                y: y2\r\n                            }\r\n                        }\r\n\r\n                        var vals\r\n                        if (Math.abs(xDiff) >= Math.abs(yDiff)) {\r\n                            vals = rightLeftCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (y2 > bottom || y2 < top) {\r\n                                vals = topBotCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n\r\n                        } else {\r\n                            vals = topBotCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (x2 > right || x2 < left) {\r\n                                vals = rightLeftCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n                        }\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dx = Math.abs((x1 - x2) / 2),\r\n                            dy = Math.abs((y1 - y2) / 2),\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (i !== (l - 1) / 2) {\r\n                            dd = Math.sqrt(dx * dx + dy * dy);\r\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                        }\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            if (options.padEllipse) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\r\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\r\n                            xR1,\r\n                            xR2,\r\n                            yR1,\r\n                            yR2,\r\n                            sT = con.source.transform(),\r\n                            tT = con.target.transform()\r\n\r\n                        if (elmS.tagName === \"circle\") {\r\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\r\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\r\n                        } else {\r\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\r\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\r\n\r\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\r\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\r\n                        }\r\n\r\n                        // Get centers\r\n                        var sx = sT.x + xR1 / 2,\r\n                            sy = sT.y + yR1 / 2,\r\n                            tx = tT.x + xR2 / 2,\r\n                            ty = tT.y + yR2 / 2\r\n\r\n                        // Calculate distance from source center to target center\r\n                        ,\r\n                            dx = tx - sx,\r\n                            dy = ty - sy,\r\n                            d = Math.sqrt(dx * dx + dy * dy)\r\n\r\n                        // Construct unit vector between centers\r\n                        ,\r\n                            ux = dx / d,\r\n                            uy = dy / d\r\n\r\n                        // Point on source circle\r\n                        ,\r\n                            cx1 = sx + xR1 * ux,\r\n                            cy1 = sy + yR1 * uy\r\n\r\n                        // Point on target circle\r\n                        ,\r\n                            cx2 = sx + (d - xR2 - 5) * ux,\r\n                            cy2 = sy + (d - yR2 - 5) * uy;\r\n\r\n                        var x1 = cx1 + xR1 / 2,\r\n                            y1 = cy1 + yR1 / 2,\r\n                            x2 = cx2 + xR2 / 2,\r\n                            y2 = cy2 + yR2 / 2\r\n                        // TODO\r\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\r\n                        //  , angle = 0\r\n                        ;\r\n\r\n                        //if (i !== (l - 1) / 2) {\r\n                        //    angle = step * (i + 1);\r\n                        //}\r\n\r\n\r\n                        //var xC1 = (sT.x + xR1)\r\n                        //  , yC1 = (sT.y + yR1)\r\n                        //  , xC2 = (tT.y + xR2)\r\n                        //  , yC2 = (tT.y + yR2)\r\n                        //  , ddx1 = x1 - xC1\r\n                        //  , ddy1 = y1 - yC1\r\n                        //  , ddx2 = x2 - xC2\r\n                        //  , ddy2 = y2 - yC2\r\n                        //  , cosAngle = Math.cos(angle)\r\n                        //  , sinAngle = Math.sin(angle)\r\n                        //  , cosAngleM = Math.cos(-angle)\r\n                        //  , sinAngleM = Math.sin(-angle)\r\n                        //  ;\r\n\r\n                        // TODO This should change the points to arrange them on the circle\r\n                        //\r\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\r\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\r\n\r\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\r\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\r\n\r\n                        // ===================\r\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\r\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\r\n\r\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\r\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (isNaN(out.x1)) {\r\n                            out.x1 = sT.x + xR1 * 2;\r\n                            out.y1 = sT.y + yR1 / 2;\r\n                            out.x2 = sT.x;\r\n                            out.y2 = out.y1;\r\n                            out.ex = (out.x1 + out.x2) / 2;\r\n                            out.ey = out.y1 - options.kk * (i + 1);\r\n                        } else {\r\n                            dx = Math.abs((x1 - x2) / 2);\r\n                            dy = Math.abs((y1 - y2) / 2);\r\n\r\n                            if (i !== (l - 1) / 2) {\r\n                                dd = Math.sqrt(dx * dx + dy * dy);\r\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                            }\r\n                        }\r\n\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            elmSource.cons = elmSource.cons || [];\r\n            elmSource.cons.push(con);\r\n\r\n            /**\r\n             * update\r\n             * Updates the line coordinates.\r\n             *\r\n             * @name update\r\n             * @function\r\n             * @return {undefined}\r\n             */\r\n            con.update = function () {\r\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\r\n                    results = con.computeLineCoordinates(cons);\r\n\r\n                IterateObject(results, function (r, i) {\r\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\r\n                });\r\n            };\r\n\r\n            con.update();\r\n            elmSource.on(\"dragmove\", con.update);\r\n            elmTarget.on(\"dragmove\", con.update);\r\n\r\n            /**\r\n             * setLineColor\r\n             * Sets the line color.\r\n             *\r\n             * @name setLineColor\r\n             * @function\r\n             * @param {String} color The new color.\r\n             * @param {Connectable} c The connectable instance.\r\n             * @return {undefined}\r\n             */\r\n            con.setLineColor = function (color, c) {\r\n                c = c || this;\r\n                c.line.stroke(color);\r\n                c.marker.fill(color);\r\n            };\r\n\r\n            return con;\r\n        }\r\n\r\n        if (typeof SVG === \"function\") {\r\n            SVG.extend(SVG.Element, {\r\n                connectable: connectable,\r\n                delete_connectable: delete_connectable\r\n            });\r\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\r\n            throw new Error(\"SVG.js is not loaded but it is required.\");\r\n        }\r\n\r\n        module.exports = connectable;\r\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Typpy = require(\"typpy\");\r\n\r\n        /**\r\n         * Deffy\r\n         * Computes a final value by providing the input and default values.\r\n         *\r\n         * @name Deffy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Anything|Function} def The default value or a function getting the\r\n         * input value as first argument.\r\n         * @param {Object|Boolean} options The `empty` value or an object containing\r\n         * the following fields:\r\n         *\r\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\r\n         *\r\n         * @return {Anything} The computed value.\r\n         */\r\n        function Deffy(input, def, options) {\r\n\r\n            // Default is a function\r\n            if (typeof def === \"function\") {\r\n                return def(input);\r\n            }\r\n\r\n            options = Typpy(options) === \"boolean\" ? {\r\n                empty: options\r\n            } : {\r\n                empty: false\r\n            };\r\n\r\n            // Handle empty\r\n            if (options.empty) {\r\n                return input || def;\r\n            }\r\n\r\n            // Return input\r\n            if (Typpy(input) === Typpy(def)) {\r\n                return input;\r\n            }\r\n\r\n            // Return the default\r\n            return def;\r\n        }\r\n\r\n        module.exports = Deffy;\r\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\r\n        /**\r\n         * Typpy\r\n         * Gets the type of the input value or compares it\r\n         * with a provided type.\r\n         *\r\n         * Usage:\r\n         *\r\n         * ```js\r\n         * Typpy({}) // => \"object\"\r\n         * Typpy(42, Number); // => true\r\n         * Typpy.get([], \"array\"); => true\r\n         * ```\r\n         *\r\n         * @name Typpy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {String|Boolean} It returns `true` if the\r\n         * input has the provided type `target` (if was provided),\r\n         * `false` if the input type does *not* have the provided type\r\n         * `target` or the stringified type of the input (always lowercase).\r\n         */\r\n        function Typpy(input, target) {\r\n            if (arguments.length === 2) {\r\n                return Typpy.is(input, target);\r\n            }\r\n            return Typpy.get(input, true);\r\n        }\r\n\r\n        /**\r\n         * Typpy.is\r\n         * Checks if the input value has a specified type.\r\n         *\r\n         * @name Typpy.is\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {Boolean} `true`, if the input has the same\r\n         * type with the target or `false` otherwise.\r\n         */\r\n        Typpy.is = function (input, target) {\r\n            return Typpy.get(input, typeof target === \"string\") === target;\r\n        };\r\n\r\n        /**\r\n         * Typpy.get\r\n         * Gets the type of the input value. This is used internally.\r\n         *\r\n         * @name Typpy.get\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Boolean} str A flag to indicate if the return value\r\n         * should be a string or not.\r\n         * @return {Constructor|String} The input value constructor\r\n         * (if any) or the stringified type (always lowercase).\r\n         */\r\n        Typpy.get = function (input, str) {\r\n\r\n            if (typeof input === \"string\") {\r\n                return str ? \"string\" : String;\r\n            }\r\n\r\n            if (null === input) {\r\n                return str ? \"null\" : null;\r\n            }\r\n\r\n            if (undefined === input) {\r\n                return str ? \"undefined\" : undefined;\r\n            }\r\n\r\n            // eslint-disable-next-line no-self-compare\r\n            if (input !== input) {\r\n                return str ? \"nan\" : NaN;\r\n            }\r\n\r\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\r\n        };\r\n\r\n        module.exports = Typpy;\r\n    }, {}], 4: [function (require, module, exports) {\r\n        /**\r\n         * Idy\r\n         * Generates a random id and potentially unique.\r\n         *\r\n         * @name Idy\r\n         * @function\r\n         * @param {Number} length The id length (default: 10).\r\n         * @return {String} The generated id.\r\n         */\r\n        function Idy(length) {\r\n            length = length || 10;\r\n            return Math.random().toString(35).substr(2, length);\r\n        }\r\n\r\n        module.exports = Idy;\r\n    }, {}], 5: [function (require, module, exports) {\r\n        /**\r\n         * IterateObject\r\n         * Iterates an object. Note the object field order may differ.\r\n         *\r\n         * @name IterateObject\r\n         * @function\r\n         * @param {Object} obj The input object.\r\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\r\n         * @return {Function} The `IterateObject` function.\r\n         */\r\n        function IterateObject(obj, fn) {\r\n            var i = 0,\r\n                keys = [];\r\n\r\n            if (Array.isArray(obj)) {\r\n                for (; i < obj.length; ++i) {\r\n                    if (fn(obj[i], i, obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                keys = Object.keys(obj);\r\n                for (; i < keys.length; ++i) {\r\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        module.exports = IterateObject;\r\n    }, {}], 6: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Deffy = require(\"deffy\");\r\n\r\n        /**\r\n         * SetOrGet\r\n         * Sets or gets an object field value.\r\n         *\r\n         * @name SetOrGet\r\n         * @function\r\n         * @param {Object|Array} input The cache/input object.\r\n         * @param {String|Number} field The field you want to update/create.\r\n         * @param {Object|Array} def The default value.\r\n         * @return {Object|Array} The field value.\r\n         */\r\n        function SetOrGet(input, field, def) {\r\n            return input[field] = Deffy(input[field], def);\r\n        }\r\n\r\n        module.exports = SetOrGet;\r\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\r\n        arguments[4][2][0].apply(exports, arguments);\r\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\r\n        arguments[4][3][0].apply(exports, arguments);\r\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\r\nimport LinkNode from './nodes/LinkNode.js'\r\nimport BodyNode from './nodes/BodyNode.js'\r\nimport SectionNode from './nodes/SectionNode.js'\r\nimport { Block } from 'slate'\r\nimport { getEventTransfer } from 'slate-react';\r\nimport { deleteNode } from './NodeSwitch.js'\r\n\r\nexport default function LinkPlugin(options) {\r\n    return {\r\n        commands: {\r\n            wrapLinkAtSelection(editor, node_id) {\r\n                return editor.wrapInline({\r\n                    type: \"link\",\r\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\r\n                });\r\n            }\r\n        },\r\n\r\n        renderInline(props, editor, next) {\r\n            if (props.node.type === 'link') {\r\n                var { ref, id } = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        renderBlock(props, editor, next) {\r\n            var refAndId;\r\n\r\n            if (props.node.type === 'body') {\r\n                refAndId = getRefAndId(props, editor, \"long\");\r\n\r\n                // set up the placeholder text to only appear when the body is empty and no text is selected\r\n                var isEmpty = !props.node.text\r\n\r\n                var selectNode = () => {\r\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\r\n                }\r\n\r\n                return <BodyNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                            isEmpty={isEmpty}\r\n                            selectNode={selectNode}\r\n                        />\r\n\r\n            } else if (props.node.type === 'link') {\r\n                refAndId = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            linkStyle=\"heading\"\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                        />\r\n\r\n            } else if (props.node.type === 'section') {\r\n                refAndId = getRefAndId(props, editor, \"section\");\r\n\r\n                return <SectionNode\r\n                    ref={refAndId.ref}\r\n                    {...props}\r\n                    sharedState={editor.getSharedState()}\r\n                    nodeId={refAndId.id}\r\n                />\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        onDrop(event, editor, next) {\r\n            // suppress drop events\r\n            // do not call next()\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\r\n\r\n            var transfer = getEventTransfer(event);\r\n\r\n            if (transfer.type === \"fragment\") {\r\n\r\n                // if pasting into a link or body, just paste plain text, not a fragment\r\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\r\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\r\n                    editor.insertText(textNoNewlines)\r\n\r\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\r\n                    return\r\n                }\r\n\r\n                const fragmentInlines = getLinkInlines(transfer.fragment)\r\n\r\n                if (fragmentInlines) {\r\n                    const docInlines = getLinkInlines(editor.value.document)\r\n                    const usedIds = []\r\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\r\n                    \r\n                    // let the paste happen so we can operate on the document instead of inline\r\n                    next()\r\n\r\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\r\n                    fragmentInlines.forEach(inline => {\r\n                        usedIds.forEach(usedId => {\r\n                            const id = inline.data.get(\"node_id\")\r\n                            if (usedId.id === id) {\r\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\r\n                                inlinesWithId.forEach(inlineWithId => {\r\n                                    if (inlineWithId.key !== usedId.key) {\r\n                                        editor.unwrapInlineByKey(inlineWithId.key)\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                }\r\n            } else {\r\n                next()\r\n            }\r\n        },\r\n\r\n        onChange(editor, next) {\r\n            // update all node texts (both link and body)\r\n            const sharedState = editor.getSharedState();\r\n            [\r\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\r\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\r\n            ].forEach( update =>\r\n                editor.value.blocks.forEach(block => {\r\n                    const updateText = (linkNode) => {\r\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\r\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\r\n                        const id = linkNode.data.get('node_id')\r\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\r\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\r\n                            deleteNode(linkNode, editor)\r\n                        } else {\r\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\r\n                        }\r\n                    }\r\n\r\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\r\n                    linkNodes.forEach(updateText)\r\n\r\n                    if (block.type === update.nodeType) {\r\n                        updateText(block)\r\n                    }\r\n                })\r\n            )\r\n\r\n            next()\r\n        },\r\n\r\n        onKeyDown(e, editor, next) {\r\n            const { value } = editor\r\n            const { document, selection, startBlock} = value\r\n            const { start, end } = selection\r\n\r\n            // if a whole section (block or inline) is deleted, tell the graph node\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\r\n                document.getDescendantsAtRange(selection).forEach(node => {\r\n                    if (node.type === 'section' || node.type === 'link') {\r\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\r\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\r\n                        setTimeout(() => {\r\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\r\n                        }, 0)\r\n                    }\r\n                })\r\n            }\r\n\r\n            // prevent delete key from merging body and link blocks with next\r\n            if (e.key === \"Delete\") {\r\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\r\n                    const nextBlock = document.getNextBlock(start.key)\r\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\r\n                        editor.moveToStartOfNode(nextBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        }\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent backspace from merging body and link blocks with previous\r\n            if (e.key === 'Backspace') {\r\n                const prevBlock = document.getPreviousBlock(start.key)\r\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\r\n                    if (prevBlock) {\r\n                        editor.moveToEndOfNode(prevBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        } else if (prevBlock.text === \"\") {\r\n                            editor.removeNodeByKey(prevBlock.key)\r\n                         }\r\n                    }\r\n                    return editor\r\n                }\r\n            }\r\n\r\n            if (e.key === 'Enter') {\r\n                if (value.inlines.some(inline => inline.type === 'link')) {\r\n                    return // do nothing to avoid splitting the link\r\n                }\r\n\r\n                // when enter is pressed inside a link *block* (not inline), just go to body\r\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\r\n                    // unless the offset is 0, in which case insert a block before and go to that\r\n                    if (start.offset === 0) {\r\n                        const blockToInsert = Block.create({object: 'block', type: ''})\r\n                        const section = document.getParent(startBlock.key);\r\n                        const sectionParent = document.getParent(section.key);                    \r\n                        const sectionIndex = sectionParent.nodes.indexOf(section);\r\n\r\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\r\n                        return editor.moveBackward(1)\r\n                    } else {\r\n                        const nextBlock = document.getNextBlock(start.key)\r\n                        if (nextBlock) {\r\n                            return editor.moveToStartOfNode(nextBlock);\r\n                        } else {\r\n                            return editor.moveToEndOfNode(startBlock);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // prevent the cursor disappearing when navigating into the body placeholder text\r\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\r\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\r\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\r\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\r\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\r\n                    // its hard to work out how many lines of text there so use an estimate\r\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\r\n                        editor.moveToEndOfNode(relevantBlock)\r\n                        e.preventDefault()\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent tab from taking focus from the editor\r\n            if (e.key === 'Tab') {\r\n                e.preventDefault()\r\n            }\r\n\r\n            return next()\r\n        }\r\n    }\r\n\r\n    function getRefAndId(props, editor, long_or_short) {\r\n        var id = props.node.data.get(\"node_id\");\r\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\r\n        var ref = React.createRef();\r\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\r\n        return { ref, id };\r\n    }\r\n}","import React from 'react';\r\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\r\n\r\nexport default function ReorderPlugin(options) {\r\n    return {\r\n        renderBlock(props, editor, next) {            \r\n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\r\n                return <PlainBlockNode {...props}/>\r\n            }\r\n            \r\n            return next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './DocPane.css';\r\nimport DocEditor from './DocEditor.js'\r\n\r\nclass DocPane extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"pane doc\">\r\n                <DocEditor sharedState={this.props.sharedState} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\r\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\r\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\r\n\r\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\r\n\r\nconst COLOURS = [\r\n    'red',\r\n    'goldenrod',\r\n    'green',\r\n    'aqua',\r\n    'blue',\r\n    'fuchsia',\r\n    'purple',\r\n    'saddlebrown'\r\n]\r\n\r\nvar DEFAULT_ARROW_OPTIONS = [\r\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"\"},\r\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"\"},\r\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"\"},\r\n];\r\n\r\nexport default class MouseFollower {\r\n    constructor(shared_state, svg, connectables_container, markers, links) {\r\n        this.shared_state = shared_state;\r\n        this.drawing_arrow_from = false;\r\n        this.connector = undefined;\r\n        this.connectables_container = connectables_container;\r\n        this.markers = markers;\r\n        this.links = links;\r\n\r\n        this.arrow_id_counter = 0\r\n\r\n        this.completed_arrows = []\r\n\r\n        this.mouse_rect = svg.group();\r\n        window.addEventListener('mousemove', e => {\r\n            var point = svg.point(e.clientX, e.clientY);\r\n            this.mouse_rect.move(point.x, point.y);\r\n            \r\n            if (typeof(this.connector) !== 'undefined') {\r\n                this.connector.update();\r\n            }\r\n        });\r\n\r\n        // cancel arrows if they don't end on a node\r\n        window.addEventListener('mouseup', (e) => {\r\n            if (this.drawing_arrow_from) {\r\n                e.preventDefault();\r\n                this.stop_drawing_arrow();\r\n            }\r\n        });\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            arrows: this.completed_arrows,\r\n            arrow_id_counter: this.arrow_id_counter,\r\n            arrowOptions: this.arrowOptions,\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\r\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\r\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\r\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\r\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\r\n\r\n        return mf\r\n    }\r\n\r\n    // draw all the arrows in this.completed_arrows\r\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\r\n    draw_loaded_arrows(get_node) {\r\n        this.completed_arrows.forEach(arrow => {\r\n            const originNode = get_node(arrow.origin)\r\n            const destinationNode = get_node(arrow.destination)\r\n\r\n            if (!originNode) {\r\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\r\n                return\r\n            }\r\n\r\n            if (!destinationNode) {\r\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\r\n                return\r\n            }\r\n\r\n            const connector = this.draw_arrow(\r\n                originNode,\r\n                destinationNode,\r\n                arrow.colour\r\n            )\r\n            this.add_context_menu_to_arrow(connector, arrow)\r\n            \r\n            // update the arrow start and end points\r\n            originNode.group.node.dispatchEvent(new CustomEvent(\"dragmove\"))\r\n        })\r\n    }\r\n\r\n    update_source(new_source) {\r\n        if (typeof(this.connector) === 'undefined') {\r\n            this.connector = new_source.connectable({\r\n                container: this.connectables_container,\r\n                markers: this.markers\r\n            }, this.mouse_rect);\r\n        } else {\r\n            this.connector.marker.show();\r\n            this.connector.line.show();\r\n\r\n            this.connector.target = this.mouse_rect;\r\n            this.connector.source = new_source;\r\n            this.connector.update();\r\n        }\r\n        if (this.connector) {\r\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (typeof(this.connector) !== 'undefined') {\r\n            this.connector.target = this.connector.source;\r\n            this.connector.marker.hide();\r\n            this.connector.line.hide();\r\n        }\r\n    }\r\n\r\n    start_arrow(source_node) {\r\n        this.drawing_arrow_from = source_node;\r\n        if (this.connector) {\r\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    draw_arrow(origin, destination, colour) {\r\n        var connector = origin.group.connectable({\r\n            container: this.links,\r\n            markers: this.markers,\r\n            specialCoords: true\r\n        }, destination.group);\r\n        connector.setLineColor(colour);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n\r\n        return connector\r\n    }\r\n\r\n    add_context_menu_to_arrow(connector, arrowObject) {\r\n        const show_context_menu = e => {\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\r\n                arrowObject.colour = new_colour\r\n            }, arrowObject);\r\n            e.preventDefault();\r\n        };\r\n        connector.line.on(\"click\", show_context_menu);\r\n        connector.line.on(\"contextmenu\", show_context_menu);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n\r\n        // detect if the user changes the colour of this arrow\r\n        window.addEventListener('colourchange', (e) => {\r\n            if (e.detail.oldColour === arrowObject.colour) {\r\n                connector.setLineColor(e.detail.newColour)\r\n                arrowObject.colour = e.detail.newColour\r\n            }\r\n        })\r\n\r\n        // detect if all arrows of this colour were deleted\r\n        window.addEventListener('arrowdelete', (e) => {\r\n            if (e.detail.colour === arrowObject.colour) {\r\n                this.remove_arrow(connector, arrowObject)\r\n            }\r\n        })\r\n    }\r\n\r\n    complete_arrow(end_node) {\r\n        // no arrows to self\r\n        if (end_node === this.drawing_arrow_from) {\r\n            this.stop_drawing_arrow();\r\n            return;\r\n        }\r\n\r\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\r\n\r\n        var c1 = this.drawing_arrow_from.group.getScreenCoords();\r\n        var c2 = end_node.group.getScreenCoords();\r\n        var midpoint = [(c1.x + c2.x) / 2, (c1.y + c2.y) / 2]\r\n\r\n        // only add the arrow to the list of completed arrows once a colour is selected\r\n        // to prevent weird states being saved and loaded\r\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\r\n        const colourWasSelected = (colour) => {\r\n            const id = this.getNewId()\r\n            const arrowObject = {\r\n                id: id,\r\n                origin: drawing_arrow_from_id,\r\n                destination: end_node.id,\r\n                colour: colour,\r\n            }\r\n            this.completed_arrows.push(arrowObject)\r\n\r\n            this.add_context_menu_to_arrow(connector, arrowObject)\r\n        }\r\n\r\n        this.edit_connector_type(connector, midpoint[0], midpoint[1], false, colourWasSelected);\r\n\r\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\r\n        this.stop_drawing_arrow();\r\n    }\r\n\r\n    getArrowByID(id) {\r\n        return this.completed_arrows.find(arrow => arrow.id === id)\r\n    }\r\n\r\n    getNewId() {\r\n        this.arrow_id_counter++\r\n        return this.arrow_id_counter\r\n    }\r\n\r\n    changeArrowColour(entry, direction) {\r\n        const oldColour = entry.colour\r\n        var newColour = this.getNextAvailableColour(entry, direction)\r\n        if (!newColour) {\r\n            return\r\n        }\r\n        entry.colour = newColour\r\n\r\n        window.dispatchEvent(new CustomEvent('colourchange', {\r\n            detail: {\r\n                oldColour: oldColour,\r\n                newColour: newColour,\r\n            }\r\n        }))\r\n\r\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\r\n\r\n        return newColour\r\n    }\r\n\r\n    getNextAvailableColour(entry, direction) {\r\n        // find all the colours which are not used by arrowOptions other than this one\r\n        const availableColours = COLOURS.filter(colour => \r\n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\r\n        )\r\n\r\n        if (!availableColours) {\r\n            return undefined\r\n        } else {\r\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\r\n            if (thisColourIndex !== -1) {\r\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\r\n                if (nextIndex < 0) {\r\n                    nextIndex = availableColours.length - 1\r\n                }\r\n                return availableColours[nextIndex]\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrowOptions() {\r\n        const clickEditButton = (e, params) => {\r\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\r\n\r\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\r\n\r\n            transientEntry.isClickable = false\r\n\r\n            var editButton = buttonCell.children[0]\r\n\r\n            const updateName = () => {\r\n                var newValue = input.value\r\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\r\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\r\n                }\r\n                if (newValue) {\r\n                    underlyingEntry.name = newValue\r\n                }\r\n\r\n                return newValue\r\n            }\r\n\r\n            const finishEditing = () => {\r\n                var newValue = updateName()\r\n                if (newValue) {\r\n                    nameCell.textContent = newValue\r\n                }\r\n\r\n                transientEntry.isClickable = true\r\n\r\n                colourCell.textContent = colourButton.textContent\r\n                colourCell.style.color = colourButton.style.color\r\n                \r\n                editButton.classList.remove('pure-button-active')\r\n                editButton.onclick = (e) => clickEditButton(e, params)\r\n            }\r\n\r\n            editButton.classList.add('pure-button-active')\r\n            editButton.onclick = finishEditing\r\n\r\n            var input = document.createElement(\"input\")\r\n            \r\n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\r\n            input.value = nameCell.textContent\r\n            input.addEventListener('keyup', (e) => {\r\n                if (e.key === 'Enter' && input.value) {\r\n                    finishEditing()\r\n                }\r\n            })\r\n            input.addEventListener('change', updateName)\r\n\r\n            nameCell.textContent = \"\"\r\n            nameCell.appendChild(input)\r\n\r\n            var colourButton = document.createElement(\"button\")\r\n            colourButton.className = 'pure-button'\r\n            colourButton.textContent = colourCell.textContent\r\n            colourCell.textContent = \"\"\r\n            colourCell.appendChild(colourButton)\r\n            colourButton.style.color = colourCell.style.color\r\n            colourButton.style.padding = 0\r\n            colourButton.addEventListener(\"click\", () => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\r\n                transientEntry.colour = underlyingEntry.colour\r\n            })\r\n            colourButton.addEventListener(\"contextmenu\", (e) => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\r\n                transientEntry.colour = underlyingEntry.colour\r\n                e.preventDefault()\r\n            })\r\n\r\n            input.focus()\r\n        }\r\n\r\n        const clickDeleteArrowTypeButton = (e, params) => {\r\n            var { row, underlyingEntries, underlyingEntry, transientEntry, selected, hidePopup } = params\r\n            transientEntry.isClickable = false\r\n            \r\n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\r\n                // remove from underlyingEntries\r\n                var index = underlyingEntries.indexOf(underlyingEntry)\r\n                if (index !== -1) {\r\n                    underlyingEntries.splice(index, 1)\r\n                }\r\n\r\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\r\n                setTimeout(() => row.parentNode.removeChild(row), 0)\r\n\r\n                // tell all arrows of this colour to delete themselves\r\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\r\n                    detail: {\r\n                        colour: underlyingEntry.colour,\r\n                    }\r\n                }))\r\n\r\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour})\r\n\r\n                // if the selected arrow type was deleted, hide the optionpopup\r\n                if (selected) {\r\n                    hidePopup()\r\n                }\r\n            }\r\n\r\n            transientEntry.isClickable = true\r\n        }\r\n\r\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\r\n            var entryWithButtons = {...entry}\r\n            entryWithButtons.buttons = [\r\n                {\r\n                    className: 'edit-icon',\r\n                    click: clickEditButton,\r\n                    underlyingEntry: entry,\r\n                },\r\n                {\r\n                    className: 'delete-icon',\r\n                    click: clickDeleteArrowTypeButton,\r\n                    underlyingEntry: entry,\r\n                    underlyingEntries: this.arrowOptions,\r\n                }\r\n            ]\r\n            return entryWithButtons\r\n        })\r\n        \r\n        return [\r\n            ...arrowOptionsWithButtons,\r\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\r\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\r\n        ]\r\n    }\r\n\r\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\r\n        var prev_selected = undefined;\r\n        \r\n        const arrowOptions = this.getArrowOptions()\r\n\r\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\r\n        prev_selected = prev_selected ? prev_selected.name : undefined\r\n\r\n        const setArrowColour = (selected_option) => {\r\n            connector.setLineColor(selected_option.colour);\r\n            this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\r\n\r\n            if (onColourSelected) {\r\n                onColourSelected(selected_option.colour)\r\n            }\r\n        }\r\n\r\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\r\n            if (selected_option.name === \"Delete\") {\r\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\r\n                this.remove_arrow(connector, arrowObject);\r\n            } else if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\r\n                const colour = this.getNextAvailableColour(null, 1)\r\n\r\n                if (!colour) {\r\n                    toast.error(\"Maximum number of arrow types reached!\")\r\n                } else {\r\n                    const newRelation = {\r\n                        'name': 'New relation',\r\n                        'colour': colour,\r\n                        'symbol': \"\",\r\n                    }\r\n                    this.arrowOptions.push(newRelation)\r\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\r\n\r\n                    if (!prev_selected) {\r\n                        setArrowColour(newRelation)\r\n                    }\r\n\r\n                    // open a new option popup to allow the user to select the new arrow type and edit it\r\n                    this.edit_connector_type(connector, popup_x, popup_y, true, onColourSelected, arrowObject)\r\n                }\r\n            } else {\r\n                setArrowColour(selected_option)\r\n            }\r\n        }, prev_selected);\r\n    }\r\n\r\n    remove_arrow(connector, arrowObject) {\r\n        connector.line.node.instance.delete_connectable(connector);\r\n\r\n        if (arrowObject) {\r\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \r\n        }\r\n    }\r\n\r\n    stop_drawing_arrow() {\r\n        this.drawing_arrow_from = false;\r\n        this.hide();\r\n    }\r\n}","import OptionPopup from \"./OptionPopup\";\r\n\r\nvar ARROW_HITBOX_MARGIN = 20;\r\n\r\nclass GraphNode {\r\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList) {\r\n        var { shortText, x, y, width, height, id, isOnGraph, longText } = params\r\n        this.id = id ? id : shared_state.getNodeId();\r\n\r\n        this.getNodesList = getNodesList;\r\n        \r\n        this.group = nodes.group().translate(x, y);\r\n\r\n        this.dropShadow = this.group.rect(width, height).radius(5).addClass('node-drop-shadow')\r\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\r\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0).radius(10).addClass('arrow-hitbox');\r\n        \r\n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\r\n        this.editRect = this.group.rect(width - 10, height - 10).radius(5).translate(5, 5).addClass('editing-node-rect')\r\n        this.text = this.group.text(\"\").addClass('node-text');\r\n        this.updateShortText(shortText)\r\n        this.updateLongText(longText)\r\n\r\n        this.setupRectDragging(this.rect, shared_state);\r\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\r\n        const complete_arrow = (e) => {\r\n            if (mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.complete_arrow(this);\r\n            }\r\n        };\r\n        this.arrow_hitbox.on('mouseup', complete_arrow);\r\n        this.rect.on('mouseup', complete_arrow);\r\n        this.text.on('mouseup', complete_arrow);\r\n\r\n        this.setupHover(shared_state);\r\n        this.setupContextMenu(shared_state);\r\n\r\n        if (focus_text_area) {\r\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\r\n        }\r\n        \r\n        this.setIsOnGraph(isOnGraph);\r\n\r\n        // don't log add node events if they are just loaded from a save\r\n        if (!params.isFromJSON) {\r\n            shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList) {\r\n        var params = json\r\n        params.x = json.screenCoords.x\r\n        params.y = json.screenCoords.y\r\n        params.width = 200\r\n        params.height = 42\r\n        params.isFromJSON = true\r\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList)\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            id: this.id,\r\n            shortText: this.shortText,\r\n            longText: this.longText,\r\n            screenCoords: this.group.getScreenCoords(),\r\n            isOnGraph: this.isOnGraph,\r\n        }\r\n    }\r\n\r\n    setIsOnGraph(newVal) {\r\n        this.isOnGraph = newVal;\r\n        if (this.isOnGraph) {\r\n            this.rect.addClass(\"node-on-graph\");\r\n        } else {\r\n            this.rect.removeClass(\"node-on-graph\");\r\n        }\r\n    }\r\n\r\n    setupContextMenu(shared_state) {\r\n        var showOptionMenu = e => {\r\n            e.preventDefault();\r\n            \r\n            var entries = [\r\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\r\n            ]\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\r\n                if (selected_option.name === \"Delete\") {\r\n                    this.delete(shared_state);\r\n                }\r\n            });\r\n            \r\n            return false;\r\n        };\r\n        this.rect.on('contextmenu', showOptionMenu);\r\n        this.text.on('contextmenu', showOptionMenu);\r\n    }\r\n\r\n    setupHover(shared_state) {\r\n        this.hoverers = []\r\n\r\n        const startHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, true);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\r\n            });\r\n        };\r\n        const endHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, false);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\r\n            });\r\n        };\r\n        this.rect.on('mouseenter', startHover);\r\n        this.text.on('mouseenter', startHover);\r\n        this.rect.on('mouseleave', endHover);\r\n        this.text.on('mouseleave', endHover);\r\n    }\r\n\r\n    setHoverer(hoverer, isHovering) {\r\n        if (isHovering) {\r\n            if (!this.hoverers.includes(hoverer)) {\r\n                this.hoverers.push(hoverer)\r\n            }\r\n        } else {\r\n            // remove the hoverer\r\n            var index = this.hoverers.indexOf(hoverer);\r\n            if (index !== -1) this.hoverers.splice(index, 1);\r\n        }\r\n\r\n        this.setHovered(this.hoverers.length > 0)\r\n    }\r\n\r\n    setHovered(isHovered) {        \r\n        if (isHovered) {\r\n            this.rect.addClass(\"hovered\");\r\n        } else {\r\n            this.rect.removeClass(\"hovered\");\r\n        }\r\n    }\r\n\r\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\r\n    // but we only want to make the node itself draggable\r\n    // so we need to intercept drag events on the rect, and move the entire group instead!\r\n    setupRectDragging(rect, shared_state) {\r\n        this.setupGroupDragging(rect, shared_state, rect);\r\n        this.setupGroupDragging(this.text, shared_state, rect, true);\r\n        \r\n        this.text.click((e) => e.preventDefault());\r\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\r\n        rect.click(edit_text_if_not_just_dropped);\r\n        this.text.click(edit_text_if_not_just_dropped);\r\n    }\r\n\r\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\r\n        rect.draggy(); // setup dragging on the rect\r\n        rect.on('mousedown', (e) => {\r\n            e.stopPropagation(); // don't pan when moving a node\r\n        });\r\n        just_dropped_obj.just_dropped = false;\r\n        rect.on('dragstart', (e) => {\r\n            var start_x = this.group.x();\r\n            var start_y = this.group.y();\r\n            document.activeElement.blur();\r\n            shared_state.draggedNode = {\r\n                id: this.id,\r\n                text: this.getShortText(),\r\n                longText: this.getLongText(),\r\n                resetPos: () => {\r\n                    this.group.move(start_x, start_y);\r\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n                },\r\n                node: this\r\n            };\r\n\r\n            this.dropShadow.translate(5, 5)\r\n            this.dropShadow.addClass('visible')\r\n            \r\n            rect.off('dragmove');\r\n            rect.on('dragmove', (e) => {\r\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\r\n                if (center) {\r\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n                } else {\r\n                    rect.x(0);\r\n                    rect.y(0);\r\n                }\r\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n            });\r\n            rect.off('dragend');\r\n            rect.on('dragend', (e) => {\r\n                // prevent the textarea showing\r\n                // unless the drag amount was zero or just a tiny accidental drag\r\n                var x_diff = (this.group.x() - start_x);\r\n                var y_diff = (this.group.y() - start_y);\r\n                var nudge = 10;\r\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\r\n                    just_dropped_obj.just_dropped = true;\r\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\r\n                }\r\n                shared_state.draggedNode = false;\r\n\r\n                this.dropShadow.translate(0, 0)\r\n                this.dropShadow.removeClass('visible')\r\n            });\r\n        });\r\n    }\r\n\r\n    // click/drag events on the arrow hitbox should start the arrow creation process\r\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\r\n        arrow_hitbox.on('mousemove', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.update_source(this.group);\r\n            }\r\n        });\r\n        arrow_hitbox.on('mouseleave', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.hide();\r\n            }\r\n        });\r\n        arrow_hitbox.on('mousedown', (e) => {\r\n            mouse_follower.start_arrow(this);\r\n            e.stopPropagation(); // don't pan when dragging an arrow\r\n        });\r\n    }\r\n\r\n    updateShortText(newShortText) {\r\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\r\n        \r\n        const CHARS_PER_LINE = 21;\r\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\r\n\r\n        this.text.text(formattedText.join(\"\\n\"));\r\n        this.resizeRect(formattedText.length);\r\n    }\r\n\r\n    updateLongText(newLongText) {\r\n        this.longText = newLongText;\r\n    }\r\n\r\n    splitIntoLines(charsPerLine, text) {\r\n        var formattedText = [];\r\n        var line = \"\";\r\n        text.split(\" \").forEach(word => {\r\n            var segments = [];\r\n            if (word.length > charsPerLine) {\r\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\r\n                    if (segments.length > 0) {\r\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\r\n                    }\r\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\r\n                }\r\n            }\r\n            else {\r\n                segments = [word];\r\n            }\r\n            segments.forEach(segment => {\r\n                if ((line + segment).length < charsPerLine) {\r\n                    var space = line.length > 0 ? \" \" : \"\";\r\n                    line += space + segment;\r\n                }\r\n                else {\r\n                    formattedText.push(line);\r\n                    line = segment;\r\n                }\r\n            });\r\n        });\r\n        formattedText.push(line);\r\n        return formattedText;\r\n    }\r\n\r\n    // resize the rect so that the text fits on it\r\n    resizeRect(numLinesOfText) {\r\n        this.rect.width(200);\r\n        const rectHeight = numLinesOfText * 21 + 20\r\n        this.rect.height(rectHeight);\r\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n        this.dropShadow.height(rectHeight)\r\n        this.editRect.height(rectHeight - 10)\r\n\r\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\r\n\r\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n    }\r\n\r\n    getShortText() {\r\n        return this.shortText;\r\n    }\r\n\r\n    getLongText() {\r\n        return this.longText;\r\n    }\r\n\r\n    editText(shared_state, delete_if_empty_text = false) {\r\n        document.activeElement.blur(); // remove focus from everything\r\n\r\n        var textarea = document.querySelector('#nodeedit');\r\n        textarea.value = this.getShortText();\r\n\r\n        const preEditText = this.getShortText()\r\n\r\n        var screen_coords = this.group.getScreenCoords();\r\n        textarea.style.left = screen_coords.x + \"px\";\r\n        textarea.style.top = screen_coords.y + \"px\";\r\n        textarea.style.display = \"inline-block\";\r\n        textarea.focus();\r\n\r\n        textarea.style.width = \"180px\";\r\n        textarea.style.height = 'auto';\r\n        textarea.style.height = (textarea.scrollHeight) + 'px';\r\n\r\n        this.text.hide();\r\n\r\n        this.editRect.addClass('visible')\r\n        this.setHoverer('editNodeDirectly', true)\r\n\r\n        var save_changes = () => {\r\n            this.updateShortText(textarea.value);\r\n            shared_state.updateDocShortText(this.id, this.getShortText());\r\n        };\r\n        var save_and_hide = () => {\r\n            save_changes();\r\n            textarea.style.display = \"none\";\r\n            if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\r\n                this.delete(shared_state);\r\n            }\r\n            this.text.show();\r\n            this.updateShortText(this.shortText);\r\n\r\n            if (this.getShortText() !== preEditText) {\r\n                shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\r\n            }\r\n\r\n            this.editRect.removeClass('visible')\r\n            this.setHoverer('editNodeDirectly', false)\r\n        };\r\n        textarea.onblur = save_and_hide;\r\n        textarea.onkeyup = (e) => {\r\n            if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\r\n                e.preventDefault();\r\n                document.activeElement.blur();\r\n            } else {\r\n                save_changes();\r\n            }\r\n        };\r\n    }\r\n\r\n    delete(shared_state) {\r\n        shared_state.removeGraphNode(this.id);\r\n        \r\n        // remove from the list of nodes (used for saving)\r\n        const nodesList = this.getNodesList()\r\n        var index = nodesList.indexOf(this);\r\n        if (index !== -1) {\r\n            nodesList.splice(index, 1)\r\n        } else {\r\n            console.log('node not found in this.nodesList when deleting');\r\n        }        \r\n\r\n        this.group.remove();\r\n\r\n        // delete arrows\r\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\r\n\r\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\r\n    }\r\n}\r\n\r\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst graphTarget = {\r\n    canDrop(props, monitor) {\r\n        const item = monitor.getItem()\r\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\r\nimport './GraphPane.css';\r\nimport SVG from 'svg.js';\r\nimport 'svg.panzoom.js';\r\nimport 'svg.draggy.js';\r\nimport './svg.connectable.js';\r\nimport MouseFollower from './MouseFollower.js';\r\nimport GraphNode from './GraphNode.js';\r\nimport DropifyGraphPane from './DropifyGraphPane.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nclass GraphPane extends React.Component {\r\n    componentDidMount() {\r\n        this.props.sharedState.getSavedGraph((json) => {\r\n            this.nodesList = [];\r\n\r\n            this.props.sharedState.graphPane = this;\r\n\r\n            this.$el = document.querySelector(\"#graph\")\r\n\r\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 1, zoomMax: 1 }); // just pan, no zoom\r\n\r\n            SVG.extend(SVG.Element, {\r\n                getScreenCoords: function () {\r\n                    var root_point = this.doc().node.getBoundingClientRect();\r\n                    var point = this.point(0, 0);\r\n                    return {\r\n                        x: -point.x - root_point.left,\r\n                        y: -point.y - root_point.top\r\n                    };\r\n                }\r\n            })\r\n\r\n            var links = svg.group();\r\n            var markers = svg.group();\r\n            var nodes = svg.group();\r\n\r\n            const json_connections = json ? json.connections : undefined\r\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\r\n            this.mouse_follower = mouse_follower\r\n\r\n            // add new nodes on mouse click\r\n            svg.on('dblclick', (e) => {\r\n                // only clicks on background and not when dragging\r\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\r\n                    return;\r\n                }\r\n\r\n                var x = e.clientX\r\n                if (x + 200 > window.innerWidth) {\r\n                    x = window.innerWidth - 200\r\n                }\r\n                var y = e.clientY\r\n                if (y + 60 > window.innerHeight) {\r\n                    y = window.innerHeight - 60\r\n                }\r\n\r\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", x, y, true);\r\n            });\r\n\r\n            this.setupTextDropping(svg, nodes, mouse_follower);\r\n\r\n            svg.on('panStart', (e) => {\r\n                document.activeElement.blur();\r\n            });\r\n\r\n            var textarea = document.querySelector('#nodeedit');\r\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\r\n            textarea.addEventListener(\"input\", (e) => {\r\n                textarea.style.height = 'auto';\r\n                textarea.style.height = (textarea.scrollHeight) + 'px';\r\n            });\r\n\r\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\r\n                if (x + 200 > window.innerWidth) {\r\n                    x = window.innerWidth - 200\r\n                }\r\n                if (y + 60 > window.innerHeight) {\r\n                    y = window.innerHeight - 60\r\n                }\r\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\r\n            }\r\n            if (json && json.nodes) {\r\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\r\n            }\r\n\r\n            this.getNodeById = this.getNodeById.bind(this)\r\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\r\n\r\n            if (this.nodesList.length === 0) {\r\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\r\n            }\r\n        })\r\n    }\r\n\r\n    getNodeById(id) {\r\n        return this.nodesList.find(node => node.id.toString() === id.toString())\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            nodes: this.nodesList.map(node => node.toJSON()),\r\n            connections: this.mouse_follower.toJSON()\r\n        }\r\n    }\r\n\r\n    loadNodesFromJSON(json, mouse_follower, nodes) {\r\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList))\r\n    }\r\n\r\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\r\n        this.noNodesIndicator = svg.text(\"Double click to add a node\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\r\n        this.noNodesIndicator.on('dblclick', (e) => {\r\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n        });\r\n    }\r\n\r\n    setupTextDropping(svg, nodes, mouse_follower) {\r\n        this.$el.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        this.$el.addEventListener(\"drop\", (e) => {\r\n            e.preventDefault();\r\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\r\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\r\n            }\r\n            \r\n            var data = e.dataTransfer.getData(\"Text\");\r\n\r\n            if (data.includes('\\n')) {\r\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\r\n                return\r\n            }\r\n\r\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\r\n                toast.error('You can\\'t add the same node to the graph twice!')\r\n                return\r\n            }\r\n\r\n            var x = e.clientX\r\n            if (x + 200 > window.innerWidth) {\r\n                x = window.innerWidth - 200\r\n            }\r\n            var y = e.clientY\r\n            if (y + 60 > window.innerHeight) {\r\n                y = window.innerHeight - 60\r\n            }\r\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, x, y, false);\r\n            this.props.sharedState.addLinkAtSelection(node.id, node);\r\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\r\n            document.activeElement.blur();\r\n        });\r\n    }\r\n\r\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false) {\r\n        var point = svg.point(x, y);\r\n        const params = {\r\n            shortText: text,\r\n            longText: \"\", \r\n            x: point.x,\r\n            y: point.y,\r\n            width: 200,\r\n            height: 42,\r\n            isOnGraph: false,\r\n            id: undefined, // set automatically\r\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\r\n        }\r\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList);\r\n        this.nodesList.push(node);\r\n\r\n        if (this.noNodesIndicator) {\r\n            this.noNodesIndicator.hide();\r\n        }\r\n\r\n        return node;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.$el.somePlugin('destroy');\r\n    }\r\n\r\n    render() {\r\n        return this.props.connectDropTarget(\r\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\r\n                <textarea id='nodeedit'></textarea>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\r\n\r\nconst db = new Dexie('writeReasonDb');\r\ndb.version(1).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\r\n\r\nexport default db;","import React, { Component } from 'react';\r\n\r\nexport default class ProjectsList extends Component {\r\n    render() {\r\n        return (\r\n            <div className='display-block'>\r\n                <table className='pure-table'>\r\n                    <thead>\r\n                        <tr>\r\n                            {/* {(process.env.NODE_ENV === 'development') && <th>ID</th>} */}\r\n                            <th>Project</th>\r\n                            <th></th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {\r\n                            this.props.projects.map(project => <tr key={project.id.toString()}>\r\n                                {/* {(process.env.NODE_ENV === 'development') && <td>{project.id}</td>} */}\r\n                                <td>{project.name}</td>\r\n                                <td>\r\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"...\">\r\n                                        <button className=\"pure-button\" onClick={() => this.props.loadProject(project.id)}>Open</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.renameProject(project.id)}>Rename</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.duplicateProject(project.id)}>Duplicate</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.deleteProject(project.id)}>Delete</button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>)\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        )\r\n      }\r\n}","import db from './db.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY = [\r\n    'session_start',\r\n    'document_content_detailed',\r\n    'document_content_markdown',\r\n]\r\n\r\nexport default class Logger {\r\n    shouldLogToConsole = false;\r\n\r\n    constructor(db_id, params) {\r\n        this.db_id = db_id;\r\n        this.conditions = params;\r\n        this.logToConsole(\"Logging begin, db_id \" + db_id + \"\\nParams \" + JSON.stringify(params, null, 1));\r\n\r\n        // used for tracking whether changes have been made since last save\r\n        // obviously, does not track events which are not logged, like typing in the document\r\n        this.stateIsDirty = false\r\n\r\n        this.logEvent({'type': 'session_start'})\r\n    }\r\n\r\n    logEvent(event) {\r\n        if (!EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY.includes(event.type)) {\r\n            this.stateIsDirty = true\r\n        }\r\n\r\n        if (event.type === 'save') {\r\n            this.stateIsDirty = false\r\n        }\r\n\r\n        this.getLog(log => {\r\n            if (log.events === undefined) {\r\n                log.events = {}\r\n            }\r\n    \r\n            if (log.events[event.type] === undefined) {\r\n                log.events[event.type] = []\r\n            }\r\n            event.timestamp = new Date()\r\n            log.events[event.type].push(event)\r\n            this.setLog(log)\r\n\r\n            this.logToConsole(\"Logging event: \" + JSON.stringify(event))\r\n        })\r\n    }\r\n\r\n    // keep a history of the save states so that we can look back at how the project developed\r\n    logSaveState(save) {\r\n        this.getLog(log => {\r\n            if (log.saves === undefined) {\r\n                log.saves = []\r\n            }\r\n\r\n            // don't store this save if we have stored a save <3 minutes ago\r\n            // to prevent multiple clicks of the save button taking up lots of space\r\n            const timestamp = new Date()\r\n            const THREE_MINUTES = 3 * 60 * 1000; // ms\r\n            if (!log.saves.find(save => (timestamp - save.timestamp < THREE_MINUTES))) {\r\n                log.saves.push({\r\n                    timestamp: timestamp,\r\n                    ...save,\r\n                })\r\n                this.setLog(log)\r\n            }\r\n        })\r\n    }\r\n\r\n    getLog(callback) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then((project) => {\r\n                callback(project.log ? project.log : {})\r\n            })\r\n    }\r\n\r\n    setLog(log) {\r\n        db.table('projects')\r\n            .update(this.db_id, { log: log })\r\n            .catch(err => {\r\n                toast.error('Logging error: ' + err)\r\n                console.log('Logging error: ' + err)\r\n            })\r\n    }\r\n\r\n    logToConsole(msg) {\r\n        if (this.shouldLogToConsole) {\r\n            console.log(msg);\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport { Text } from 'slate';\r\nimport Html from 'slate-html-serializer'\r\nimport Logger from './logging'\r\nimport db from './db.js'\r\nimport { toast } from 'react-toastify';\r\nimport { pdf, Document, Page, Text as PdfText, StyleSheet, Font } from '@react-pdf/renderer';\r\nimport CrimsonText from './assets/CrimsonText-Regular.ttf'\r\nimport CrimsonTextBold from './assets/CrimsonText-Bold.ttf'\r\n\r\nexport default class SharedState {\r\n    constructor(db_id, params) {      \r\n        this.logger = new Logger(db_id, params)\r\n        this.condition = params.condition;\r\n        this.params = params;\r\n        \r\n        this.node_id_counter = 0;\r\n        this.slate_id_counter = 10\r\n        this.map = {};\r\n        this.map_recycle_bin = {};\r\n        this.db_id = db_id\r\n\r\n        // this.editor_ref and this.graphPane set in the editor and graphpane\r\n        this.editor_ref = undefined;\r\n        this.graphPane = undefined;\r\n\r\n        // log entire document content every 30 seconds\r\n        this.intervalLogger = window.setInterval(() => {\r\n            this.logger.logEvent({'type': 'document_content_detailed', 'content': this.getEditor().getValue()});\r\n            this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\r\n        }, 30000);\r\n        \r\n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\r\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\r\n        this.save = this.save.bind(this)\r\n        this.exportPDF = this.exportPDF.bind(this)\r\n\r\n        // when the tab is closed, if the document has been edited, warn before closing\r\n        window.onbeforeunload = (e) => {\r\n            if (process.env.NODE_ENV !== 'development' && this.getStateIsDirty()) { // disable in development for webpack hot reloading\r\n                e.preventDefault()\r\n                e.returnValue = '' // for Chrome\r\n            }\r\n        }\r\n    }\r\n\r\n    // called by editor once the database saved value has been set as the document.value\r\n    editorHasLoaded() {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\r\n                this.map = project.map ? this.mapFromJSON(project.map) : {}\r\n                this.getEditor().mapHasLoaded()\r\n                this.projectName = project.name\r\n                document.title = this.projectName + \" - Write Reason\"\r\n            })\r\n        \r\n        this.lastSavedDocumentState = this.getEditor().getValue().document // editor is definitely not dirty right now\r\n    }\r\n\r\n    save() {\r\n        const changes = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        db.table('projects')\r\n            .update(this.db_id, changes)\r\n            .then((idExists) => {\r\n                if (!idExists) {\r\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\r\n                    console.log(message)\r\n                    toast.error(message)\r\n                } else {\r\n                    toast.info('Changes saved!')\r\n                    this.lastSavedDocumentState = this.getEditor().getValue().document\r\n                    this.logger.logSaveState(changes)\r\n                }\r\n            }).catch(err => {\r\n                toast.error('Save error: ' + err.toString())\r\n            })\r\n            \r\n        this.logger.logEvent({'type': 'save'})\r\n    }\r\n\r\n    getStateIsDirty() {\r\n        return this.logger.stateIsDirty || (\r\n            this.getEditor() && this.getEditor().getValue() && this.getEditor().getValue().document !== this.lastSavedDocumentState\r\n        ) \r\n    }\r\n\r\n    getSavedDocValue = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.doc_value)\r\n            })\r\n    }\r\n\r\n    getSavedGraph = async function(onDataLoad) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then(project => {\r\n                onDataLoad(project.graph_value)\r\n            })\r\n    }\r\n\r\n    mapToJSON() {\r\n        var mapJson = {}\r\n        const document = this.getEditor().value.document\r\n        for (const id in this.map) {\r\n            let doc_nodes = {};\r\n            ['section', 'long', 'short'].forEach(part => {\r\n                const docNodeObjects = this.getDocNodes(id)\r\n                if (docNodeObjects) {\r\n                    if (docNodeObjects[part]) {\r\n                        const path = document.getPath(docNodeObjects[part])\r\n                        doc_nodes[part] = path.toArray()\r\n                    }\r\n                } \r\n            })\r\n\r\n            mapJson[id] = {\r\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\r\n                doc_nodes: doc_nodes\r\n            }\r\n        }\r\n\r\n        return mapJson\r\n    }\r\n\r\n    mapFromJSON(json) {\r\n        this.map = {}\r\n        for (const id in json) {\r\n            if (json[id].graph_node) {\r\n                const graphNode = this.graphPane.getNodeById(id)\r\n                if (graphNode) {\r\n                    this.addGraphMapping(id, graphNode)\r\n                } else {\r\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\r\n                }\r\n            }\r\n\r\n            if (json[id].doc_nodes) {\r\n                for (const part in json[id].doc_nodes) {\r\n                    const path = json[id].doc_nodes[part]\r\n                    \r\n                    const document = this.getEditor().value.document\r\n                    if (document.hasNode(path)) {\r\n                        this.setLinkMapping(id, document.getNode(path), part)\r\n                    } else {\r\n                        console.log(document);\r\n                        \r\n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.map\r\n    }\r\n\r\n    downloadExperimentData() {\r\n        this.logger.getLog(log => {\r\n            const element = document.createElement(\"a\");\r\n            const data = {\r\n                params: this.params,\r\n                argument: this.getArgumentMarkdown(),\r\n                logs: log\r\n            }\r\n            const file = new Blob([JSON.stringify(data, null, 2)], {type: 'text/plain'});\r\n    \r\n            element.href = URL.createObjectURL(file);\r\n            element.download = this.logger.getExperimentId() + \".json\";\r\n            document.body.appendChild(element); // Required for this to work in FireFox\r\n            element.click();\r\n        })\r\n    }\r\n\r\n    getArgumentHTML() {\r\n        const parentStyleIs = (node, styleToCheck) => {\r\n            const parent = this.getEditor().value.document.getParent(node.key)\r\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\r\n        }\r\n\r\n        const RULES = [\r\n            {\r\n                serialize: (node, children) => {\r\n                    if ([\"block\", \"inline\"].includes(node.object)) {\r\n                        switch(node.type) {\r\n                            case 'paragraph':\r\n                            case '':\r\n                                return <p>{children}</p>\r\n\r\n                            case 'heading':\r\n                                return <h2>{children}</h2>\r\n                            \r\n                            case 'section':\r\n                                return <div>{children}</div>\r\n                            \r\n                            case 'body':\r\n                                if (parentStyleIs(node, \"Heading only\")) {\r\n                                    return <p></p>\r\n                                } else {\r\n                                    return <p>{children}</p>\r\n                                }\r\n\r\n                            case 'link':\r\n                                if (node.object === \"inline\") {\r\n                                    return <span>{children}</span>\r\n                                } else {\r\n                                    if (parentStyleIs(node, \"Body only\")) {\r\n                                        return <p></p>\r\n                                    } else {\r\n                                        return <h2>{children}</h2>\r\n                                    }\r\n                                }\r\n\r\n                            default:\r\n                                return undefined\r\n                        }\r\n                    } else if(node.object === 'string') {\r\n                        return node.text\r\n                    }\r\n                } \r\n            }\r\n        ]\r\n\r\n        const serializer = new Html({rules: RULES})\r\n        return serializer.serialize(this.getEditor().value)\r\n    }\r\n\r\n    exportPDF() {\r\n        this.logger.getLog(log => {\r\n            const element = document.createElement(\"a\");\r\n            this.getReactPdfDocument().then(file => {            \r\n                element.href = URL.createObjectURL(file);\r\n                element.download = this.projectName + \".pdf\";\r\n                document.body.appendChild(element); // Required for this to work in FireFox\r\n                element.click();\r\n            })\r\n        })\r\n    }\r\n\r\n    getReactPdfDocument() {\r\n        const markdown = this.getArgumentMarkdown()\r\n\r\n        Font.register({family: 'Crimson Text', fonts: [\r\n            {src: CrimsonText},\r\n            {src: CrimsonTextBold, fontWeight: 800}\r\n        ]})\r\n\r\n        const styles = StyleSheet.create({\r\n            page: {\r\n                padding: 80\r\n            },\r\n            text: {\r\n                fontFamily: \"Crimson Text\",\r\n                width: \"100%\",\r\n                fontSize: \"12pt\",\r\n                paddingBottom: 8,\r\n            },\r\n            heading: {\r\n                fontFamily: \"Crimson Text\",\r\n                textDecoration: \"underline\",\r\n                fontWeight: 800,\r\n                width: \"100%\",\r\n                fontSize: \"12pt\"\r\n            }\r\n        })\r\n\r\n        const document = (\r\n            <Document>\r\n                <Page style={styles.page}>\r\n                    {markdown.split('\\n').map(line => {                        \r\n                        if (line.startsWith('##')) { // markdown heading\r\n                            line = line.substring('##'.length)\r\n                            return <PdfText style={styles.heading}>{line}</PdfText>\r\n                        }\r\n\r\n                        return <PdfText style={styles.text}>{line}</PdfText>\r\n                        }\r\n                    )}\r\n                </Page>\r\n            </Document>\r\n        )\r\n        return pdf(document).toBlob()\r\n    }\r\n\r\n    getArgumentMarkdown() {\r\n        var output = this.getArgumentHTML()\r\n        \r\n        var tagReplacements = [\r\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\r\n\r\n            {regex: /<p>/g},\r\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\r\n            {regex: /<div>/g},\r\n            {regex: /<\\/div>/g},\r\n            {regex: /<span>/g},\r\n            {regex: /<\\/span>/g},\r\n            {regex: /<h2>/g, replace: \"## \"},\r\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\r\n        ]\r\n        tagReplacements.forEach((replacement) => {\r\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\r\n        })\r\n\r\n        // unescape HTML entities, eg replace '&amp' with '&'\r\n        var element = document.createElement(\"span\")\r\n        element.innerHTML = output\r\n        output = element.innerText\r\n\r\n        return output\r\n    }\r\n\r\n    finishCondition() {\r\n        window.onbeforeunload = undefined // remove the warning about closing the tab\r\n        window.clearInterval(this.intervalLogger)\r\n    }\r\n\r\n    getEditor() {\r\n        return this.editor_ref.current;\r\n    }\r\n\r\n    getNodeId() {\r\n        this.node_id_counter++;\r\n        return this.node_id_counter;\r\n    }\r\n\r\n    canAddLinkAtSelection() {\r\n        const value = this.getEditor().value;\r\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\r\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\r\n        return !is_in_linked_block && !is_in_linked_inline;\r\n    }\r\n\r\n    addLinkAtSelection(id, graph_node) {\r\n        this.getEditor().wrapLinkAtSelection(id);\r\n        this.addGraphMapping(id, graph_node);\r\n    }\r\n\r\n    addGraphMapping(id, graph_node) {\r\n        graph_node.setIsOnGraph(true);\r\n        this.map[id] = { graph_node: graph_node };\r\n    }\r\n\r\n    setLinkMapping(id, doc_node, long_or_short) {\r\n        if (!this.map[id]) {\r\n            // uh oh, this should exist\r\n            this.map[id] = {}\r\n\r\n            // maybe the mapping was deleted and re-added with ctrl-Z\r\n            // if so, hopefully it's stored as recently deleted\r\n            this.checkRecycleBinForGraphNode(id)\r\n        }\r\n\r\n        if (this.map[id].doc_nodes === undefined) {\r\n            this.map[id].doc_nodes = {};\r\n        }\r\n        this.map[id].doc_nodes[long_or_short] = doc_node;\r\n    }\r\n\r\n    getGraphNodeAndDocNode(id) {\r\n        return this.map[id];\r\n    }\r\n\r\n    checkRecycleBinForGraphNode(id) {\r\n        if (!this.map[id]) {\r\n            this.map[id] = {}\r\n        }\r\n\r\n        if (this.map[id].graph_node) {\r\n            // no need to restore\r\n            return;\r\n        }\r\n\r\n        const prev_version = this.map_recycle_bin[id]\r\n        if (prev_version && prev_version.graph_node) {\r\n            console.log('restored from recycle');\r\n            \r\n            this.addGraphMapping(id, prev_version.graph_node)\r\n        }\r\n    }\r\n\r\n    getGraphNode(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.graph_node;\r\n        }\r\n    }\r\n\r\n    removeGraphNode(id) {\r\n        if (this.getDocNodes(id)) {\r\n            Object.values(this.getDocNodes(id)).forEach(node => {\r\n                this.getEditor().removeGraphLink(node);\r\n            })\r\n            this.map[id] = undefined;\r\n        }\r\n    }\r\n\r\n    removeDocNode(id) {\r\n        var map = this.getGraphNodeAndDocNode(id)\r\n        if (map) {\r\n            if (map.graph_node) {\r\n                map.graph_node.setIsOnGraph(false);\r\n            }\r\n            \r\n            this.map_recycle_bin[id] = this.map[id]\r\n            this.map[id] = undefined\r\n        }\r\n    }\r\n\r\n    getDocNodes(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.doc_nodes;\r\n        }\r\n    }\r\n\r\n    getDocNodeShortText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.short;\r\n        }\r\n    }\r\n\r\n    getDocNodeLongText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.long;\r\n        }\r\n    }\r\n\r\n    getDocNodeRef(id, long_or_short) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map && map.doc_link_node) {\r\n            return map.doc_link_node[long_or_short].current;\r\n        }\r\n    }\r\n\r\n    getAllDocNodeRefs(id) {\r\n        var docNodes = [];\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\r\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\r\n                    docNodes.push(map.doc_link_node[long_or_short].current)\r\n                }\r\n            })\r\n        }\r\n        return docNodes;\r\n    }\r\n\r\n    registerLinkNode(id, ref, long_or_short) {\r\n        if (this.map[id].doc_link_node === undefined) {\r\n            this.map[id].doc_link_node = {};\r\n        }\r\n        this.map[id].doc_link_node[long_or_short] = ref;\r\n    }\r\n\r\n    // check whether a graph node's doc node still exists\r\n    updateIsOnGraphStatus(id) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        if (!docNode) {\r\n            return false\r\n        }\r\n\r\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\r\n            // tell the graph node that there is no doc node any more, for whatever reason\r\n            this.removeDocNode(id)\r\n            return false\r\n        }\r\n\r\n        return true\r\n    }\r\n\r\n    updateDocShortText(id, newText) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        \r\n        if (docNode) {\r\n            var editor = this.getEditor();\r\n\r\n            if (this.updateIsOnGraphStatus(id)) {\r\n                // replace any text with newText\r\n                docNode.nodes.forEach(child => {\r\n                    editor.removeNodeByKey(child.key);\r\n                });\r\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\r\n            }\r\n        }\r\n    }\r\n\r\n    updateGraphShortText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateShortText(newText);            \r\n        }\r\n    }\r\n\r\n    updateGraphLongText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateLongText(newText);            \r\n        }\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './LoadProject.css'\r\nimport db from '../../db.js'\r\nimport ProjectList from './ProjectsList.js'\r\nimport SharedState from '../../shared_state.js';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class LoadProject extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            projects: []\r\n        };\r\n        this.addProject = this.addProject.bind(this)\r\n        this.deleteProject = this.deleteProject.bind(this)\r\n        this.loadProject = this.loadProject.bind(this)\r\n        this.renameProject = this.renameProject.bind(this)\r\n        this.duplicateProject = this.duplicateProject.bind(this)\r\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\r\n        \r\n        document.title = \"Write Reason\"\r\n\r\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\r\n        if (process.env.NODE_ENV === 'development' && this.props.autoload) {\r\n            this.loadProject(this.props.autoload)\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (process.env.NODE_ENV !== 'development' || !this.props.autoload) {\r\n            this.updateProjectsFromDb()\r\n        }\r\n    }\r\n\r\n    updateProjectsFromDb() {\r\n        // todo - only retrieve relevant rows from projects table?\r\n        db.table('projects')\r\n            .toArray(projects => {\r\n                this.setState({ projects })\r\n            }).catch(err => {\r\n                toast.error(\"Error when loading projects: \" + err)\r\n            })\r\n    }\r\n\r\n    loadProject(id) {\r\n        const params = { condition: 'graph' }\r\n        const sharedState = new SharedState(id, params)\r\n        this.props.transitionToEditor(sharedState)\r\n    }\r\n\r\n    addProject() {\r\n        const project = {name: window.prompt('Name your project', 'New project')}\r\n        if (project.name) {\r\n            db.table('projects')\r\n                .add(project)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                });\r\n        }\r\n    }\r\n\r\n    renameProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                const newName = window.prompt('Set a new project name', project.name)\r\n                if (newName) {\r\n                    db.table('projects')\r\n                        .update(id, { name: newName })\r\n                        .then(() => {\r\n                            this.updateProjectsFromDb()\r\n                        })\r\n                }\r\n            });\r\n    }\r\n\r\n    duplicateProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                project.name += ' (copy)'\r\n                delete project.id // set a new one automatically\r\n                db.table('projects')\r\n                    .add(project)\r\n                    .then(() => {\r\n                        this.updateProjectsFromDb()\r\n                    });\r\n            })\r\n    }\r\n\r\n    deleteProject(id) {\r\n        if (window.confirm('Are you sure you want to delete this project? This cannot be undone.')) {\r\n            db.table('projects')\r\n                .delete(id)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                })\r\n        }\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n            <div className=\"load-project\">\r\n                <button className=\"pure-button button-primary\" onClick={this.addProject}>New project</button>\r\n                <div className=\"load-project-table\">\r\n                    {this.state.projects && this.state.projects.length > 0 && <ProjectList projects={this.state.projects}\r\n                        deleteProject={this.deleteProject}\r\n                        loadProject={this.loadProject}\r\n                        renameProject={this.renameProject}\r\n                        duplicateProject={this.duplicateProject}\r\n                    />}\r\n                </div>\r\n            </div>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react';\r\nimport './ExperimentalControls.css';\r\n\r\nexport default class ExperimentControls extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"experiment-controls\">\r\n                <button onClick={this.props.backToMenu}>Back</button>\r\n                <button onClick={this.props.sharedState.exportPDF}>Export PDF</button>\r\n                <button onClick={this.props.sharedState.save}>Save</button>\r\n            </div>\r\n        );\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport Logo from '../../assets/logo.png'\r\nimport { Player, BigPlayButton } from 'video-react'\r\nimport Video from '../../assets/instructions.mp4'\r\nimport Thumbnail from '../../assets/thumbnail.png'\r\nimport \"video-react/dist/video-react.css\"\r\n\r\nexport default class IntroSection extends Component {\r\n    \r\n    render() {\r\n        // eslint-disable-next-line no-useless-concat\r\n        var emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\r\n\r\n        return (\r\n            <div className='intro-section'>\r\n                <img src={Logo} className='logo' alt=\"Write Reason\"/>\r\n                <p className='privacy-notice'><b>Privacy notice</b>: This webpage simply downloads the Write Reason application to your browser. Once loaded, \r\n                    everything runs locally in your browser. No data is sent back to the server.</p>\r\n                <Player src={Video} poster={Thumbnail}>\r\n                    <BigPlayButton className='play-button' position='center' />\r\n                </Player>\r\n        <p><i>Not sure how something works? Get in touch at <a href={'mailto:' + emailAddress + '?subject=Write Reason question'}>{emailAddress}</a>.</i></p>\r\n            </div>\r\n        );\r\n      }\r\n}","/* eslint-disable no-fallthrough */\r\n/* eslint-disable default-case */\r\nimport React, { Component } from 'react';\r\nimport './App.css';\r\nimport DocPane from './components/doc/DocPane.js';\r\nimport GraphPane from './components/graph/GraphPane.js';\r\nimport SplitPane from 'react-split-pane';\r\nimport LoadProject from './components/loadproject/LoadProject.js';\r\nimport { DndProvider } from 'react-dnd'\r\nimport Backend from 'react-dnd-html5-backend'\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport SaveButton from './components/experiment/SaveButton';\r\nimport IntroSection from './components/loadproject/IntroSection';\r\n\r\n\r\nexport default class App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            phase: \"loadproject\",\r\n            params: undefined\r\n        }\r\n\r\n        this.transitionToEditor = this.transitionToEditor.bind(this)\r\n        this.transitionToMenu = this.transitionToMenu.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getStorageUsed()\r\n    }\r\n\r\n    transitionToEditor(newSharedState) {\r\n        this.setState({ \r\n            sharedState: newSharedState,\r\n            phase: \"editor\"\r\n        })\r\n    }\r\n\r\n    transitionToMenu() {\r\n        if (this.state.sharedState) {\r\n            this.state.sharedState.finishCondition()\r\n        }\r\n        this.setState({\r\n            sharedState: undefined,\r\n            phase: \"loadproject\"\r\n        })\r\n    }\r\n\r\n    getStorageUsed() {\r\n        navigator.storage.estimate().then(estimate => {\r\n            this.setState({ storageUsed: (estimate.usage / estimate.quota * 100).toPrecision(2) })\r\n        });\r\n    }\r\n\r\n    render() {\r\n        switch(this.state.phase) {\r\n            case \"loadproject\":\r\n                return (\r\n                    <>\r\n                        <IntroSection />\r\n                        <LoadProject transitionToEditor={this.transitionToEditor} autoload={39} />\r\n                        {this.state.storageUsed && <footer>Storage used: {this.state.storageUsed}%</footer>}\r\n                    </>\r\n                )\r\n            case \"editor\":\r\n                return (\r\n                    <div className=\"App\">\r\n                        <DndProvider backend={Backend}>\r\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\r\n                                <DocPane sharedState={this.state.sharedState} />\r\n                                <GraphPane sharedState={this.state.sharedState} />\r\n                            </SplitPane>\r\n                            <SaveButton sharedState={this.state.sharedState} backToMenu={this.transitionToMenu} />\r\n                        </DndProvider>\r\n                        <ToastContainer\r\n                            position=\"bottom-center\"\r\n                            autoClose={5000}\r\n                            hideProgressBar\r\n                            newestOnTop={false}\r\n                            closeOnClick\r\n                            rtl={false}\r\n                            pauseOnFocusLoss\r\n                            draggable={false}\r\n                            pauseOnHover\r\n                        />\r\n                    </div>\r\n                );\r\n            \r\n            case \"reset\":\r\n                // hacky way to destroy and recreate all components\r\n                window.setTimeout(() => this.setState({phase: \"editor\"}), 0.1)\r\n                return (\r\n                    <p>...</p>\r\n                )\r\n        }\r\n    }\r\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}