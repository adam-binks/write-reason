(this["webpackJsonpwrite-reason"]=this["webpackJsonpwrite-reason"]||[]).push([[0],{114:function(e,t,n){e.exports=n(237)},119:function(e,t,n){},120:function(e,t,n){},121:function(e,t,n){},228:function(e,t,n){},232:function(e,t,n){},236:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(19),i=n.n(a),s=(n(119),n(6)),c=n(7),d=n(11),u=n(10),l=n(13),p=n(12),h=(n(120),n(121),n(36)),v=n(5),f=function(){function e(t,n,o,r,a){var i=this,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;Object(s.a)(this,e),this.hidePopup=this.hidePopup.bind(this),this.div=document.createElement("div"),this.div.classList.add("option-popup-div"),this.div.appendChild(this.generateTable(t,a,c)),this.div.style.left=n+"px",this.div.style.top=o+"px",void 0===d&&(d=document.getElementById("graph")),d.appendChild(this.div);var u=this.div.getBoundingClientRect();u.right>window.innerWidth&&(this.div.style.left=n-(u.right-window.innerWidth)+"px"),u.bottom>window.innerHeight&&(this.div.style.top=o-(u.bottom-window.innerHeight)+"px"),r&&setTimeout((function(){return i.hideOnClickOutside(i.div)}),.01)}return Object(c.a)(e,[{key:"generateTable",value:function(e,t,n){var o=this,r=document.createElement("table");return e.forEach((function(e){e.isClickable=void 0===e.isClickable||e.isClickable;var a=r.insertRow();a.classList.add("option-row"),e.name===n&&a.classList.add("option-row-selected");var i=function(n){e.isClickable&&(t(e),o.hidePopup())},s=a.insertCell();s.textContent=e.symbol,s.style.color=e.colour,s.style.fontSize="150%",s.style.padding="10px";var c=a.insertCell();c.classList.add("option-cell"),c.textContent=e.name,s.addEventListener("click",i),c.addEventListener("click",i),e.buttons&&e.buttons.forEach((function(t){var r=a.insertCell(),i=document.createElement("BUTTON");i.innerHTML='<p class="'+t.className+'"></p>',i.className="pure-button",i.style.padding="0px 10px 0px 10px",r.appendChild(i),i.onclick=function(i){return t.click(i,{colourCell:s,nameCell:c,buttonCell:r,underlyingEntry:t.underlyingEntry,transientEntry:e,underlyingEntries:t.underlyingEntries,row:a,selected:e.name===n,hidePopup:o.hidePopup})}}))})),r}},{key:"hidePopup",value:function(){this.div.remove()}},{key:"hideOnClickOutside",value:function(e){var t=function(t){var o;!e.contains(t.target)&&((o=e)&&(o.offsetWidth||o.offsetHeight||o.getClientRects().length))&&(e.remove(),n())},n=function(){document.removeEventListener("click",t)};document.addEventListener("click",t),document.addEventListener("contextmenu",t)}}]),e}(),g=n(14);function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Heading and body";t.getSharedState().addGraphMapping(e.id,e.node),y(t,e.id,e.text,e.longText,n),t.getSharedState().logger.logEvent({type:"doc_create_from_node",node_id:e.id,short_text:e.text,long_text:e.longText})}function y(e,t,n,o,r){var a=v.a.create({type:"link",data:{node_id:t},nodes:[v.m.create({text:n})]}),i=v.a.create({type:"body",data:{node_id:t},nodes:[v.m.create({text:o})]}),s=v.a.create({type:"section",data:{node_id:t,nodeStyle:r},nodes:[a,i]});return e.insertBlock(s),e.moveToEndOfNode(s),s}function b(e,t){var n=e.getSharedState().draggedNode;if(n){if(n.resetPos(),!e.getSharedState().getGraphNode(n.id)){var o=e.value.document;return e.focus(),"body"!==t.type&&"link"!==t.type||(t=o.getParent(t)),e.moveToEndOfNode(t),m(n,e),e.getSharedState().draggedNode=!1,!0}g.b.error("You can't add the same node twice!"),console.log("Duplicate - node")}}var k=function(e,t,n,o){var r=[{colour:"black",name:"Inline",symbol:"\u2336"},{colour:"black",name:"Heading and body",symbol:"\u25a4"},{colour:"black",name:"Heading only",symbol:"\u2594"},{colour:"black",name:"Body only",symbol:"\u2582"},{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}];o&&(r=r.filter((function(e){return!o.includes(e.name)}))),e.preventDefault();new f(r,e.clientX,e.clientY,!0,(function(e){var o=e.name;if("Delete"===o)n.getSharedState().logger.logEvent({type:"doc_node_delete",id:t.data.get("node_id")}),x(t,n);else{var r=t.data.get("nodeStyle");r||(r="Inline"),n.getSharedState().logger.logEvent({type:"doc_node_change_format",old:r,new:o,id:t.data.get("node_id")}),"Inline"!==r&&"Inline"!==o?n.setNodeByKey(t.key,{data:{node_id:t.data.get("node_id"),nodeStyle:o}}):"Inline"===r&&"Inline"!==o?function(e,t,n){t.moveToRangeOfNode(e);var o=t.value.document.getParent(e.key);o&&o.text===e.text&&t.moveToRangeOfNode(o);y(t,e.data.get("node_id"),e.text,"",n)}(t,n,o):"Inline"!==r&&"Inline"===o&&function(e,t){var n=e.getBlocksByType("link").get(0).text,o=t.value.document.getPreviousBlock(e.nodes.get(0).key),r=t.value.document.getNextBlock(e.nodes.get(1).key);o||r||t.insertNodeByKey(t.value.document.key,0,v.a.create({type:"paragraph"}));t.moveToRangeOfNode(e),o&&("section"===o.type||"body"===o.type)||!o&&r&&("section"===r.type||"link"===r.type)?(t.wrapBlockByKey(e.key,"paragraph"),t.removeNodeByKey(e.key)):t.removeNodeByKey(e.key);t.insertInline({type:"link",data:{node_id:e.data.get("node_id"),nodeStyle:"Inline"}}).insertText(n)}(t,n)}}),t.data.get("nodeStyle"),document.querySelector(".App"))};function x(e,t){t.getSharedState().removeDocNode(e.data.get("node_id")),t.removeNodeByKey(e.key)}var w=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={hover:!1,externalHover:!1},n.setHover=n.setHover.bind(Object(l.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){var t=this.props.sharedState.getGraphNode(this.props.nodeId);t&&t.setHoverer("link_mouse",e),this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e=this,t=this.props.editor.value,n=t.document,o=t.selection,a=n.getDescendantsAtRange(o).contains(this.props.node),i=this.props.sharedState.getGraphNode(this.props.nodeId);i&&i.setHoverer("link_cursor",a);var s="node-link"+(this.state.externalHover||a?" hovered":"");return"heading"===this.props.linkStyle?r.a.createElement("p",Object.assign({className:s},this.props.attributes),r.a.createElement("u",null,r.a.createElement("b",null,this.props.children))):"inline"===this.props.linkStyle?r.a.createElement("p",Object.assign({className:s},this.props.attributes,{onMouseEnter:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},onContextMenu:function(t){return k(t,e.props.node,e.props.editor)}}),this.props.children):void 0}}]),t}(o.Component),_=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={hover:!1,externalHover:!1},n.setHover=n.setHover.bind(Object(l.a)(n)),n.selectNode=e.selectNode,n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e="node-body"+(this.state.externalHover||this.state.hover?" hovered":"")+(this.props.isEmpty?" placeholder":""),t=this.props.editor.value,n=t.document,o=t.selection,a=n.getDescendantsAtRange(o).contains(this.props.node),i=this.props.sharedState.getGraphNode(this.props.nodeId);return i&&(i.setHoverer("body_cursor",a),i.setHoverer("body_mouse",this.state.hover)),this.props.isEmpty?r.a.createElement("p",Object.assign({className:e},this.props.attributes,{onMouseDown:this.selectNode}),"Type some text...",this.props.children):r.a.createElement("p",Object.assign({className:e},this.props.attributes),this.props.children)}}]),t}(o.Component),E=n(242),O="block",S={canDrag:function(e){return e.editor.value.selection.isCollapsed},beginDrag:function(e){return{id:e.node.id,node:e.node}},endDrag:function(e,t,n){if(t.didDrop()){var o=t.getDropResult(),r=e.editor.getSharedState();if(o.droppedOnGraph){var a=r.addGraphNode("",o.position.x,o.position.y,!0),i={id:a.id,node:a,text:"",longText:e.node.text};e.editor.moveTo(e.node.key),m(i,e.editor,"Body only"),e.editor.removeNodeByKey(e.node.key)}else{var s=e.editor.value.document.getParent(e.node.key).nodes.indexOf(e.node),c=(o.insertBefore?1:0)-(o.indexDroppedOn>s?1:0);e.editor.moveNodeByKey(e.node.key,o.parentKey,o.indexDroppedOn+c),r.logger.logEvent({type:"reorder",id:e.node.data.get("node_id"),old_index:s,new_index:o.indexDroppedOn+c})}}}};var j=Object(E.a)(O,S,(function(e,t){return{connectDragSource:e.dragSource(),dragPreview:e.dragPreview(),isDragging:t.isDragging()}})),N=n(243),C={hover:function(e,t,n){var o,r=t.getClientOffset(),a=i.a.findDOMNode(n),s=a.getBoundingClientRect(),c=!0,d=!1,u=void 0;try{for(var l,p=a.children[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var h=l.value;if(h.classList.contains("plain-block")||h.classList.contains("section")){o=h;break}}}catch(m){d=!0,u=m}finally{try{c||null==p.return||p.return()}finally{if(d)throw u}}if(o){var v=o.getBoundingClientRect(),f=v.y-s.y,g=!1;r.y+f>v.y+v.height/2&&(g=!0),n.state.overHalf!==g&&n.setState({overHalf:g})}else console.log("error: couldn't find the inner div!")},drop:function(e,t,n){var o=e.editor.value.document.getParent(e.node.key),r=o.nodes.indexOf(e.node);return{droppedOnGraph:!1,parentKey:o.key,indexDroppedOn:r,insertBefore:n.state.overHalf}}};var D=Object(N.a)(O,C,(function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})),T=j(D(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={hover:!1,externalHover:!1},n.setHover=n.setHover.bind(Object(l.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){var t=this.props.sharedState.getGraphNode(this.props.nodeId);t&&t.setHoverer("section_mouse",e),this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.isOverCurrent,o=t.connectDropTarget,a=t.connectDragSource,i=t.isDragging,s=this.props.editor.value,c=s.blocks&&s.blocks.some((function(t){return t===e.props.node||e.props.node.nodes.includes(t)})),d="section plain-block "+(this.state.externalHover||c?" hovered":"")+(i?" display-none":"");return d+=function(e){switch(e){case"Heading only":return" hide-body";case"Body only":return" hide-heading";default:return""}}(this.props.node.data.get("nodeStyle")),o(r.a.createElement("div",{className:"block-outer-div"},n&&!this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),r.a.createElement("div",Object.assign({className:d},this.props.attributes,{onMouseEnter:function(){return e.setHover(!0)},onMouseOver:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},onMouseUp:function(){b(e.props.editor,e.props.node)&&e.setState({hover:!1})},onContextMenu:function(t){return k(t,e.props.node,e.props.editor)},ref:a}),this.props.children),n&&this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),this.state.hover&&this.props.editor.getSharedState().draggedNode&&r.a.createElement("div",{className:"drop-indicator"})))}}]),t}(o.Component)));function L(e){return{onCopy:function(e,t,n){t.getSharedState().logger.logEvent({type:"copy",content:t.value.fragment.text}),n()},onCut:function(e,t,n){t.getSharedState().logger.logEvent({type:"cut",content:t.value.fragment.text}),n()},onPaste:function(e,t,n){var o=Object(h.b)(e);t.getSharedState().logger.logEvent({type:"paste",paste_type:o.type,content:o.fragment?o.fragment.text:"",content_html:o.fragment?"":o.html}),n()}}}var H=j(D(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={hover:!1},n.setHover=n.setHover.bind(Object(l.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){this.setState({hover:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.isOverCurrent,o=t.connectDropTarget,a=t.connectDragSource,i="plain-block "+(t.isDragging?" display-none":"");return o(r.a.createElement("div",{className:"block-outer-div"},n&&!this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),r.a.createElement("div",Object.assign({className:i},this.props.attributes,{onMouseUp:function(){b(e.props.editor,e.props.node)&&e.setState({hover:!1})},onMouseEnter:function(){return e.setHover(!0)},onMouseOver:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},ref:a}),this.props.children),n&&this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),this.state.hover&&this.props.editor.getSharedState().draggedNode&&r.a.createElement("div",{className:"drop-indicator"})))}}]),t}(o.Component)));var B=n(21),P=n(16),I=n(32);function A(){var e=Object(B.a)(["\n        position: relative;\n        padding: 1px 18px 17px;\n        margin: 0 -20px;\n        border-bottom: 2px solid #eee;\n        margin-bottom: 20px;\n      "]);return A=function(){return e},e}function M(){var e=Object(B.a)(["\n        & > * {\n          display: inline-block;\n        }\n\n        & > * + * {\n          margin-left: 15px;\n        }\n      "]);return M=function(){return e},e}function G(){var e=Object(B.a)(["\n        white-space: pre-wrap;\n        margin: 0 -20px 10px;\n        padding: 10px 20px;\n        font-size: 14px;\n        background: #f8f8e8;\n      "]);return G=function(){return e},e}function R(){var e=Object(B.a)(["\n        font-size: 18px;\n        vertical-align: text-bottom;\n      "]);return R=function(){return e},e}function F(){var e=Object(B.a)(["\n            color: #404040;\n            font: 12px monospace;\n            white-space: pre-wrap;\n            padding: 10px 20px;\n            div {\n              margin: 0 0 0.5em;\n            }\n          "]);return F=function(){return e},e}function K(){var e=Object(B.a)(["\n            font-size: 14px;\n            padding: 5px 20px;\n            color: #404040;\n            border-top: 2px solid #eeeeee;\n            background: #f8f8f8;\n          "]);return K=function(){return e},e}function J(){var e=Object(B.a)(["\n            margin: 30px -20px 0;\n          "]);return J=function(){return e},e}function q(){var e=Object(B.a)(["\n          cursor: pointer;\n          color: ",";\n        "]);return q=function(){return e},e}var U=r.a.forwardRef((function(e,t){var n=e.className,o=e.active,a=e.reversed,i=Object(I.a)(e,["className","active","reversed"]);return r.a.createElement("span",Object.assign({},i,{ref:t,className:Object(P.b)(n,Object(P.a)(q(),a?o?"white":"#aaa":o?"black":"#ccc"))}))})),z=(r.a.forwardRef((function(e,t){var n=e.className,o=e.value,a=Object(I.a)(e,["className","value"]),i=o.document.nodes.map((function(e){return e.text})).toArray().join("\n");return r.a.createElement("div",Object.assign({ref:t},a,{className:Object(P.b)(n,Object(P.a)(J()))}),r.a.createElement("div",{className:Object(P.a)(K())},"Slate's value as text"),r.a.createElement("div",{className:Object(P.a)(F())},i))})),r.a.forwardRef((function(e,t){var n=e.className,o=Object(I.a)(e,["className"]);return r.a.createElement("span",Object.assign({},o,{ref:t,className:Object(P.b)("material-icons",n,Object(P.a)(R()))}))}))),Y=(r.a.forwardRef((function(e,t){var n=e.className,o=Object(I.a)(e,["className"]);return r.a.createElement("div",Object.assign({},o,{ref:t,className:Object(P.b)(n,Object(P.a)(G()))}))})),r.a.forwardRef((function(e,t){var n=e.className,o=Object(I.a)(e,["className"]);return r.a.createElement("div",Object.assign({},o,{ref:t,className:Object(P.b)(n,Object(P.a)(M()))}))})));r.a.forwardRef((function(e,t){var n=e.className,o=Object(I.a)(e,["className"]);return r.a.createElement(Y,Object.assign({},o,{ref:t,className:Object(P.b)(n,Object(P.a)(A()))}))}));function V(){var e=Object(B.a)(["\n        padding: 8px 7px 6px;\n        position: absolute;\n        z-index: 1;\n        top: -10000px;\n        left: -10000px;\n        margin-top: -6px;\n        opacity: 0;\n        background-color: #222;\n        border-radius: 4px;\n        transition: opacity 0.25s;\n      "]);return V=function(){return e},e}var W=function(e){var t=e.editor,n=e.type,o=e.icon,a=t.value,i=a.blocks&&a.blocks.some((function(e){return e.type===n}));return r.a.createElement(U,{reversed:!0,active:i,onMouseDown:function(e){e.preventDefault(),t.setBlocks(i?"paragraph":n),t.getSharedState().logger.logEvent({type:"set_title"+(i?"_disabled":"_enabled")})}},r.a.createElement(z,null,o))},X=r.a.forwardRef((function(e,t){var n=e.editor,o=window.document.getElementById("root");return i.a.createPortal(r.a.createElement(Y,{ref:t,className:Object(P.a)(V())},r.a.createElement(W,{editor:n,type:"heading",icon:"Heading"})),o)})),$=function(e){function t(){var e,n;Object(s.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).menuRef=r.a.createRef(),n.componentDidMount=function(){n.updateMenu()},n.componentDidUpdate=function(){n.updateMenu()},n.updateMenu=function(){var e=n.menuRef.current;if(e){var t=n.props.editor.value,o=t.fragment,r=t.selection;if(r.isBlurred||r.isCollapsed||""===o.text)e.removeAttribute("style");else{var a=window.getSelection().getRangeAt(0).getBoundingClientRect();e.style.opacity=1,e.style.top="".concat(a.top+window.pageYOffset-e.offsetHeight,"px"),e.style.left="".concat(a.left+window.pageXOffset-e.offsetWidth/2+a.width/2,"px")}}},n.render=function(e,t,o){return r.a.createElement(X,{ref:n.menuRef,editor:n.props.editor})},n}return Object(p.a)(t,e),t}(r.a.Component);var Q={inlines:{link:{parent:[{type:""},{type:"paragraph"}],normalize:function(e,t){switch(t.code){case"parent_type_invalid":return void e.unwrapInlineByKey(t.node.key);default:console.log("unhandled link inline err "+t)}}}},blocks:{section:{parent:{object:"document"},nodes:[{match:{type:"link"},min:1,max:1},{match:{type:"body"},min:1,max:1}],normalize:function(e,t){switch(t.code){case"child_max_invalid":return Z(e,t.child,t.node),void e.setNodeByKey(t.child.key,"paragraph");case"child_type_invalid":if("text"===t.child.object||"paragraph"===t.child.type){var n=t.node.nodes.find((function(e){return"link"===e.type}));if(n){var o=n.getLastText(),r=o.text?o.text.length:0;e.insertTextByKey(o.key,r,t.child.text)}else ee(e,t,"link",t.child.text)}return void e.removeNodeByKey(t.child.key);case"child_min_invalid":var a=[];return t.node.nodes.forEach((function(e){a.push(e.type)})),a.includes("link")||ee(e,t,"link"),void(a.includes("body")||ee(e,t,"body"));case"parent_object_invalid":return void Z(e,t.node,t.parent);default:return void console.log("unhandled section schema err "+t)}}}}};function Z(e,t,n){var o=e.value.document.nodes.indexOf(n);-1!==o&&e.moveNodeByKey(t.key,e.value.document.key,o+1)}function ee(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=t.node.data.get("node_id"),a=e.getSharedState().getGraphNode(r);o||(o="link"===n?a.getShortText():a.getLongText());var i="link"===n?0:1;!function(e,t,n,o,r,a){var i=v.a.create({type:n,data:{node_id:r},nodes:[v.m.create({text:a})]});e.insertNodeByKey(t.key,o,i)}(e,t.node,n,i,r,o)}var te,ne={graph:[L(),{onMouseUp:function(e,t,n){var o=t.getSharedState().draggedNode;if(o)if(o.resetPos(),t.getSharedState().getGraphNode(o.id))g.b.error("You can't add the same node twice!"),console.log("Duplicate - editor");else{var r=t.findEventRange(e);if(r){t.select(r);var a=t.value.inlines.find((function(e){return"link"===e.type}));a&&t.moveToEndOfNode(a),m(o,t)}}n()},onBlur:function(e,t,n){t.deselect(),n()},commands:{removeGraphLink:function(e,t){var n=e.value.document;if(n.hasNode(t.key))if("section"===t.type){var o=e.value.document.nodes.indexOf(t);if(-1!==o){var r=0;t.nodes.forEach((function(a){if(n.hasNode(a.key)){var i=t.data.get("nodeStyle");0===r&&"Body only"===i||1===r&&"Heading only"===i?e.removeNodeByKey(a.key):e.moveNodeByKey(a.key,e.value.document.key,o+r+1),r++}}))}e.removeNodeByKey(t.key)}else(e.value.document.getChild(t.key)||"inline"===t.object)&&e.setNodeByKey(t.key,{type:""});else console.log("couldnt remove graph link, node doesnt exist")}}},function(e){return{commands:{wrapLinkAtSelection:function(e,t){return e.wrapInline({type:"link",data:{node_id:t,nodeStyle:"Inline"}})}},renderInline:function(e,n,o){if("link"===e.node.type){var a=t(e,n,"short"),i=a.ref,s=a.id;return r.a.createElement(w,Object.assign({ref:i},e,{linkStyle:"inline",sharedState:n.getSharedState(),nodeId:s}))}return o()},renderBlock:function(e,n,o){var a;if("body"===e.node.type){a=t(e,n,"long");var i=!e.node.text;return r.a.createElement(_,Object.assign({ref:a.ref},e,{sharedState:n.getSharedState(),nodeId:a.id,isEmpty:i,selectNode:function(){setTimeout((function(){n.focus(),n.moveToStartOfNode(e.node)}),0)}}))}return"link"===e.node.type?(a=t(e,n,"short"),r.a.createElement(w,Object.assign({ref:a.ref},e,{linkStyle:"heading",sharedState:n.getSharedState(),nodeId:a.id}))):"section"===e.node.type?(a=t(e,n,"section"),r.a.createElement(T,Object.assign({ref:a.ref},e,{sharedState:n.getSharedState(),nodeId:a.id}))):o()},onDrop:function(e,t,n){},onPaste:function(e,t,n){var o=function(e){return e.filterDescendants((function(e){return"link"===e.type&&"inline"===e.object}))},r=Object(h.b)(e);if("fragment"===r.type){if(t.value.blocks.some((function(e){return"link"===e.type||"body"===e.type}))){var a=r.fragment.text.replace(/(\r\n|\n|\r)/gm,"");return void t.insertText(a)}var i=o(r.fragment);if(i){var s=o(t.value.document),c=[];s.forEach((function(e){c.push({key:e.key,id:e.data.get("node_id")})})),n(),i.forEach((function(e){c.forEach((function(n){var o=e.data.get("node_id");n.id===o&&t.value.document.filterDescendants((function(e){return"link"===e.type&&"inline"===e.object&&e.data.get("node_id")===o})).forEach((function(e){e.key!==n.key&&t.unwrapInlineByKey(e.key)}))}))}))}}else n()},onChange:function(e,t){var n=e.getSharedState();[{nodeType:"link",updateFunc:n.updateGraphShortText.bind(n)},{nodeType:"body",updateFunc:n.updateGraphLongText.bind(n)}].forEach((function(t){return e.value.blocks.forEach((function(o){var r=function(o){var r=o.data.get("node_id");n.checkRecycleBinForGraphNode(r),"inline"!==o.object||""!==o.text&&n.getGraphNode(r)?t.updateFunc(o.data.get("node_id"),o.text):x(o,e)};o.filterDescendants((function(e){return e.type===t.nodeType})).forEach(r),o.type===t.nodeType&&r(o)}))})),t()},onKeyDown:function(e,t,n){var o=t.value,r=o.document,a=o.selection,i=o.startBlock,s=a.start,c=a.end;if("Backspace"!==e.key&&"Delete"!==e.key||!a.isExpanded||r.getNodesAtRange(a).forEach((function(e){"section"!==e.type&&"link"!==e.type||setTimeout((function(){t.getSharedState().updateIsOnGraphStatus(e.data.get("node_id"))}),0)})),"Delete"===e.key&&i&&o.selection.isCollapsed&&o.selection.end.isAtEndOfNode(i)){var d=r.getNextBlock(s.key);!d||"body"!==d.type&&"link"!==d.type&&"section"!==d.type||(t.moveToStartOfNode(d),""===i.text&&t.removeNodeByKey(i.key))}if("Backspace"===e.key){var u=r.getPreviousBlock(s.key);if(i&&a.isCollapsed&&0===s.offset&&u&&("body"===i.type||"link"===i.type))return u&&(t.moveToEndOfNode(u),""===i.text?t.removeNodeByKey(i.key):""===u.text&&t.removeNodeByKey(u.key)),t}if("Enter"===e.key){if(o.inlines.some((function(e){return"link"===e.type})))return;if(i&&"link"===i.type&&s.key===c.key){if(0===s.offset){var l=v.a.create({object:"block",type:""}),p=r.getParent(i.key),h=r.getParent(p.key),f=h.nodes.indexOf(p);return t.insertNodeByKey(h.key,f,l),t.moveBackward(1)}var g=r.getNextBlock(s.key);return g?t.moveToStartOfNode(g):t.moveToEndOfNode(i)}}if("ArrowDown"===e.key||"ArrowUp"===e.key){var m="ArrowDown"===e.key?r.getNextBlock(s.key):r.getPreviousBlock(s.key);if(m&&"body"===m.type&&s.offset<"Type some text... ".length&&("ArrowUp"===e.key||i.text.length<130))return t.moveToEndOfNode(m),void e.preventDefault()}return"Tab"===e.key&&e.preventDefault(),n()}};function t(e,t,n){var o=e.node.data.get("node_id");t.getSharedState().setLinkMapping(o,e.node,n);var a=r.a.createRef();return t.getSharedState().registerLinkNode(o,a,n),{ref:a,id:o}}}(),{renderBlock:function(e,t,n){return e.node.type&&""!==e.node.type&&"paragraph"!==e.node.type?n():r.a.createElement(H,e)}}],plain:[L(),{renderEditor:function(e,t,n){var o=n();return r.a.createElement(r.a.Fragment,null,o,r.a.createElement($,{editor:t}))},renderBlock:function(e,t,n){switch(e.node.type){case"heading":return r.a.createElement("u",null,r.a.createElement("b",null,e.children));default:return n()}}}]},oe=v.n.fromJSON({document:{nodes:[{object:"block",type:"paragraph",nodes:[{object:"text",text:""}]}]}}),re=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={value:void 0,mapHasLoaded:!1},n.queries={getSharedState:function(){return n.props.sharedState},getValue:function(){return n.state.value},mapHasLoaded:function(){n.setState({mapHasLoaded:!0})}},n.onChange=function(e){var t=e.value;n.setState({value:t})},n.props.sharedState.editor_ref=r.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.sharedState;t.getSavedDocValue((function(n){e.setState({value:n?v.n.fromJSON(n):oe},t.editorHasLoaded)}))}},{key:"render",value:function(){var e="plain"===this.props.sharedState.condition?" slate-editor-no-graph":"";return void 0!==this.state.value?r.a.createElement(h.a,{className:"slate-editor"+e,key:this.state.mapHasLoaded?"map-loading":"map-loaded",ref:this.props.sharedState.editor_ref,schema:Q,plugins:ne[this.props.sharedState.condition],queries:this.queries,value:this.state.value,onChange:this.onChange,placeholder:"Write your document here...",spellCheck:!1}):r.a.createElement("p",null)}}]),t}(r.a.Component),ae=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"pane doc"},r.a.createElement(re,{sharedState:this.props.sharedState}))}}]),t}(o.Component),ie=(n(228),n(27)),se=n.n(ie),ce=(n(229),n(230),"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e});!function e(t,n,o){function r(i,s){if(!n[i]){if(!t[i]){if(!s&&("function"==typeof te&&te))return te(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[i]={exports:{}};t[i][0].call(d.exports,(function(e){var n=t[i][1][e];return r(n||e)}),d,d.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof te&&te,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){var o=e("idy"),r=e("set-or-get"),a=e("iterate-object"),i=e("deffy"),s={},c={},d=null,u=null;function l(e,t){var n={};void 0===t&&(t=e,e={}),d=e.container||d;u=e.markers||u,e.k=e.k||100,e.kk=e.kk||10;var l=u.marker(10,10).addClass("connector-marker"),p="triangle-"+o(),h=d.path().attr("marker-end","url(#"+p+")").fill("none").stroke({width:3});return e.specialCoords&&h.addClass("connector-line"),l.attr({id:p,viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"4",markerHeight:"5"}),l.path().attr({d:"M 0 0 L 10 5 L 0 10 z"}),n.source=this,n.target=t,n.line=h,n.marker=l,e.specialCoords,r(s,n.source.id(),[]).push(n),r(s,n.target.id(),[]).push(n),r(c,{toString:function(){var e=[n.source.id(),n.target.id()],t=e.join("->"),o=e.reverse().join("->");return n._=n.id=t,c[o]?(n._=o,o):(n.id=t,t)}},[]).push(n),n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a=t.source.transform(),i=t.target.transform(),s=t.source.bbox(),c=t.target.bbox(),d=a.x+s.width/2,u=a.y+s.height/2,l=i.x+c.width/2,p=i.y+c.height/2,h=(d+l)/2,v=(u+p)/2,f=Math.abs((d-l)/2),g=Math.abs((u-p)/2),m=null,y={x1:d,y1:u,x2:l,y2:p,ex:d,ey:u};r!==(o-1)/2&&(m=Math.sqrt(f*f+g*g),y.ex=h+g/m*e.k*(r-(o-1)/2),y.ey=v-f/m*e.k*(r-(o-1)/2)),n.push(y)})),n},e.specialCoords&&(n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a,i,s=t.source.transform(),c=t.target.transform(),d=t.source.bbox(),u=t.target.bbox(),l=s.x+d.width/2,p=s.y+d.height/2-20,h=s.x-c.x,v=s.y-c.y,f=c.x+u.width/2,g=(c.y+u.height/2-p)/(f-l===0?1e-7:f-l);0===g&&(g=1e-7);var m,y=c.x-10,b=c.x+u.width-30,k=c.y-10,x=c.y+u.height-30,w=function(){var e=h<0?y:b;return{x:e,y:(e-l)*g+p}},_=function(){var e=v<0?k:x;return{x:1/g*(e-p)+l,y:e}};Math.abs(h)>=Math.abs(v)?(a=(m=w()).x,((i=m.y)>x||i<k)&&(a=(m=_()).x,i=m.y)):(a=(m=_()).x,i=m.y,(a>b||a<y)&&(a=(m=w()).x,i=m.y));var E=(l+a)/2,O=(p+i)/2,S=Math.abs((l-a)/2),j=Math.abs((p-i)/2),N=null,C={x1:l,y1:p,x2:a,y2:i,ex:l,ey:p};r!==(o-1)/2&&(N=Math.sqrt(S*S+j*j),C.ex=E+j/N*e.k*(r-(o-1)/2),C.ey=O-S/N*e.k*(r-(o-1)/2)),n.push(C)})),n}),e.padEllipse&&(n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a,i,s,c,d=t.source.node.querySelector("ellipse")||t.source.node.querySelector("circle"),u=t.target.node.querySelector("ellipse")||t.target.node.querySelector("circle"),l=t.source.transform(),p=t.target.transform();"circle"===d.tagName?(a=s=parseFloat(d.getAttribute("r")),i=c=parseFloat(u.getAttribute("r"))):(a=parseFloat(d.getAttribute("rx")),s=parseFloat(d.getAttribute("ry")),i=parseFloat(u.getAttribute("rx")),c=parseFloat(u.getAttribute("ry")));var h=l.x+a/2,v=l.y+s/2,f=p.x+i/2-h,g=p.y+c/2-v,m=Math.sqrt(f*f+g*g),y=f/m,b=g/m,k=h+a*y+a/2,x=v+s*b+s/2,w=h+(m-i-5)*y+i/2,_=v+(m-c-5)*b+c/2,E=(k+w)/2,O=(x+_)/2,S=null,j={x1:k,y1:x,x2:w,y2:_,ex:k,ey:x};isNaN(j.x1)?(j.x1=l.x+2*a,j.y1=l.y+s/2,j.x2=l.x,j.y2=j.y1,j.ex=(j.x1+j.x2)/2,j.ey=j.y1-e.kk*(r+1)):(f=Math.abs((k-w)/2),g=Math.abs((x-_)/2),r!==(o-1)/2&&(S=Math.sqrt(f*f+g*g),j.ex=E+g/S*e.k*(r-(o-1)/2),j.ey=O-f/S*e.k*(r-(o-1)/2))),n.push(j)})),n}),this.cons=this.cons||[],this.cons.push(n),n.update=function(){var e=i(c[n._],[]),t=n.computeLineCoordinates(e);a(t,(function(t,n){e[n].line.plot("M"+t.x1+" "+t.y1+" Q"+t.ex+" "+t.ey+" "+t.x2+" "+t.y2)}))},n.update(),this.on("dragmove",n.update),t.on("dragmove",n.update),n.setLineColor=function(e,t){(t=t||this).line.stroke(e),t.marker.fill(e)},n}if("function"===typeof se.a)se.a.extend(se.a.Element,{connectable:l,delete_connectable:function(e){e.line.remove(),e.marker.remove(),s[e.source.id()]=s[e.source.id()].filter((function(t){return t!==e})),s[e.target.id()]=s[e.target.id()].filter((function(t){return t!==e}));var t=function(){var t=[e.source.id(),e.target.id()],n=t.join("->"),o=t.reverse().join("->");return e._=e.id=n,c[o]?(e._=o,o):(e.id=n,n)};c[t()]=c[t()].filter((function(t){return t!==e})),e.source.node.dispatchEvent(new CustomEvent("dragmove"))}});else if("object"===("undefined"===typeof window?"undefined":ce(window)))throw new Error("SVG.js is not loaded but it is required.");t.exports=l},{deffy:2,idy:4,"iterate-object":5,"set-or-get":6}],2:[function(e,t,n){var o=e("typpy");t.exports=function(e,t,n){return"function"===typeof t?t(e):(n="boolean"===o(n)?{empty:n}:{empty:!1}).empty?e||t:o(e)===o(t)?e:t}},{typpy:3}],3:[function(e,t,n){function o(e,t){return 2===arguments.length?o.is(e,t):o.get(e,!0)}o.is=function(e,t){return o.get(e,"string"===typeof t)===t},o.get=function(e,t){return"string"===typeof e?t?"string":String:null===e?t?"null":null:void 0===e?t?"undefined":void 0:e!==e?t?"nan":NaN:t?e.constructor.name.toLowerCase():e.constructor},t.exports=o},{}],4:[function(e,t,n){t.exports=function(e){return e=e||10,Math.random().toString(35).substr(2,e)}},{}],5:[function(e,t,n){t.exports=function(e,t){var n=0,o=[];if(Array.isArray(e))for(;n<e.length&&!1!==t(e[n],n,e);++n);else for(o=Object.keys(e);n<o.length&&!1!==t(e[o[n]],o[n],e);++n);}},{}],6:[function(e,t,n){var o=e("deffy");t.exports=function(e,t,n){return e[t]=o(e[t],n)}},{deffy:7}],7:[function(e,t,n){arguments[4][2][0].apply(n,arguments)},{dup:2,typpy:8}],8:[function(e,t,n){arguments[4][3][0].apply(n,arguments)},{dup:3}]},{},[1]);var de=n(111),ue=n(106);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var pe=["red","goldenrod","green","aqua","blue","fuchsia","purple","saddlebrown"],he=[{colour:"green",name:"Supports",symbol:"\u2192"},{colour:"red",name:"Opposes",symbol:"\u2192"},{colour:"blue",name:"Expands",symbol:"\u2192"}],ve=function(){function e(t,n,o,r,a){var i=this;Object(s.a)(this,e),this.shared_state=t,this.drawing_arrow_from=!1,this.connector=void 0,this.connectables_container=o,this.markers=r,this.links=a,this.arrow_id_counter=0,this.completed_arrows=[],this.mouse_rect=n.group(),window.addEventListener("mousemove",(function(e){var t=n.point(e.clientX,e.clientY);i.mouse_rect.move(t.x,t.y),"undefined"!==typeof i.connector&&i.connector.update()})),window.addEventListener("mouseup",(function(e){i.drawing_arrow_from&&(e.preventDefault(),i.stop_drawing_arrow())}))}return Object(c.a)(e,[{key:"toJSON",value:function(){return{arrows:this.completed_arrows,arrow_id_counter:this.arrow_id_counter,arrowOptions:this.arrowOptions}}},{key:"draw_loaded_arrows",value:function(e){var t=this;this.completed_arrows.forEach((function(n){var o=e(n.origin),r=e(n.destination);if(o)if(r){var a=t.draw_arrow(o,r,n.colour);t.add_context_menu_to_arrow(a,n),o.group.node.dispatchEvent(new CustomEvent("dragmove"))}else g.b.error("Error: could not draw arrow to destination "+n.destination);else g.b.error("Error: could not draw arrow from origin "+n.origin)}))}},{key:"update_source",value:function(e){"undefined"===typeof this.connector?this.connector=e.connectable({container:this.connectables_container,markers:this.markers},this.mouse_rect):(this.connector.marker.show(),this.connector.line.show(),this.connector.target=this.mouse_rect,this.connector.source=e,this.connector.update()),this.connector&&this.connector.setLineColor("#d4b8b0")}},{key:"hide",value:function(){"undefined"!==typeof this.connector&&(this.connector.target=this.connector.source,this.connector.marker.hide(),this.connector.line.hide())}},{key:"start_arrow",value:function(e){this.drawing_arrow_from=e,this.connector&&this.connector.setLineColor("#719deb")}},{key:"draw_arrow",value:function(e,t,n){var o=this,r=e.group.connectable({container:this.links,markers:this.markers,specialCoords:!0},t.group);return r.setLineColor(n),r.source.on("deletenode",(function(){r.source.node.instance.delete_connectable(r),o.remove_arrow(r)})),r.target.on("deletenode",(function(){r.target.node.instance.delete_connectable(r),o.remove_arrow(r)})),r}},{key:"add_context_menu_to_arrow",value:function(e,t){var n=this,o=function(o){var r=document.getElementById("graph").getBoundingClientRect();n.edit_connector_type(e,o.clientX-r.left,o.clientY-r.top,!0,(function(e){t.colour=e}),t),o.preventDefault()};e.line.on("click",o),e.line.on("contextmenu",o),e.source.on("deletenode",(function(){e.source.node.instance.delete_connectable(e),n.remove_arrow(e,t)})),e.target.on("deletenode",(function(){e.target.node.instance.delete_connectable(e),n.remove_arrow(e,t)})),window.addEventListener("colourchange",(function(n){n.detail.oldColour===t.colour&&(e.setLineColor(n.detail.newColour),t.colour=n.detail.newColour)})),window.addEventListener("arrowdelete",(function(o){o.detail.colour===t.colour&&n.remove_arrow(e,t)}))}},{key:"complete_arrow",value:function(e){var t=this;if(e!==this.drawing_arrow_from){var n=this.draw_arrow(this.drawing_arrow_from,e,"#5D4037"),o=this.drawing_arrow_from.group.getScreenCoords(),r=e.group.getScreenCoords(),a=[(o.x+r.x)/2,(o.y+r.y)/2],i=this.drawing_arrow_from.id;this.edit_connector_type(n,a[0],a[1],!1,(function(o){var r={id:t.getNewId(),origin:i,destination:e.id,colour:o};t.completed_arrows.push(r),t.add_context_menu_to_arrow(n,r)})),this.shared_state.logger.logEvent({type:"arrow_create",id:n.id,source:this.drawing_arrow_from.id,target:e.id}),this.stop_drawing_arrow()}else this.stop_drawing_arrow()}},{key:"getArrowByID",value:function(e){return this.completed_arrows.find((function(t){return t.id===e}))}},{key:"getNewId",value:function(){return this.arrow_id_counter++,this.arrow_id_counter}},{key:"changeArrowColour",value:function(e,t){var n=e.colour,o=this.getNextAvailableColour(e,t);if(o)return e.colour=o,window.dispatchEvent(new CustomEvent("colourchange",{detail:{oldColour:n,newColour:o}})),this.shared_state.logger.logEvent({type:"update_arrow_colour",newColour:o}),o}},{key:"getNextAvailableColour",value:function(e,t){var n=this,o=pe.filter((function(t){return!n.arrowOptions.find((function(n){return n.colour===t&&n!==e}))}));if(o){var r=e?o.indexOf(e.colour):0;if(-1!==r){var a=(r+1*t)%o.length;return a<0&&(a=o.length-1),o[a]}}}},{key:"getArrowOptions",value:function(){var e=this,t=function t(n,o){var r=o.colourCell,a=o.nameCell,i=o.buttonCell,s=o.underlyingEntry,c=o.transientEntry;c.isClickable=!1;var d=i.children[0],u=function(){var e=p.value;return e.length>=50&&(e=e.substring(0,50)),e&&(s.name=e),e},l=function(){var e=u();e&&(a.textContent=e),c.isClickable=!0,r.textContent=h.textContent,r.style.color=h.style.color,d.classList.remove("pure-button-active"),d.onclick=function(e){return t(e,o)}};d.classList.add("pure-button-active"),d.onclick=l;var p=document.createElement("input");p.style.width=(a.getBoundingClientRect().width-5).toString()+"px",p.value=a.textContent,p.addEventListener("keyup",(function(e){"Enter"===e.key&&p.value&&l()})),p.addEventListener("change",u),a.textContent="",a.appendChild(p);var h=document.createElement("button");h.className="pure-button",h.textContent=r.textContent,r.textContent="",r.appendChild(h),h.style.color=r.style.color,h.style.padding=0,h.addEventListener("click",(function(){h.style.color=e.changeArrowColour(s,1),c.colour=s.colour})),h.addEventListener("contextmenu",(function(t){h.style.color=e.changeArrowColour(s,-1),c.colour=s.colour,t.preventDefault()})),p.focus()},n=function(t,n){var o=n.row,r=n.underlyingEntries,a=n.underlyingEntry,i=n.transientEntry,s=n.selected,c=n.hidePopup;if(i.isClickable=!1,window.confirm('Are you sure you want to delete all "'+a.name+'" arrows? This cannot be undone.')){var d=r.indexOf(a);-1!==d&&r.splice(d,1),setTimeout((function(){return o.parentNode.removeChild(o)}),0),window.dispatchEvent(new CustomEvent("arrowdelete",{detail:{colour:a.colour}})),e.shared_state.logger.logEvent({type:"delete_arrow_type",colour:a.colour}),s&&c()}i.isClickable=!0},o=this.arrowOptions.map((function(o){var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(n,!0).forEach((function(t){Object(ue.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o);return r.buttons=[{className:"edit-icon",click:t,underlyingEntry:o},{className:"delete-icon",click:n,underlyingEntry:o,underlyingEntries:e.arrowOptions}],r}));return[].concat(Object(de.a)(o),[{colour:"black",name:"Add arrow type",symbol:"+"},{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}])}},{key:"edit_connector_type",value:function(e,t,n,o,r,a){var i=this,s=void 0,c=this.getArrowOptions();s=(s=c.find((function(t){return t.colour===e.line.attr("stroke")&&"Delete"!==t.name&&"Add arrow type"!==t.name})))?s.name:void 0;var d=function(t){e.setLineColor(t.colour),i.shared_state.logger.logEvent({type:"arrow_set_type",id:e.id,new_type:t.name}),r&&r(t.colour)};new f(c,t,n,o,(function(o){if("Delete"===o.name)i.shared_state.logger.logEvent({type:"arrow_delete",id:e.id}),i.remove_arrow(e,a);else if("Add arrow type"===o.name){var c=i.getNextAvailableColour(null,1);if(c){var u={name:"New relation",colour:c,symbol:"\u2192"};i.arrowOptions.push(u),i.shared_state.logger.logEvent({type:"add_arrow_type",colour:c}),s||d(u),i.edit_connector_type(e,t,n,!0,r,a)}else g.b.error("Maximum number of arrow types reached!")}else d(o)}),s)}},{key:"remove_arrow",value:function(e,t){e.line.node.instance.delete_connectable(e),t&&(this.completed_arrows=this.completed_arrows.filter((function(e){return e!==t})))}},{key:"stop_drawing_arrow",value:function(){this.drawing_arrow_from=!1,this.hide()}}],[{key:"fromJSON",value:function(t,n,o,r,a,i){var s=new e(n,o,r,a,i);return s.arrow_id_counter=t&&t.arrow_id_counter?t.arrow_id_counter:0,s.completed_arrows=t&&t.arrows?t.arrows:[],s.arrowOptions=t&&t.arrowOptions?t.arrowOptions:he,s}}]),e}(),fe=20,ge=function(){function e(t,n,o,r,a,i){var c=this;Object(s.a)(this,e);var d=t.shortText,u=t.x,l=t.y,p=t.width,h=t.height,v=t.id,f=t.isOnGraph,g=t.longText;this.id=v||r.getNodeId(),this.getNodesList=i,this.group=n.group().translate(u,l),this.dropShadow=this.group.rect(p,h).radius(5).addClass("node-drop-shadow"),this.arrow_hitbox=this.group.rect(p+2*fe,h+2*fe).translate(-fe,-fe).opacity(0).radius(10).addClass("arrow-hitbox"),this.rect=this.group.rect(p,h).radius(5).addClass("node"),this.editRect=this.group.rect(p-10,h-10).radius(5).translate(5,5).addClass("editing-node-rect"),this.text=this.group.text("").addClass("node-text"),this.updateShortText(d),this.updateLongText(g),this.setupRectDragging(this.rect,r),this.setupArrowHitbox(this.arrow_hitbox,o);var m=function(e){o.drawing_arrow_from&&o.complete_arrow(c)};this.arrow_hitbox.on("mouseup",m),this.rect.on("mouseup",m),this.text.on("mouseup",m),this.setupHover(r),this.setupContextMenu(r),a&&this.editText(r,!t.doNotDeleteIfEmptyText),this.setIsOnGraph(f),t.isFromJSON||r.logger.logEvent({type:"node_create",id:this.id})}return Object(c.a)(e,[{key:"toJSON",value:function(){return{id:this.id,shortText:this.shortText,longText:this.longText,screenCoords:this.group.getScreenCoords(),isOnGraph:this.isOnGraph}}},{key:"setIsOnGraph",value:function(e){this.isOnGraph=e,this.isOnGraph?this.rect.addClass("node-on-graph"):this.rect.removeClass("node-on-graph")}},{key:"setupContextMenu",value:function(e){var t=this,n=function(n){n.preventDefault();var o=document.getElementById("graph").getBoundingClientRect();return new f([{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}],n.clientX-o.left,n.clientY-o.top,!0,(function(n){"Delete"===n.name&&t.delete(e)})),!1};this.rect.on("contextmenu",n),this.text.on("contextmenu",n)}},{key:"setupHover",value:function(e){var t=this;this.hoverers=[];var n=function(n){t.setHoverer("mouse_"+n.target,!0),e.getAllDocNodeRefs(t.id).forEach((function(e){e&&(e.decoratedRef?e.decoratedRef.current.decoratedRef.current.setExternalHover(!0):e.setExternalHover(!0))}))},o=function(n){t.setHoverer("mouse_"+n.target,!1),e.getAllDocNodeRefs(t.id).forEach((function(e){e&&(e.decoratedRef?e.decoratedRef.current.decoratedRef.current.setExternalHover(!1):e.setExternalHover(!1))}))};this.rect.on("mouseenter",n),this.text.on("mouseenter",n),this.rect.on("mouseleave",o),this.text.on("mouseleave",o)}},{key:"setHoverer",value:function(e,t){if(t)this.hoverers.includes(e)||this.hoverers.push(e);else{var n=this.hoverers.indexOf(e);-1!==n&&this.hoverers.splice(n,1)}this.setHovered(this.hoverers.length>0)}},{key:"setHovered",value:function(e){e?this.rect.addClass("hovered"):this.rect.removeClass("hovered")}},{key:"setupRectDragging",value:function(e,t){var n=this;this.setupGroupDragging(e,t,e),this.setupGroupDragging(this.text,t,e,!0),this.text.click((function(e){return e.preventDefault()}));var o=function(){e.just_dropped||n.editText(t)};e.click(o),this.text.click(o)}},{key:"setupGroupDragging",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.draggy(),e.on("mousedown",(function(e){e.stopPropagation()})),n.just_dropped=!1,e.on("dragstart",(function(a){var i=o.group.x(),s=o.group.y();document.activeElement.blur(),t.draggedNode={id:o.id,text:o.getShortText(),longText:o.getLongText(),resetPos:function(){o.group.move(i,s),o.group.node.dispatchEvent(new CustomEvent("dragmove"))},node:o},o.dropShadow.translate(5,5),o.dropShadow.addClass("visible"),e.off("dragmove"),e.on("dragmove",(function(t){o.group.move(i+t.detail.delta.movedX,s+t.detail.delta.movedY),r?o.text.center(.5*o.rect.width(),.5*o.rect.height()):(e.x(0),e.y(0)),o.group.node.dispatchEvent(new CustomEvent("dragmove"))})),e.off("dragend"),e.on("dragend",(function(e){var r=o.group.x()-i,a=o.group.y()-s;(r>10||r<-10||a>10||a<-10)&&(n.just_dropped=!0,setTimeout((function(){n.just_dropped=!1}),.05)),t.draggedNode=!1,o.dropShadow.translate(0,0),o.dropShadow.removeClass("visible")}))}))}},{key:"setupArrowHitbox",value:function(e,t){var n=this;e.on("mousemove",(function(){t.drawing_arrow_from||t.update_source(n.group)})),e.on("mouseleave",(function(){t.drawing_arrow_from||t.hide()})),e.on("mousedown",(function(e){t.start_arrow(n),e.stopPropagation()}))}},{key:"updateShortText",value:function(e){this.shortText=e.replace(/[\r\n\v]+/g,"");var t=this.splitIntoLines(21,this.shortText);this.text.text(t.join("\n")),this.resizeRect(t.length)}},{key:"updateLongText",value:function(e){this.longText=e}},{key:"splitIntoLines",value:function(e,t){var n=[],o="";return t.split(" ").forEach((function(t){var r=[];if(t.length>e)for(var a=0;a<t.length;a+=e-1)r.length>0&&(r[r.length-1]+="-"),r.push(t.substring(a,Math.min(a+e,t.length)));else r=[t];r.forEach((function(t){if((o+t).length<e){var r=o.length>0?" ":"";o+=r+t}else n.push(o),o=t}))})),n.push(o),n}},{key:"resizeRect",value:function(e){this.rect.width(200);var t=21*e+20;this.rect.height(t),this.text.center(.5*this.rect.width(),.5*this.rect.height()),this.dropShadow.height(t),this.editRect.height(t-10),this.arrow_hitbox.size(this.rect.width()+2*fe,this.rect.height()+2*fe),this.group.node.dispatchEvent(new CustomEvent("dragmove"))}},{key:"getShortText",value:function(){return this.shortText}},{key:"getLongText",value:function(){return this.longText}},{key:"editText",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];document.activeElement.blur();var o=document.querySelector("#nodeedit");o.value=this.getShortText();var r=this.getShortText(),a=this.group.getScreenCoords();o.style.left=a.x+"px",o.style.top=a.y+"px",o.style.display="inline-block",o.focus(),o.style.width="180px",o.style.height="auto",o.style.height=o.scrollHeight+"px",this.text.hide(),this.editRect.addClass("visible"),this.setHoverer("editNodeDirectly",!0);var i=function(){t.updateShortText(o.value),e.updateDocShortText(t.id,t.getShortText())},s=function(){i(),o.style.display="none",!n||t.text.text()&&""!==t.text.text()||t.delete(e),t.text.show(),t.updateShortText(t.shortText),t.getShortText()!==r&&e.logger.logEvent({type:"node_edit_short_text",id:t.id,text:t.shortText}),t.editRect.removeClass("visible"),t.setHoverer("editNodeDirectly",!1)};o.onblur=s,o.onkeyup=function(e){"Escape"===e.key||"Esc"===e.key||"Enter"===e.key?(e.preventDefault(),document.activeElement.blur()):i()}}},{key:"delete",value:function(e){e.removeGraphNode(this.id);var t=this.getNodesList(),n=t.indexOf(this);-1!==n?t.splice(n,1):console.log("node not found in this.nodesList when deleting"),this.group.remove(),this.group.node.dispatchEvent(new CustomEvent("deletenode")),e.logger.logEvent({type:"node_delete",id:this.id})}}],[{key:"fromJSON",value:function(t,n,o,r,a){var i=t;return i.x=t.screenCoords.x,i.y=t.screenCoords.y,i.width=200,i.height=42,i.isFromJSON=!0,new e(i,n,o,r,!1,a)}}]),e}();var me=Object(N.a)(O,{canDrop:function(e,t){var n=t.getItem();return"section"!==n.node.type&&!n.node.findDescendant((function(e){return"link"===e.type}))},drop:function(e,t,n){return{droppedOnGraph:!0,position:t.getClientOffset()}}},(function(e,t){return{connectDropTarget:e.dropTarget(),itemType:t.getItemType()}}))(function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.sharedState.getSavedGraph((function(t){e.nodesList=[],e.props.sharedState.graphPane=e,e.$el=document.querySelector("#graph");var n=new se.a(e.$el).size("100%","100%").panZoom({zoomMin:1,zoomMax:1});se.a.extend(se.a.Element,{getScreenCoords:function(){var e=this.doc().node.getBoundingClientRect(),t=this.point(0,0);return{x:-t.x-e.left,y:-t.y-e.top}}});var o=n.group(),r=n.group(),a=n.group(),i=t?t.connections:void 0,s=ve.fromJSON(i,e.props.sharedState,n,o,r,o);e.mouse_follower=s,n.on("dblclick",(function(t){(t.target===n.node||s.drawing_arrow_from)&&e.addNodeAtScreenLocation(n,a,s,"",t.clientX,t.clientY,!0)})),e.setupTextDropping(n,a,s),n.on("panStart",(function(e){document.activeElement.blur()}));var c=document.querySelector("#nodeedit");c.setAttribute("style","height:"+c.scrollHeight+"px;overflow-y:hidden;"),c.addEventListener("input",(function(e){c.style.height="auto",c.style.height=c.scrollHeight+"px"})),e.props.sharedState.addGraphNode=function(t,o,r,i){return e.addNodeAtScreenLocation(n,a,s,t,o,r,!0,i)},t&&t.nodes&&e.loadNodesFromJSON(t.nodes,s,a),e.getNodeById=e.getNodeById.bind(e),s.draw_loaded_arrows(e.getNodeById),0===e.nodesList.length&&e.addNoNodesIndicator(n,a,s)}))}},{key:"getNodeById",value:function(e){return this.nodesList.find((function(t){return t.id.toString()===e.toString()}))}},{key:"toJSON",value:function(){return{nodes:this.nodesList.map((function(e){return e.toJSON()})),connections:this.mouse_follower.toJSON()}}},{key:"loadNodesFromJSON",value:function(e,t,n){var o=this;this.nodesList=e.map((function(e){return ge.fromJSON(e,n,t,o.props.sharedState,(function(){return o.nodesList}))}))}},{key:"addNoNodesIndicator",value:function(e,t,n){var o=this;this.noNodesIndicator=e.text("Double click to add a node").addClass("indicator-text").attr({x:"40%",y:"45%"}),this.noNodesIndicator.on("dblclick",(function(r){o.addNodeAtScreenLocation(e,t,n,"",r.clientX,r.clientY,!0)}))}},{key:"setupTextDropping",value:function(e,t,n){var o=this;this.$el.addEventListener("dragover",(function(e){e.preventDefault()})),this.$el.addEventListener("drop",(function(r){if(r.preventDefault(),r.dataTransfer.types.includes("text/plain")){var a=r.dataTransfer.getData("Text");if(a.includes("\n"))g.b.error("You can't add multiple paragraphs to the graph at once");else if(o.props.sharedState.canAddLinkAtSelection()){var i=o.addNodeAtScreenLocation(e,t,n,a,r.clientX,r.clientY,!1);o.props.sharedState.addLinkAtSelection(i.id,i),o.props.sharedState.logger.logEvent({type:"node_create_from_doc",node_id:i.id,text:a}),document.activeElement.blur()}else g.b.error("You can't add the same node to the graph twice!")}}))}},{key:"addNodeAtScreenLocation",value:function(e,t,n,o,r,a,i){var s=this,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=e.point(r,a),u={shortText:o,longText:"",x:d.x,y:d.y,width:200,height:42,isOnGraph:!1,id:void 0,doNotDeleteIfEmptyText:c},l=new ge(u,t,n,this.props.sharedState,i,(function(){return s.nodesList}));return this.nodesList.push(l),this.noNodesIndicator&&this.noNodesIndicator.hide(),l}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return this.props.connectDropTarget(r.a.createElement("div",{id:"graph",className:"pane",ref:function(t){return e.el=t}},r.a.createElement("textarea",{id:"nodeedit"})))}}]),t}(r.a.Component)),ye=n(112),be=(n(232),new(n(107).a)("writeReasonDb"));be.version(1).stores({projects:"++id,name"});var ke=be,xe=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"display-block"},r.a.createElement("table",{className:"pure-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"ID"),r.a.createElement("th",null,"Name"),r.a.createElement("th",null),r.a.createElement("th",null),r.a.createElement("th",null),r.a.createElement("th",null))),r.a.createElement("tbody",null,this.props.projects.map((function(t){return r.a.createElement("tr",{key:t.id.toString()},r.a.createElement("td",null,t.id),r.a.createElement("td",null,t.name),r.a.createElement("td",null,r.a.createElement("button",{className:"pure-button",onClick:function(){return e.props.loadProject(t.id)}},"Open")),r.a.createElement("td",null,r.a.createElement("button",{className:"pure-button",onClick:function(){return e.props.renameProject(t.id)}},"Rename")),r.a.createElement("td",null,r.a.createElement("button",{className:"pure-button",onClick:function(){return e.props.duplicateProject(t.id)}},"Duplicate")),r.a.createElement("td",null,r.a.createElement("button",{className:"pure-button",onClick:function(){return e.props.deleteProject(t.id)}},"Delete")))})))))}}]),t}(o.Component),we=n(43),_e=n.n(we),Ee=n(78),Oe=n(108),Se=["session_start","document_content_detailed","document_content_markdown"],je=function(){function e(t,n){Object(s.a)(this,e),this.shouldLogToConsole=!1,this.db_id=t,this.conditions=n,this.logToConsole("Logging begin, db_id "+t+"\nParams "+JSON.stringify(n,null,1)),this.stateIsDirty=!1,this.logEvent({type:"session_start"})}return Object(c.a)(e,[{key:"logEvent",value:function(e){var t=this;Se.includes(e.type)||(this.stateIsDirty=!0),"save"===e.type&&(this.stateIsDirty=!1),this.getLog((function(n){void 0===n.events&&(n.events={}),void 0===n.events[e.type]&&(n.events[e.type]=[]),e.timestamp=new Date,n.events[e.type].push(e),t.setLog(n),t.logToConsole("Logging event: "+JSON.stringify(e))}))}},{key:"getLog",value:function(e){ke.table("projects").get(this.db_id).then((function(t){e(t.log?t.log:{})}))}},{key:"setLog",value:function(e){ke.table("projects").update(this.db_id,{log:e}).catch((function(e){g.b.error("Logging error: "+e),console.log("Logging error: "+e)}))}},{key:"logToConsole",value:function(e){this.shouldLogToConsole&&console.log(e)}}]),e}(),Ne=function(){function e(t,n){var o=this;Object(s.a)(this,e),this.getSavedDocValue=function(){var e=Object(Ee.a)(_e.a.mark((function e(t){return _e.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ke.table("projects").get(this.db_id).then((function(e){t(e.doc_value)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.getSavedGraph=function(){var e=Object(Ee.a)(_e.a.mark((function e(t){return _e.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ke.table("projects").get(this.db_id).then((function(e){t(e.graph_value)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.logger=new je(t,n),this.condition=n.condition,this.params=n,this.node_id_counter=0,this.slate_id_counter=10,this.map={},this.map_recycle_bin={},this.db_id=t,this.editor_ref=void 0,this.graphPane=void 0,this.intervalLogger=window.setInterval((function(){o.logger.logEvent({type:"document_content_detailed",content:o.getEditor().getValue()}),o.logger.logEvent({type:"document_content_markdown",content:o.getArgumentMarkdown()})}),3e4),this.downloadExperimentData=this.downloadExperimentData.bind(this),this.editorHasLoaded=this.editorHasLoaded.bind(this),this.save=this.save.bind(this),window.onbeforeunload=function(e){o.getStateIsDirty()&&(e.preventDefault(),e.returnValue="")}}return Object(c.a)(e,[{key:"editorHasLoaded",value:function(){var e=this;ke.table("projects").get(this.db_id).then((function(t){e.node_id_counter=t.node_id_counter?t.node_id_counter:0,e.map=t.map?e.mapFromJSON(t.map):{},e.getEditor().mapHasLoaded()})),this.lastSavedDocumentState=this.getEditor().getValue().document}},{key:"save",value:function(){var e=this,t={map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON()};ke.table("projects").update(this.db_id,t).then((function(t){if(t)g.b.info("Changes saved!"),e.lastSavedDocumentState=e.getEditor().getValue().document;else{var n="Save error: file with ID "+e.db_id.toString()+" does not exist!";console.log(n),g.b.error(n)}})).catch((function(e){g.b.error("Save error: "+e.toString())})),this.logger.logEvent({type:"save"})}},{key:"getStateIsDirty",value:function(){return this.logger.stateIsDirty||this.getEditor()&&this.getEditor().getValue()&&this.getEditor().getValue().document!==this.lastSavedDocumentState}},{key:"mapToJSON",value:function(){var e=this,t={},n=this.getEditor().value.document,o=function(o){var r={};["section","long","short"].forEach((function(t){var a=e.getDocNodes(o);if(a&&a[t]){var i=n.getPath(a[t]);r[t]=i.toArray()}})),t[o]={graph_node:e.getGraphNode(o)?e.getGraphNode(o).id:void 0,doc_nodes:r}};for(var r in this.map)o(r);return t}},{key:"mapFromJSON",value:function(e){for(var t in this.map={},e){if(e[t].graph_node){var n=this.graphPane.getNodeById(t);n?this.addGraphMapping(t,n):g.b.error("Error when loading: could not find graph node with ID "+t)}if(e[t].doc_nodes)for(var o in e[t].doc_nodes){var r=e[t].doc_nodes[o],a=this.getEditor().value.document;a.hasNode(r)?this.setLinkMapping(t,a.getNode(r),o):(console.log(a),g.b.error("Error when loading: could not find "+o+" with ID "+t))}}return this.map}},{key:"downloadExperimentData",value:function(){var e=this;this.logger.getLog((function(t){var n=document.createElement("a"),o={params:e.params,argument:e.getArgumentMarkdown(),logs:t},r=new Blob([JSON.stringify(o,null,2)],{type:"text/plain"});n.href=URL.createObjectURL(r),n.download=e.logger.getExperimentId()+".json",document.body.appendChild(n),n.click()}))}},{key:"getArgumentMarkdown",value:function(){var e=this,t=function(t,n){var o=e.getEditor().value.document.getParent(t.key);return o&&o.data.get("nodeStyle")===n},n=[{serialize:function(e,n){if(["block","inline"].includes(e.object))switch(e.type){case"paragraph":case"":return r.a.createElement("p",null,n);case"heading":return r.a.createElement("h2",null,n);case"section":return r.a.createElement("div",null,n);case"body":return t(e,"Heading only")?r.a.createElement("p",null):r.a.createElement("p",null,n);case"link":return"inline"===e.object?r.a.createElement("span",null,n):t(e,"Body only")?r.a.createElement("p",null):r.a.createElement("h2",null,n);default:return}}}],o=new Oe.a({rules:n}).serialize(this.getEditor().value);return[{regex:/<p>\s*<\/p>/g},{regex:/<p>/g},{regex:/<\/p>/g,replace:"\n\n"},{regex:/<div>/g},{regex:/<\/div>/g},{regex:/<span>/g},{regex:/<\/span>/g},{regex:/<h2>/g,replace:"## "},{regex:/<\/h2>/g,replace:"\n"}].forEach((function(e){o=o.replace(e.regex,e.replace?e.replace:"")})),o}},{key:"finishCondition",value:function(){window.onbeforeunload=void 0,window.clearInterval(this.intervalLogger)}},{key:"getEditor",value:function(){return this.editor_ref.current}},{key:"getNodeId",value:function(){return this.node_id_counter++,this.node_id_counter}},{key:"canAddLinkAtSelection",value:function(){var e=this.getEditor().value,t=e.blocks.some((function(e){return"link"===e.type||"section"===e.type||"body"===e.type})),n=e.inlines.some((function(e){return"link"===e.type}));return!t&&!n}},{key:"addLinkAtSelection",value:function(e,t){this.getEditor().wrapLinkAtSelection(e),this.addGraphMapping(e,t)}},{key:"addGraphMapping",value:function(e,t){t.setIsOnGraph(!0),this.map[e]={graph_node:t}}},{key:"setLinkMapping",value:function(e,t,n){this.map[e]||(this.map[e]={},this.checkRecycleBinForGraphNode(e)),void 0===this.map[e].doc_nodes&&(this.map[e].doc_nodes={}),this.map[e].doc_nodes[n]=t}},{key:"getGraphNodeAndDocNode",value:function(e){return this.map[e]}},{key:"checkRecycleBinForGraphNode",value:function(e){if(this.map[e]||(this.map[e]={}),!this.map[e].graph_node){var t=this.map_recycle_bin[e];t&&t.graph_node&&(console.log("restored from recycle"),this.addGraphMapping(e,t.graph_node))}}},{key:"getGraphNode",value:function(e){var t=this.getGraphNodeAndDocNode(e);if(t)return t.graph_node}},{key:"removeGraphNode",value:function(e){var t=this;this.getDocNodes(e)&&(Object.values(this.getDocNodes(e)).forEach((function(e){t.getEditor().removeGraphLink(e)})),this.map[e]=void 0)}},{key:"removeDocNode",value:function(e){var t=this.getGraphNodeAndDocNode(e);t&&(t.graph_node&&t.graph_node.setIsOnGraph(!1),this.map_recycle_bin[e]=this.map[e],this.map[e]=void 0)}},{key:"getDocNodes",value:function(e){var t=this.getGraphNodeAndDocNode(e);if(t)return t.doc_nodes}},{key:"getDocNodeShortText",value:function(e){var t=this.getDocNodes(e);if(t)return t.short}},{key:"getDocNodeLongText",value:function(e){var t=this.getDocNodes(e);if(t)return t.long}},{key:"getDocNodeRef",value:function(e,t){var n=this.getGraphNodeAndDocNode(e);if(n&&n.doc_link_node)return n.doc_link_node[t].current}},{key:"getAllDocNodeRefs",value:function(e){var t=[],n=this.getGraphNodeAndDocNode(e);return n&&["long","short","section"].forEach((function(e){n.doc_link_node&&n.doc_link_node[e]&&t.push(n.doc_link_node[e].current)})),t}},{key:"registerLinkNode",value:function(e,t,n){void 0===this.map[e].doc_link_node&&(this.map[e].doc_link_node={}),this.map[e].doc_link_node[n]=t}},{key:"updateIsOnGraphStatus",value:function(e){var t=this.getDocNodeShortText(e);return!!t&&(!(t&&!this.getEditor().value.document.hasNode(t.key))||(this.removeDocNode(e),!1))}},{key:"updateDocShortText",value:function(e,t){var n=this.getDocNodeShortText(e);if(n){var o=this.getEditor();this.updateIsOnGraphStatus(e)&&(n.nodes.forEach((function(e){o.removeNodeByKey(e.key)})),o.insertNodeByKey(n.key,0,v.m.create({text:t})))}}},{key:"updateGraphShortText",value:function(e,t){var n=this.getGraphNode(e);n&&n.updateShortText(t)}},{key:"updateGraphLongText",value:function(e,t){var n=this.getGraphNode(e);n&&n.updateLongText(t)}}]),e}(),Ce=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={projects:[]},n.addProject=n.addProject.bind(Object(l.a)(n)),n.deleteProject=n.deleteProject.bind(Object(l.a)(n)),n.loadProject=n.loadProject.bind(Object(l.a)(n)),n.renameProject=n.renameProject.bind(Object(l.a)(n)),n.duplicateProject=n.duplicateProject.bind(Object(l.a)(n)),n.updateProjectsFromDb=n.updateProjectsFromDb.bind(Object(l.a)(n)),n.props.autoload&&n.loadProject(n.props.autoload),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.autoload||this.updateProjectsFromDb()}},{key:"updateProjectsFromDb",value:function(){var e=this;ke.table("projects").toArray((function(t){e.setState({projects:t})})).catch((function(e){g.b.error("Error when loading projects: "+e)}))}},{key:"loadProject",value:function(e){var t=new Ne(e,{condition:"graph"});this.props.transitionToEditor(t)}},{key:"addProject",value:function(){var e=this,t={name:window.prompt("Name your project","New project")};t.name&&ke.table("projects").add(t).then((function(){e.updateProjectsFromDb()}))}},{key:"renameProject",value:function(e){var t=this;ke.table("projects").get(e).then((function(n){var o=window.prompt("Set a new project name",n.name);o&&ke.table("projects").update(e,{name:o}).then((function(){t.updateProjectsFromDb()}))}))}},{key:"duplicateProject",value:function(e){var t=this;ke.table("projects").get(e).then((function(e){e.name+=" (copy)",delete e.id,ke.table("projects").add(e).then((function(){t.updateProjectsFromDb()}))}))}},{key:"deleteProject",value:function(e){var t=this;ke.table("projects").delete(e).then((function(){t.updateProjectsFromDb()}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"load-project"},r.a.createElement("button",{className:"pure-button pure-button-primary",onClick:this.addProject},"New project"),r.a.createElement("div",{className:"load-project-table"},this.state.projects&&this.state.projects.length>0&&r.a.createElement(xe,{projects:this.state.projects,deleteProject:this.deleteProject,loadProject:this.loadProject,renameProject:this.renameProject,duplicateProject:this.duplicateProject})))}}]),t}(o.Component),De=n(241),Te=n(110),Le=(n(235),n(236),function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"experiment-controls"},r.a.createElement("button",{onClick:this.props.backToMenu},"Back"),r.a.createElement("button",{onClick:this.props.sharedState.save},"Save"))}}]),t}(o.Component)),He=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(u.a)(t).call(this,e))).state={phase:"loadproject",params:void 0},n.transitionToEditor=n.transitionToEditor.bind(Object(l.a)(n)),n.transitionToMenu=n.transitionToMenu.bind(Object(l.a)(n)),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getStorageUsed()}},{key:"transitionToEditor",value:function(e){this.setState({sharedState:e,phase:"editor"})}},{key:"transitionToMenu",value:function(){this.state.sharedState&&this.state.sharedState.finishCondition(),this.setState({sharedState:void 0,phase:"loadproject"})}},{key:"getStorageUsed",value:function(){var e=this;navigator.storage.estimate().then((function(t){e.setState({storageUsed:(t.usage/t.quota*100).toPrecision(2)})}))}},{key:"render",value:function(){var e=this;switch(this.state.phase){case"loadproject":return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce,{transitionToEditor:this.transitionToEditor,autoload:39}),this.state.storageUsed&&r.a.createElement("footer",null,"Storage used: ",this.state.storageUsed,"%"));case"editor":return r.a.createElement("div",{className:"App"},r.a.createElement(De.a,{backend:Te.a},r.a.createElement(ye.a,{split:"vertical",defaultSize:"50%"},r.a.createElement(ae,{sharedState:this.state.sharedState}),r.a.createElement(me,{sharedState:this.state.sharedState})),r.a.createElement(Le,{sharedState:this.state.sharedState,backToMenu:this.transitionToMenu})),r.a.createElement(g.a,{position:"bottom-center",autoClose:5e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!1,pauseOnHover:!0}));case"reset":return window.setTimeout((function(){return e.setState({phase:"editor"})}),.1),r.a.createElement("p",null,"...")}}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(He,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[114,1,2]]]);
//# sourceMappingURL=main.0a9cd8a7.chunk.js.map