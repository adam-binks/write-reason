(this["webpackJsonpwrite-reason"]=this["webpackJsonpwrite-reason"]||[]).push([[0],{299:function(e,t,n){},324:function(e,t,n){e.exports=n.p+"static/media/CrimsonText-Regular.62f10d46.ttf"},325:function(e,t,n){e.exports=n.p+"static/media/CrimsonText-Bold.89b16aa6.ttf"},326:function(e,t,n){e.exports=n.p+"static/media/logo.510deb2b.png"},331:function(e,t,n){e.exports=n(636)},336:function(e,t,n){},337:function(e,t,n){},338:function(e,t,n){},445:function(e,t,n){},449:function(e,t,n){},455:function(e,t){},457:function(e,t){},499:function(e,t){},500:function(e,t){},624:function(e,t,n){var o={"./1.json":[637,3],"./10.json":[638,4],"./11.json":[639,5],"./12.json":[640,6],"./14.json":[641,7],"./15.json":[642,8],"./17.json":[643,9],"./18.json":[644,10],"./1old.json":[645,11],"./2.json":[646,12],"./21.json":[647,13],"./22.json":[648,14],"./23.json":[649,15],"./25.json":[650,16],"./26.json":[651,17],"./3.json":[652,18],"./4.json":[653,19],"./5.json":[654,20],"./6.json":[655,21],"./7.json":[656,22],"./8.json":[657,23]};function r(e){if(!n.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,3)}))}r.keys=function(){return Object.keys(o)},r.id=624,e.exports=r},636:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),a=n(47),i=n.n(a),s=(n(336),n(15)),c=n(17),d=n(20),l=n(19),u=n(24),h=n(21),p=(n(337),n(338),n(105)),g=n(12),f=function(){function e(t,n,o,r,a){var i=this,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;Object(s.a)(this,e),this.hidePopup=this.hidePopup.bind(this),this.div=document.createElement("div"),this.div.classList.add("option-popup-div"),this.div.appendChild(this.generateTable(t,a,c)),this.div.style.left=n+"px",this.div.style.top=o+"px",void 0===d&&(d=document.getElementById("graph")),d.appendChild(this.div);var l=this.div.getBoundingClientRect();l.right>window.innerWidth&&(this.div.style.left=n-(l.right-window.innerWidth)+"px"),l.bottom>window.innerHeight&&(this.div.style.top=o-(l.bottom-window.innerHeight)+"px"),r&&setTimeout((function(){return i.hideOnClickOutside(i.div)}),.01)}return Object(c.a)(e,[{key:"generateTable",value:function(e,t,n){var o=this,r=document.createElement("table");return e.forEach((function(e){e.isClickable=void 0===e.isClickable||e.isClickable;var a=r.insertRow();a.classList.add("option-row"),e.name===n&&a.classList.add("option-row-selected");var i=function(n){e.isClickable&&(t(e),o.hidePopup())},s=a.insertCell();s.textContent=e.symbol,s.style.color=e.colour,s.style.fontSize="150%",s.style.padding="10px";var c=a.insertCell();c.classList.add("option-cell"),c.textContent=e.name,s.addEventListener("click",i),c.addEventListener("click",i),e.buttons&&e.buttons.forEach((function(t){var r=a.insertCell(),i=document.createElement("BUTTON");i.innerHTML='<p class="'+t.className+'"></p>',i.className="pure-button",i.style.padding="0px 10px 0px 10px",r.appendChild(i),i.onclick=function(i){return t.click(i,{colourCell:s,nameCell:c,buttonCell:r,underlyingEntry:t.underlyingEntry,transientEntry:e,underlyingEntries:t.underlyingEntries,row:a,selected:e.name===n,hidePopup:o.hidePopup})}}))})),r}},{key:"hidePopup",value:function(){this.div.remove()}},{key:"hideOnClickOutside",value:function(e){var t=function(t){var o;!e.contains(t.target)&&((o=e)&&(o.offsetWidth||o.offsetHeight||o.getClientRects().length))&&(e.remove(),n())},n=function(){document.removeEventListener("click",t)};document.addEventListener("click",t),document.addEventListener("contextmenu",t)}}]),e}(),v=n(30);function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Heading and body";t.getSharedState().addGraphMapping(e.id,e.node),y(t,e.id,e.text,e.longText,n),t.getSharedState().logger.logEvent({type:"doc_create_from_node",node_id:e.id,short_text:e.text,long_text:e.longText})}function y(e,t,n,o,r){var a=1===e.value.document.nodes.size&&""===e.value.document.text,i=g.a.create({type:"link",data:{node_id:t},nodes:[g.m.create({text:n})]}),s=g.a.create({type:"body",data:{node_id:t},nodes:[g.m.create({text:o})]}),c=g.a.create({type:"section",data:{node_id:t,nodeStyle:r},nodes:[i,s]});return e.insertBlock(c),e.moveToEndOfNode(c),a&&e.removeNodeByKey(e.value.document.nodes.get(0).key),c}function b(e,t,n){var o=e.getSharedState().draggedNode;if(o){if(o.resetPos(),!e.getSharedState().getGraphNode(o.id)){var r=e.value.document;return e.focus(),"body"!==t.type&&"link"!==t.type||(t=r.getParent(t)),n?e.moveToEndOfNode(t):(e.moveToStartOfNode(t),e.moveBackward()),m(o,e),e.getSharedState().draggedNode=!1,!0}v.b.error("You can't add the same node twice!"),console.log("Duplicate - node")}}var k=function(e,t,n,o){var r=[{colour:"black",name:"Inline",symbol:"\u2336"},{colour:"black",name:"Heading and body",symbol:"\u25a4"},{colour:"black",name:"Heading only",symbol:"\u2594"},{colour:"black",name:"Body only",symbol:"\u2582"},{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}];o&&(r=r.filter((function(e){return!o.includes(e.name)}))),e.preventDefault();new f(r,e.clientX,e.clientY,!0,(function(e){var o=e.name;if("Delete"===o)n.getSharedState().logger.logEvent({type:"doc_node_delete",id:t.data.get("node_id")}),x(t,n);else{var r=t.data.get("nodeStyle");r||(r="Inline"),n.getSharedState().logger.logEvent({type:"doc_node_change_format",old:r,new:o,id:t.data.get("node_id")}),"Inline"!==r&&"Inline"!==o?n.setNodeByKey(t.key,{data:{node_id:t.data.get("node_id"),nodeStyle:o}}):"Inline"===r&&"Inline"!==o?function(e,t,n){t.moveToRangeOfNode(e);var o=t.value.document.getParent(e.key);o&&o.text===e.text&&t.moveToRangeOfNode(o);var r=t.getSharedState().getGraphNode(e.data.get("node_id")),a=r&&r.longText?r.longText:"";y(t,e.data.get("node_id"),e.text,a,n)}(t,n,o):"Inline"!==r&&"Inline"===o&&function(e,t){var n=e.getBlocksByType("link").get(0).text,o=t.value.document.getPreviousBlock(e.nodes.get(0).key),r=t.value.document.getNextBlock(e.nodes.get(1).key);o||r||t.insertNodeByKey(t.value.document.key,0,w());t.moveToRangeOfNode(e),o&&("section"===o.type||"body"===o.type)||!o&&r&&("section"===r.type||"link"===r.type)?(t.wrapBlockByKey(e.key,"paragraph"),t.removeNodeByKey(e.key)):t.removeNodeByKey(e.key);t.insertInline({type:"link",data:{node_id:e.data.get("node_id"),nodeStyle:"Inline"}}).insertText(n),setTimeout((function(){t.focus(),t.moveForward(),t.moveBackward()}),0)}(t,n)}}),t.data.get("nodeStyle"),document.querySelector(".App"))};function x(e,t){t.getSharedState().removeDocNode(e.data.get("node_id")),t.removeNodeByKey(e.key),0===t.value.document.nodes.size&&t.insertNodeByKey(t.value.document.key,0,w())}function w(){return g.a.create({type:"paragraph"})}var E=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("button",{className:"style-button pure-button "+("section"===this.props.nodeStyle?"style-button-section":"style-button-inline"),onClick:function(t){return k(t,e.props.node,e.props.editor)}},r.a.createElement("p",{className:"eye-icon"}))}}]),t}(o.Component),O=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={hover:!1,externalHover:!1},n.setHover=n.setHover.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){var t=this.props.sharedState.getGraphNode(this.props.nodeId);t&&t.setHoverer("link_mouse",e),this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e=this,t=this.props.editor.value,n=t.document,o=t.selection,a=n.getDescendantsAtRange(o).contains(this.props.node),i=this.props.sharedState.getGraphNode(this.props.nodeId);i&&i.setHoverer("link_cursor",a);var s="node-link"+(this.state.externalHover||a?" hovered":"");return"heading"===this.props.linkStyle?r.a.createElement("p",Object.assign({className:s},this.props.attributes),r.a.createElement("u",null,r.a.createElement("b",null,this.props.children))):"inline"===this.props.linkStyle?r.a.createElement("p",Object.assign({className:s},this.props.attributes,{onMouseEnter:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)}}),this.props.children,this.state.hover&&r.a.createElement(E,{node:this.props.node,editor:this.props.editor,nodeStyle:"inline"})):void 0}}]),t}(o.Component),_=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={hover:!1,externalHover:!1},n.setHover=n.setHover.bind(Object(u.a)(n)),n.selectNode=e.selectNode,n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e="node-body"+(this.state.externalHover||this.state.hover?" hovered":"")+(this.props.isEmpty?" placeholder":""),t=this.props.editor.value,n=t.document,o=t.selection,a=n.getDescendantsAtRange(o).contains(this.props.node),i=this.props.sharedState.getGraphNode(this.props.nodeId);return i&&(i.setHoverer("body_cursor",a),i.setHoverer("body_mouse",this.state.hover)),this.props.isEmpty?r.a.createElement("p",Object.assign({className:e},this.props.attributes,{onMouseDown:this.selectNode}),"Type some text...",this.props.children):r.a.createElement("p",Object.assign({className:e},this.props.attributes),this.props.children)}}]),t}(o.Component),S=n(662),N="block",j={canDrag:function(e){return e.editor.value.selection.isCollapsed},beginDrag:function(e){return{id:e.node.id,node:e.node}},endDrag:function(e,t,n){if(t.didDrop()){var o=t.getDropResult(),r=e.editor.getSharedState();if(o.droppedOnGraph){var a=r.addGraphNode("",o.position.x,o.position.y,!0),i={id:a.id,node:a,text:"",longText:e.node.text};e.editor.moveTo(e.node.key),m(i,e.editor,"Body only"),e.editor.removeNodeByKey(e.node.key),e.editor.blur()}else{var s=e.editor.value.document.getParent(e.node.key).nodes.indexOf(e.node),c=(o.insertBefore?1:0)-(o.indexDroppedOn>s?1:0);e.editor.moveNodeByKey(e.node.key,o.parentKey,o.indexDroppedOn+c),r.logger.logEvent({type:"reorder",id:e.node.data.get("node_id"),old_index:s,new_index:o.indexDroppedOn+c})}}}};var T=Object(S.a)(N,j,(function(e,t){return{connectDragSource:e.dragSource(),dragPreview:e.dragPreview(),isDragging:t.isDragging()}})),C=n(663);function D(e,t){var n,o=i.a.findDOMNode(e),r=o.getBoundingClientRect(),a=!0,s=!1,c=void 0;try{for(var d,l=o.children[Symbol.iterator]();!(a=(d=l.next()).done);a=!0){var u=d.value;if(u.classList.contains("plain-block")||u.classList.contains("section")){n=u;break}}}catch(f){s=!0,c=f}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}if(n){var h=n.getBoundingClientRect(),p=h.y-r.y,g=!1;t.clientY+p>h.y+h.height/2&&(g=!0),e.state.overHalf!==g&&e.setState({overHalf:g})}else console.log("error: couldn't find the inner div!")}var L={hover:function(e,t,n){D(n,{clientY:t.getClientOffset().y})},drop:function(e,t,n){var o=e.editor.value.document.getParent(e.node.key),r=o.nodes.indexOf(e.node);return{droppedOnGraph:!1,parentKey:o.key,indexDroppedOn:r,insertBefore:n.state.overHalf}}};var H=Object(C.a)(N,L,(function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})),B=T(H(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={hover:!1,externalHover:!1,overHalf:!1},n.setHover=n.setHover.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){var t=this.props.sharedState.getGraphNode(this.props.nodeId);t&&t.setHoverer("section_mouse",e),this.setState({hover:e})}},{key:"setExternalHover",value:function(e){this.setState({externalHover:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.isOverCurrent,o=t.connectDropTarget,a=t.connectDragSource,i=t.isDragging,s=this.props.editor.value,c=s.blocks&&s.blocks.some((function(t){return t===e.props.node||e.props.node.nodes.includes(t)})),d="section plain-block "+(this.state.externalHover||c?" hovered":"")+(i?" display-none":"");d+=function(e){switch(e){case"Heading only":return" hide-body";case"Body only":return" hide-heading";default:return""}}(this.props.node.data.get("nodeStyle"));var l=n||this.state.hover&&this.props.editor.getSharedState().draggedNode;return o(r.a.createElement("div",{className:"block-outer-div",onMouseEnter:function(){return e.setHover(!0)},onMouseOver:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},onMouseUp:function(){b(e.props.editor,e.props.node,e.state.overHalf)&&e.setState({hover:!1})},onMouseMove:function(t){return D(e,t)}},l&&!this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),r.a.createElement("div",Object.assign({className:d},this.props.attributes,{ref:a}),this.state.hover&&r.a.createElement(E,{node:this.props.node,editor:this.props.editor,nodeStyle:"section"}),this.props.children),l&&this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"})))}}]),t}(o.Component)));function I(e){return{onCopy:function(e,t,n){t.getSharedState().logger.logEvent({type:"copy",content:t.value.fragment.text}),n()},onCut:function(e,t,n){t.getSharedState().logger.logEvent({type:"cut",content:t.value.fragment.text}),n()},onPaste:function(e,t,n){var o=Object(p.b)(e);t.getSharedState().logger.logEvent({type:"paste",paste_type:o.type,content:o.fragment?o.fragment.text:"",content_html:o.fragment?"":o.html}),n()}}}var P=T(H(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={hover:!1},n.setHover=n.setHover.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"setHover",value:function(e){this.setState({hover:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.isOverCurrent,o=t.connectDropTarget,a=t.connectDragSource,i="plain-block "+(t.isDragging?" display-none":""),s=n||this.state.hover&&this.props.editor.getSharedState().draggedNode;return o(r.a.createElement("div",{className:"block-outer-div",onMouseUp:function(){b(e.props.editor,e.props.node,e.state.overHalf)&&e.setState({hover:!1})},onMouseEnter:function(){return e.setHover(!0)},onMouseOver:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},onMouseMove:function(t){return D(e,t)}},s&&!this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"}),r.a.createElement("div",Object.assign({className:i},this.props.attributes,{ref:a}),this.props.children),s&&this.state.overHalf&&r.a.createElement("div",{className:"drop-indicator"})))}}]),t}(o.Component)));var A=n(55),R=n(40),M=n(92);function G(){var e=Object(A.a)(["\n        position: relative;\n        padding: 1px 18px 17px;\n        margin: 0 -20px;\n        border-bottom: 2px solid #eee;\n        margin-bottom: 20px;\n      "]);return G=function(){return e},e}function J(){var e=Object(A.a)(["\n        & > * {\n          display: inline-block;\n        }\n\n        & > * + * {\n          margin-left: 15px;\n        }\n      "]);return J=function(){return e},e}function F(){var e=Object(A.a)(["\n        white-space: pre-wrap;\n        margin: 0 -20px 10px;\n        padding: 10px 20px;\n        font-size: 14px;\n        background: #f8f8e8;\n      "]);return F=function(){return e},e}function W(){var e=Object(A.a)(["\n        font-size: 18px;\n        vertical-align: text-bottom;\n      "]);return W=function(){return e},e}function K(){var e=Object(A.a)(["\n            color: #404040;\n            font: 12px monospace;\n            white-space: pre-wrap;\n            padding: 10px 20px;\n            div {\n              margin: 0 0 0.5em;\n            }\n          "]);return K=function(){return e},e}function q(){var e=Object(A.a)(["\n            font-size: 14px;\n            padding: 5px 20px;\n            color: #404040;\n            border-top: 2px solid #eeeeee;\n            background: #f8f8f8;\n          "]);return q=function(){return e},e}function z(){var e=Object(A.a)(["\n            margin: 30px -20px 0;\n          "]);return z=function(){return e},e}function U(){var e=Object(A.a)(["\n          cursor: pointer;\n          color: ",";\n        "]);return U=function(){return e},e}var Y=r.a.forwardRef((function(e,t){var n=e.className,o=e.active,a=e.reversed,i=Object(M.a)(e,["className","active","reversed"]);return r.a.createElement("span",Object.assign({},i,{ref:t,className:Object(R.b)(n,Object(R.a)(U(),a?o?"white":"#aaa":o?"black":"#ccc"))}))})),V=(r.a.forwardRef((function(e,t){var n=e.className,o=e.value,a=Object(M.a)(e,["className","value"]),i=o.document.nodes.map((function(e){return e.text})).toArray().join("\n");return r.a.createElement("div",Object.assign({ref:t},a,{className:Object(R.b)(n,Object(R.a)(z()))}),r.a.createElement("div",{className:Object(R.a)(q())},"Slate's value as text"),r.a.createElement("div",{className:Object(R.a)(K())},i))})),r.a.forwardRef((function(e,t){var n=e.className,o=Object(M.a)(e,["className"]);return r.a.createElement("span",Object.assign({},o,{ref:t,className:Object(R.b)("material-icons",n,Object(R.a)(W()))}))}))),X=(r.a.forwardRef((function(e,t){var n=e.className,o=Object(M.a)(e,["className"]);return r.a.createElement("div",Object.assign({},o,{ref:t,className:Object(R.b)(n,Object(R.a)(F()))}))})),r.a.forwardRef((function(e,t){var n=e.className,o=Object(M.a)(e,["className"]);return r.a.createElement("div",Object.assign({},o,{ref:t,className:Object(R.b)(n,Object(R.a)(J()))}))})));r.a.forwardRef((function(e,t){var n=e.className,o=Object(M.a)(e,["className"]);return r.a.createElement(X,Object.assign({},o,{ref:t,className:Object(R.b)(n,Object(R.a)(G()))}))}));function Q(){var e=Object(A.a)(["\n        padding: 8px 7px 6px;\n        position: absolute;\n        z-index: 1;\n        top: -10000px;\n        left: -10000px;\n        margin-top: -6px;\n        opacity: 0;\n        background-color: #222;\n        border-radius: 4px;\n        transition: opacity 0.25s;\n      "]);return Q=function(){return e},e}var $=function(e){var t=e.editor,n=e.type,o=e.icon,a=t.value,i=a.blocks&&a.blocks.some((function(e){return e.type===n}));return r.a.createElement(Y,{reversed:!0,active:i,onMouseDown:function(e){e.preventDefault(),t.setBlocks(i?"paragraph":n),t.getSharedState().logger.logEvent({type:"set_title"+(i?"_disabled":"_enabled")})}},r.a.createElement(V,null,o))},Z=r.a.forwardRef((function(e,t){var n=e.editor,o=window.document.getElementById("root");return i.a.createPortal(r.a.createElement(X,{ref:t,className:Object(R.a)(Q())},r.a.createElement($,{editor:n,type:"heading",icon:"Heading"})),o)})),ee=function(e){function t(){var e,n;Object(s.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).menuRef=r.a.createRef(),n.componentDidMount=function(){n.updateMenu()},n.componentDidUpdate=function(){n.updateMenu()},n.updateMenu=function(){var e=n.menuRef.current;if(e){var t=n.props.editor.value,o=t.fragment,r=t.selection;if(r.isBlurred||r.isCollapsed||""===o.text)e.removeAttribute("style");else{var a=window.getSelection().getRangeAt(0).getBoundingClientRect();e.style.opacity=1,e.style.top="".concat(a.top+window.pageYOffset-e.offsetHeight,"px"),e.style.left="".concat(a.left+window.pageXOffset-e.offsetWidth/2+a.width/2,"px")}}},n.render=function(e,t,o){return r.a.createElement(Z,{ref:n.menuRef,editor:n.props.editor})},n}return Object(h.a)(t,e),t}(r.a.Component);var te={inlines:{link:{parent:[{type:""},{type:"paragraph"}],normalize:function(e,t){switch(t.code){case"parent_type_invalid":return void e.unwrapInlineByKey(t.node.key);default:console.log("unhandled link inline err "+t)}}}},blocks:{section:{parent:{object:"document"},nodes:[{match:{type:"link"},min:1,max:1},{match:{type:"body"},min:1,max:1}],normalize:function(e,t){switch(t.code){case"child_max_invalid":return ne(e,t.child,t.node),void e.setNodeByKey(t.child.key,"paragraph");case"child_type_invalid":if("text"===t.child.object||"paragraph"===t.child.type){var n=t.node.nodes.find((function(e){return"link"===e.type}));if(n){var o=n.getLastText(),r=o.text?o.text.length:0;e.insertTextByKey(o.key,r,t.child.text)}else oe(e,t,"link",t.child.text)}return void e.removeNodeByKey(t.child.key);case"child_min_invalid":var a=[];return t.node.nodes.forEach((function(e){a.push(e.type)})),a.includes("link")||oe(e,t,"link"),void(a.includes("body")||oe(e,t,"body"));case"parent_object_invalid":return void ne(e,t.node,t.parent);default:return void console.log("unhandled section schema err "+t)}}}}};function ne(e,t,n){var o=e.value.document.nodes.indexOf(n);-1!==o&&e.moveNodeByKey(t.key,e.value.document.key,o+1)}function oe(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=t.node.data.get("node_id"),a=e.getSharedState().getGraphNode(r);o||(o="link"===n?a.getShortText():a.getLongText());var i="link"===n?0:1;!function(e,t,n,o,r,a){var i=g.a.create({type:n,data:{node_id:r},nodes:[g.m.create({text:a})]});e.insertNodeByKey(t.key,o,i)}(e,t.node,n,i,r,o)}var re,ae={graph:[I(),{onMouseUp:function(e,t,n){var o=t.getSharedState().draggedNode;if(o)if(o.resetPos(),t.getSharedState().getGraphNode(o.id))v.b.error("You can't add the same node twice!"),console.log("Duplicate - editor");else{var r=t.findEventRange(e);if(r){t.select(r);var a=t.value.inlines.find((function(e){return"link"===e.type}));a&&t.moveToEndOfNode(a),m(o,t)}}n()},onBlur:function(e,t,n){t.deselect(),n()},commands:{removeGraphLink:function(e,t){var n=e.value.document;if(n.hasNode(t.key))if("section"===t.type){var o=e.value.document.nodes.indexOf(t);if(-1!==o){var r=0;t.nodes.forEach((function(a){if(n.hasNode(a.key)){var i=t.data.get("nodeStyle");if(0===r&&"Body only"===i||1===r&&"Heading only"===i)e.removeNodeByKey(a.key);else{var s=1===r&&"Body only"===i?1:r+1;e.moveNodeByKey(a.key,e.value.document.key,o+s)}r++}}))}e.removeNodeByKey(t.key)}else(e.value.document.getChild(t.key)||"inline"===t.object)&&e.setNodeByKey(t.key,{type:""});else console.log("couldnt remove graph link, node doesnt exist")}}},function(e){return{commands:{wrapLinkAtSelection:function(e,t){return e.wrapInline({type:"link",data:{node_id:t,nodeStyle:"Inline"}})}},renderInline:function(e,n,o){if("link"===e.node.type){var a=t(e,n,"short"),i=a.ref,s=a.id;return r.a.createElement(O,Object.assign({ref:i},e,{linkStyle:"inline",sharedState:n.getSharedState(),nodeId:s}))}return o()},renderBlock:function(e,n,o){var a;if("body"===e.node.type){a=t(e,n,"long");var i=!e.node.text;return r.a.createElement(_,Object.assign({ref:a.ref},e,{sharedState:n.getSharedState(),nodeId:a.id,isEmpty:i,selectNode:function(){setTimeout((function(){n.focus(),n.moveToStartOfNode(e.node)}),0)}}))}return"link"===e.node.type?(a=t(e,n,"short"),r.a.createElement(O,Object.assign({ref:a.ref},e,{linkStyle:"heading",sharedState:n.getSharedState(),nodeId:a.id}))):"section"===e.node.type?(a=t(e,n,"section"),r.a.createElement(B,Object.assign({ref:a.ref},e,{sharedState:n.getSharedState(),nodeId:a.id}))):o()},onDrop:function(e,t,n){},onPaste:function(e,t,n){var o=function(e){return e.filterDescendants((function(e){return"link"===e.type&&"inline"===e.object}))},r=Object(p.b)(e);if("fragment"===r.type){if(t.value.blocks.some((function(e){return"link"===e.type||"body"===e.type}))){var a=r.fragment.text.replace(/(\r\n|\n|\r)/gm,"");return void t.insertText(a)}var i=o(r.fragment);if(i){var s=o(t.value.document),c=[];s.forEach((function(e){c.push({key:e.key,id:e.data.get("node_id")})})),n(),i.forEach((function(e){c.forEach((function(n){var o=e.data.get("node_id");n.id===o&&t.value.document.filterDescendants((function(e){return"link"===e.type&&"inline"===e.object&&e.data.get("node_id")===o})).forEach((function(e){e.key!==n.key&&t.unwrapInlineByKey(e.key)}))}))}))}}else n()},onChange:function(e,t){var n=e.getSharedState();[{nodeType:"link",updateFunc:n.updateGraphShortText.bind(n)},{nodeType:"body",updateFunc:n.updateGraphLongText.bind(n)}].forEach((function(t){return e.value.blocks.forEach((function(o){var r=function(o){var r=o.data.get("node_id");n.checkRecycleBinForGraphNode(r),"inline"!==o.object||""!==o.text&&n.getGraphNode(r)?t.updateFunc(o.data.get("node_id"),o.text):x(o,e)};o.filterDescendants((function(e){return e.type===t.nodeType})).forEach(r),o.type===t.nodeType&&r(o)}))})),t()},onKeyDown:function(e,t,n){var o=t.value,r=o.document,a=o.selection,i=o.startBlock,s=a.start,c=a.end;if("Backspace"!==e.key&&"Delete"!==e.key||!a.isExpanded||r.getDescendantsAtRange(a).forEach((function(e){"section"!==e.type&&"link"!==e.type||setTimeout((function(){t.getSharedState().updateIsOnGraphStatus(e.data.get("node_id"))}),0)})),"Delete"===e.key&&i&&o.selection.isCollapsed&&o.selection.end.isAtEndOfNode(i)){var d=r.getNextBlock(s.key);if(d&&("body"===d.type||"link"===d.type||"section"===d.type))return t.moveToStartOfNode(d),void(""===i.text&&t.removeNodeByKey(i.key))}if("Backspace"===e.key){var l=r.getPreviousBlock(s.key);if(i&&a.isCollapsed&&0===s.offset&&l&&("body"===i.type||"link"===i.type))return l&&(t.moveToEndOfNode(l),""===i.text?t.removeNodeByKey(i.key):""===l.text&&t.removeNodeByKey(l.key)),t}if("Enter"===e.key){if(o.inlines.some((function(e){return"link"===e.type})))return;if(i&&"link"===i.type&&s.key===c.key){if(0===s.offset){var u=g.a.create({object:"block",type:""}),h=r.getParent(i.key),p=r.getParent(h.key),f=p.nodes.indexOf(h);return t.insertNodeByKey(p.key,f,u),t.moveBackward(1)}var v=r.getNextBlock(s.key);return v?t.moveToStartOfNode(v):t.moveToEndOfNode(i)}}if("ArrowDown"===e.key||"ArrowUp"===e.key){var m="ArrowDown"===e.key?r.getNextBlock(s.key):r.getPreviousBlock(s.key);if(m&&"body"===m.type&&s.offset<"Type some text... ".length&&("ArrowUp"===e.key||i.text.length<130))return t.moveToEndOfNode(m),void e.preventDefault()}return"Tab"===e.key&&e.preventDefault(),n()}};function t(e,t,n){var o=e.node.data.get("node_id");t.getSharedState().setLinkMapping(o,e.node,n);var a=r.a.createRef();return t.getSharedState().registerLinkNode(o,a,n),{ref:a,id:o}}}(),{renderBlock:function(e,t,n){return e.node.type&&""!==e.node.type&&"paragraph"!==e.node.type?n():r.a.createElement(P,e)}},{renderEditor:function(e,t,n){var o=function(e){if(!e)return 0;var t=0;return e.getBlocks().forEach((function(n){if("link"===n.type||"body"===n.type){var o=e.getParent(n.key);if(o&&"section"===o.type&&("Heading only"===o.data.get("nodeStyle")&&"body"===n.type||"Body only"===o.data.get("nodeStyle")&&"link"===n.type))return}var r=n.text.match(/\S+/g);r&&(t+=r.length)})),t.toString()}(e.editor.value.document),a=n();return r.a.createElement(r.a.Fragment,null,a,r.a.createElement("span",{className:"word-count"},o+" words"))}}],plain:[I(),{renderEditor:function(e,t,n){var o=n();return r.a.createElement(r.a.Fragment,null,o,r.a.createElement(ee,{editor:t}))},renderBlock:function(e,t,n){switch(e.node.type){case"heading":return r.a.createElement("u",null,r.a.createElement("b",null,e.children));default:return n()}}}]},ie=g.n.fromJSON({document:{nodes:[{object:"block",type:"paragraph",nodes:[{object:"text",text:""}]}]}}),se=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={value:void 0,mapHasLoaded:!1},n.queries={getSharedState:function(){return n.props.sharedState},getValue:function(){return n.state.value},mapHasLoaded:function(){n.setState({mapHasLoaded:!0})}},n.onChange=function(e){var t=e.value;n.setState({value:t})},n.props.sharedState.editor_ref=r.a.createRef(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.sharedState;t.getSavedDocValue((function(n){e.setState({value:n?g.n.fromJSON(n):ie},t.editorHasLoaded)}))}},{key:"render",value:function(){var e="plain"===this.props.sharedState.condition?" slate-editor-no-graph":"";return void 0!==this.state.value?r.a.createElement(p.a,{className:"slate-editor"+e,key:this.state.mapHasLoaded?"map-loading":"map-loaded",ref:this.props.sharedState.editor_ref,schema:te,plugins:ae[this.props.sharedState.condition],queries:this.queries,value:this.state.value,onChange:this.onChange,placeholder:"Write your document here...",spellCheck:!0}):r.a.createElement("p",null)}}]),t}(r.a.Component),ce=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"pane doc"},r.a.createElement(se,{sharedState:this.props.sharedState}))}}]),t}(o.Component),de=(n(445),n(77)),le=n.n(de),ue=(n(446),n(447),"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e});!function e(t,n,o){function r(i,s){if(!n[i]){if(!t[i]){if(!s&&("function"==typeof re&&re))return re(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[i]={exports:{}};t[i][0].call(d.exports,(function(e){var n=t[i][1][e];return r(n||e)}),d,d.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof re&&re,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){var o=e("idy"),r=e("set-or-get"),a=e("iterate-object"),i=e("deffy"),s={},c={},d=null,l=null;function u(e,t){var n={};void 0===t&&(t=e,e={}),d=e.container||d;l=e.markers||l,e.k=e.k||100,e.kk=e.kk||10;var u=l.marker(10,10).addClass("connector-marker"),h="triangle-"+o(),p=d.path().attr("marker-end","url(#"+h+")").fill("none").stroke({width:3});return e.specialCoords&&p.addClass("connector-line"),u.attr({id:h,viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"4",markerHeight:"5"}),u.path().attr({d:"M 0 0 L 10 5 L 0 10 z"}),n.source=this,n.target=t,n.line=p,n.marker=u,e.specialCoords,r(s,n.source.id(),[]).push(n),r(s,n.target.id(),[]).push(n),r(c,{toString:function(){var e=[n.source.id(),n.target.id()],t=e.join("->"),o=e.reverse().join("->");return n._=n.id=t,c[o]?(n._=o,o):(n.id=t,t)}},[]).push(n),n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a=t.source.transform(),i=t.target.transform(),s=t.source.bbox(),c=t.target.bbox(),d=a.x+s.width/2,l=a.y+s.height/2,u=i.x+c.width/2,h=i.y+c.height/2,p=(d+u)/2,g=(l+h)/2,f=Math.abs((d-u)/2),v=Math.abs((l-h)/2),m=null,y={x1:d,y1:l,x2:u,y2:h,ex:d,ey:l};r!==(o-1)/2&&(m=Math.sqrt(f*f+v*v),y.ex=p+v/m*e.k*(r-(o-1)/2),y.ey=g-f/m*e.k*(r-(o-1)/2)),n.push(y)})),n},e.specialCoords&&(n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a,i,s=t.source.transform(),c=t.target.transform(),d=t.source.bbox(),l=t.target.bbox(),u=s.x+d.width/2,h=s.y+d.height/2-20,p=s.x-c.x,g=s.y-c.y,f=c.x+l.width/2,v=(c.y+l.height/2-h)/(f-u===0?1e-7:f-u);0===v&&(v=1e-7);var m,y=c.x-10,b=c.x+l.width-30,k=c.y-10,x=c.y+l.height-30,w=function(){var e=p<0?y:b;return{x:e,y:(e-u)*v+h}},E=function(){var e=g<0?k:x;return{x:1/v*(e-h)+u,y:e}};Math.abs(p)>=Math.abs(g)?(a=(m=w()).x,((i=m.y)>x||i<k)&&(a=(m=E()).x,i=m.y)):(a=(m=E()).x,i=m.y,(a>b||a<y)&&(a=(m=w()).x,i=m.y));var O=(u+a)/2,_=(h+i)/2,S=Math.abs((u-a)/2),N=Math.abs((h-i)/2),j=null,T={x1:u,y1:h,x2:a,y2:i,ex:u,ey:h};r!==(o-1)/2&&(j=Math.sqrt(S*S+N*N),T.ex=O+N/j*e.k*(r-(o-1)/2),T.ey=_-S/j*e.k*(r-(o-1)/2)),n.push(T)})),n}),e.padEllipse&&(n.computeLineCoordinates=function(t){var n=[],o=t.length;return a(t,(function(t,r){var a,i,s,c,d=t.source.node.querySelector("ellipse")||t.source.node.querySelector("circle"),l=t.target.node.querySelector("ellipse")||t.target.node.querySelector("circle"),u=t.source.transform(),h=t.target.transform();"circle"===d.tagName?(a=s=parseFloat(d.getAttribute("r")),i=c=parseFloat(l.getAttribute("r"))):(a=parseFloat(d.getAttribute("rx")),s=parseFloat(d.getAttribute("ry")),i=parseFloat(l.getAttribute("rx")),c=parseFloat(l.getAttribute("ry")));var p=u.x+a/2,g=u.y+s/2,f=h.x+i/2-p,v=h.y+c/2-g,m=Math.sqrt(f*f+v*v),y=f/m,b=v/m,k=p+a*y+a/2,x=g+s*b+s/2,w=p+(m-i-5)*y+i/2,E=g+(m-c-5)*b+c/2,O=(k+w)/2,_=(x+E)/2,S=null,N={x1:k,y1:x,x2:w,y2:E,ex:k,ey:x};isNaN(N.x1)?(N.x1=u.x+2*a,N.y1=u.y+s/2,N.x2=u.x,N.y2=N.y1,N.ex=(N.x1+N.x2)/2,N.ey=N.y1-e.kk*(r+1)):(f=Math.abs((k-w)/2),v=Math.abs((x-E)/2),r!==(o-1)/2&&(S=Math.sqrt(f*f+v*v),N.ex=O+v/S*e.k*(r-(o-1)/2),N.ey=_-f/S*e.k*(r-(o-1)/2))),n.push(N)})),n}),this.cons=this.cons||[],this.cons.push(n),n.update=function(){var e=i(c[n._],[]),t=n.computeLineCoordinates(e);a(t,(function(t,n){e[n].line.plot("M"+t.x1+" "+t.y1+" Q"+t.ex+" "+t.ey+" "+t.x2+" "+t.y2)}))},n.update(),this.on("dragmove",n.update),t.on("dragmove",n.update),n.setLineColor=function(e,t){(t=t||this).line.stroke(e),t.marker.fill(e)},n}if("function"===typeof le.a)le.a.extend(le.a.Element,{connectable:u,delete_connectable:function(e){e.line.remove(),e.marker.remove(),s[e.source.id()]=s[e.source.id()].filter((function(t){return t!==e})),s[e.target.id()]=s[e.target.id()].filter((function(t){return t!==e}));var t=function(){var t=[e.source.id(),e.target.id()],n=t.join("->"),o=t.reverse().join("->");return e._=e.id=n,c[o]?(e._=o,o):(e.id=n,n)};c[t()]=c[t()].filter((function(t){return t!==e})),e.source.node.dispatchEvent(new CustomEvent("dragmove"))}});else if("object"===("undefined"===typeof window?"undefined":ue(window)))throw new Error("SVG.js is not loaded but it is required.");t.exports=u},{deffy:2,idy:4,"iterate-object":5,"set-or-get":6}],2:[function(e,t,n){var o=e("typpy");t.exports=function(e,t,n){return"function"===typeof t?t(e):(n="boolean"===o(n)?{empty:n}:{empty:!1}).empty?e||t:o(e)===o(t)?e:t}},{typpy:3}],3:[function(e,t,n){function o(e,t){return 2===arguments.length?o.is(e,t):o.get(e,!0)}o.is=function(e,t){return o.get(e,"string"===typeof t)===t},o.get=function(e,t){return"string"===typeof e?t?"string":String:null===e?t?"null":null:void 0===e?t?"undefined":void 0:e!==e?t?"nan":NaN:t?e.constructor.name.toLowerCase():e.constructor},t.exports=o},{}],4:[function(e,t,n){t.exports=function(e){return e=e||10,Math.random().toString(35).substr(2,e)}},{}],5:[function(e,t,n){t.exports=function(e,t){var n=0,o=[];if(Array.isArray(e))for(;n<e.length&&!1!==t(e[n],n,e);++n);else for(o=Object.keys(e);n<o.length&&!1!==t(e[o[n]],o[n],e);++n);}},{}],6:[function(e,t,n){var o=e("deffy");t.exports=function(e,t,n){return e[t]=o(e[t],n)}},{deffy:7}],7:[function(e,t,n){arguments[4][2][0].apply(n,arguments)},{dup:2,typpy:8}],8:[function(e,t,n){arguments[4][3][0].apply(n,arguments)},{dup:3}]},{},[1]);var he=n(329),pe=n(102);function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var fe=["red","goldenrod","green","aqua","blue","fuchsia","purple","saddlebrown"],ve=[{colour:"green",name:"Supports",symbol:"\u2192"},{colour:"red",name:"Opposes",symbol:"\u2192"},{colour:"blue",name:"Expands",symbol:"\u2192"}],me=function(){function e(t,n,o,r,a){var i=this;Object(s.a)(this,e),this.shared_state=t,this.drawing_arrow_from=!1,this.connector=void 0,this.connectables_container=o,this.markers=r,this.links=a,this.connector_objs={},this.temp_arrows={},this.arrow_id_counter=0,this.completed_arrows=[],this.mouse_rect=n.group(),window.addEventListener("mousemove",(function(e){var t=n.point(e.clientX,e.clientY);i.mouse_rect.move(t.x,t.y),"undefined"!==typeof i.connector&&i.connector.update()})),window.addEventListener("mouseup",(function(e){i.drawing_arrow_from&&(e.preventDefault(),i.stop_drawing_arrow())}))}return Object(c.a)(e,[{key:"toJSON",value:function(){return{arrows:this.completed_arrows,arrow_id_counter:this.arrow_id_counter,arrowOptions:this.arrowOptions}}},{key:"draw_loaded_arrows",value:function(e){var t=this;this.completed_arrows.forEach((function(n){var o=e(n.origin),r=e(n.destination);if(o)if(r){var a=t.draw_arrow(o,r,n.colour);t.add_context_menu_to_arrow(a,n),t.connector_objs[n.origin+"->"+n.destination]=a,o.group.node.dispatchEvent(new CustomEvent("dragmove"))}else v.b.error("Error: could not draw arrow to destination "+n.destination);else v.b.error("Error: could not draw arrow from origin "+n.origin)}))}},{key:"update_source",value:function(e){"undefined"===typeof this.connector?this.connector=e.connectable({container:this.connectables_container,markers:this.markers},this.mouse_rect):(this.connector.marker.show(),this.connector.line.show(),this.connector.target=this.mouse_rect,this.connector.source=e,this.connector.update()),this.connector&&this.connector.setLineColor("#d4b8b0")}},{key:"hide",value:function(){"undefined"!==typeof this.connector&&(this.connector.target=this.connector.source,this.connector.marker.hide(),this.connector.line.hide())}},{key:"start_arrow",value:function(e){this.drawing_arrow_from=e,this.connector&&this.connector.setLineColor("#719deb")}},{key:"draw_arrow",value:function(e,t,n){var o=this,r=e.group.connectable({container:this.links,markers:this.markers,specialCoords:!0},t.group);return r.setLineColor(n),r.source.on("deletenode",(function(){r.source.node.instance.delete_connectable(r),o.remove_arrow(r)})),r.target.on("deletenode",(function(){r.target.node.instance.delete_connectable(r),o.remove_arrow(r)})),r}},{key:"add_context_menu_to_arrow",value:function(e,t){var n=this,o=function(o){var r=document.getElementById("graph").getBoundingClientRect();n.edit_connector_type(e,o.clientX-r.left,o.clientY-r.top,!0,(function(e){t.colour=e}),t),o.preventDefault()};e.line.on("click",o),e.line.on("contextmenu",o),e.source.on("deletenode",(function(){e.source.node.instance.delete_connectable(e),n.remove_arrow(e,t)})),e.target.on("deletenode",(function(){e.target.node.instance.delete_connectable(e),n.remove_arrow(e,t)})),window.addEventListener("colourchange",(function(n){n.detail.oldColour===t.colour&&(e.setLineColor(n.detail.newColour),t.colour=n.detail.newColour)})),window.addEventListener("arrowdelete",(function(o){o.detail.colour===t.colour&&n.remove_arrow(e,t)}))}},{key:"complete_arrow",value:function(e){var t=this;if(e!==this.drawing_arrow_from){var n=this.draw_arrow(this.drawing_arrow_from,e,"#5D4037"),o=this.drawing_arrow_from.group.getScreenCoords("centre"),r=e.group.getScreenCoords("centre"),a={x:(o.x+r.x)/2,y:(o.y+r.y)/2},i=this.drawing_arrow_from.id;this.edit_connector_type(n,a.x,a.y,!1,(function(o){var r={id:t.getNewId(),origin:i,destination:e.id,colour:o};t.completed_arrows.push(r),t.add_context_menu_to_arrow(n,r)})),this.shared_state.logger.logEvent({type:"arrow_create",id:n.id,source:this.drawing_arrow_from.id,target:e.id}),this.stop_drawing_arrow()}else this.stop_drawing_arrow()}},{key:"getArrowByID",value:function(e){return this.completed_arrows.find((function(t){return t.id===e}))}},{key:"getConnectorObjectConnecting",value:function(e,t){return this.connector_objs[e+"->"+t]}},{key:"addTempArrow",value:function(e,t,n,o){var r=this.shared_state.graphPane.getNodeById(e),a=this.shared_state.graphPane.getNodeById(t);r&&a&&(this.connector_objs[e+"->"+t]=this.draw_arrow(r,a,n),this.temp_arrows[o]=e+"->"+t)}},{key:"getNewId",value:function(){return this.arrow_id_counter++,this.arrow_id_counter}},{key:"changeArrowColour",value:function(e,t){var n=e.colour,o=this.getNextAvailableColour(e,t);if(o)return e.colour=o,window.dispatchEvent(new CustomEvent("colourchange",{detail:{oldColour:n,newColour:o}})),this.shared_state.logger.logEvent({type:"update_arrow_colour",newColour:o}),o}},{key:"getNextAvailableColour",value:function(e,t){var n=this,o=fe.filter((function(t){return!n.arrowOptions.find((function(n){return n.colour===t&&n!==e}))}));if(o){var r=e?o.indexOf(e.colour):0;if(-1!==r){var a=(r+1*t)%o.length;return a<0&&(a=o.length-1),o[a]}}}},{key:"getArrowOptions",value:function(){var e=this,t=function t(n,o){var r=o.colourCell,a=o.nameCell,i=o.buttonCell,s=o.underlyingEntry,c=o.transientEntry;c.isClickable=!1;var d=i.children[0],l=function(){var e=h.value;return e.length>=50&&(e=e.substring(0,50)),e&&(s.name=e),e},u=function(){var e=l();e&&(a.textContent=e),c.isClickable=!0,r.textContent=p.textContent,r.style.color=p.style.color,d.classList.remove("pure-button-active"),d.onclick=function(e){return t(e,o)}};d.classList.add("pure-button-active"),d.onclick=u;var h=document.createElement("input");h.style.width=(a.getBoundingClientRect().width-5).toString()+"px",h.value=a.textContent,h.addEventListener("keyup",(function(e){"Enter"===e.key&&h.value&&u()})),h.addEventListener("change",l),a.textContent="",a.appendChild(h);var p=document.createElement("button");p.className="pure-button",p.textContent=r.textContent,r.textContent="",r.appendChild(p),p.style.color=r.style.color,p.style.padding=0,p.addEventListener("click",(function(){p.style.color=e.changeArrowColour(s,1),c.colour=s.colour})),p.addEventListener("contextmenu",(function(t){p.style.color=e.changeArrowColour(s,-1),c.colour=s.colour,t.preventDefault()})),h.focus()},n=function(t,n){var o=n.row,r=n.underlyingEntries,a=n.underlyingEntry,i=n.transientEntry,s=n.selected,c=n.hidePopup;if(i.isClickable=!1,window.confirm('Are you sure you want to delete all "'+a.name+'" arrows? This cannot be undone.')){var d=r.indexOf(a);-1!==d&&r.splice(d,1),setTimeout((function(){return o.parentNode.removeChild(o)}),0),window.dispatchEvent(new CustomEvent("arrowdelete",{detail:{colour:a.colour}})),e.shared_state.logger.logEvent({type:"delete_arrow_type",colour:a.colour}),s&&c()}i.isClickable=!0},o=this.arrowOptions.map((function(o){var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(n,!0).forEach((function(t){Object(pe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o);return r.buttons=[{className:"edit-icon",click:t,underlyingEntry:o},{className:"delete-icon",click:n,underlyingEntry:o,underlyingEntries:e.arrowOptions}],r}));return[].concat(Object(he.a)(o),[{colour:"black",name:"Add arrow type",symbol:"+"},{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}])}},{key:"edit_connector_type",value:function(e,t,n,o,r,a){var i=this,s=void 0,c=this.getArrowOptions();s=(s=c.find((function(t){return t.colour===e.line.attr("stroke")&&"Delete"!==t.name&&"Add arrow type"!==t.name})))?s.name:void 0;var d=function(t){e.setLineColor(t.colour),i.shared_state.logger.logEvent({type:"arrow_set_type",id:e.id,new_type:t.name}),r&&r(t.colour)};new f(c,t,n,o,(function(o){if("Delete"===o.name)i.shared_state.logger.logEvent({type:"arrow_delete",id:e.id}),i.remove_arrow(e,a);else if("Add arrow type"===o.name){var c=i.getNextAvailableColour(null,1);if(c){var l={name:"New relation",colour:c,symbol:"\u2192"};i.arrowOptions.push(l),i.shared_state.logger.logEvent({type:"add_arrow_type",colour:c}),s||d(l),i.edit_connector_type(e,t,n,!0,r,a)}else v.b.error("Maximum number of arrow types reached!")}else d(o)}),s)}},{key:"remove_arrow",value:function(e,t){e&&e.line&&e.line.node.instance.delete_connectable(e),t&&(this.completed_arrows=this.completed_arrows.filter((function(e){return e!==t})))}},{key:"stop_drawing_arrow",value:function(){this.drawing_arrow_from=!1,this.hide()}}],[{key:"fromJSON",value:function(t,n,o,r,a,i){var s=new e(n,o,r,a,i);return s.arrow_id_counter=t&&t.arrow_id_counter?t.arrow_id_counter:0,s.completed_arrows=t&&t.arrows?t.arrows:[],s.arrowOptions=t&&t.arrowOptions?t.arrowOptions:ve,s}}]),e}(),ye=20,be=function(){function e(t,n,o,r,a,i,c){var d=this;Object(s.a)(this,e);var l=t.shortText,u=t.x,h=t.y,p=t.width,g=t.height,f=t.id,v=t.isOnGraph,m=t.longText,y=t.annotatedOrder;this.id=f||r.getNodeId(),this.getNodesList=i,this.zoomCanvasTo=c,this.group=n.group().translate(u,h),this.dropShadow=this.group.rect(p,g).radius(5).addClass("node-drop-shadow"),this.arrow_hitbox=this.group.rect(p+2*ye,g+2*ye).translate(-ye,-ye).opacity(0).radius(10).addClass("arrow-hitbox"),this.rect=this.group.rect(p,g).radius(5).addClass("node"),this.editRect=this.group.rect(p-10,g-10).radius(5).translate(5,5).addClass("editing-node-rect"),this.text=this.group.text("").addClass("node-text"),this.updateShortText(l),this.updateLongText(m),this.setupRectDragging(this.rect,r),this.setupArrowHitbox(this.arrow_hitbox,o);var b=function(e){o.drawing_arrow_from&&o.complete_arrow(d)};this.arrow_hitbox.on("mouseup",b),this.rect.on("mouseup",b),this.text.on("mouseup",b),this.setupHover(r),this.setupContextMenu(r),a&&this.editText(r,!t.doNotDeleteIfEmptyText),this.setIsOnGraph(v),this.annotatedOrder=y,this.showAnnotatedOrder(),t.isFromJSON||r.logger.logEvent({type:"node_create",id:this.id})}return Object(c.a)(e,[{key:"toJSON",value:function(){return{id:this.id,shortText:this.shortText,longText:this.longText,screenCoords:this.group.getScreenCoords(),isOnGraph:this.isOnGraph,annotatedOrder:this.annotatedOrder}}},{key:"setIsOnGraph",value:function(e){this.isOnGraph=e,this.isOnGraph?this.rect.addClass("node-on-graph"):this.rect.removeClass("node-on-graph")}},{key:"setupContextMenu",value:function(e){var t=this,n=function(n){n.preventDefault();var o=document.getElementById("graph").getBoundingClientRect();return new f([{colour:"red",name:"Delete",symbol:"\ud83d\uddd9"}],n.clientX-o.left,n.clientY-o.top,!0,(function(n){"Delete"===n.name&&t.delete(e)})),!1};this.rect.on("contextmenu",n),this.text.on("contextmenu",n)}},{key:"setupHover",value:function(e){var t=this;this.hoverers=[];var n=function(n){t.setHoverer("mouse_"+n.target,!0),e.getAllDocNodeRefs(t.id).forEach((function(e){e&&(e.decoratedRef?e.decoratedRef.current.decoratedRef.current.setExternalHover(!0):e.setExternalHover(!0))}))},o=function(n){t.setHoverer("mouse_"+n.target,!1),e.getAllDocNodeRefs(t.id).forEach((function(e){e&&(e.decoratedRef?e.decoratedRef.current.decoratedRef.current.setExternalHover(!1):e.setExternalHover(!1))}))};this.rect.on("mouseenter",n),this.text.on("mouseenter",n),this.rect.on("mouseleave",o),this.text.on("mouseleave",o)}},{key:"setHoverer",value:function(e,t){if(t)this.hoverers.includes(e)||this.hoverers.push(e);else{var n=this.hoverers.indexOf(e);-1!==n&&this.hoverers.splice(n,1)}this.setHovered(this.hoverers.length>0)}},{key:"setHovered",value:function(e){e?this.rect.addClass("hovered"):this.rect.removeClass("hovered")}},{key:"setupRectDragging",value:function(e,t){var n=this;this.setupGroupDragging(e,t,e),this.setupGroupDragging(this.text,t,e,!0),this.text.click((function(e){return e.preventDefault()}));var o=function(){e.just_dropped||n.editText(t)};e.click(o),this.text.click(o)}},{key:"setupGroupDragging",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.draggy(),e.on("mousedown",(function(e){e.stopPropagation()})),n.just_dropped=!1,e.on("dragstart",(function(a){var i=o.group.x(),s=o.group.y();document.activeElement.blur(),t.draggedNode={id:o.id,text:o.getShortText(),longText:o.getLongText(),resetPos:function(){o.group.move(i,s),o.group.node.dispatchEvent(new CustomEvent("dragmove"))},node:o},o.dropShadow.translate(5,5),o.dropShadow.addClass("visible"),e.off("dragmove"),e.on("dragmove",(function(t){o.group.move(i+t.detail.delta.movedX,s+t.detail.delta.movedY),r?o.text.center(.5*o.rect.width(),.5*o.rect.height()):(e.x(0),e.y(0)),o.group.node.dispatchEvent(new CustomEvent("dragmove"))})),e.off("dragend"),e.on("dragend",(function(e){var r=o.group.x()-i,a=o.group.y()-s;(r>10||r<-10||a>10||a<-10)&&(n.just_dropped=!0,setTimeout((function(){n.just_dropped=!1}),.05)),t.draggedNode=!1,o.dropShadow.translate(0,0),o.dropShadow.removeClass("visible")}))}))}},{key:"setupArrowHitbox",value:function(e,t){var n=this;e.on("mousemove",(function(){t.drawing_arrow_from||t.update_source(n.group)})),e.on("mouseleave",(function(){t.drawing_arrow_from||t.hide()})),e.on("mousedown",(function(e){t.start_arrow(n),e.stopPropagation()}))}},{key:"updateShortText",value:function(e){this.shortText=e.replace(/[\r\n\v]+/g,"");var t=this.splitIntoLines(21,this.shortText);this.text.text(t.join("\n")),this.resizeRect(t.length)}},{key:"updateLongText",value:function(e){this.longText=e}},{key:"splitIntoLines",value:function(e,t){var n=[],o="";return t.split(" ").forEach((function(t){var r=[];if(t.length>e)for(var a=0;a<t.length;a+=e-1)r.length>0&&(r[r.length-1]+="-"),r.push(t.substring(a,Math.min(a+e,t.length)));else r=[t];r.forEach((function(t){if((o+t).length<e){var r=o.length>0?" ":"";o+=r+t}else n.push(o),o=t}))})),n.push(o),n}},{key:"resizeRect",value:function(e){this.rect.width(200);var t=21*e+20;this.rect.height(t),this.text.center(.5*this.rect.width(),.5*this.rect.height()),this.dropShadow.height(t),this.editRect.height(t-10),this.arrow_hitbox.size(this.rect.width()+2*ye,this.rect.height()+2*ye),this.group.node.dispatchEvent(new CustomEvent("dragmove"))}},{key:"getShortText",value:function(){return this.shortText}},{key:"getLongText",value:function(){return this.longText}},{key:"showAnnotatedOrder",value:function(){this.annotatedOrder&&(this.annotatedOrderText=this.group.text(this.annotatedOrder.toString()))}},{key:"editText",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(document.activeElement.blur(),e.orderAnnotate)if(this.annotatedOrder)e.annotatedNumbers=e.annotatedNumbers.filter((function(e){return e!==t.annotatedOrder})),this.annotatedOrder=void 0,this.annotatedOrderText.remove();else{var o=e.getNextAnnotateNum();this.annotatedOrder=o,e.annotatedNumbers.push(o),this.showAnnotatedOrder()}else this.zoomCanvasTo(1,{x:this.group.cx(),y:this.group.cy()},(function(){var o=document.querySelector("#nodeedit");o.value=t.getShortText();var r=t.getShortText(),a=t.rect.getScreenCoords();o.style.left=a.x+"px",o.style.top=a.y+"px",o.style.display="inline-block",o.focus(),o.style.width="180px",o.style.height="auto",o.style.height=o.scrollHeight+"px",t.text.hide(),t.editRect.addClass("visible"),t.setHoverer("editNodeDirectly",!0);var i=function(){t.updateShortText(o.value),e.updateDocShortText(t.id,t.getShortText())};o.onblur=function(){i(),o.style.display="none",!n||t.text.text()&&""!==t.text.text()||t.delete(e),t.text.show(),t.updateShortText(t.shortText),t.getShortText()!==r&&e.logger.logEvent({type:"node_edit_short_text",id:t.id,text:t.shortText}),t.editRect.removeClass("visible"),t.setHoverer("editNodeDirectly",!1)},o.onkeyup=function(e){"Escape"===e.key||"Esc"===e.key||"Enter"===e.key?(e.preventDefault(),document.activeElement.blur()):i()}}))}},{key:"delete",value:function(e){e.removeGraphNode(this.id);var t=this.getNodesList(),n=t.indexOf(this);-1!==n?t.splice(n,1):console.log("node not found in this.nodesList when deleting"),this.group.remove(),this.group.node.dispatchEvent(new CustomEvent("deletenode")),e.logger.logEvent({type:"node_delete",id:this.id})}}],[{key:"fromJSON",value:function(t,n,o,r,a,i){var s=t;return s.x=t.screenCoords.x,s.y=t.screenCoords.y,s.width=200,s.height=42,s.isFromJSON=!0,new e(s,n,o,r,!1,a,i)}}]),e}();var ke=Object(C.a)(N,{canDrop:function(e,t){var n=t.getItem();return"section"!==n.node.type&&!n.node.findDescendant((function(e){return"link"===e.type}))},drop:function(e,t,n){return{droppedOnGraph:!0,position:t.getClientOffset()}}},(function(e,t){return{connectDropTarget:e.dropTarget(),itemType:t.getItemType()}}))(function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.sharedState.getSavedGraph((function(t){e.nodesList=[],e.props.sharedState.graphPane=e,e.$el=document.querySelector("#graph");var n=new le.a(e.$el).size("100%","100%").panZoom({zoomMin:.2,zoomMax:1,zoomFactor:.1});e.svg=n,e.zoomCanvasTo=function(e,t,o){if(Math.abs(n.zoom()-e)<.01)o&&o();else{var r=n.animate({duration:100,ease:">"}).zoom(e,t);o&&r.after(o)}},n.zoom(1),le.a.extend(le.a.Element,{getScreenCoords:function(e){var t=this.doc().node.getBoundingClientRect(),n=this.node.getBoundingClientRect();return"centre"===e?{x:(n.left+n.right)/2-t.left,y:(n.top+n.bottom)/2-t.top}:{x:n.x-t.left,y:n.y-t.top}}});var o=n.group(),r=n.group(),a=n.group();e.nodesSvgGroup=a,e.numTempNodes=0;var i=t?t.connections:void 0,s=me.fromJSON(i,e.props.sharedState,n,o,r,o);e.mouse_follower=s,n.on("dblclick",(function(t){if(t.target===n.node||s.drawing_arrow_from){var o=t.clientX;o+200>window.innerWidth&&(o=window.innerWidth-200);var r=t.clientY;r+60>window.innerHeight&&(r=window.innerHeight-60),e.addNodeAtScreenLocation(n,a,s,"",o,r,!0)}})),e.setupTextDropping(n,a,s);var c=function(e){document.activeElement.blur()};n.on("panStart",c),n.on("zoom",c);var d=document.querySelector("#nodeedit");d.setAttribute("style","height:"+d.scrollHeight+"px;overflow-y:hidden;"),d.addEventListener("input",(function(e){d.style.height="auto",d.style.height=d.scrollHeight+"px"})),e.props.sharedState.addGraphNode=function(t,o,r,i){return o+200>window.innerWidth&&(o=window.innerWidth-200),r+60>window.innerHeight&&(r=window.innerHeight-60),e.addNodeAtScreenLocation(n,a,s,t,o,r,!0,i)},t&&t.nodes&&e.loadNodesFromJSON(t.nodes,s,a),e.getNodeById=e.getNodeById.bind(e),s.draw_loaded_arrows(e.getNodeById),0===e.nodesList.length&&e.addNoNodesIndicator(n,a,s)}))}},{key:"getNodeById",value:function(e){return this.nodesList.find((function(t){return t.id.toString()===e.toString()}))}},{key:"toJSON",value:function(){return{nodes:this.nodesList.map((function(e){return e.toJSON()})),connections:this.mouse_follower.toJSON()}}},{key:"loadNodesFromJSON",value:function(e,t,n){var o=this;this.nodesList=e.map((function(e){return be.fromJSON(e,n,t,o.props.sharedState,(function(){return o.nodesList}),o.zoomCanvasTo)})),console.log("num nodes: "+this.nodesList.length)}},{key:"explodeNodes",value:function(){this.nodesList.forEach((function(e){e.group.move(e.group.x()+.1*e.group.x(),e.group.y()+.1*e.group.y()),e.group.node.dispatchEvent(new CustomEvent("dragmove"))}))}},{key:"addTempNode",value:function(e){var t=this.addNodeAtScreenLocation(this.svg,this.nodesSvgGroup,this.mouse_follower,"?",0,150*this.numTempNodes,!1,!0,e,!0);return this.numTempNodes++,t}},{key:"addNoNodesIndicator",value:function(e,t,n){var o=this;this.noNodesIndicator=e.text("No nodes created").addClass("indicator-text").attr({x:"40%",y:"45%"}),this.noNodesIndicator.on("dblclick",(function(r){o.addNodeAtScreenLocation(e,t,n,"",r.clientX,r.clientY,!0)}))}},{key:"setupTextDropping",value:function(e,t,n){var o=this;this.$el.addEventListener("dragover",(function(e){e.preventDefault()})),this.$el.addEventListener("drop",(function(r){if(r.preventDefault(),r.dataTransfer.types.includes("text/plain")){var a=r.dataTransfer.getData("Text");if(a.includes("\n"))v.b.error("You can't add multiple paragraphs to the graph at once");else if(o.props.sharedState.canAddLinkAtSelection()){var i=r.clientX;i+200>window.innerWidth&&(i=window.innerWidth-200);var s=r.clientY;s+60>window.innerHeight&&(s=window.innerHeight-60);var c=o.addNodeAtScreenLocation(e,t,n,a,i,s,!1);o.props.sharedState.addLinkAtSelection(c.id,c),o.props.sharedState.logger.logEvent({type:"node_create_from_doc",node_id:c.id,text:a}),document.activeElement.blur()}else v.b.error("You can't add the same node to the graph twice!")}}))}},{key:"addNodeAtScreenLocation",value:function(e,t,n,o,r,a,i){var s=this,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0,l=arguments.length>9&&void 0!==arguments[9]&&arguments[9],u=e.point(r,a);l&&(u={x:r,y:a});var h={shortText:o,longText:"",x:u.x,y:u.y,width:200,height:42,isOnGraph:!1,id:d,doNotDeleteIfEmptyText:c},p=new be(h,t,n,this.props.sharedState,i,(function(){return s.nodesList}),this.zoomCanvasTo);return this.nodesList.push(p),this.noNodesIndicator&&this.noNodesIndicator.hide(),p}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return this.props.connectDropTarget(r.a.createElement("div",{id:"graph",className:"pane",ref:function(t){return e.el=t}},r.a.createElement("textarea",{id:"nodeedit"})))}}]),t}(r.a.Component)),xe=n(308),we=(n(449),new(n(309).a)("writeReasonDb"));we.version(3).stores({projects:"++id,name"});var Ee=we,Oe=n(107),_e=n.n(Oe),Se=n(217),Ne=n(310);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach((function(t){Object(pe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ce=["session_start","document_content_detailed","document_content_markdown"],De=function(){function e(t,n){Object(s.a)(this,e),this.shouldLogToConsole=!1,this.db_id=t,this.conditions=n,this.logToConsole("Logging begin, db_id "+t+"\nParams "+JSON.stringify(n,null,1)),this.stateIsDirty=!1,this.logEvent({type:"session_start"})}return Object(c.a)(e,[{key:"logEvent",value:function(e){var t=this;Ce.includes(e.type)||(this.stateIsDirty=!0),"save"===e.type&&(this.stateIsDirty=!1),this.getLog((function(n){void 0===n.events&&(n.events={}),void 0===n.events[e.type]&&(n.events[e.type]=[]),e.timestamp=new Date,n.events[e.type].push(e),t.setLog(n),t.logToConsole("Logging event: "+JSON.stringify(e))}))}},{key:"logSaveState",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getLog((function(o){void 0===o.saves&&(o.saves=[]);var r=new Date;!n&&o.saves.find((function(e){return r-e.timestamp<18e4}))||(o.saves.push(Te({timestamp:r},e)),t.setLog(o))}))}},{key:"getLog",value:function(e){Ee.table("projects").get(this.db_id).then((function(t){e(t.log?t.log:{})}))}},{key:"setLog",value:function(e){Ee.table("projects").update(this.db_id,{log:e}).catch((function(e){v.b.error("Logging error: "+e),console.log("Logging error: "+e)}))}},{key:"logToConsole",value:function(e){this.shouldLogToConsole&&console.log(e)}}]),e}(),Le=n(80),He=n(324),Be=n.n(He),Ie=n(325),Pe=n.n(Ie),Ae=function(){function e(t,n){var o=this;Object(s.a)(this,e),this.getSavedDocValue=function(){var e=Object(Se.a)(_e.a.mark((function e(t){return _e.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getProjectThen((function(e){t(e.doc_value)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.getSavedGraph=function(){var e=Object(Se.a)(_e.a.mark((function e(t){return _e.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getProjectThen((function(e){t(e.graph_value)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.logExplore?this.logger={logEvent:function(e,t){}}:this.logger=new De(t,n),this.condition=n.condition,this.params=n,this.node_id_counter=0,this.slate_id_counter=10,this.map={},this.map_recycle_bin={},this.db_id=t,this.orderAnnotate=!1,this.annotatedNumbers=[],this.editor_ref=void 0,this.graphPane=void 0,this.params.logExplore||(this.intervalLogger=window.setInterval((function(){o.logger.logEvent({type:"document_content_markdown",content:o.getArgumentMarkdown()})}),6e4)),this.downloadExperimentData=this.downloadExperimentData.bind(this),this.editorHasLoaded=this.editorHasLoaded.bind(this),this.save=this.save.bind(this),this.mapToJSON=this.mapToJSON.bind(this),this.exportPDF=this.exportPDF.bind(this),this.exploreNext=this.exploreNext.bind(this),this.explorePrev=this.explorePrev.bind(this),this.exploreLog=this.exploreLog.bind(this),this.makeNodeReport=this.makeNodeReport.bind(this),this.getNextAnnotateNum=this.getNextAnnotateNum.bind(this),this.exportAnnotatedLog=this.exportAnnotatedLog.bind(this),this.explodeNodes=this.explodeNodes.bind(this),window.onbeforeunload=function(e){o.getStateIsDirty()&&(e.preventDefault(),e.returnValue="")}}return Object(c.a)(e,[{key:"exportAnnotatedLog",value:function(){var e={map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON()};this.downloadJSON(e,this.params.logExplore.project.filename+"__order_annotated.json")}},{key:"getNextAnnotateNum",value:function(){if(0===this.annotatedNumbers.length)return 1;this.annotatedNumbers.sort((function(e,t){return e-t}));var e=0;return this.annotatedNumbers.forEach((function(t){if(e+1!==t)return e+1;e=t})),this.annotatedNumbers[this.annotatedNumbers.length-1]+1}},{key:"viewFactSheet",value:function(){var e=localStorage.getItem("scenario");if(e){var t=e+"_factsheet.pdf";window.open(t,"_blank")}else v.b.error("Fact sheet not found. Please re-open Write Reason using the link in the email we sent you.")}},{key:"editorHasLoaded",value:function(){var e=this;this.getProjectThen((function(t){e.node_id_counter=t.node_id_counter?t.node_id_counter:0,e.map=t.map?e.mapFromJSON(t.map):{},e.getEditor().mapHasLoaded(),e.projectName=t.name})),this.lastSavedDocumentState=this.getEditor().getValue().document}},{key:"downloadThisLog",value:function(){var e={map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON()};this.params.logExplore.project.log.saves.push(e),this.downloadJSON({projects:[{map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON(),log:this.params.logExplore.project.log}]},"x.json")}},{key:"save",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON()};Ee.table("projects").update(this.db_id,o).then((function(t){if(t)v.b.info("Changes saved!"),e.lastSavedDocumentState=e.getEditor().getValue().document,e.logger.logSaveState(o,n);else{var r="Save error: file with ID "+e.db_id.toString()+" does not exist!";console.log(r),v.b.error(r)}})).catch((function(e){v.b.error("Save error: "+e.toString())})),this.logger.logEvent({type:"save"}),t&&t()}},{key:"getStateIsDirty",value:function(){return this.logger.stateIsDirty||this.getEditor()&&this.getEditor().getValue()&&this.getEditor().getValue().document!==this.lastSavedDocumentState}},{key:"explorePrev",value:function(){0!==this.params.logExplore.saveIndex&&this.exploreLog(this.params.logExplore.project,this.params.logExplore.saveIndex-1)}},{key:"exploreNext",value:function(){this.params.logExplore.saveIndex!==this.params.logExplore.project.log.saves.length-1&&this.exploreLog(this.params.logExplore.project,this.params.logExplore.saveIndex+1)}},{key:"exploreLog",value:function(t,n){var o=new e(-1,{condition:"graph",logExplore:{project:t,saveIndex:n},transitionToEditor:this.params.transitionToEditor});this.params.transitionToEditor(o,!0)}},{key:"makeNodeReport",value:function(){var e={map:this.mapToJSON(),node_id_counter:this.node_id_counter,doc_value:this.getEditor().getValue().toJSON(),graph_value:this.graphPane.toJSON()};this.downloadJSON(e,this.params.logExplore.project.filename+"_ANNOTATED.json");var t={linkedTexts:[],unlinkedTexts:[]},n=this.getEditor().getValue();n.document.getBlocks().forEach((function(e){"body"===e.type||"link"===e.type||"section"===e.type?t.linkedTexts.push(e.text):e.nodes.forEach((function(e){e.text&&("link"===e.type?t.linkedTexts.push(e.text):t.unlinkedTexts.push(e.text))}))})),t.linked=t.linkedTexts.join("\n"),t.unlinked=t.unlinkedTexts.join("\n"),t.linkedCharsProportion=t.linked.length/(t.linked.length+t.unlinked.length);var o=function(e){return e.trim().split(/\s+/).length};t.linkedWords=o(t.linked),t.unlinkedWords=o(t.unlinked),t.linkedWordProportion=t.linkedWords/(t.linkedWords+t.unlinkedWords),t.rawValue=n;var r=localStorage.getItem("nodeReports")?JSON.parse(localStorage.getItem("nodeReports")):{};r[this.params.logExplore.project.filename]=t,localStorage.setItem("nodeReports",JSON.stringify(r))}},{key:"getProjectThen",value:function(e){if(this.params.logExplore){var t=this.params.logExplore;e(t.project.log.saves[t.saveIndex])}else Ee.table("projects").get(this.db_id).then((function(t){e(t)}))}},{key:"mapToJSON",value:function(){var e=this,t={},n=this.getEditor().value.document,o=function(o){var r={};["section","long","short"].forEach((function(t){var a=e.getDocNodes(o);if(a&&a[t]){var i=n.getPath(a[t]);i&&(r[t]=i.toArray())}})),t[o]={graph_node:e.getGraphNode(o)?e.getGraphNode(o).id:void 0,doc_nodes:r}};for(var r in this.map)o(r);return t}},{key:"mapFromJSON",value:function(e){for(var t in this.map={},e){if(e[t].graph_node){var n=this.graphPane.getNodeById(t);n?this.addGraphMapping(t,n):v.b.error("Error when loading: could not find graph node with ID "+t)}if(e[t].doc_nodes)for(var o in e[t].doc_nodes){var r=e[t].doc_nodes[o],a=this.getEditor().value.document;a.hasNode(r)?this.setLinkMapping(t,a.getNode(r),o):(console.log(a),v.b.error("Error when loading: could not find "+o+" with ID "+t))}}return this.map}},{key:"downloadExperimentData",value:function(){var e=this;this.save((function(){Ee.table("projects").toArray((function(t){var n={timestamp:new Date,preTaskSubmission:localStorage.getItem("preTaskSubmission"),projects:t};e.downloadJSON(n,"Write Reason logs.json")})).catch((function(e){v.b.error("Error downloading logs: "+e)}))}),!0)}},{key:"getArgumentHTML",value:function(){var e=this,t=function(t,n){var o=e.getEditor().value.document.getParent(t.key);return o&&o.data.get("nodeStyle")===n},n=[{serialize:function(e,n){if(["block","inline"].includes(e.object))switch(e.type){case"paragraph":case"":return r.a.createElement("p",null,n);case"heading":return r.a.createElement("h2",null,n);case"section":return r.a.createElement("div",null,n);case"body":return t(e,"Heading only")?r.a.createElement("p",null):r.a.createElement("p",null,n);case"link":return"inline"===e.object?r.a.createElement("span",null,n):t(e,"Body only")?r.a.createElement("p",null):r.a.createElement("h2",null,n);default:return}else if("string"===e.object)return e.text}}];return new Ne.a({rules:n}).serialize(this.getEditor().value)}},{key:"downloadJSON",value:function(e,t){var n=new Blob([JSON.stringify(e,null,2)],{type:"text/plain"});this.downloadBlob(n,t)}},{key:"downloadBlob",value:function(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,document.body.appendChild(n),n.click()}},{key:"exportPDF",value:function(){var e=this;this.logger.getLog((function(t){e.getReactPdfDocument().then((function(t){e.downloadBlob(t,e.projectName+".pdf")}))}))}},{key:"getReactPdfDocument",value:function(){var e=this.getArgumentMarkdown();Le.b.register({family:"Crimson Text",fonts:[{src:Be.a},{src:Pe.a,fontWeight:800}]});var t=Le.d.create({page:{padding:80},text:{fontFamily:"Crimson Text",width:"100%",fontSize:"12pt",paddingBottom:8},heading:{fontFamily:"Crimson Text",textDecoration:"underline",fontWeight:800,width:"100%",fontSize:"12pt"}}),n=r.a.createElement(Le.a,null,r.a.createElement(Le.c,{style:t.page},e.split("\n").map((function(e){return e.startsWith("##")?(e=e.substring("##".length),r.a.createElement(Le.e,{style:t.heading},e)):r.a.createElement(Le.e,{style:t.text},e)}))));return Object(Le.f)(n).toBlob()}},{key:"getArgumentMarkdown",value:function(){var e=this.getArgumentHTML();[{regex:/<p>\s*<\/p>/g},{regex:/<p>/g},{regex:/<\/p>/g,replace:"\n\n"},{regex:/<div>/g},{regex:/<\/div>/g},{regex:/<span>/g},{regex:/<\/span>/g},{regex:/<h2>/g,replace:"## "},{regex:/<\/h2>/g,replace:"\n"}].forEach((function(t){e=e.replace(t.regex,t.replace?t.replace:"")}));var t=document.createElement("span");return t.innerHTML=e,e=t.innerText}},{key:"finishCondition",value:function(){window.onbeforeunload=void 0,window.clearInterval(this.intervalLogger)}},{key:"getEditor",value:function(){return this.editor_ref.current}},{key:"getNodeId",value:function(){return this.node_id_counter++,this.node_id_counter}},{key:"canAddLinkAtSelection",value:function(){var e=this.getEditor().value,t=e.blocks.some((function(e){return"link"===e.type||"section"===e.type||"body"===e.type})),n=e.inlines.some((function(e){return"link"===e.type}));return!t&&!n}},{key:"addLinkAtSelection",value:function(e,t){this.getEditor().wrapLinkAtSelection(e),this.addGraphMapping(e,t)}},{key:"addGraphMapping",value:function(e,t){t.setIsOnGraph(!0),this.map[e]={graph_node:t}}},{key:"setLinkMapping",value:function(e,t,n){this.map[e]||(this.map[e]={},this.checkRecycleBinForGraphNode(e)),void 0===this.map[e].doc_nodes&&(this.map[e].doc_nodes={}),this.map[e].doc_nodes[n]=t}},{key:"getGraphNodeAndDocNode",value:function(e){return this.map[e]}},{key:"checkRecycleBinForGraphNode",value:function(e){if(this.map[e]||(this.map[e]={}),!this.map[e].graph_node){var t=this.map_recycle_bin[e];t&&t.graph_node&&(console.log("restored from recycle"),this.addGraphMapping(e,t.graph_node))}}},{key:"getGraphNode",value:function(e){var t=this.getGraphNodeAndDocNode(e);if(t)return t.graph_node}},{key:"removeGraphNode",value:function(e){var t=this;this.getDocNodes(e)&&(Object.values(this.getDocNodes(e)).forEach((function(e){t.getEditor().removeGraphLink(e)})),this.map[e]=void 0)}},{key:"removeDocNode",value:function(e){var t=this.getGraphNodeAndDocNode(e);t&&(t.graph_node&&t.graph_node.setIsOnGraph(!1),this.map_recycle_bin[e]=this.map[e],this.map[e]=void 0)}},{key:"getDocNodes",value:function(e){var t=this.getGraphNodeAndDocNode(e);if(t)return t.doc_nodes}},{key:"getDocNodeShortText",value:function(e){var t=this.getDocNodes(e);if(t)return t.short}},{key:"getDocNodeLongText",value:function(e){var t=this.getDocNodes(e);if(t)return t.long}},{key:"getDocNodeRef",value:function(e,t){var n=this.getGraphNodeAndDocNode(e);if(n&&n.doc_link_node)return n.doc_link_node[t].current}},{key:"getAllDocNodeRefs",value:function(e){var t=[],n=this.getGraphNodeAndDocNode(e);return n&&["long","short","section"].forEach((function(e){n.doc_link_node&&n.doc_link_node[e]&&t.push(n.doc_link_node[e].current)})),t}},{key:"registerLinkNode",value:function(e,t,n){void 0===this.map[e].doc_link_node&&(this.map[e].doc_link_node={}),this.map[e].doc_link_node[n]=t}},{key:"updateIsOnGraphStatus",value:function(e){var t=this.getDocNodeShortText(e);return!!t&&(!(t&&!this.getEditor().value.document.hasNode(t.key))||(this.removeDocNode(e),!1))}},{key:"updateDocShortText",value:function(e,t){var n=this.getDocNodeShortText(e);if(n){var o=this.getEditor();this.updateIsOnGraphStatus(e)&&(n.nodes.forEach((function(e){o.removeNodeByKey(e.key)})),o.insertNodeByKey(n.key,0,g.m.create({text:t})))}}},{key:"updateGraphShortText",value:function(e,t){var n=this.getGraphNode(e);n&&n.updateShortText(t)}},{key:"updateGraphLongText",value:function(e,t){var n=this.getGraphNode(e);n&&n.updateLongText(t)}},{key:"explodeNodes",value:function(){this.graphPane.explodeNodes()}}]),e}(),Re=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t="/write-reason/explore/thumbnails/"+this.props.participant_id+".png";return r.a.createElement("div",{className:"log-load-button",onClick:function(){e.props.loadLog(e.props.participant_id)}},r.a.createElement("img",{src:t,className:"log-load-img",alt:"P"+this.props.participant_id+" map thumbnail"}),r.a.createElement("p",null,"P",this.props.participant_id))}}]),t}(o.Component),Me=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={projects:[]},n.loadProject=n.loadProject.bind(Object(u.a)(n)),n.updateProjectsFromDb=n.updateProjectsFromDb.bind(Object(u.a)(n)),n.onDropLogFiles=n.onDropLogFiles.bind(Object(u.a)(n)),n.exploreLog=n.exploreLog.bind(Object(u.a)(n)),document.title="Write Reason",n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.updateProjectsFromDb()}},{key:"updateProjectsFromDb",value:function(){var e=this;Ee.table("projects").toArray((function(t){e.setState({projects:t})})).catch((function(e){v.b.error("Error when loading projects: "+e)}))}},{key:"loadProject",value:function(e){var t=new Ae(e,{condition:"graph"});this.props.transitionToEditor(t)}},{key:"deleteProject",value:function(e){var t=this;window.confirm("Are you sure you want to delete this project? This cannot be undone.")&&Ee.table("projects").delete(e).then((function(){t.updateProjectsFromDb()}))}},{key:"onDropLogFiles",value:function(e){e.forEach((function(e){var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){var n=localStorage.getItem("logsToExplore")||JSON.stringify({logs:[]}),o=JSON.parse(n).logs,r=JSON.parse(t.result);r.filename=e.name,r.projects.forEach((function(t){return t.filename=e.name})),o.push(r),localStorage.setItem("logsToExplore",JSON.stringify({logs:o}))},t.readAsText(e)}))}},{key:"exploreLog",value:function(e,t){var n={condition:"graph",logExplore:{project:e,saveIndex:t},transitionToEditor:this.props.transitionToEditor},o=new Ae(-1,n);this.props.transitionToEditor(o)}},{key:"render",value:function(){var e=this,t=function(t){n(624)("./"+t+".json").then((function(t){console.log(t),e.exploreLog(t.projects[0],t.projects[0].log.saves.length-1)})),document.title="P"+t+" - Write Reason"};return r.a.createElement("div",{className:"load-project"},r.a.createElement("div",{className:"logs-grid"},[1,2,3,4,5,6,7,8,10,11,12,14,15,17,18,21,22,23,25,26].map((function(e){return r.a.createElement(Re,{participant_id:e,loadLog:t,key:e})}))))}}]),t}(o.Component),Ge=n(661),Je=n(328),Fe=(n(625),n(299),function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(this.props.sharedState.params.logExplore)return r.a.createElement("div",{className:"experiment-controls"},r.a.createElement("button",{className:"pure-button button-primary",onClick:this.props.backToMenu},"Back"))}}]),t}(o.Component)),We=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e="";return this.props.log.type.includes("doc")&&(e="red"),this.props.log.type.includes("node")&&(e="blue"),(this.props.log.type.includes("doc_create_from_node")||this.props.log.type.includes("doc_node_change_format"))&&(e="yellow"),this.props.log.type.includes("arrow")&&(e="green"),this.props.isExploreHead&&(e+=" explore-head pure-button-active"),r.a.createElement("button",{className:e,onClick:this.props.onClick},this.props.log.type," ",r.a.createElement("i",null,this.props.log.id&&(this.props.log.id.toString().length<4?this.props.log.id:this.props.log.source&&this.props.log.source+" \u2192 "+this.props.log.target)),r.a.createElement("br",null),this.props.timestampFormatted)}}]),t}(o.Component),Ke=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={exploreHead:void 0},n.moveExploreHead=n.moveExploreHead.bind(Object(u.a)(n)),n.exploreEvent=n.exploreEvent.bind(Object(u.a)(n)),n.setDocValue=n.setDocValue.bind(Object(u.a)(n)),n.handleKeyDown=n.handleKeyDown.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"moveExploreHead",value:function(e){document.getElementById("graph").classList.add("timeline-explore-mode");var t=this.props.sharedState.params.logExplore.project.orderedLogs;if(t){this.setState({exploreHead:e});for(var n=!1,o="empty",r=0;r<t.length;r++)this.exploreEvent(t[r],n),"doc_change"!==t[r].type||n||(o=t[r].content),t[r]===e&&(n=!0,this.setDocValue(o))}}},{key:"setDocValue",value:function(e){var t=this.props.sharedState.getEditor();t.moveToRangeOfDocument(),t.delete(),t.moveToStartOfDocument();var n=g.a.create({object:"block",type:""}),o=t.value.document.getParent(t.value.startBlock.key),r=t.value.document.getParent(o.key);if(r){var a=r.nodes.indexOf(o);t.insertNodeByKey(r.key,a,n),t.moveBackward(1)}t.insertText(e)}},{key:"exploreEvent",value:function(e,t){var n,o=this.props.sharedState.graphPane,r=function(e){e&&(t?e.removeClass("has-been-explored"):e.addClass("has-been-explored"))};switch(e.type){case"node_create":(n=o.getNodeById(e.id))?r(n.rect):t||(n=o.addTempNode(e.id))&&r(n.rect);break;case"node_delete":t||(n=o.getNodeById(e.id))&&(n.delete(this.props.sharedState),o.numTempNodes--);break;case"arrow_create":var a=o.mouse_follower.getConnectorObjectConnecting(e.source,e.target);a?r(a.line):t||o.mouse_follower.addTempArrow(e.source,e.target,"black",e.id);break;case"arrow_delete":if(t)break;var i=o.mouse_follower.temp_arrows[e.id];i&&(o.mouse_follower.remove_arrow(o.mouse_follower.connector_objs[i],void 0),o.mouse_follower.connector_objs[i]=void 0);break;case"node_edit_short_text":(n=o.getNodeById(e.id))&&!t&&n.updateShortText(e.text)}}},{key:"handleKeyDown",value:function(e){var t=void 0;if(39===e.keyCode?t=1:37===e.keyCode&&(t=-1),void 0!==t){var n=this.props.sharedState.params.logExplore.project.orderedLogs;if(!n)return;for(var o=0;o<n.length;o++)this.state.exploreHead===n[o]&&o+t>0&&o+t<n.length&&this.moveExploreHead(n[o+t])}}},{key:"render",value:function(){var e=this,t=this.props.sharedState.params.logExplore.project;if(!t.orderedLogs){var n=t.log.events.document_content_markdown;t.log.events.doc_change=[],n.forEach((function(e,o){0!==o&&n[o-1].content===e.content||t.log.events.doc_change.push({type:"doc_change",content:e.content,timestamp:e.timestamp})})),t.log.events.doc_change.forEach((function(e){return e.type="doc_change"})),t.orderedLogs=[].concat.apply([],Object.values(t.log.events)).filter((function(e){return"document_content_markdown"!==e.type})),t.orderedLogs.sort((function(e,t){return new Date(e.timestamp)-new Date(t.timestamp)}))}var o=t.orderedLogs;return r.a.createElement("div",{className:"timeline",onKeyDown:this.handleKeyDown},r.a.createElement("p",{className:"timeline-description"},"This timeline shows in what order the participant built their map and text.",r.a.createElement("br",null),"Click on an event to see which elements had been created at that time."),r.a.createElement("p",null,t.filename),o.map((function(t,n){var a=function(e){return e.substring("2020-".length,"2020-07-21".length)},i=t.timestamp.substring("2020-07-21T".length,"2020-07-21T12:51:45".length),s=function(){return r.a.createElement(We,{onClick:function(){return e.moveExploreHead(t)},log:t,timestampFormatted:i,sharedState:e.props.sharedState,isExploreHead:e.state.exploreHead===t})};return 0===n||a(t.timestamp)!==a(o[n-1].timestamp)?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,r.a.createElement("b",null,a(t.timestamp))),s()):s()})))}}]),t}(o.Component),qe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={open:!1},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=function(t){return t+(e.state.open?"":" closed")};return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:t("pure-button timeline-toggle-button"),onClick:function(){e.setState({open:!e.state.open}),document.getElementById("graph").classList.remove("timeline-explore-mode")}},this.state.open?"Hide timeline":"Show timeline"),r.a.createElement("div",{className:t("slide-out-pane")},this.props.children))}}]),t}(o.Component),ze=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e,t=this,n=localStorage.getItem("scenario");return"biohacking"===n?e=r.a.createElement("b",null,"QUESTION: Should greater regulatory control be exerted over genetic biohacking?"):"sharedSpace"===n?e=r.a.createElement("b",null,"QUESTION: Should \u201cshared spaces\u201d in urban planning be promoted?"):v.b.error("Question not found. Please re-open Write Reason using the link in the email we sent you."),r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Instructions for study participants"),r.a.createElement("p",null,"Thank you for participating in this study!"),r.a.createElement("h3",null,"Before you start"),r.a.createElement("p",null,"Watch the \u201cHow to use\u201d video on the home page."),r.a.createElement("h3",null,"The task"),r.a.createElement("p",null,"Your task is to decide where you stand on the question below, and write an essay justifying your view. Use Write Reason for all parts of the task."),e,r.a.createElement("p",null,"Write in the style of a short academic essay. You may not have heard of this topic before - don't worry, the fact sheet has all the information you need on it!"),r.a.createElement("h3",null,"How to work on the task"),r.a.createElement("ol",null,r.a.createElement("li",null,"First, ",r.a.createElement("a",{href:"#factsheet",onClick:function(e){e.preventDefault(),t.props.sharedState.viewFactSheet()}},"click here to read the fact sheet")),r.a.createElement("li",null,"Spend around 1 hour 40 minutes on this task, over the next week"),r.a.createElement("li",null,"Aim for around 700 words as a very rough guide - though it's fine to exceed this!"),r.a.createElement("li",null,"Whenever you work on the task record it in the diary. ",r.a.createElement("a",{href:"/diary_template.csv",download:!0},"Download a blank diary here")),r.a.createElement("li",null,"Please ",r.a.createElement("b",null,"do not enter any personal information")," when using Write Reason"),r.a.createElement("li",null,'Your work will be saved in your browser on this computer when you press "Save"')),r.a.createElement("h3",null,"What to do when you're finished"),r.a.createElement("ol",null,r.a.createElement("li",null,'Press the "Export logs" button in the bottom right of the screen, and keep the downloaded file somewhere safe'),r.a.createElement("li",null,"Make sure your diary is filled out"),r.a.createElement("li",null,"Email us at ",r.a.createElement("a",{href:"mailto:ab390@st-andrews.ac.uk?subject=Write Reason task complete"},"ab390@st-andrews.ac.uk")," to arrange a short interview about your experiences! During the interview you will send us the logs and your diary"),r.a.createElement("li",null,"You will receive a \xa320 Amazon voucher to thank you for your time")),r.a.createElement("p",null,"Your contribution to our research is incredibly valuable, thank you!"))}}]),t}(o.Component),Ue=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={q1:"",q2:"",q3:""},n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e,t){this.setState(Object(pe.a)({},t,e.target.value))}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=[this.state.q1,this.state.q2,this.state.q3],n=!1;t.forEach((function(e){if(!n&&(!e||""===e))return alert("Please enter an answer for all three questions"),void(n=!0)})),n||window.confirm("Are you ready submit your answers? You cannot undo this action")&&(localStorage.setItem("preTaskSubmission",JSON.stringify(this.state)),this.props.transitionToMenu())}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"intro-section"},r.a.createElement("h3",{style:{paddingTop:"40px"}},"Thank you for participating in this experiment!"),r.a.createElement("ol",{className:"steps"},r.a.createElement("li",null,r.a.createElement("p",null,"Before we begin, please complete this ",r.a.createElement("a",{href:"https://standrews.eu.qualtrics.com/jfe/form/SV_9tYNKrCBK8uHOiV"},"short, anonymous demographics questionnaire")," if you have not done so already.")),r.a.createElement("li",null,r.a.createElement("p",null," Then, write a paragraph (at least 2 sentences) answering each of the questions below:"),r.a.createElement("form",{onSubmit:this.handleSubmit,className:"pure-form pure-form-stacked"},r.a.createElement("label",null,"When you write an essay, what do you aim to produce?"),r.a.createElement("textarea",{className:"pure-input-1",rows:"10",value:this.state.value,onChange:function(t){return e.handleChange(t,"q1")},placeholder:"Your answer..."}),r.a.createElement("label",null,"What makes a good essay?"),r.a.createElement("textarea",{className:"pure-input-1",rows:"10",value:this.state.value,onChange:function(t){return e.handleChange(t,"q2")},placeholder:"Your answer..."}),r.a.createElement("label",null,"What do you think are the possible purposes of writing an essay?"),r.a.createElement("textarea",{className:"pure-input-1",rows:"10",value:this.state.value,onChange:function(t){return e.handleChange(t,"q3")},placeholder:"Your answer..."}),r.a.createElement("input",{className:"pure-button button-primary",type:"submit",value:"Submit answer"})))),r.a.createElement("p",null,r.a.createElement("i",null,"Any questions? Get in touch at ",r.a.createElement("a",{href:"mailto:ab390@st-andrews.ac.uk?subject=Write Reason question"},"ab390@st-andrews.ac.uk"),".")),r.a.createElement("br",null))}}]),t}(o.Component),Ye=n(326),Ve=n.n(Ye),Xe=(n(626),function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"intro-section"},r.a.createElement("a",{href:"https://adambinks.me/write-reason/"},r.a.createElement("img",{src:Ve.a,className:"logo",alt:"Write Reason"})),r.a.createElement("p",null,"Explore the representations created by participants in our study."),r.a.createElement("p",null,r.a.createElement("em",null,"These data were collected by Adam Binks, Alice Toniolo and Miguel Nacenta, from consenting study participants, and are shared in an anonymised form as approved by University of St Andrews ",r.a.createElement("a",{href:"https://www.st-andrews.ac.uk/research/environment/committees/utrec/"},"UTREC")," (approval code CS14896).")))}}]),t}(o.Component)),Qe=n(225),$e=n.n(Qe),Ze=n(327);$e.a.setAppElement("#root");var et={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",maxWidth:"40%",maxHeight:"90%",padding:"50px"}},tt=function(e){function t(e){var n;Object(s.a)(this,t);return(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={phase:"loadproject",params:void 0},n.transitionToEditor=n.transitionToEditor.bind(Object(u.a)(n)),n.transitionToMenu=n.transitionToMenu.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){if(window.location.search){var e=new URLSearchParams(window.location.search).get("scenario");"biohacking"!==e&&"sharedSpace"!==e?console.error("Unrecognised scenario "+e):(localStorage.setItem("scenario",e),console.log(localStorage.getItem("scenario")))}this.getStorageUsed()}},{key:"transitionToEditor",value:function(e,t){var n=this;t?(this.setState({phase:"reset",sharedState:void 0}),window.setTimeout((function(){n.setState({sharedState:e,phase:"editor"})}),0)):this.setState({sharedState:e,phase:"editor"})}},{key:"transitionToMenu",value:function(){this.state.sharedState&&this.state.sharedState.finishCondition(),this.setState({sharedState:void 0,phase:"loadproject"})}},{key:"getStorageUsed",value:function(){var e=this;navigator.storage&&navigator.storage.estimate().then((function(t){if(t){var n=t.usage/t.quota*100;n<5e-8&&(n=0),n=n.toPrecision(2),e.setState({storageUsed:n})}}))}},{key:"render",value:function(){var e=this;if(Ze.isMobile)return r.a.createElement("p",null,"Write Reason is designed for non-mobile devices. Please access from a laptop or desktop computer.");switch(this.state.phase){case"pretask":return r.a.createElement(Ue,{transitionToMenu:this.transitionToMenu});case"loadproject":return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xe,null),r.a.createElement(Me,{transitionToEditor:this.transitionToEditor,autoload:!1}),r.a.createElement("footer",null,this.state.storageUsed&&r.a.createElement("p",null,"Storage used: ",this.state.storageUsed,"%"),r.a.createElement("p",null,r.a.createElement("b",null,"Privacy notice"),": This webpage simply downloads the Write Reason application to your browser. Once loaded, everything runs locally in your browser. No data is sent back to the server.")));case"editor":return r.a.createElement("div",{className:"App"},r.a.createElement($e.a,{isOpen:this.state.modalIsOpen,style:et,contentLabel:"Experiment information",onRequestClose:function(){return e.setState({modalIsOpen:!1})}},r.a.createElement(ze,{sharedState:this.state.sharedState}),r.a.createElement("button",{className:"pure-button",onClick:function(){return e.setState({modalIsOpen:!1})}},"Close")),r.a.createElement(Ge.a,{backend:Je.a},r.a.createElement(xe.a,{split:"vertical",defaultSize:"50%"},r.a.createElement(ce,{sharedState:this.state.sharedState}),r.a.createElement(ke,{sharedState:this.state.sharedState})),this.state.sharedState.params.logExplore&&r.a.createElement(qe,null,r.a.createElement(Ke,{sharedState:this.state.sharedState})),r.a.createElement(Fe,{sharedState:this.state.sharedState,backToMenu:this.transitionToMenu,showExperimentInfo:function(){return e.setState({modalIsOpen:!0})}})),r.a.createElement(v.a,{position:"bottom-center",autoClose:5e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!1,pauseOnHover:!0}));case"reset":return r.a.createElement("p",null,"...")}}}]),t}(o.Component);i.a.render(r.a.createElement(tt,null),document.getElementById("root"))}},[[331,1,2]]]);
//# sourceMappingURL=main.8de5134f.chunk.js.map