{"version":3,"sources":["assets/CrimsonText-Regular.ttf","assets/CrimsonText-Bold.ttf","assets/logo.png","assets/logs lazy /^/.*/.json$/ groupOptions: {} namespace object","components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/StyleButton.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/WordCountPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","logging.js","shared_state.js","components/loadproject/LogLoadButton.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","components/experiment/TimelineEntry.js","components/experiment/LogExploreTimeline.js","components/experiment/SlideOutPane.js","components/experiment/ExperimentInfo.js","components/loadproject/PreTaskSection.js","components/loadproject/IntroSection.js","App.js","index.js"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","t","keys","Object","OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","this","hidePopup","bind","div","document","createElement","classList","add","appendChild","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","remove","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","node","insertSectionBlock","text","longText","logger","logEvent","removeFirstNode","value","nodes","size","link","Block","create","type","data","node_id","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","removeNodeByKey","get","key","handleMouseUp","clickedNode","isOverHalf","resetPos","getGraphNode","focus","getParent","moveToStartOfNode","moveBackward","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","deleteNode","old","new","setNodeByKey","newStyle","moveToRangeOfNode","graphNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","getEmptyParagraph","wrapBlockByKey","insertInline","insertText","moveForward","convertToInline","querySelector","removeDocNode","StyleButton","props","onClick","Component","LinkNode","state","hover","externalHover","setHover","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","addGraphNode","position","moveTo","blur","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","innerDiv","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","blockTarget","getClientOffset","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","dragOverCurrent","onMouseOver","onMouseUp","onMouseMove","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","destOffset","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","wordCount","count","getBlocks","words","toString","countWords","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","n","r","s","u","require","a","i","f","l","call","1","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","x2centre","grad","vals","rightLeftCalc","topBotCalc","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","Array","isArray","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","connector_objs","temp_arrows","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","show","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","dest","temp_id","graphPane","getNodeById","dest_node","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","updateName","newValue","substring","finishEditing","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","removeChild","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","setArrowColour","selected_option","newRelation","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","zoomCanvasTo","isOnGraph","annotatedOrder","getNodeId","translate","dropShadow","radius","arrow_hitbox","editRect","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","editText","doNotDeleteIfEmptyText","setIsOnGraph","showAnnotatedOrder","isFromJSON","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","rectHeight","annotatedOrderText","delete_if_empty_text","orderAnnotate","annotatedNumbers","num","getNextAnnotateNum","textarea","preEditText","screen_coords","display","scrollHeight","save_changes","updateDocShortText","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","$el","panZoom","zoomMin","zoomMax","zoomFactor","level","pos","cb","zoom","runner","animate","duration","ease","after","zone","root_point","doc","nodesSvgGroup","numTempNodes","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","blurActiveElement","setAttribute","loadNodesFromJSON","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","isSvgCoords","el","db","Dexie","version","stores","projects","EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY","Logger","db_id","shouldLogToConsole","conditions","logToConsole","JSON","stringify","stateIsDirty","getLog","events","timestamp","Date","setLog","save","forceLog","saves","project","catch","err","msg","SharedState","onDataLoad","getProjectThen","doc_value","graph_value","logExplore","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getArgumentMarkdown","downloadExperimentData","mapToJSON","exportPDF","exploreNext","explorePrev","exploreLog","makeNodeReport","exportAnnotatedLog","explodeNodes","onbeforeunload","getStateIsDirty","returnValue","getEditor","downloadJSON","filename","sort","b","annotatedNum","scenario","localStorage","factSheetURL","open","mapFromJSON","projectName","lastSavedDocumentState","changes","idExists","info","logSaveState","message","saveIndex","transitionToEditor","nodeReport","linkedTexts","unlinkedTexts","linked","unlinked","linkedCharsProportion","trim","linkedWords","unlinkedWords","linkedWordProportion","rawValue","nodeReports","parse","setItem","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","preTaskSubmission","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","file","Blob","downloadBlob","blob","href","URL","createObjectURL","download","getReactPdfDocument","markdown","Font","register","family","fonts","src","CrimsonText","CrimsonTextBold","fontWeight","styles","StyleSheet","page","fontFamily","paddingBottom","heading","textDecoration","startsWith","pdf","toBlob","getArgumentHTML","regex","replacement","innerText","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LogLoadButton","process","participant_id","loadLog","alt","LoadProject","loadProject","updateProjectsFromDb","onDropLogFiles","title","files","reader","FileReader","onabort","onerror","onload","stored","logs","allLogs","newLog","result","readAsText","ExperimentControls","backToMenu","TimelineEntry","theClass","isExploreHead","timestampFormatted","LogExploreTimeline","exploreHead","moveExploreHead","exploreEvent","setDocValue","handleKeyDown","orderedLogs","pastExploreHead","lastDocChangeContent","moveToRangeOfDocument","moveToStartOfDocument","hasNotBeenExplored","updateSvgElement","addTempNode","getConnectorObjectConnecting","addTempArrow","sourceDestString","shift","keyCode","markdown_events","document_content_markdown","doc_change","concat","getDate","time","makeEntry","SlideOutPane","addClosed","cn","ExperimentInfo","question","viewFactSheet","PreTaskSection","q1","q2","q3","handleChange","handleSubmit","questions","shouldReturn","questionValue","alert","transitionToMenu","paddingTop","onSubmit","rows","IntroSection","Logo","Modal","setAppElement","modalStyles","marginRight","maxWidth","maxHeight","App","phase","location","search","URLSearchParams","getStorageUsed","newSharedState","resetFirst","finishCondition","navigator","storage","estimate","storageUsed","usage","quota","toPrecision","isMobile","autoload","isOpen","modalIsOpen","contentLabel","onRequestClose","DndProvider","backend","Backend","defaultSize","showExperimentInfo","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover"],"mappings":"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","file":"static/js/main.233fd698.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Regular.62f10d46.ttf\";","module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Bold.89b16aa6.ttf\";","module.exports = __webpack_public_path__ + \"static/media/logo.510deb2b.png\";","var map = {\n\t\"./1.json\": [\n\t\t637,\n\t\t3\n\t],\n\t\"./10.json\": [\n\t\t638,\n\t\t4\n\t],\n\t\"./11.json\": [\n\t\t639,\n\t\t5\n\t],\n\t\"./12.json\": [\n\t\t640,\n\t\t6\n\t],\n\t\"./14.json\": [\n\t\t641,\n\t\t7\n\t],\n\t\"./15.json\": [\n\t\t642,\n\t\t8\n\t],\n\t\"./17.json\": [\n\t\t643,\n\t\t9\n\t],\n\t\"./18.json\": [\n\t\t644,\n\t\t10\n\t],\n\t\"./1old.json\": [\n\t\t645,\n\t\t11\n\t],\n\t\"./2.json\": [\n\t\t646,\n\t\t12\n\t],\n\t\"./21.json\": [\n\t\t647,\n\t\t13\n\t],\n\t\"./22.json\": [\n\t\t648,\n\t\t14\n\t],\n\t\"./23.json\": [\n\t\t649,\n\t\t15\n\t],\n\t\"./25.json\": [\n\t\t650,\n\t\t16\n\t],\n\t\"./26.json\": [\n\t\t651,\n\t\t17\n\t],\n\t\"./3.json\": [\n\t\t652,\n\t\t18\n\t],\n\t\"./4.json\": [\n\t\t653,\n\t\t19\n\t],\n\t\"./5.json\": [\n\t\t654,\n\t\t20\n\t],\n\t\"./6.json\": [\n\t\t655,\n\t\t21\n\t],\n\t\"./7.json\": [\n\t\t656,\n\t\t22\n\t],\n\t\"./8.json\": [\n\t\t657,\n\t\t23\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 3);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 624;\nmodule.exports = webpackAsyncContext;","export default class OptionPopup {\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\n        this.hidePopup = this.hidePopup.bind(this)\n\n        this.div = document.createElement(\"div\");\n        this.div.classList.add(\"option-popup-div\");\n        this.div.appendChild(this.generateTable(entries, callback, selected));\n        this.div.style.left = x + \"px\";\n        this.div.style.top = y + \"px\";\n\n        if (parent === undefined) {\n            parent = document.getElementById(\"graph\");\n        }\n        parent.appendChild(this.div);\n\n        // prevent the popup from showing up partially offscreen\n        const rect = this.div.getBoundingClientRect()\n        if (rect.right > window.innerWidth) {\n            this.div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\n        }\n        if (rect.bottom > window.innerHeight) {\n            this.div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\n        }\n\n        if (shouldHideOnClickOutside) {\n            setTimeout(() => this.hideOnClickOutside(this.div), 0.01);\n        }\n    }\n\n    generateTable(entries, callback, selected) {\n        var table = document.createElement(\"table\");\n        entries.forEach(entry => {\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\n\n            var row = table.insertRow();\n            row.classList.add(\"option-row\");\n            if (entry.name === selected) {\n                row.classList.add(\"option-row-selected\");\n            }\n\n            const selectItem = (e) => {\n                if (entry.isClickable) {                    \n                    callback(entry);\n                    this.hidePopup();\n                }\n            }\n\n            var colourCell = row.insertCell();\n            colourCell.textContent = entry.symbol;\n            colourCell.style.color = entry.colour;\n            colourCell.style.fontSize = \"150%\";\n            colourCell.style.padding = '10px'\n            \n            var nameCell = row.insertCell();\n            nameCell.classList.add('option-cell')\n            nameCell.textContent = entry.name\n\n            colourCell.addEventListener('click', selectItem)\n            nameCell.addEventListener('click', selectItem)\n\n            if (entry.buttons) {\n                entry.buttons.forEach(buttonEntry => {\n                    var buttonCell = row.insertCell()\n                    var button = document.createElement('BUTTON')\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\n                    button.className = \"pure-button\"\n                    button.style.padding = \"0px 10px 0px 10px\"\n                    buttonCell.appendChild(button)\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row, selected: entry.name === selected,\n                            hidePopup: this.hidePopup})\n                })\n            }\n        });\n\n        return table;\n    }\n\n    hidePopup() {\n        this.div.remove()\n    }\n\n    hideOnClickOutside(element) {\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\n\n        const outsideClickListener = event => {\n            if (!element.contains(event.target) && isVisible(element)) {\n              element.remove();\n              removeClickListener()\n            }\n        }\n    \n        const removeClickListener = () => {\n            document.removeEventListener('click', outsideClickListener)\n        }\n    \n        document.addEventListener('click', outsideClickListener)\n        document.addEventListener('contextmenu', outsideClickListener)\n    }\n}","import { Block, Text } from 'slate';\nimport { toast } from 'react-toastify';\n\nexport default function GraphPlugin(options) {\n    return {\n        onMouseUp(event, editor, next) {\n            var draggedNode = editor.getSharedState().draggedNode;\n\n            if (draggedNode) {\n                draggedNode.resetPos();\n\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\n                    toast.error('You can\\'t add the same node twice!')\n                    console.log('Duplicate - editor')\n                } else {\n                    const target = editor.findEventRange(event)\n                    if (target) {\n                        editor.select(target)\n\n                        // prevent insertion inside an inline link\n                        // (insertion inside a section is fixed by schema)\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\n                        if (linkNode) {\n                            editor.moveToEndOfNode(linkNode)\n                        }\n\n                        addSection(draggedNode, editor)\n                    }\n                }\n            }\n            next();\n        },\n        \n        onBlur(event, editor, next) {\n            editor.deselect();\n            next();\n        },\n\n        commands: {\n            removeGraphLink(editor, node) {\n                const document = editor.value.document\n                if (!document.hasNode(node.key)) {\n                    console.log('couldnt remove graph link, node doesnt exist');\n                    \n                    return\n                }\n\n                if (node.type === \"section\") {\n                    // move the children out from inside this section to be after it\n                    const section_index = editor.value.document.nodes.indexOf(node)\n                    if (section_index !== -1) {\n                        var child_index = 0;\n                        node.nodes.forEach(child => {\n                            if (!document.hasNode(child.key)) {\n                                return\n                            }\n\n                            const nodeStyle = node.data.get(\"nodeStyle\")\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\n                                editor.removeNodeByKey(child.key)\n                            } else {\n                                // offset varies because the link node has already been removed if body only\n                                const destOffset = (child_index === 1 && nodeStyle === \"Body only\") ? 1 : child_index + 1\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + destOffset)\n                            }\n\n                            child_index++\n                        });\n                    }\n                    editor.removeNodeByKey(node.key)\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\n                }\n            }\n        }\n    }\n}\n\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\n\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\n\n    editor.getSharedState().logger.logEvent({\n        'type': 'doc_create_from_node', \n        'node_id': draggedNode.id, \n        'short_text': draggedNode.text, \n        'long_text': draggedNode.longText\n    });\n}\n\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\n    // if its an empty document, prevent a blank node being shown above the section added\n    const removeFirstNode = editor.value.document.nodes.size === 1 && editor.value.document.text === \"\"\n    \n    var link = Block.create({\n        type: 'link',\n        data: {node_id: id},\n        nodes: [Text.create({text: text})]\n    })\n\n    var body = Block.create({\n        type: 'body',\n        data: {node_id: id},\n        nodes: [Text.create({text: longText})]\n    })\n\n    var section = Block.create({\n        type: 'section',\n        data: {node_id: id, nodeStyle: initialNodeStyle},\n        nodes: [link, body]\n    })\n\n    editor.insertBlock(section);\n    editor.moveToEndOfNode(section)\n\n    if (removeFirstNode) {\n        editor.removeNodeByKey(editor.value.document.nodes.get(0).key)\n    }\n\n    return section\n}\n\nexport function handleMouseUp(editor, clickedNode, isOverHalf) {\n    var draggedNode = editor.getSharedState().draggedNode;\n\n    if (draggedNode) {\n        draggedNode.resetPos();\n\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\n            toast.error('You can\\'t add the same node twice!')\n            console.log('Duplicate - node');\n            \n        } else {\n            const { value } = editor\n            const { document } = value\n            editor.focus()\n\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\n                clickedNode = document.getParent(clickedNode);\n            }\n\n            if (isOverHalf) {\n                editor.moveToEndOfNode(clickedNode);\n            } else {\n                editor.moveToStartOfNode(clickedNode)\n                editor.moveBackward()\n            }\n\n            addSection(draggedNode, editor);\n\n            editor.getSharedState().draggedNode = false;\n            return true;\n        }\n    }\n}","import { Block } from 'slate';\nimport OptionPopup from '../graph/OptionPopup.js'\nimport { insertSectionBlock } from './GraphPlugin.js';\n\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\n    var entries = [\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"⌶\"},\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"▤\"},\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"▔\"},\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"▂\"},\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\n    ]\n\n    if (entriesToHide) {\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\n    }\n\n    event.preventDefault();\n\n    const onOptionSelect = (selectedEntry) => {\n        const selected = selectedEntry.name\n        if (selected === \"Delete\") {\n            editor.getSharedState().logger.logEvent({\n                type: \"doc_node_delete\",\n                id: node.data.get(\"node_id\")\n            });\n            deleteNode(node, editor);\n        } else {\n            var nodeStyle = node.data.get(\"nodeStyle\")\n            if (!nodeStyle) {\n                nodeStyle = \"Inline\"\n            }\n\n            editor.getSharedState().logger.logEvent({\n                type: \"doc_node_change_format\",\n                old: nodeStyle,\n                new: selected,\n                id: node.data.get(\"node_id\")\n            });\n\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\n                convertFromInline(node, editor, selected)\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\n                convertToInline(node, editor, selected)\n            }\n        }\n    }\n\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\n}\n\nexport function deleteNode(node, editor) {\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\n\n    editor.removeNodeByKey(node.key)\n\n    if (editor.value.document.nodes.size === 0) {\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\n    }\n}\n\nfunction convertFromInline(node, editor, newStyle) {\n    editor.moveToRangeOfNode(node);\n    const parent = editor.value.document.getParent(node.key)\n    if (parent && parent.text === node.text) {\n        editor.moveToRangeOfNode(parent)\n    }\n\n    const graphNode = editor.getSharedState().getGraphNode(node.data.get('node_id'))\n    const longText = graphNode && graphNode.longText ? graphNode.longText : \"\"\n\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, longText, newStyle)    \n}\n\nfunction getEmptyParagraph() {\n    return Block.create({\n        type: 'paragraph'\n    })\n}\n\nfunction convertToInline(node, editor) {\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\n    // need to get 0th child because previous of section is the body inside it\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\n\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\n    if (!prev && !next) {\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\n    }\n\n    editor.moveToRangeOfNode(node)\n\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\n        editor.wrapBlockByKey(node.key, \"paragraph\")\n        editor.removeNodeByKey(node.key)\n    } else {\n        editor.removeNodeByKey(node.key)\n    }\n\n    editor.insertInline({\n            type: \"link\",\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\n        })\n        .insertText(shortText)\n    \n    // prevent rare bug where style is changed inline > section > inline, and doc-graph link is severed\n    setTimeout(() => {editor.focus(); editor.moveForward(); editor.moveBackward()}, 0)\n}\n\nexport const getNodeStyleClass = (verbose) => {\n    switch (verbose) {\n        case \"Heading only\":\n            return \" hide-body\"\n\n        case \"Body only\":\n            return \" hide-heading\"\n    \n        default:\n            return \"\";\n    }\n}","import React, { Component } from 'react';\nimport { showNodeSwitchMenu } from './NodeSwitch';\n\nexport default class StyleButton extends Component {\n    render() {\n        return (<button \n                    className={'style-button pure-button '\n                                 + ((this.props.nodeStyle === 'section') ? 'style-button-section' : 'style-button-inline')}\n                    onClick={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\n                        <p className='eye-icon'></p>\n                </button>)\n    }\n}","import React, { Component } from 'react'\nimport StyleButton from '../StyleButton'\n\nexport default class LinkNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false,\n        }\n        \n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {     \n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"link_mouse\", newHover);\n        }\n\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        const { value } = this.props.editor;\n        const { document, selection } = value;\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"link_cursor\", cursorInside)\n        }\n        \n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\n        var classes = \"node-link\" + hoverClass;\n\n        if (this.props.linkStyle === \"heading\") {\n            return (\n                <p className={classes} {...this.props.attributes}>\n                    <u><b>{this.props.children}</b></u>\n                </p>\n            );\n\n        } else if (this.props.linkStyle === \"inline\") {\n            return (\n                <p className={classes} {...this.props.attributes}\n                        onMouseEnter={() => this.setHover(true)} \n                        onMouseLeave={() => this.setHover(false)}>\n                    {this.props.children}\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='inline' />}\n                </p>\n            );\n        }\n    }\n}","import React, { Component } from 'react';\n\nexport default class BodyNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false\n        }\n        this.setHover = this.setHover.bind(this);\n        this.selectNode = props.selectNode;\n    }\n\n    setHover(newHover) {\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\n\n        const { value } = this.props.editor;\n        const { document, selection } = value;\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"body_cursor\", cursorInside);\n            node.setHoverer(\"body_mouse\", this.state.hover);\n        }\n\n        if (this.props.isEmpty) {\n                return (\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\n                        Type some text...{this.props.children}\n                    </p>\n                );\n        } else {\n            return (\n                <p className={classes} {...this.props.attributes}>\n                    {this.props.children}\n                </p>\n            );\n        }\n    }\n}","export const ItemTypes = {\n    BLOCK: \"block\",\n}","import { DragSource } from 'react-dnd';\nimport { ItemTypes } from '../../dragtypes';\nimport { addSection } from './GraphPlugin.js'\n\nconst blockSource = {\n    canDrag(props) {\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\n        return props.editor.value.selection.isCollapsed\n    },\n\n    beginDrag(props) {\n      // Return the data describing the dragged item\n      const item = { id: props.node.id, node: props.node }\n      return item\n    },\n\n    endDrag(props, monitor, component) {\n        if (!monitor.didDrop()) {            \n            return\n        }\n\n        const dropResult = monitor.getDropResult()\n        const sharedState = props.editor.getSharedState()\n\n        if (dropResult.droppedOnGraph) {\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\n            const draggedNode = {\n                id: graphNode.id,\n                node: graphNode,\n                text: \"\",\n                longText: props.node.text\n            }\n            props.editor.moveTo(props.node.key)\n            \n            addSection(draggedNode, props.editor, \"Body only\")\n            props.editor.removeNodeByKey(props.node.key)\n            props.editor.blur()\n        } else {\n            const document = props.editor.value.document;\n            const blockParent = document.getParent(props.node.key);\n            const blockIndex = blockParent.nodes.indexOf(props.node);\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\n\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\n\n            sharedState.logger.logEvent({\n                'type': 'reorder',\n                'id': props.node.data.get('node_id'),\n                'old_index': blockIndex,\n                'new_index': dropResult.indexDroppedOn + indexShift,\n            });\n        }\n    },\n  }\n\n/**\n * Specifies which props to inject into your component.\n */\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDragSource: connect.dragSource(),\n        dragPreview: connect.dragPreview(),\n        isDragging: monitor.isDragging(),\n    }\n}\n\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\nimport { DropTarget } from \"react-dnd\";\nimport { ItemTypes } from \"../../dragtypes\";\n\nexport function isOverHalf(component, event) {\n    // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\n    const outerDiv = ReactDOM.findDOMNode(component)        \n    const outerRect = outerDiv.getBoundingClientRect()\n    \n    var innerDiv;\n    for (let item of outerDiv.children) {\n        if (item.classList.contains('plain-block') || item.classList.contains('section')) {\n            innerDiv = item;\n            break;\n        }\n    }\n\n    if (!innerDiv) {\n        console.log('error: couldn\\'t find the inner div!');\n        return\n    }\n    const innerRect = innerDiv.getBoundingClientRect()       \n\n    // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\n    const offset = (innerRect.y - outerRect.y)\n    var newState = false\n    if (event.clientY + offset > (innerRect.y + innerRect.height / 2)) {\n        newState = true\n    }\n    \n    if (component.state.overHalf !== newState) {\n        component.setState({overHalf: newState});\n    }\n}\n\nconst blockTarget = {\n    hover(props, monitor, component) {\n        isOverHalf(component, { clientY: monitor.getClientOffset().y })\n    },\n    drop(props, monitor, component) {\n        const document = props.editor.value.document;\n        const blockParent = document.getParent(props.node.key);\n        const blockIndex = blockParent.nodes.indexOf(props.node);\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\n    },\n}\n\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDropTarget: connect.dropTarget(),\n        // You can ask the monitor about the current drag state:\n        isOver: monitor.isOver(),\n        isOverCurrent: monitor.isOver({ shallow: true }),\n        canDrop: monitor.canDrop(),\n        itemType: monitor.getItemType(),\n    }\n}\n\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\nimport DragifyBlock from '../DragifyBlock';\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\nimport { handleMouseUp } from '../GraphPlugin';\nimport { getNodeStyleClass } from '../NodeSwitch';\nimport StyleButton from '../StyleButton';\n\nclass SectionNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false,\n            overHalf: false,\n        }\n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {     \n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"section_mouse\", newHover);\n        }\n\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\n\n        const value = this.props.editor.value\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\n\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\n\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\n\n        return connectDropTarget(\n            <div className='block-outer-div'\n                onMouseEnter={() => this.setHover(true)}\n                onMouseOver={() => this.setHover(true)}\n                onMouseLeave={() => this.setHover(false)} \n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}}\n                onMouseMove={(e) => isOverHalf(this, e)}>\n\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='section' />}\n                    {this.props.children}\n                </div>\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\n\n            </div>\n        );\n    }\n}\n\nexport default DragifyBlock(DropifyBlock(SectionNode))","\nimport { getEventTransfer } from 'slate-react';\n\nexport default function LoggingPlugin(options) {\n    return {\n        onCopy(event, editor, next) {\n            editor.getSharedState().logger.logEvent({\n                type: \"copy\",\n                content: editor.value.fragment.text\n            });\n            \n            next();\n        },\n\n        onCut(event, editor, next) {\n            editor.getSharedState().logger.logEvent({\n                type: \"cut\",\n                content: editor.value.fragment.text\n            });\n            \n            next();\n        },\n\n        onPaste(event, editor, next) {\n            var transfer = getEventTransfer(event);\n\n            editor.getSharedState().logger.logEvent({\n                type: \"paste\",\n                paste_type: transfer.type,\n                content: transfer.fragment ? transfer.fragment.text : \"\",\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\n            });\n            \n            next();\n        },\n    }\n}","import React, { Component } from 'react';\nimport DragifyBlock from '../DragifyBlock';\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\nimport { handleMouseUp } from '../GraphPlugin';\n\nclass PlainBlockNode extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            hover: false\n        }\n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {\n        this.setState({hover: newHover});\n    }\n\n    render() {\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\n\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\n\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\n\n        return connectDropTarget(\n            <div className='block-outer-div'\n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}} \n                onMouseEnter={() => this.setHover(true)}\n                onMouseOver={() => this.setHover(true)}\n                onMouseLeave={() => this.setHover(false)}\n                onMouseMove={(e) => isOverHalf(this, e)}>\n\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\n                    {this.props.children}\n                </div>\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\n\n            </div>\n        );\n    }\n}\n\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\nimport { cx, css } from 'emotion'\n\nexport const Button = React.forwardRef(\n  ({ className, active, reversed, ...props }, ref) => (\n    <span\n      {...props}\n      ref={ref}\n      className={cx(\n        className,\n        css`\n          cursor: pointer;\n          color: ${reversed\n            ? active ? 'white' : '#aaa'\n            : active ? 'black' : '#ccc'};\n        `\n      )}\n    />\n  )\n)\n\nexport const EditorValue = React.forwardRef(\n  ({ className, value, ...props }, ref) => {\n    const textLines = value.document.nodes\n      .map(node => node.text)\n      .toArray()\n      .join('\\n')\n    return (\n      <div\n        ref={ref}\n        {...props}\n        className={cx(\n          className,\n          css`\n            margin: 30px -20px 0;\n          `\n        )}\n      >\n        <div\n          className={css`\n            font-size: 14px;\n            padding: 5px 20px;\n            color: #404040;\n            border-top: 2px solid #eeeeee;\n            background: #f8f8f8;\n          `}\n        >\n          Slate's value as text\n        </div>\n        <div\n          className={css`\n            color: #404040;\n            font: 12px monospace;\n            white-space: pre-wrap;\n            padding: 10px 20px;\n            div {\n              margin: 0 0 0.5em;\n            }\n          `}\n        >\n          {textLines}\n        </div>\n      </div>\n    )\n  }\n)\n\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\n  <span\n    {...props}\n    ref={ref}\n    className={cx(\n      'material-icons',\n      className,\n      css`\n        font-size: 18px;\n        vertical-align: text-bottom;\n      `\n    )}\n  />\n))\n\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\n  <div\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        white-space: pre-wrap;\n        margin: 0 -20px 10px;\n        padding: 10px 20px;\n        font-size: 14px;\n        background: #f8f8e8;\n      `\n    )}\n  />\n))\n\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\n  <div\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        & > * {\n          display: inline-block;\n        }\n\n        & > * + * {\n          margin-left: 15px;\n        }\n      `\n    )}\n  />\n))\n\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\n  <Menu\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        position: relative;\n        padding: 1px 18px 17px;\n        margin: 0 -20px;\n        border-bottom: 2px solid #eee;\n        margin-bottom: 20px;\n      `\n    )}\n  />\n))","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { css } from 'emotion'\nimport { Button, Icon, Menu } from './SlateComponents.js'\n\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\n\nconst MarkButton = ({ editor, type, icon }) => {\n  const { value } = editor\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\n  return (\n    <Button\n      reversed\n      active={isActive}\n      onMouseDown={event => {\n        event.preventDefault()\n        editor.setBlocks((isActive ? \"paragraph\" : type))\n\n        editor.getSharedState().logger.logEvent({\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\n      });\n      }}\n    >\n      <Icon>{icon}</Icon>\n    </Button>\n  )\n}\n\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\n  const root = window.document.getElementById('root')\n  return ReactDOM.createPortal(\n    <Menu\n      ref={ref}\n      className={css`\n        padding: 8px 7px 6px;\n        position: absolute;\n        z-index: 1;\n        top: -10000px;\n        left: -10000px;\n        margin-top: -6px;\n        opacity: 0;\n        background-color: #222;\n        border-radius: 4px;\n        transition: opacity 0.25s;\n      `}\n    >\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\n    </Menu>,\n    root\n  )\n})\n\n\nclass HoveringMenu extends React.Component {\n\n  menuRef = React.createRef()\n\n  componentDidMount = () => {\n    this.updateMenu()\n  }\n\n  componentDidUpdate = () => {\n    this.updateMenu()\n  }\n\n  updateMenu = () => {\n    const menu = this.menuRef.current\n    if (!menu) return\n\n    const value = this.props.editor.value\n    const { fragment, selection } = value\n\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\n      menu.removeAttribute('style')\n      return\n    }\n\n    const native = window.getSelection()\n    const range = native.getRangeAt(0)\n    const rect = range.getBoundingClientRect()\n    menu.style.opacity = 1\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\n\n    menu.style.left = `${rect.left +\n      window.pageXOffset -\n      menu.offsetWidth / 2 +\n      rect.width / 2}px`\n  }\n\n  render = (props, editor, next) => {\n    return (\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\n    )\n  }\n}\n\n\nexport default function HoveringMenuPlugin(options) {\n    return {\n        renderEditor (props, editor, next) {\n            const children = next()\n            return (\n              <React.Fragment>\n                {children}\n                <HoveringMenu editor={editor} />\n              </React.Fragment>\n            )\n          },\n\n        renderBlock (props, editor, next) {\n            switch (props.node.type) {\n            case 'heading':\n                return <u><b>{props.children}</b></u>\n            default:\n                return next()\n            }\n        },\n    }\n}","import { Block, Text } from 'slate';\n\nexport const schema = {\n    inlines: {\n        link: {\n            parent: [{type: ''}, {type: 'paragraph'}],\n\n            normalize: (editor, error) => {\n                switch (error.code) {\n                    case 'parent_type_invalid':\n                        editor.unwrapInlineByKey(error.node.key)\n                        return\n\n                    default:\n                        console.log(\"unhandled link inline err \" + error);\n                }\n            }\n        }\n    },\n\n    blocks: {\n        section: {\n            parent: {object: \"document\"},\n            nodes: [\n                {\n                    match: {type: 'link'},\n                    min: 1,\n                    max: 1,\n                },\n                {\n                    match: {type: 'body'},\n                    min: 1,\n                    max: 1,\n                }\n            ],\n\n            normalize: (editor, error) => {\n                switch (error.code) {\n                    case 'child_max_invalid':\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \n                        // this can happen if the enter key is pressed (splits the current node)\n                        moveBlockAfterSection(editor, error.child, error.node)\n                        editor.setNodeByKey(error.child.key, 'paragraph')\n                        return\n\n                    case 'child_type_invalid':\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\n                            if (linkNode) {\n                                const textNode = linkNode.getLastText()\n                                const offset = textNode.text ? textNode.text.length : 0\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\n                            } else {\n                                addMissing(editor, error, \"link\", error.child.text)\n                            }\n                        }\n\n                        editor.removeNodeByKey(error.child.key)\n                        \n                        return\n                    \n                    case 'child_min_invalid':\n                        var hasChildTypes = [];\n                        error.node.nodes.forEach(node => {\n                            hasChildTypes.push(node.type)\n                        })\n                        \n                        if (!hasChildTypes.includes(\"link\")) {\n                            addMissing(editor, error, \"link\")\n                        }\n\n                        if (!hasChildTypes.includes(\"body\")) {\n                            addMissing(editor, error, \"body\")\n                        }\n\n                        return\n                    \n                    case 'parent_object_invalid':\n                        // a section has ended up inside another section - shift it out\n                        moveBlockAfterSection(editor, error.node, error.parent)\n                        return\n\n                    default:\n                        console.log(\"unhandled section schema err \" + error);\n                        \n                        return\n                }\n            }\n        },\n    }\n}\n\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\n    if (sectionIndex === -1) {\n        return\n    }\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\n}\n\nfunction addMissing(editor, error, nodeType, text=\"\") {\n    const node_id = error.node.data.get(\"node_id\")\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\n    if (!text) {\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\n    }\n    const index = nodeType === \"link\" ? 0 : 1\n\n    addBlock(editor, error.node, nodeType, index, node_id, text)\n}\n\nfunction addBlock(editor, parent, nodeType, index, id, text) {\n    var block = Block.create({\n        type: nodeType,\n        data: {node_id: id},\n        nodes: [Text.create({'text': text})]\n    })\n    editor.insertNodeByKey(parent.key, index, block);\n    \n}","import React from 'react';\nimport { Editor } from 'slate-react';\nimport { Value } from 'slate';\nimport NodePlugin from './NodePlugin.js';\nimport GraphPlugin from './GraphPlugin.js';\nimport LoggingPlugin from './LoggingPlugin.js';\nimport ReorderPlugin from './ReorderPlugin.js';\nimport HoveringMenu from './HoveringMenu.js';\nimport WordCountPlugin from './WordCountPlugin.js';\nimport { schema } from './Schema.js'\n\nconst plugins = {\n    'graph': [\n        LoggingPlugin(),\n        GraphPlugin(),\n        NodePlugin(),\n        ReorderPlugin(),\n        WordCountPlugin(),\n    ],\n    'plain': [\n        LoggingPlugin(),\n        HoveringMenu(),\n    ]\n};\n\nconst emptyValue = Value.fromJSON({\n    document: {\n        nodes: [\n            {\n                object: 'block',\n                type: 'paragraph',\n                nodes: [\n                    {\n                        object: 'text',\n                        text: '',\n                    },\n                ],\n            },\n        ],\n    },\n});\n\nclass DocEditor extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.props.sharedState.editor_ref = React.createRef();\n    }\n\n    componentDidMount() {\n        const sharedState = this.props.sharedState\n        sharedState.getSavedDocValue((savedValue) => {\n            this.setState({\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\n            }, sharedState.editorHasLoaded)\n        })\n    }\n\n    state = {\n        value: undefined, // don't display editor until the db's saved document loads\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\n    }\n    \n    queries = {\n        getSharedState: () => {\n            return this.props.sharedState;\n        },\n        getValue: () => {\n            return this.state.value;\n        },\n        mapHasLoaded: () => {\n            this.setState({ mapHasLoaded: true })\n        }\n    }\n\n    onChange = ({ value }) => {\n        this.setState({ value })\n    }\n\n    render() {\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\n\n        if (this.state.value !== undefined) {\n            return <Editor\n                className={\"slate-editor\" + plainClass}\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\n                ref={this.props.sharedState.editor_ref}\n                schema={schema}\n                plugins={plugins[this.props.sharedState.condition]}\n                queries={this.queries}\n                value={this.state.value}\n                onChange={this.onChange}\n                placeholder=\"Write your document here...\"\n                spellCheck={true}\n            />\n        } else {\n            return <p></p>\n        }\n    }\n}\n\nexport default DocEditor;","import SVG from 'svg.js';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n(function e(t, n, r) {\n    function s(o, u) {\n        if (!n[o]) {\n            if (!t[o]) {\n                // eslint-disable-next-line no-sequences\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\n                var n = t[o][1][e];return s(n ? n : e);\n            }, l, l.exports, e, t, n, r);\n        }return n[o].exports;\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\n        s(r[o]);\n    }return s;\n})({ 1: [function (require, module, exports) {\n        // Dependencies\n        var Id = require(\"idy\"),\n            SetOrGet = require(\"set-or-get\"),\n            IterateObject = require(\"iterate-object\"),\n            Deffy = require(\"deffy\");\n\n        // Internal cache\n        var _connections = {},\n            _betweenTwoBubbles = {},\n            container = null,\n            markers = null;\n\n        function delete_connectable(con) {\n            con.line.remove();\n            con.marker.remove();\n\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\n\n            var toString = function() {\n                var ids = [con.source.id(), con.target.id()],\n                    id1 = ids.join(\"->\"),\n                    id2 = ids.reverse().join(\"->\");\n\n                con._ = con.id = id1;\n\n                if (_betweenTwoBubbles[id2]) {\n                    con._ = id2;\n                    return id2;\n                }\n\n                con.id = id1;\n                return id1;\n            }\n\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\n        }\n\n        /**\n         * connectable\n         * Connects two elements.\n         *\n         * @name connectable\n         * @function\n         * @param {Object} options An object containing the following fields:\n         *\n         *  - `container` (SVGElement): The line elements container.\n         *  - `markers` (SVGElement): The marker elements container.\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\n         *\n         * @param {SVGElement} elmTarget The target SVG element.\n         * @return {Object} The connectable object containing:\n         *\n         *  - `source` (SVGElement): The source element.\n         *  - `target` (SVGElement): The target element.\n         *  - `line` (SVGElement): The line element.\n         *  - `marker` (SVGElement): The marker element.\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\n         *  - [`update` (Function)](#update)\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\n         */\n        function connectable(options, elmTarget) {\n\n            var con = {};\n\n            if (elmTarget === undefined) {\n                elmTarget = options;\n                options = {};\n            }\n\n            container = options.container || container;\n            var elmSource = this;\n            markers = options.markers || markers;\n\n            options.k = options.k || 100;\n            options.kk = options.kk || 10;\n\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\n                markerId = \"triangle-\" + Id(),\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\n            \n            if (options.specialCoords) {\n                line.addClass('connector-line');\n            }\n\n            marker.attr({\n                id: markerId,\n                viewBox: \"0 0 10 10\",\n                refX: \"0\",\n                refY: \"5\",\n                markerUnits: \"strokeWidth\",\n                markerWidth: \"4\",\n                markerHeight: \"5\"\n            });\n\n            marker.path().attr({\n                d: \"M 0 0 L 10 5 L 0 10 z\"\n            });\n\n            // Append the SVG elements\n            con.source = elmSource;\n            con.target = elmTarget;\n            con.line = line;\n            con.marker = marker;\n\n\n            if (options.specialCoords) {\n                // remove this when node is deleted\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\n            }\n\n            SetOrGet(_connections, con.source.id(), []).push(con);\n            SetOrGet(_connections, con.target.id(), []).push(con);\n\n            SetOrGet(_betweenTwoBubbles, {\n                toString: function toString() {\n                    var ids = [con.source.id(), con.target.id()],\n                        id1 = ids.join(\"->\"),\n                        id2 = ids.reverse().join(\"->\");\n\n                    con._ = con.id = id1;\n\n                    if (_betweenTwoBubbles[id2]) {\n                        con._ = id2;\n                        return id2;\n                    }\n\n                    con.id = id1;\n                    return id1;\n                }\n            }, []).push(con);\n            \n\n            /**\n             * computeLineCoordinates\n             * The function that computes the new coordinates.\n             * It can be overriden with a custom function.\n             *\n             * @name computeLineCoordinates\n             * @function\n             * @param {Connectable} con The connectable instance.\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\n             */\n            con.computeLineCoordinates = function (cons) {\n\n                var output = [],\n                    l = cons.length;\n\n                IterateObject(cons, function (con, i) {\n\n                    var sT = con.source.transform(),\n                        tT = con.target.transform(),\n                        sB = con.source.bbox(),\n                        tB = con.target.bbox(),\n                        x1 = sT.x + sB.width / 2,\n                        y1 = sT.y + sB.height / 2,\n                        x2 = tT.x + tB.width / 2,\n                        y2 = tT.y + tB.height / 2,\n                        cx = (x1 + x2) / 2,\n                        cy = (y1 + y2) / 2,\n                        dx = Math.abs((x1 - x2) / 2),\n                        dy = Math.abs((y1 - y2) / 2),\n                        dd = null,\n                        out = {\n                        x1: x1,\n                        y1: y1,\n                        x2: x2,\n                        y2: y2,\n                        ex: x1,\n                        ey: y1\n                    };\n\n                    if (i !== (l - 1) / 2) {\n                        dd = Math.sqrt(dx * dx + dy * dy);\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                    }\n                    output.push(out);\n                });\n\n                return output;\n            };\n\n            if (options.specialCoords) {\n                con.computeLineCoordinates = function (cons) {\n\n                    var output = [],\n                        l = cons.length;\n\n                    IterateObject(cons, function (con, i) {\n\n                        var sT = con.source.transform(),\n                            tT = con.target.transform(),\n                            sB = con.source.bbox(),\n                            tB = con.target.bbox(),\n                            x1 = sT.x + sB.width / 2,\n                            y1 = sT.y + sB.height / 2 - 20;\n\n                        var xDiff = sT.x - tT.x;\n                        var yDiff = sT.y - tT.y;\n                        var x2, y2;\n\n                        var x2centre = tT.x + tB.width / 2\n                        var y2centre = tT.y + tB.height / 2\n\n                        var grad = (y2centre - y1) / ((x2centre - x1) === 0 ? 0.0000001 : (x2centre - x1))\n\n                        if (grad === 0) {\n                            grad = 0.0000001\n                        }\n\n                        var left = tT.x - 10\n                        var right = tT.x + tB.width - 30\n                        var top = tT.y - 10\n                        var bottom = tT.y + tB.height - 30\n                        \n                        var rightLeftCalc = () => {\n                            var x2 = xDiff < 0 ? left : right\n                            return { \n                                x: x2,\n                                y: ((x2 - x1) * grad) + y1\n                            }\n                        }\n\n                        var topBotCalc = () => {\n                            var y2 = yDiff < 0 ? top : bottom\n                            return {\n                                x: ((y2 - y1) * (1/grad)) + x1,\n                                y: y2\n                            }\n                        }\n\n                        var vals\n                        if (Math.abs(xDiff) >= Math.abs(yDiff)) {\n                            vals = rightLeftCalc()\n                            x2 = vals.x\n                            y2 = vals.y\n\n                            if (y2 > bottom || y2 < top) {\n                                vals = topBotCalc()\n                                x2 = vals.x\n                                y2 = vals.y\n                            }\n\n                        } else {\n                            vals = topBotCalc()\n                            x2 = vals.x\n                            y2 = vals.y\n\n                            if (x2 > right || x2 < left) {\n                                vals = rightLeftCalc()\n                                x2 = vals.x\n                                y2 = vals.y\n                            }\n                        }\n\n                        var cx = (x1 + x2) / 2,\n                            cy = (y1 + y2) / 2,\n                            dx = Math.abs((x1 - x2) / 2),\n                            dy = Math.abs((y1 - y2) / 2),\n                            dd = null,\n                            out = {\n                            x1: x1,\n                            y1: y1,\n                            x2: x2,\n                            y2: y2,\n                            ex: x1,\n                            ey: y1\n                        };\n\n                        if (i !== (l - 1) / 2) {\n                            dd = Math.sqrt(dx * dx + dy * dy);\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                        }\n                        output.push(out);\n                    });\n\n                    return output;\n                };\n            }\n\n            if (options.padEllipse) {\n                con.computeLineCoordinates = function (cons) {\n\n                    var output = [],\n                        l = cons.length;\n\n                    IterateObject(cons, function (con, i) {\n\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\n                            xR1,\n                            xR2,\n                            yR1,\n                            yR2,\n                            sT = con.source.transform(),\n                            tT = con.target.transform()\n\n                        if (elmS.tagName === \"circle\") {\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\n                        } else {\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\n\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\n                        }\n\n                        // Get centers\n                        var sx = sT.x + xR1 / 2,\n                            sy = sT.y + yR1 / 2,\n                            tx = tT.x + xR2 / 2,\n                            ty = tT.y + yR2 / 2\n\n                        // Calculate distance from source center to target center\n                        ,\n                            dx = tx - sx,\n                            dy = ty - sy,\n                            d = Math.sqrt(dx * dx + dy * dy)\n\n                        // Construct unit vector between centers\n                        ,\n                            ux = dx / d,\n                            uy = dy / d\n\n                        // Point on source circle\n                        ,\n                            cx1 = sx + xR1 * ux,\n                            cy1 = sy + yR1 * uy\n\n                        // Point on target circle\n                        ,\n                            cx2 = sx + (d - xR2 - 5) * ux,\n                            cy2 = sy + (d - yR2 - 5) * uy;\n\n                        var x1 = cx1 + xR1 / 2,\n                            y1 = cy1 + yR1 / 2,\n                            x2 = cx2 + xR2 / 2,\n                            y2 = cy2 + yR2 / 2\n                        // TODO\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\n                        //  , angle = 0\n                        ;\n\n                        //if (i !== (l - 1) / 2) {\n                        //    angle = step * (i + 1);\n                        //}\n\n\n                        //var xC1 = (sT.x + xR1)\n                        //  , yC1 = (sT.y + yR1)\n                        //  , xC2 = (tT.y + xR2)\n                        //  , yC2 = (tT.y + yR2)\n                        //  , ddx1 = x1 - xC1\n                        //  , ddy1 = y1 - yC1\n                        //  , ddx2 = x2 - xC2\n                        //  , ddy2 = y2 - yC2\n                        //  , cosAngle = Math.cos(angle)\n                        //  , sinAngle = Math.sin(angle)\n                        //  , cosAngleM = Math.cos(-angle)\n                        //  , sinAngleM = Math.sin(-angle)\n                        //  ;\n\n                        // TODO This should change the points to arrange them on the circle\n                        //\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\n\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\n\n                        // ===================\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\n\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\n\n                        var cx = (x1 + x2) / 2,\n                            cy = (y1 + y2) / 2,\n                            dd = null,\n                            out = {\n                            x1: x1,\n                            y1: y1,\n                            x2: x2,\n                            y2: y2,\n                            ex: x1,\n                            ey: y1\n                        };\n\n                        if (isNaN(out.x1)) {\n                            out.x1 = sT.x + xR1 * 2;\n                            out.y1 = sT.y + yR1 / 2;\n                            out.x2 = sT.x;\n                            out.y2 = out.y1;\n                            out.ex = (out.x1 + out.x2) / 2;\n                            out.ey = out.y1 - options.kk * (i + 1);\n                        } else {\n                            dx = Math.abs((x1 - x2) / 2);\n                            dy = Math.abs((y1 - y2) / 2);\n\n                            if (i !== (l - 1) / 2) {\n                                dd = Math.sqrt(dx * dx + dy * dy);\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                            }\n                        }\n\n                        output.push(out);\n                    });\n\n                    return output;\n                };\n            }\n\n            elmSource.cons = elmSource.cons || [];\n            elmSource.cons.push(con);\n\n            /**\n             * update\n             * Updates the line coordinates.\n             *\n             * @name update\n             * @function\n             * @return {undefined}\n             */\n            con.update = function () {\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\n                    results = con.computeLineCoordinates(cons);\n\n                IterateObject(results, function (r, i) {\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\n                });\n            };\n\n            con.update();\n            elmSource.on(\"dragmove\", con.update);\n            elmTarget.on(\"dragmove\", con.update);\n\n            /**\n             * setLineColor\n             * Sets the line color.\n             *\n             * @name setLineColor\n             * @function\n             * @param {String} color The new color.\n             * @param {Connectable} c The connectable instance.\n             * @return {undefined}\n             */\n            con.setLineColor = function (color, c) {\n                c = c || this;\n                c.line.stroke(color);\n                c.marker.fill(color);\n            };\n\n            return con;\n        }\n\n        if (typeof SVG === \"function\") {\n            SVG.extend(SVG.Element, {\n                connectable: connectable,\n                delete_connectable: delete_connectable\n            });\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\n            throw new Error(\"SVG.js is not loaded but it is required.\");\n        }\n\n        module.exports = connectable;\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\n        // Dependencies\n        var Typpy = require(\"typpy\");\n\n        /**\n         * Deffy\n         * Computes a final value by providing the input and default values.\n         *\n         * @name Deffy\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Anything|Function} def The default value or a function getting the\n         * input value as first argument.\n         * @param {Object|Boolean} options The `empty` value or an object containing\n         * the following fields:\n         *\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\n         *\n         * @return {Anything} The computed value.\n         */\n        function Deffy(input, def, options) {\n\n            // Default is a function\n            if (typeof def === \"function\") {\n                return def(input);\n            }\n\n            options = Typpy(options) === \"boolean\" ? {\n                empty: options\n            } : {\n                empty: false\n            };\n\n            // Handle empty\n            if (options.empty) {\n                return input || def;\n            }\n\n            // Return input\n            if (Typpy(input) === Typpy(def)) {\n                return input;\n            }\n\n            // Return the default\n            return def;\n        }\n\n        module.exports = Deffy;\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\n        /**\n         * Typpy\n         * Gets the type of the input value or compares it\n         * with a provided type.\n         *\n         * Usage:\n         *\n         * ```js\n         * Typpy({}) // => \"object\"\n         * Typpy(42, Number); // => true\n         * Typpy.get([], \"array\"); => true\n         * ```\n         *\n         * @name Typpy\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Constructor|String} target The target type.\n         * It could be a string (e.g. `\"array\"`) or a\n         * constructor (e.g. `Array`).\n         * @return {String|Boolean} It returns `true` if the\n         * input has the provided type `target` (if was provided),\n         * `false` if the input type does *not* have the provided type\n         * `target` or the stringified type of the input (always lowercase).\n         */\n        function Typpy(input, target) {\n            if (arguments.length === 2) {\n                return Typpy.is(input, target);\n            }\n            return Typpy.get(input, true);\n        }\n\n        /**\n         * Typpy.is\n         * Checks if the input value has a specified type.\n         *\n         * @name Typpy.is\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Constructor|String} target The target type.\n         * It could be a string (e.g. `\"array\"`) or a\n         * constructor (e.g. `Array`).\n         * @return {Boolean} `true`, if the input has the same\n         * type with the target or `false` otherwise.\n         */\n        Typpy.is = function (input, target) {\n            return Typpy.get(input, typeof target === \"string\") === target;\n        };\n\n        /**\n         * Typpy.get\n         * Gets the type of the input value. This is used internally.\n         *\n         * @name Typpy.get\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Boolean} str A flag to indicate if the return value\n         * should be a string or not.\n         * @return {Constructor|String} The input value constructor\n         * (if any) or the stringified type (always lowercase).\n         */\n        Typpy.get = function (input, str) {\n\n            if (typeof input === \"string\") {\n                return str ? \"string\" : String;\n            }\n\n            if (null === input) {\n                return str ? \"null\" : null;\n            }\n\n            if (undefined === input) {\n                return str ? \"undefined\" : undefined;\n            }\n\n            // eslint-disable-next-line no-self-compare\n            if (input !== input) {\n                return str ? \"nan\" : NaN;\n            }\n\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\n        };\n\n        module.exports = Typpy;\n    }, {}], 4: [function (require, module, exports) {\n        /**\n         * Idy\n         * Generates a random id and potentially unique.\n         *\n         * @name Idy\n         * @function\n         * @param {Number} length The id length (default: 10).\n         * @return {String} The generated id.\n         */\n        function Idy(length) {\n            length = length || 10;\n            return Math.random().toString(35).substr(2, length);\n        }\n\n        module.exports = Idy;\n    }, {}], 5: [function (require, module, exports) {\n        /**\n         * IterateObject\n         * Iterates an object. Note the object field order may differ.\n         *\n         * @name IterateObject\n         * @function\n         * @param {Object} obj The input object.\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\n         * @return {Function} The `IterateObject` function.\n         */\n        function IterateObject(obj, fn) {\n            var i = 0,\n                keys = [];\n\n            if (Array.isArray(obj)) {\n                for (; i < obj.length; ++i) {\n                    if (fn(obj[i], i, obj) === false) {\n                        break;\n                    }\n                }\n            } else {\n                keys = Object.keys(obj);\n                for (; i < keys.length; ++i) {\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        module.exports = IterateObject;\n    }, {}], 6: [function (require, module, exports) {\n        // Dependencies\n        var Deffy = require(\"deffy\");\n\n        /**\n         * SetOrGet\n         * Sets or gets an object field value.\n         *\n         * @name SetOrGet\n         * @function\n         * @param {Object|Array} input The cache/input object.\n         * @param {String|Number} field The field you want to update/create.\n         * @param {Object|Array} def The default value.\n         * @return {Object|Array} The field value.\n         */\n        function SetOrGet(input, field, def) {\n            return input[field] = Deffy(input[field], def);\n        }\n\n        module.exports = SetOrGet;\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\n        arguments[4][2][0].apply(exports, arguments);\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\n        arguments[4][3][0].apply(exports, arguments);\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\nimport LinkNode from './nodes/LinkNode.js'\nimport BodyNode from './nodes/BodyNode.js'\nimport SectionNode from './nodes/SectionNode.js'\nimport { Block } from 'slate'\nimport { getEventTransfer } from 'slate-react';\nimport { deleteNode } from './NodeSwitch.js'\n\nexport default function LinkPlugin(options) {\n    return {\n        commands: {\n            wrapLinkAtSelection(editor, node_id) {\n                return editor.wrapInline({\n                    type: \"link\",\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\n                });\n            }\n        },\n\n        renderInline(props, editor, next) {\n            if (props.node.type === 'link') {\n                var { ref, id } = getRefAndId(props, editor, \"short\");\n\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\n            }\n\n            return next();\n        },\n\n        renderBlock(props, editor, next) {\n            var refAndId;\n\n            if (props.node.type === 'body') {\n                refAndId = getRefAndId(props, editor, \"long\");\n\n                // set up the placeholder text to only appear when the body is empty and no text is selected\n                var isEmpty = !props.node.text\n\n                var selectNode = () => {\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\n                }\n\n                return <BodyNode\n                            ref={refAndId.ref}\n                            {...props}\n                            sharedState={editor.getSharedState()}\n                            nodeId={refAndId.id}\n                            isEmpty={isEmpty}\n                            selectNode={selectNode}\n                        />\n\n            } else if (props.node.type === 'link') {\n                refAndId = getRefAndId(props, editor, \"short\");\n\n                return <LinkNode\n                            ref={refAndId.ref}\n                            {...props}\n                            linkStyle=\"heading\"\n                            sharedState={editor.getSharedState()}\n                            nodeId={refAndId.id}\n                        />\n\n            } else if (props.node.type === 'section') {\n                refAndId = getRefAndId(props, editor, \"section\");\n\n                return <SectionNode\n                    ref={refAndId.ref}\n                    {...props}\n                    sharedState={editor.getSharedState()}\n                    nodeId={refAndId.id}\n                />\n            }\n\n            return next();\n        },\n\n        onDrop(event, editor, next) {\n            // suppress drop events\n            // do not call next()\n        },\n\n        onPaste(event, editor, next) {\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\n\n            var transfer = getEventTransfer(event);\n\n            if (transfer.type === \"fragment\") {\n\n                // if pasting into a link or body, just paste plain text, not a fragment\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\n                    editor.insertText(textNoNewlines)\n\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\n                    return\n                }\n\n                const fragmentInlines = getLinkInlines(transfer.fragment)\n\n                if (fragmentInlines) {\n                    const docInlines = getLinkInlines(editor.value.document)\n                    const usedIds = []\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\n                    \n                    // let the paste happen so we can operate on the document instead of inline\n                    next()\n\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\n                    fragmentInlines.forEach(inline => {\n                        usedIds.forEach(usedId => {\n                            const id = inline.data.get(\"node_id\")\n                            if (usedId.id === id) {\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\n                                inlinesWithId.forEach(inlineWithId => {\n                                    if (inlineWithId.key !== usedId.key) {\n                                        editor.unwrapInlineByKey(inlineWithId.key)\n                                    }\n                                })\n                            }\n                        })\n                    })\n                }\n            } else {\n                next()\n            }\n        },\n\n        onChange(editor, next) {\n            // update all node texts (both link and body)\n            const sharedState = editor.getSharedState();\n            [\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\n            ].forEach( update =>\n                editor.value.blocks.forEach(block => {\n                    const updateText = (linkNode) => {\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\n                        const id = linkNode.data.get('node_id')\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\n                            deleteNode(linkNode, editor)\n                        } else {\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\n                        }\n                    }\n\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\n                    linkNodes.forEach(updateText)\n\n                    if (block.type === update.nodeType) {\n                        updateText(block)\n                    }\n                })\n            )\n\n            next()\n        },\n\n        onKeyDown(e, editor, next) {\n            const { value } = editor\n            const { document, selection, startBlock} = value\n            const { start, end } = selection\n\n            // if a whole section (block or inline) is deleted, tell the graph node\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\n                document.getDescendantsAtRange(selection).forEach(node => {\n                    if (node.type === 'section' || node.type === 'link') {\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\n                        setTimeout(() => {\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\n                        }, 0)\n                    }\n                })\n            }\n\n            // prevent delete key from merging body and link blocks with next\n            if (e.key === \"Delete\") {\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\n                    const nextBlock = document.getNextBlock(start.key)\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\n                        editor.moveToStartOfNode(nextBlock);\n                        if (startBlock.text === \"\") {\n                            editor.removeNodeByKey(startBlock.key)\n                        }\n                        return\n                    }\n                }\n            }\n\n            // prevent backspace from merging body and link blocks with previous\n            if (e.key === 'Backspace') {\n                const prevBlock = document.getPreviousBlock(start.key)\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\n                    if (prevBlock) {\n                        editor.moveToEndOfNode(prevBlock);\n                        if (startBlock.text === \"\") {\n                            editor.removeNodeByKey(startBlock.key)\n                        } else if (prevBlock.text === \"\") {\n                            editor.removeNodeByKey(prevBlock.key)\n                         }\n                    }\n                    return editor\n                }\n            }\n\n            if (e.key === 'Enter') {\n                if (value.inlines.some(inline => inline.type === 'link')) {\n                    return // do nothing to avoid splitting the link\n                }\n\n                // when enter is pressed inside a link *block* (not inline), just go to body\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\n                    // unless the offset is 0, in which case insert a block before and go to that\n                    if (start.offset === 0) {\n                        const blockToInsert = Block.create({object: 'block', type: ''})\n                        const section = document.getParent(startBlock.key);\n                        const sectionParent = document.getParent(section.key);                    \n                        const sectionIndex = sectionParent.nodes.indexOf(section);\n\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\n                        return editor.moveBackward(1)\n                    } else {\n                        const nextBlock = document.getNextBlock(start.key)\n                        if (nextBlock) {\n                            return editor.moveToStartOfNode(nextBlock);\n                        } else {\n                            return editor.moveToEndOfNode(startBlock);\n                        }\n                    }\n                }\n            }\n            \n            // prevent the cursor disappearing when navigating into the body placeholder text\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\n                    // its hard to work out how many lines of text there so use an estimate\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\n                        editor.moveToEndOfNode(relevantBlock)\n                        e.preventDefault()\n                        return\n                    }\n                }\n            }\n\n            // prevent tab from taking focus from the editor\n            if (e.key === 'Tab') {\n                e.preventDefault()\n            }\n\n            return next()\n        }\n    }\n\n    function getRefAndId(props, editor, long_or_short) {\n        var id = props.node.data.get(\"node_id\");\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\n        var ref = React.createRef();\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\n        return { ref, id };\n    }\n}","import React from 'react';\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\n\nexport default function ReorderPlugin(options) {\n    return {\n        renderBlock(props, editor, next) {            \n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\n                return <PlainBlockNode {...props}/>\n            }\n            \n            return next();\n        },\n    }\n}","import React from 'react';\n\nexport default function WordCountPlugin(options) {\n    return {\n        renderEditor(props, editor, next) {\n            const wordCount = countWords(props.editor.value.document)\n            const children = next()\n\n            return (\n                <React.Fragment>\n                    {children}\n                    <span className=\"word-count\">{wordCount + \" words\"}</span>\n                </React.Fragment>\n            )\n        }\n    }\n}\n\nfunction countWords(document) {\n    if (!document) {\n        return 0\n    }\n\n    // count words per block because document.text does not preserve newlines so undercounts\n    var count = 0\n    document.getBlocks().forEach(block => {\n        // skip hidden body/link elements\n        if (block.type === 'link' || block.type === 'body') {\n            const parent = document.getParent(block.key)\n            if (parent && parent.type === 'section') {\n                if ((parent.data.get('nodeStyle') === 'Heading only' && block.type === 'body') ||\n                    (parent.data.get('nodeStyle') === 'Body only' && block.type === 'link')) {\n                    return\n                }\n            }\n        }        \n\n        const words = block.text.match(/\\S+/g)  // split into non-whitespace substrings\n        if (words) {\n            count += words.length\n        }\n    })\n\n    return count.toString()\n}","import React, { Component } from 'react';\nimport './DocPane.css';\nimport DocEditor from './DocEditor.js'\n\nclass DocPane extends Component {\n    render() {\n        return (\n            <div className=\"pane doc\">\n                <DocEditor sharedState={this.props.sharedState} />\n            </div>\n        );\n    }\n}\n\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\nimport { toast } from 'react-toastify';\n\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\n\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\n\nconst COLOURS = [\n    'red',\n    'goldenrod',\n    'green',\n    'aqua',\n    'blue',\n    'fuchsia',\n    'purple',\n    'saddlebrown'\n]\n\nvar DEFAULT_ARROW_OPTIONS = [\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"→\"},\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"→\"},\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"→\"},\n];\n\nexport default class MouseFollower {\n    constructor(shared_state, svg, connectables_container, markers, links) {\n        this.shared_state = shared_state;\n        this.drawing_arrow_from = false;\n        this.connector = undefined;\n        this.connectables_container = connectables_container;\n        this.markers = markers;\n        this.links = links;\n\n        this.connector_objs = {}\n        this.temp_arrows = {}\n\n        this.arrow_id_counter = 0\n\n        this.completed_arrows = []\n\n        this.mouse_rect = svg.group();\n        window.addEventListener('mousemove', e => {\n            var point = svg.point(e.clientX, e.clientY);\n            this.mouse_rect.move(point.x, point.y);\n            \n            if (typeof(this.connector) !== 'undefined') {\n                this.connector.update();\n            }\n        });\n\n        // cancel arrows if they don't end on a node\n        window.addEventListener('mouseup', (e) => {\n            if (this.drawing_arrow_from) {\n                e.preventDefault();\n                this.stop_drawing_arrow();\n            }\n        });\n    }\n\n    toJSON() {\n        return {\n            arrows: this.completed_arrows,\n            arrow_id_counter: this.arrow_id_counter,\n            arrowOptions: this.arrowOptions,\n        }\n    }\n\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\n\n        return mf\n    }\n\n    // draw all the arrows in this.completed_arrows\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\n    draw_loaded_arrows(get_node) {\n        this.completed_arrows.forEach(arrow => {\n            const originNode = get_node(arrow.origin)\n            const destinationNode = get_node(arrow.destination)\n\n            if (!originNode) {\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\n                return\n            }\n\n            if (!destinationNode) {\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\n                return\n            }\n\n            const connector = this.draw_arrow(\n                originNode,\n                destinationNode,\n                arrow.colour\n            )\n            this.add_context_menu_to_arrow(connector, arrow)\n            this.connector_objs[arrow.origin + \"->\" + arrow.destination] = connector\n            \n            // update the arrow start and end points\n            originNode.group.node.dispatchEvent(new CustomEvent(\"dragmove\"))\n        })\n    }\n\n    update_source(new_source) {\n        if (typeof(this.connector) === 'undefined') {\n            this.connector = new_source.connectable({\n                container: this.connectables_container,\n                markers: this.markers\n            }, this.mouse_rect);\n        } else {\n            this.connector.marker.show();\n            this.connector.line.show();\n\n            this.connector.target = this.mouse_rect;\n            this.connector.source = new_source;\n            this.connector.update();\n        }\n        if (this.connector) {\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\n        }\n    }\n\n    hide() {\n        if (typeof(this.connector) !== 'undefined') {\n            this.connector.target = this.connector.source;\n            this.connector.marker.hide();\n            this.connector.line.hide();\n        }\n    }\n\n    start_arrow(source_node) {\n        this.drawing_arrow_from = source_node;\n        if (this.connector) {\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\n        }\n    }\n\n    draw_arrow(origin, destination, colour) {\n        var connector = origin.group.connectable({\n            container: this.links,\n            markers: this.markers,\n            specialCoords: true\n        }, destination.group);\n        connector.setLineColor(colour);\n\n        connector.source.on(\"deletenode\", () => {\n            connector.source.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector)\n        });\n        connector.target.on(\"deletenode\", () => {\n            connector.target.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector)\n        });\n\n        return connector\n    }\n\n    add_context_menu_to_arrow(connector, arrowObject) {\n        const show_context_menu = e => {\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\n                arrowObject.colour = new_colour\n            }, arrowObject);\n            e.preventDefault();\n        };\n        connector.line.on(\"click\", show_context_menu);\n        connector.line.on(\"contextmenu\", show_context_menu);\n\n        connector.source.on(\"deletenode\", () => {\n            connector.source.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector, arrowObject)\n        });\n        connector.target.on(\"deletenode\", () => {\n            connector.target.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector, arrowObject)\n        });\n\n        // detect if the user changes the colour of this arrow\n        window.addEventListener('colourchange', (e) => {\n            if (e.detail.oldColour === arrowObject.colour) {\n                connector.setLineColor(e.detail.newColour)\n                arrowObject.colour = e.detail.newColour\n            }\n        })\n\n        // detect if all arrows of this colour were deleted\n        window.addEventListener('arrowdelete', (e) => {\n            if (e.detail.colour === arrowObject.colour) {\n                this.remove_arrow(connector, arrowObject)\n            }\n        })\n    }\n\n    complete_arrow(end_node) {\n        // no arrows to self\n        if (end_node === this.drawing_arrow_from) {\n            this.stop_drawing_arrow();\n            return;\n        }\n\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\n\n        var c1 = this.drawing_arrow_from.group.getScreenCoords('centre')\n        var c2 = end_node.group.getScreenCoords('centre')\n        var midpoint = {x: (c1.x + c2.x) / 2, y: (c1.y + c2.y) / 2}\n\n        // only add the arrow to the list of completed arrows once a colour is selected\n        // to prevent weird states being saved and loaded\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\n        const colourWasSelected = (colour) => {\n            const id = this.getNewId()\n            const arrowObject = {\n                id: id,\n                origin: drawing_arrow_from_id,\n                destination: end_node.id,\n                colour: colour,\n            }\n            this.completed_arrows.push(arrowObject)\n\n            this.add_context_menu_to_arrow(connector, arrowObject)\n        }\n\n        this.edit_connector_type(connector, midpoint.x, midpoint.y, false, colourWasSelected);\n\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\n        this.stop_drawing_arrow();\n    }\n\n    getArrowByID(id) {\n        return this.completed_arrows.find(arrow => arrow.id === id)\n    }\n\n    getConnectorObjectConnecting(source, dest) {\n        // if there are multiple, this will just return the first\n        return this.connector_objs[source + \"->\" + dest]\n    }\n\n    addTempArrow(source, dest, colour, temp_id) {\n        const source_node = this.shared_state.graphPane.getNodeById(source)\n        const dest_node = this.shared_state.graphPane.getNodeById(dest)\n        if (!source_node || !dest_node) {\n            return\n        }\n        this.connector_objs[source + '->' + dest] = this.draw_arrow(source_node, dest_node, colour)\n        this.temp_arrows[temp_id] = source + '->' + dest\n    }\n\n    getNewId() {\n        this.arrow_id_counter++\n        return this.arrow_id_counter\n    }\n\n    changeArrowColour(entry, direction) {\n        const oldColour = entry.colour\n        var newColour = this.getNextAvailableColour(entry, direction)\n        if (!newColour) {\n            return\n        }\n        entry.colour = newColour\n\n        window.dispatchEvent(new CustomEvent('colourchange', {\n            detail: {\n                oldColour: oldColour,\n                newColour: newColour,\n            }\n        }))\n\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\n\n        return newColour\n    }\n\n    getNextAvailableColour(entry, direction) {\n        // find all the colours which are not used by arrowOptions other than this one\n        const availableColours = COLOURS.filter(colour => \n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\n        )\n\n        if (!availableColours) {\n            return undefined\n        } else {\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\n            if (thisColourIndex !== -1) {\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\n                if (nextIndex < 0) {\n                    nextIndex = availableColours.length - 1\n                }\n                return availableColours[nextIndex]\n            }\n        }\n    }\n\n    getArrowOptions() {\n        const clickEditButton = (e, params) => {\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\n\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\n\n            transientEntry.isClickable = false\n\n            var editButton = buttonCell.children[0]\n\n            const updateName = () => {\n                var newValue = input.value\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\n                }\n                if (newValue) {\n                    underlyingEntry.name = newValue\n                }\n\n                return newValue\n            }\n\n            const finishEditing = () => {\n                var newValue = updateName()\n                if (newValue) {\n                    nameCell.textContent = newValue\n                }\n\n                transientEntry.isClickable = true\n\n                colourCell.textContent = colourButton.textContent\n                colourCell.style.color = colourButton.style.color\n                \n                editButton.classList.remove('pure-button-active')\n                editButton.onclick = (e) => clickEditButton(e, params)\n            }\n\n            editButton.classList.add('pure-button-active')\n            editButton.onclick = finishEditing\n\n            var input = document.createElement(\"input\")\n            \n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\n            input.value = nameCell.textContent\n            input.addEventListener('keyup', (e) => {\n                if (e.key === 'Enter' && input.value) {\n                    finishEditing()\n                }\n            })\n            input.addEventListener('change', updateName)\n\n            nameCell.textContent = \"\"\n            nameCell.appendChild(input)\n\n            var colourButton = document.createElement(\"button\")\n            colourButton.className = 'pure-button'\n            colourButton.textContent = colourCell.textContent\n            colourCell.textContent = \"\"\n            colourCell.appendChild(colourButton)\n            colourButton.style.color = colourCell.style.color\n            colourButton.style.padding = 0\n            colourButton.addEventListener(\"click\", () => {\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\n                transientEntry.colour = underlyingEntry.colour\n            })\n            colourButton.addEventListener(\"contextmenu\", (e) => {\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\n                transientEntry.colour = underlyingEntry.colour\n                e.preventDefault()\n            })\n\n            input.focus()\n        }\n\n        const clickDeleteArrowTypeButton = (e, params) => {\n            var { row, underlyingEntries, underlyingEntry, transientEntry, selected, hidePopup } = params\n            transientEntry.isClickable = false\n            \n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\n                // remove from underlyingEntries\n                var index = underlyingEntries.indexOf(underlyingEntry)\n                if (index !== -1) {\n                    underlyingEntries.splice(index, 1)\n                }\n\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\n                setTimeout(() => row.parentNode.removeChild(row), 0)\n\n                // tell all arrows of this colour to delete themselves\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\n                    detail: {\n                        colour: underlyingEntry.colour,\n                    }\n                }))\n\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour})\n\n                // if the selected arrow type was deleted, hide the optionpopup\n                if (selected) {\n                    hidePopup()\n                }\n            }\n\n            transientEntry.isClickable = true\n        }\n\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\n            var entryWithButtons = {...entry}\n            entryWithButtons.buttons = [\n                {\n                    className: 'edit-icon',\n                    click: clickEditButton,\n                    underlyingEntry: entry,\n                },\n                {\n                    className: 'delete-icon',\n                    click: clickDeleteArrowTypeButton,\n                    underlyingEntry: entry,\n                    underlyingEntries: this.arrowOptions,\n                }\n            ]\n            return entryWithButtons\n        })\n        \n        return [\n            ...arrowOptionsWithButtons,\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\n        ]\n    }\n\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\n        var prev_selected = undefined;\n        \n        const arrowOptions = this.getArrowOptions()\n\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\n        prev_selected = prev_selected ? prev_selected.name : undefined\n\n        const setArrowColour = (selected_option) => {\n            connector.setLineColor(selected_option.colour);\n            this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\n\n            if (onColourSelected) {\n                onColourSelected(selected_option.colour)\n            }\n        }\n\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\n            if (selected_option.name === \"Delete\") {\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\n                this.remove_arrow(connector, arrowObject);\n            } else if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\n                const colour = this.getNextAvailableColour(null, 1)\n\n                if (!colour) {\n                    toast.error(\"Maximum number of arrow types reached!\")\n                } else {\n                    const newRelation = {\n                        'name': 'New relation',\n                        'colour': colour,\n                        'symbol': \"→\",\n                    }\n                    this.arrowOptions.push(newRelation)\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\n\n                    if (!prev_selected) {\n                        setArrowColour(newRelation)\n                    }\n\n                    // open a new option popup to allow the user to select the new arrow type and edit it\n                    this.edit_connector_type(connector, popup_x, popup_y, true, onColourSelected, arrowObject)\n                }\n            } else {\n                setArrowColour(selected_option)\n            }\n        }, prev_selected);\n    }\n\n    remove_arrow(connector, arrowObject) {\n        if (connector && connector.line) {\n            connector.line.node.instance.delete_connectable(connector);\n        }\n\n        if (arrowObject) {\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \n        }\n    }\n\n    stop_drawing_arrow() {\n        this.drawing_arrow_from = false;\n        this.hide();\n    }\n}","import OptionPopup from \"./OptionPopup\";\n\nvar ARROW_HITBOX_MARGIN = 20;\n\nclass GraphNode {\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList, zoomCanvasTo) {\n        var { shortText, x, y, width, height, id, isOnGraph, longText, annotatedOrder } = params\n        this.id = id ? id : shared_state.getNodeId();\n\n        this.getNodesList = getNodesList\n        this.zoomCanvasTo = zoomCanvasTo\n        \n        this.group = nodes.group().translate(x, y);\n\n        this.dropShadow = this.group.rect(width, height).radius(5).addClass('node-drop-shadow')\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0).radius(10).addClass('arrow-hitbox');\n        \n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\n        this.editRect = this.group.rect(width - 10, height - 10).radius(5).translate(5, 5).addClass('editing-node-rect')\n        this.text = this.group.text(\"\").addClass('node-text');\n        this.updateShortText(shortText)\n        this.updateLongText(longText)\n\n        this.setupRectDragging(this.rect, shared_state);\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\n        const complete_arrow = (e) => {\n            if (mouse_follower.drawing_arrow_from) {\n                mouse_follower.complete_arrow(this);\n            }\n        };\n        this.arrow_hitbox.on('mouseup', complete_arrow);\n        this.rect.on('mouseup', complete_arrow);\n        this.text.on('mouseup', complete_arrow);\n\n        this.setupHover(shared_state);\n        this.setupContextMenu(shared_state);\n\n        if (focus_text_area) {\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\n        }\n        \n        this.setIsOnGraph(isOnGraph);\n\n        this.annotatedOrder = annotatedOrder\n        this.showAnnotatedOrder()\n\n        // don't log add node events if they are just loaded from a save\n        if (!params.isFromJSON) {\n            shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\n        }\n    }\n\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList, zoomCanvasTo) {\n        var params = json\n        params.x = json.screenCoords.x\n        params.y = json.screenCoords.y\n        params.width = 200\n        params.height = 42\n        params.isFromJSON = true\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList, zoomCanvasTo)\n    }\n\n    toJSON() {\n        return {\n            id: this.id,\n            shortText: this.shortText,\n            longText: this.longText,\n            screenCoords: this.group.getScreenCoords(),\n            isOnGraph: this.isOnGraph,\n            annotatedOrder: this.annotatedOrder,\n        }\n    }\n\n    setIsOnGraph(newVal) {\n        this.isOnGraph = newVal;\n        if (this.isOnGraph) {\n            this.rect.addClass(\"node-on-graph\");\n        } else {\n            this.rect.removeClass(\"node-on-graph\");\n        }\n    }\n\n    setupContextMenu(shared_state) {\n        var showOptionMenu = e => {\n            e.preventDefault();\n            \n            var entries = [\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\n            ]\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\n                if (selected_option.name === \"Delete\") {\n                    this.delete(shared_state);\n                }\n            });\n            \n            return false;\n        };\n        this.rect.on('contextmenu', showOptionMenu);\n        this.text.on('contextmenu', showOptionMenu);\n    }\n\n    setupHover(shared_state) {\n        this.hoverers = []\n\n        const startHover = (e) => {\n            this.setHoverer(\"mouse_\" + e.target, true);\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\n                if (!ref) {\n                    return\n                }\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\n            });\n        };\n        const endHover = (e) => {\n            this.setHoverer(\"mouse_\" + e.target, false);\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\n                if (!ref) {\n                    return\n                }\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\n            });\n        };\n        this.rect.on('mouseenter', startHover);\n        this.text.on('mouseenter', startHover);\n        this.rect.on('mouseleave', endHover);\n        this.text.on('mouseleave', endHover);\n    }\n\n    setHoverer(hoverer, isHovering) {\n        if (isHovering) {\n            if (!this.hoverers.includes(hoverer)) {\n                this.hoverers.push(hoverer)\n            }\n        } else {\n            // remove the hoverer\n            var index = this.hoverers.indexOf(hoverer);\n            if (index !== -1) this.hoverers.splice(index, 1);\n        }\n\n        this.setHovered(this.hoverers.length > 0)\n    }\n\n    setHovered(isHovered) {        \n        if (isHovered) {\n            this.rect.addClass(\"hovered\");\n        } else {\n            this.rect.removeClass(\"hovered\");\n        }\n    }\n\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\n    // but we only want to make the node itself draggable\n    // so we need to intercept drag events on the rect, and move the entire group instead!\n    setupRectDragging(rect, shared_state) {\n        this.setupGroupDragging(rect, shared_state, rect);\n        this.setupGroupDragging(this.text, shared_state, rect, true);\n        \n        this.text.click((e) => e.preventDefault());\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\n        rect.click(edit_text_if_not_just_dropped);\n        this.text.click(edit_text_if_not_just_dropped);\n    }\n\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\n        rect.draggy(); // setup dragging on the rect\n        rect.on('mousedown', (e) => {\n            e.stopPropagation(); // don't pan when moving a node\n        });\n        just_dropped_obj.just_dropped = false;\n        rect.on('dragstart', (e) => {\n            var start_x = this.group.x();\n            var start_y = this.group.y();\n            document.activeElement.blur();\n            shared_state.draggedNode = {\n                id: this.id,\n                text: this.getShortText(),\n                longText: this.getLongText(),\n                resetPos: () => {\n                    this.group.move(start_x, start_y);\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n                },\n                node: this\n            };\n\n            this.dropShadow.translate(5, 5)\n            this.dropShadow.addClass('visible')\n            \n            rect.off('dragmove');\n            rect.on('dragmove', (e) => {\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\n                if (center) {\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\n                } else {\n                    rect.x(0);\n                    rect.y(0);\n                }\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n            });\n            rect.off('dragend');\n            rect.on('dragend', (e) => {\n                // prevent the textarea showing\n                // unless the drag amount was zero or just a tiny accidental drag\n                var x_diff = (this.group.x() - start_x);\n                var y_diff = (this.group.y() - start_y);\n                var nudge = 10;\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\n                    just_dropped_obj.just_dropped = true;\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\n                }\n                shared_state.draggedNode = false;\n\n                this.dropShadow.translate(0, 0)\n                this.dropShadow.removeClass('visible')\n            });\n        });\n    }\n\n    // click/drag events on the arrow hitbox should start the arrow creation process\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\n        arrow_hitbox.on('mousemove', () => {\n            if (!mouse_follower.drawing_arrow_from) {\n                mouse_follower.update_source(this.group);\n            }\n        });\n        arrow_hitbox.on('mouseleave', () => {\n            if (!mouse_follower.drawing_arrow_from) {\n                mouse_follower.hide();\n            }\n        });\n        arrow_hitbox.on('mousedown', (e) => {\n            mouse_follower.start_arrow(this);\n            e.stopPropagation(); // don't pan when dragging an arrow\n        });\n    }\n\n    updateShortText(newShortText) {\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\n        \n        const CHARS_PER_LINE = 21;\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\n\n        this.text.text(formattedText.join(\"\\n\"));\n        this.resizeRect(formattedText.length);\n    }\n\n    updateLongText(newLongText) {\n        this.longText = newLongText;\n    }\n\n    splitIntoLines(charsPerLine, text) {\n        var formattedText = [];\n        var line = \"\";\n        text.split(\" \").forEach(word => {\n            var segments = [];\n            if (word.length > charsPerLine) {\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\n                    if (segments.length > 0) {\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\n                    }\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\n                }\n            }\n            else {\n                segments = [word];\n            }\n            segments.forEach(segment => {\n                if ((line + segment).length < charsPerLine) {\n                    var space = line.length > 0 ? \" \" : \"\";\n                    line += space + segment;\n                }\n                else {\n                    formattedText.push(line);\n                    line = segment;\n                }\n            });\n        });\n        formattedText.push(line);\n        return formattedText;\n    }\n\n    // resize the rect so that the text fits on it\n    resizeRect(numLinesOfText) {\n        this.rect.width(200);\n        const rectHeight = numLinesOfText * 21 + 20\n        this.rect.height(rectHeight);\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\n        this.dropShadow.height(rectHeight)\n        this.editRect.height(rectHeight - 10)\n\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\n\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n    }\n\n    getShortText() {\n        return this.shortText;\n    }\n\n    getLongText() {\n        return this.longText;\n    }\n\n    showAnnotatedOrder() {\n        if (this.annotatedOrder) {\n            this.annotatedOrderText = this.group.text(this.annotatedOrder.toString())\n        }\n    }\n\n    editText(shared_state, delete_if_empty_text = false) {\n        document.activeElement.blur(); // remove focus from everything\n\n        if (shared_state.orderAnnotate) {\n            if (this.annotatedOrder) {\n                shared_state.annotatedNumbers = shared_state.annotatedNumbers.filter(num => num !== this.annotatedOrder)\n                this.annotatedOrder = undefined\n                this.annotatedOrderText.remove()\n            } else {\n                const num = shared_state.getNextAnnotateNum()\n                this.annotatedOrder = num\n                shared_state.annotatedNumbers.push(num)\n                this.showAnnotatedOrder()\n            }\n            return\n        }\n\n        this.zoomCanvasTo(1, {x: this.group.cx(), y: this.group.cy()}, () => {\n            var textarea = document.querySelector('#nodeedit');\n            textarea.value = this.getShortText();\n\n            const preEditText = this.getShortText()\n\n            var screen_coords = this.rect.getScreenCoords();\n            textarea.style.left = screen_coords.x + \"px\";\n            textarea.style.top = screen_coords.y + \"px\";\n            textarea.style.display = \"inline-block\";\n            textarea.focus();\n\n            textarea.style.width = \"180px\";\n            textarea.style.height = 'auto';\n            textarea.style.height = (textarea.scrollHeight) + 'px';\n\n            this.text.hide();\n\n            this.editRect.addClass('visible')\n            this.setHoverer('editNodeDirectly', true)\n\n            var save_changes = () => {\n                this.updateShortText(textarea.value);\n                shared_state.updateDocShortText(this.id, this.getShortText());\n            };\n            var save_and_hide = () => {\n                save_changes();\n                textarea.style.display = \"none\";\n                if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\n                    this.delete(shared_state);\n                }\n                this.text.show();\n                this.updateShortText(this.shortText);\n\n                if (this.getShortText() !== preEditText) {\n                    shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\n                }\n\n                this.editRect.removeClass('visible')\n                this.setHoverer('editNodeDirectly', false)\n            };\n            textarea.onblur = save_and_hide;\n            textarea.onkeyup = (e) => {\n                if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\n                    e.preventDefault();\n                    document.activeElement.blur();\n                } else {\n                    save_changes();\n                }\n            };\n        })\n    }\n\n    delete(shared_state) {\n        shared_state.removeGraphNode(this.id);\n        \n        // remove from the list of nodes (used for saving)\n        const nodesList = this.getNodesList()\n        var index = nodesList.indexOf(this);\n        if (index !== -1) {\n            nodesList.splice(index, 1)\n        } else {\n            console.log('node not found in this.nodesList when deleting');\n        }        \n\n        this.group.remove();\n\n        // delete arrows\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\n\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\n    }\n}\n\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\nimport { ItemTypes } from \"../../dragtypes\";\n\nconst graphTarget = {\n    canDrop(props, monitor) {\n        const item = monitor.getItem()\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\n    },\n\n    drop(props, monitor, component) {\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\n    },\n}\n\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDropTarget: connect.dropTarget(),\n        // You can ask the monitor about the current drag state:\n        itemType: monitor.getItemType(),\n    }\n}\n\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\nimport './GraphPane.css';\nimport SVG from 'svg.js';\nimport 'svg.panzoom.js';\nimport 'svg.draggy.js';\nimport './svg.connectable.js';\nimport MouseFollower from './MouseFollower.js';\nimport GraphNode from './GraphNode.js';\nimport DropifyGraphPane from './DropifyGraphPane.js'\nimport { toast } from 'react-toastify';\n\nclass GraphPane extends React.Component {\n    componentDidMount() {\n        this.props.sharedState.getSavedGraph((json) => {\n            this.nodesList = [];\n\n            this.props.sharedState.graphPane = this;\n\n            this.$el = document.querySelector(\"#graph\")\n\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 0.2, zoomMax: 1, zoomFactor: 0.1 }); // just pan, no zoom\n            this.svg = svg\n            this.zoomCanvasTo = (level, pos, cb) => {\n                if (Math.abs(svg.zoom() - level) < 0.01) { // it doesn't zoom to the exact number\n                    if (cb) { cb() }\n                } else {\n                    const runner = svg.animate({duration: 100, ease: '>'})\n                        .zoom(level, pos)\n                    \n                    if (cb) { runner.after(cb) }\n                }\n            }\n\n            svg.zoom(1)\n\n            SVG.extend(SVG.Element, {\n                getScreenCoords: function (zone) {\n                    var root_point = this.doc().node.getBoundingClientRect()\n                    var point = this.node.getBoundingClientRect()\n\n                    if (zone === 'centre') {\n                        return {\n                            x: (point.left + point.right) / 2 - root_point.left,\n                            y: (point.top + point.bottom) / 2 - root_point.top\n                        }\n                    } else {\n                        return {\n                            x: point.x - root_point.left,\n                            y: point.y - root_point.top\n                        }\n                    }\n                }\n            })\n\n            var links = svg.group();\n            var markers = svg.group();\n            var nodes = svg.group();\n            this.nodesSvgGroup = nodes\n\n            this.numTempNodes = 0\n\n            const json_connections = json ? json.connections : undefined\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\n            this.mouse_follower = mouse_follower\n\n            // add new nodes on mouse click\n            svg.on('dblclick', (e) => {\n                // only clicks on background and not when dragging\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\n                    return;\n                }\n\n                var x = e.clientX\n                if (x + 200 > window.innerWidth) {\n                    x = window.innerWidth - 200\n                }\n                var y = e.clientY\n                if (y + 60 > window.innerHeight) {\n                    y = window.innerHeight - 60\n                }\n\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", x, y, true);\n            });\n\n            this.setupTextDropping(svg, nodes, mouse_follower);\n\n            const blurActiveElement = (e) => {\n                document.activeElement.blur();\n            }\n            svg.on('panStart', blurActiveElement)\n            svg.on('zoom', blurActiveElement)\n\n            var textarea = document.querySelector('#nodeedit');\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\n            textarea.addEventListener(\"input\", (e) => {\n                textarea.style.height = 'auto';\n                textarea.style.height = (textarea.scrollHeight) + 'px';\n            });\n\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\n                if (x + 200 > window.innerWidth) {\n                    x = window.innerWidth - 200\n                }\n                if (y + 60 > window.innerHeight) {\n                    y = window.innerHeight - 60\n                }\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\n            }\n            if (json && json.nodes) {\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\n            }\n\n            this.getNodeById = this.getNodeById.bind(this)\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\n\n            if (this.nodesList.length === 0) {\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\n            }\n        })\n    }\n\n    getNodeById(id) {\n        return this.nodesList.find(node => node.id.toString() === id.toString())\n    }\n\n    toJSON() {\n        return {\n            nodes: this.nodesList.map(node => node.toJSON()),\n            connections: this.mouse_follower.toJSON()\n        }\n    }\n\n    loadNodesFromJSON(json, mouse_follower, nodes) {\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList, this.zoomCanvasTo))\n        // temp\n        console.log(\"num nodes: \" + this.nodesList.length)\n    }\n\n    explodeNodes() {\n        const factor = 0.1\n        this.nodesList.forEach((node) => {\n            node.group.move(\n                node.group.x() + node.group.x() * factor, \n                node.group.y() + node.group.y() * factor\n            )\n            node.group.node.dispatchEvent(new CustomEvent(\"dragmove\")) // update arrows\n        })\n    }\n\n    addTempNode(id) {\n        // this is to visualise nodes that were created then deleted, and are now being viewed in the log explore timeline\n        var node = this.addNodeAtScreenLocation(this.svg, this.nodesSvgGroup, this.mouse_follower, \"?\", 0, this.numTempNodes * 150, false, true, id, true)\n        this.numTempNodes++\n\n        return node\n    }\n\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\n        this.noNodesIndicator = svg.text(\"No nodes created\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\n        this.noNodesIndicator.on('dblclick', (e) => {\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\n        });\n    }\n\n    setupTextDropping(svg, nodes, mouse_follower) {\n        this.$el.addEventListener(\"dragover\", (e) => {\n            e.preventDefault();\n        });\n\n        this.$el.addEventListener(\"drop\", (e) => {\n            e.preventDefault();\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\n            }\n            \n            var data = e.dataTransfer.getData(\"Text\");\n\n            if (data.includes('\\n')) {\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\n                return\n            }\n\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\n                toast.error('You can\\'t add the same node to the graph twice!')\n                return\n            }\n\n            var x = e.clientX\n            if (x + 200 > window.innerWidth) {\n                x = window.innerWidth - 200\n            }\n            var y = e.clientY\n            if (y + 60 > window.innerHeight) {\n                y = window.innerHeight - 60\n            }\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, x, y, false);\n            this.props.sharedState.addLinkAtSelection(node.id, node);\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\n            document.activeElement.blur();\n        });\n    }\n\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false, id=undefined, isSvgCoords=false) {\n        var point = svg.point(x, y);\n        if (isSvgCoords) { // don't convert screen > svg coords\n            point = {x: x, y: y}\n        }\n        const params = {\n            shortText: text,\n            longText: \"\", \n            x: point.x,\n            y: point.y,\n            width: 200,\n            height: 42,\n            isOnGraph: false,\n            id: id, // set automatically\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\n        }\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList, this.zoomCanvasTo);\n        this.nodesList.push(node);\n\n        if (this.noNodesIndicator) {\n            this.noNodesIndicator.hide();\n        }\n\n        return node;\n    }\n\n    componentWillUnmount() {\n        // this.$el.somePlugin('destroy');\n    }\n\n    render() {\n        return this.props.connectDropTarget(\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\n                <textarea id='nodeedit'></textarea>\n            </div>\n        );\n    }\n}\n\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\n\nconst db = new Dexie('writeReasonDb');\ndb.version(3).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\n\nexport default db;","import db from './db.js'\nimport { toast } from 'react-toastify';\n\nconst EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY = [\n    'session_start',\n    'document_content_detailed',\n    'document_content_markdown',\n]\n\nexport default class Logger {\n    shouldLogToConsole = false;\n\n    constructor(db_id, params) {\n        this.db_id = db_id;\n        this.conditions = params;\n        this.logToConsole(\"Logging begin, db_id \" + db_id + \"\\nParams \" + JSON.stringify(params, null, 1));\n\n        // used for tracking whether changes have been made since last save\n        // obviously, does not track events which are not logged, like typing in the document\n        this.stateIsDirty = false\n\n        this.logEvent({'type': 'session_start'})\n    }\n\n    logEvent(event) {\n        if (!EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY.includes(event.type)) {\n            this.stateIsDirty = true\n        }\n\n        if (event.type === 'save') {\n            this.stateIsDirty = false\n        }\n\n        this.getLog(log => {\n            if (log.events === undefined) {\n                log.events = {}\n            }\n    \n            if (log.events[event.type] === undefined) {\n                log.events[event.type] = []\n            }\n            event.timestamp = new Date()\n            log.events[event.type].push(event)\n            this.setLog(log)\n\n            this.logToConsole(\"Logging event: \" + JSON.stringify(event))\n        })\n    }\n\n    // keep a history of the save states so that we can look back at how the project developed\n    logSaveState(save, forceLog=false) {\n        this.getLog(log => {\n            if (log.saves === undefined) {\n                log.saves = []\n            }\n\n            // don't store this save if we have stored a save <3 minutes ago\n            // to prevent multiple clicks of the save button taking up lots of space\n            const timestamp = new Date()\n            const THREE_MINUTES = 3 * 60 * 1000; // ms\n            if (forceLog || !log.saves.find(save => (timestamp - save.timestamp < THREE_MINUTES))) {\n                log.saves.push({\n                    timestamp: timestamp,\n                    ...save,\n                })\n                this.setLog(log)\n            }\n        })\n    }\n\n    getLog(callback) {\n        db.table('projects')\n            .get(this.db_id)\n            .then((project) => {\n                callback(project.log ? project.log : {})\n            })\n    }\n\n    setLog(log) {\n        db.table('projects')\n            .update(this.db_id, { log: log })\n            .catch(err => {\n                toast.error('Logging error: ' + err)\n                console.log('Logging error: ' + err)\n            })\n    }\n\n    logToConsole(msg) {\n        if (this.shouldLogToConsole) {\n            console.log(msg);\n        }\n    }\n}","import React from 'react';\nimport { Text } from 'slate';\nimport Html from 'slate-html-serializer'\nimport Logger from './logging'\nimport db from './db.js'\nimport { toast } from 'react-toastify';\nimport { pdf, Document, Page, Text as PdfText, StyleSheet, Font } from '@react-pdf/renderer';\nimport CrimsonText from './assets/CrimsonText-Regular.ttf'\nimport CrimsonTextBold from './assets/CrimsonText-Bold.ttf'\n\n\nexport default class SharedState {\n    constructor(db_id, params) {\n        if (!params.logExplore) {\n            this.logger = new Logger(db_id, params)\n        } else {\n            this.logger = {logEvent: (x, y) => {} }\n        }\n        this.condition = params.condition;\n        this.params = params;\n        \n        this.node_id_counter = 0;\n        this.slate_id_counter = 10\n        this.map = {};\n        this.map_recycle_bin = {};\n        this.db_id = db_id\n        this.orderAnnotate = false\n        this.annotatedNumbers = []\n\n        // this.editor_ref and this.graphPane set in the editor and graphpane\n        this.editor_ref = undefined;\n        this.graphPane = undefined;\n\n        // log entire document content every 60 seconds\n        if (!this.params.logExplore) {\n            this.intervalLogger = window.setInterval(() => {\n                this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\n            }, 60000);\n        }\n        \n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\n        this.save = this.save.bind(this)\n        this.mapToJSON = this.mapToJSON.bind(this)\n        this.exportPDF = this.exportPDF.bind(this)\n        this.exploreNext = this.exploreNext.bind(this)\n        this.explorePrev = this.explorePrev.bind(this)\n        this.exploreLog = this.exploreLog.bind(this)\n        this.makeNodeReport = this.makeNodeReport.bind(this)\n        this.getNextAnnotateNum = this.getNextAnnotateNum.bind(this)\n        this.exportAnnotatedLog = this.exportAnnotatedLog.bind(this)\n        this.explodeNodes = this.explodeNodes.bind(this)\n\n        // when the tab is closed, if the document has been edited, warn before closing\n        window.onbeforeunload = (e) => {\n            if (process.env.NODE_ENV !== 'development' && this.getStateIsDirty()) { // disable in development for webpack hot reloading\n                e.preventDefault()\n                e.returnValue = '' // for Chrome\n            }\n        }\n    }\n\n    exportAnnotatedLog() {\n        const save = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        this.downloadJSON(save, this.params.logExplore.project.filename + \"__order_annotated.json\")\n    }\n\n    getNextAnnotateNum() {\n        if (this.annotatedNumbers.length === 0) {\n            return 1\n        } else {\n            // check for a gap\n            this.annotatedNumbers.sort((a, b) => a - b)\n            var prev = 0\n            this.annotatedNumbers.forEach(annotatedNum => {\n                if (prev + 1 !== annotatedNum) {\n                    return prev + 1\n                }\n                prev = annotatedNum\n            })\n            \n            // if no gaps\n            return this.annotatedNumbers[this.annotatedNumbers.length - 1] + 1\n        }\n    }\n\n    viewFactSheet() {\n        const scenario = localStorage.getItem('scenario')\n        if (!scenario) {\n            toast.error('Fact sheet not found. Please re-open Write Reason using the link in the email we sent you.')\n            return\n        }\n\n        const factSheetURL = scenario + '_factsheet.pdf'\n        window.open(factSheetURL, '_blank')  // open in new tab\n    }\n\n    // called by editor once the database saved value has been set as the document.value\n    editorHasLoaded() {\n        this.getProjectThen(project => {\n            this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\n            this.map = project.map ? this.mapFromJSON(project.map) : {}\n            this.getEditor().mapHasLoaded()\n            this.projectName = project.name\n        })\n        \n        this.lastSavedDocumentState = this.getEditor().getValue().document // editor is definitely not dirty right now\n    }\n\n    downloadThisLog() {\n        const save = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        this.params.logExplore.project.log.saves.push(save)\n        this.downloadJSON({projects: [{\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n            log: this.params.logExplore.project.log,\n        }]}, \"x.json\")\n    }\n\n    save(cb=undefined, forceLog=false) {\n        const changes = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        db.table('projects')\n            .update(this.db_id, changes)\n            .then((idExists) => {\n                if (!idExists) {\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\n                    console.log(message)\n                    toast.error(message)\n                } else {\n                    toast.info('Changes saved!')\n                    this.lastSavedDocumentState = this.getEditor().getValue().document\n                    this.logger.logSaveState(changes, forceLog)\n                }\n            }).catch(err => {\n                toast.error('Save error: ' + err.toString())\n            })\n            \n        this.logger.logEvent({'type': 'save'})\n\n        if (cb) {\n            cb()\n        }\n    }\n\n    getStateIsDirty() {\n        return this.logger.stateIsDirty || (\n            this.getEditor() && this.getEditor().getValue() && this.getEditor().getValue().document !== this.lastSavedDocumentState\n        ) \n    }\n\n    explorePrev() {\n        if (this.params.logExplore.saveIndex === 0) {\n            return\n        }\n        \n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex - 1)\n    }\n\n    exploreNext() {\n        if (this.params.logExplore.saveIndex === this.params.logExplore.project.log.saves.length - 1) {\n            return\n        }\n\n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex + 1)\n    }\n\n    exploreLog(project, saveIndex) {\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.params.transitionToEditor }\n        const sharedState = new SharedState(-1, params)\n        this.params.transitionToEditor(sharedState, true)\n    }\n\n    makeNodeReport() {\n        const changes = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        this.downloadJSON(changes, this.params.logExplore.project.filename + \"_ANNOTATED.json\")\n\n        const nodeReport = {linkedTexts: [], unlinkedTexts: []}\n        const value = this.getEditor().getValue()\n        value.document.getBlocks().forEach(block => {\n            if (block.type === 'body' || block.type === 'link' || block.type === 'section') {\n                nodeReport.linkedTexts.push(block.text)\n            } else {\n                block.nodes.forEach(node => {\n                    if (!node.text) {\n                        return\n                    }\n                    if (node.type === 'link') {\n                        nodeReport.linkedTexts.push(node.text)\n                    } else {\n                        nodeReport.unlinkedTexts.push(node.text)\n                    }\n                })\n            }\n        })\n\n        nodeReport.linked = nodeReport.linkedTexts.join('\\n')\n        nodeReport.unlinked = nodeReport.unlinkedTexts.join('\\n')\n        \n        nodeReport.linkedCharsProportion = nodeReport.linked.length / (nodeReport.linked.length + nodeReport.unlinked.length)\n        \n        const countWords = (str) => str.trim().split(/\\s+/).length\n        nodeReport.linkedWords = countWords(nodeReport.linked)\n        nodeReport.unlinkedWords = countWords(nodeReport.unlinked)\n        nodeReport.linkedWordProportion = nodeReport.linkedWords / (nodeReport.linkedWords + nodeReport.unlinkedWords)\n\n        nodeReport.rawValue = value\n\n        var nodeReports = localStorage.getItem('nodeReports') ? JSON.parse(localStorage.getItem('nodeReports')) : {}\n        nodeReports[this.params.logExplore.project.filename] = nodeReport\n        localStorage.setItem('nodeReports', JSON.stringify(nodeReports))\n    }\n\n    getProjectThen(cb) {\n        if (this.params.logExplore) {\n            const logExplore = this.params.logExplore\n            cb(logExplore.project.log.saves[logExplore.saveIndex])\n        } else {\n            db.table('projects')\n                .get(this.db_id)\n                .then(project => {\n                    cb(project)\n                })\n        }\n    }\n\n    getSavedDocValue = async function(onDataLoad) {\n        this.getProjectThen(project => {\n            onDataLoad(project.doc_value)\n        })\n    }\n\n    getSavedGraph = async function(onDataLoad) {\n        this.getProjectThen(project => {\n            onDataLoad(project.graph_value)\n        })\n    }\n\n    mapToJSON() {\n        var mapJson = {}\n        const document = this.getEditor().value.document\n        for (const id in this.map) {\n            let doc_nodes = {};\n            ['section', 'long', 'short'].forEach(part => {\n                const docNodeObjects = this.getDocNodes(id)\n                if (docNodeObjects && docNodeObjects[part]) {\n                    const path = document.getPath(docNodeObjects[part])\n                    if (path) {\n                        doc_nodes[part] = path.toArray()\n                    }\n                } \n            })\n\n            mapJson[id] = {\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\n                doc_nodes: doc_nodes\n            }\n        }\n\n        return mapJson\n    }\n\n    mapFromJSON(json) {\n        this.map = {}\n        for (const id in json) {\n            if (json[id].graph_node) {\n                const graphNode = this.graphPane.getNodeById(id)\n                if (graphNode) {\n                    this.addGraphMapping(id, graphNode)\n                } else {\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\n                }\n            }\n\n            if (json[id].doc_nodes) {\n                for (const part in json[id].doc_nodes) {\n                    const path = json[id].doc_nodes[part]\n                    \n                    const document = this.getEditor().value.document\n                    if (document.hasNode(path)) {\n                        this.setLinkMapping(id, document.getNode(path), part)\n                    } else {\n                        console.log(document);\n                        \n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\n                    }\n                }\n            }\n        }\n\n        return this.map\n    }\n\n    downloadExperimentData() {\n        // save first to log the latest document version\n        this.save(() => {\n            db.table('projects')\n            .toArray(projects => {\n                const data = {\n                    timestamp: new Date(),\n                    preTaskSubmission: localStorage.getItem('preTaskSubmission'),\n                    projects: projects,\n                }\n                this.downloadJSON(data, 'Write Reason logs.json')\n                \n            }).catch(err => {\n                toast.error(\"Error downloading logs: \" + err)\n            })\n        }, true)\n    }\n\n    getArgumentHTML() {\n        const parentStyleIs = (node, styleToCheck) => {\n            const parent = this.getEditor().value.document.getParent(node.key)\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\n        }\n\n        const RULES = [\n            {\n                serialize: (node, children) => {\n                    if ([\"block\", \"inline\"].includes(node.object)) {\n                        switch(node.type) {\n                            case 'paragraph':\n                            case '':\n                                return <p>{children}</p>\n\n                            case 'heading':\n                                return <h2>{children}</h2>\n                            \n                            case 'section':\n                                return <div>{children}</div>\n                            \n                            case 'body':\n                                if (parentStyleIs(node, \"Heading only\")) {\n                                    return <p></p>\n                                } else {\n                                    return <p>{children}</p>\n                                }\n\n                            case 'link':\n                                if (node.object === \"inline\") {\n                                    return <span>{children}</span>\n                                } else {\n                                    if (parentStyleIs(node, \"Body only\")) {\n                                        return <p></p>\n                                    } else {\n                                        return <h2>{children}</h2>\n                                    }\n                                }\n\n                            default:\n                                return undefined\n                        }\n                    } else if(node.object === 'string') {\n                        return node.text\n                    }\n                } \n            }\n        ]\n\n        const serializer = new Html({rules: RULES})\n        return serializer.serialize(this.getEditor().value)\n    }\n\n    downloadJSON(json, filename) {\n        const file = new Blob([JSON.stringify(json, null, 2)], {type: 'text/plain'})\n        this.downloadBlob(file, filename)\n    }\n\n    downloadBlob(blob, filename) {\n        const element = document.createElement(\"a\");\n        element.href = URL.createObjectURL(blob);\n        element.download = filename;\n        document.body.appendChild(element); // Required for this to work in FireFox\n        element.click();\n    }\n\n    exportPDF() {\n        this.logger.getLog(log => {\n            this.getReactPdfDocument().then(file => {      \n                this.downloadBlob(file, this.projectName + \".pdf\")\n            })\n        })\n    }\n\n    getReactPdfDocument() {\n        const markdown = this.getArgumentMarkdown()\n\n        Font.register({family: 'Crimson Text', fonts: [\n            {src: CrimsonText},\n            {src: CrimsonTextBold, fontWeight: 800}\n        ]})\n\n        const styles = StyleSheet.create({\n            page: {\n                padding: 80\n            },\n            text: {\n                fontFamily: \"Crimson Text\",\n                width: \"100%\",\n                fontSize: \"12pt\",\n                paddingBottom: 8,\n            },\n            heading: {\n                fontFamily: \"Crimson Text\",\n                textDecoration: \"underline\",\n                fontWeight: 800,\n                width: \"100%\",\n                fontSize: \"12pt\"\n            }\n        })\n\n        const document = (\n            <Document>\n                <Page style={styles.page}>\n                    {markdown.split('\\n').map(line => {                        \n                        if (line.startsWith('##')) { // markdown heading\n                            line = line.substring('##'.length)\n                            return <PdfText style={styles.heading}>{line}</PdfText>\n                        }\n\n                        return <PdfText style={styles.text}>{line}</PdfText>\n                        }\n                    )}\n                </Page>\n            </Document>\n        )\n        return pdf(document).toBlob()\n    }\n\n    getArgumentMarkdown() {\n        var output = this.getArgumentHTML()\n        \n        var tagReplacements = [\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\n\n            {regex: /<p>/g},\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\n            {regex: /<div>/g},\n            {regex: /<\\/div>/g},\n            {regex: /<span>/g},\n            {regex: /<\\/span>/g},\n            {regex: /<h2>/g, replace: \"## \"},\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\n        ]\n        tagReplacements.forEach((replacement) => {\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\n        })\n\n        // unescape HTML entities, eg replace '&amp' with '&'\n        var element = document.createElement(\"span\")\n        element.innerHTML = output\n        output = element.innerText\n\n        return output\n    }\n\n    finishCondition() {\n        window.onbeforeunload = undefined // remove the warning about closing the tab\n        window.clearInterval(this.intervalLogger)\n    }\n\n    getEditor() {\n        return this.editor_ref.current;\n    }\n\n    getNodeId() {\n        this.node_id_counter++;\n        return this.node_id_counter;\n    }\n\n    canAddLinkAtSelection() {\n        const value = this.getEditor().value;\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\n        return !is_in_linked_block && !is_in_linked_inline;\n    }\n\n    addLinkAtSelection(id, graph_node) {\n        this.getEditor().wrapLinkAtSelection(id);\n        this.addGraphMapping(id, graph_node);\n    }\n\n    addGraphMapping(id, graph_node) {\n        graph_node.setIsOnGraph(true);\n        this.map[id] = { graph_node: graph_node };\n    }\n\n    setLinkMapping(id, doc_node, long_or_short) {\n        if (!this.map[id]) {\n            // uh oh, this should exist\n            this.map[id] = {}\n\n            // maybe the mapping was deleted and re-added with ctrl-Z\n            // if so, hopefully it's stored as recently deleted\n            this.checkRecycleBinForGraphNode(id)\n        }\n\n        if (this.map[id].doc_nodes === undefined) {\n            this.map[id].doc_nodes = {};\n        }\n        this.map[id].doc_nodes[long_or_short] = doc_node;\n    }\n\n    getGraphNodeAndDocNode(id) {\n        return this.map[id];\n    }\n\n    checkRecycleBinForGraphNode(id) {\n        if (!this.map[id]) {\n            this.map[id] = {}\n        }\n\n        if (this.map[id].graph_node) {\n            // no need to restore\n            return;\n        }\n\n        const prev_version = this.map_recycle_bin[id]\n        if (prev_version && prev_version.graph_node) {\n            console.log('restored from recycle');\n            \n            this.addGraphMapping(id, prev_version.graph_node)\n        }\n    }\n\n    getGraphNode(id) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            return map.graph_node;\n        }\n    }\n\n    removeGraphNode(id) {\n        if (this.getDocNodes(id)) {\n            Object.values(this.getDocNodes(id)).forEach(node => {\n                this.getEditor().removeGraphLink(node);\n            })\n            this.map[id] = undefined;\n        }\n    }\n\n    removeDocNode(id) {\n        var map = this.getGraphNodeAndDocNode(id)\n        if (map) {\n            if (map.graph_node) {\n                map.graph_node.setIsOnGraph(false);\n            }\n            \n            this.map_recycle_bin[id] = this.map[id]\n            this.map[id] = undefined\n        }\n    }\n\n    getDocNodes(id) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            return map.doc_nodes;\n        }\n    }\n\n    getDocNodeShortText(id) {\n        const docNode = this.getDocNodes(id);\n        if (docNode) {\n            return docNode.short;\n        }\n    }\n\n    getDocNodeLongText(id) {\n        const docNode = this.getDocNodes(id);\n        if (docNode) {\n            return docNode.long;\n        }\n    }\n\n    getDocNodeRef(id, long_or_short) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map && map.doc_link_node) {\n            return map.doc_link_node[long_or_short].current;\n        }\n    }\n\n    getAllDocNodeRefs(id) {\n        var docNodes = [];\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\n                    docNodes.push(map.doc_link_node[long_or_short].current)\n                }\n            })\n        }\n        return docNodes;\n    }\n\n    registerLinkNode(id, ref, long_or_short) {\n        if (this.map[id].doc_link_node === undefined) {\n            this.map[id].doc_link_node = {};\n        }\n        this.map[id].doc_link_node[long_or_short] = ref;\n    }\n\n    // check whether a graph node's doc node still exists\n    updateIsOnGraphStatus(id) {\n        var docNode = this.getDocNodeShortText(id);\n        if (!docNode) {\n            return false\n        }\n\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\n            // tell the graph node that there is no doc node any more, for whatever reason\n            this.removeDocNode(id)\n            return false\n        }\n\n        return true\n    }\n\n    updateDocShortText(id, newText) {\n        var docNode = this.getDocNodeShortText(id);\n        \n        if (docNode) {\n            var editor = this.getEditor();\n\n            if (this.updateIsOnGraphStatus(id)) {\n                // replace any text with newText\n                docNode.nodes.forEach(child => {\n                    editor.removeNodeByKey(child.key);\n                });\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\n            }\n        }\n    }\n\n    updateGraphShortText(id, newText) {\n        var graphNode = this.getGraphNode(id);\n        \n        if (graphNode) {\n            graphNode.updateShortText(newText);            \n        }\n    }\n\n    updateGraphLongText(id, newText) {\n        var graphNode = this.getGraphNode(id);\n        \n        if (graphNode) {\n            graphNode.updateLongText(newText);            \n        }\n    }\n\n    explodeNodes() {\n        this.graphPane.explodeNodes()\n    }\n}","import React, { Component } from 'react'\n\nexport default class LogLoadButton extends Component {\n    render() {\n        const src = process.env.PUBLIC_URL + '/thumbnails/' + this.props.participant_id + '.png'\n        return (\n            <div className='log-load-button' onClick={() => {this.props.loadLog(this.props.participant_id)}}>\n                <img src={src} className='log-load-img' alt={\"P\" + this.props.participant_id + \" map thumbnail\"}/>\n\n                <p>P{this.props.participant_id}</p>\n            </div>\n        );\n      }\n}","import React, { Component } from 'react';\nimport './LoadProject.css'\nimport db from '../../db.js'\nimport SharedState from '../../shared_state.js';\nimport LogLoadButton from './LogLoadButton.js';\nimport { toast } from 'react-toastify';\n\nexport default class LoadProject extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            projects: []\n        };\n        this.loadProject = this.loadProject.bind(this)\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\n        this.onDropLogFiles = this.onDropLogFiles.bind(this)\n        this.exploreLog = this.exploreLog.bind(this)\n        \n        document.title = \"Write Reason\"\n\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\n        if (process.env.NODE_ENV === 'development' && this.props.autoload) {\n            this.loadProject(this.props.autoload)\n        }\n    }\n\n    componentDidMount() {\n        if (process.env.NODE_ENV !== 'development' || !this.props.autoload) {\n            this.updateProjectsFromDb()\n        }\n    }\n\n    updateProjectsFromDb() {\n        // todo - only retrieve relevant rows from projects table?\n        db.table('projects')\n            .toArray(projects => {\n                this.setState({ projects })\n            }).catch(err => {\n                toast.error(\"Error when loading projects: \" + err)\n            })\n    }\n\n    loadProject(id) {\n        const params = { condition: 'graph' }\n        const sharedState = new SharedState(id, params)\n        this.props.transitionToEditor(sharedState)\n    }\n\n    deleteProject(id) {\n        if (window.confirm('Are you sure you want to delete this project? This cannot be undone.')) {\n            db.table('projects')\n                .delete(id)\n                .then(() => {\n                    this.updateProjectsFromDb()\n                })\n        }\n    }\n\n    onDropLogFiles(files) {\n        files.forEach((file) => {\n            const reader = new FileReader()\n      \n            reader.onabort = () => console.log('file reading was aborted')\n            reader.onerror = () => console.log('file reading has failed')\n            reader.onload = () => {\n                const stored = localStorage.getItem('logsToExplore') || JSON.stringify({logs: []})\n                const allLogs = JSON.parse(stored).logs\n\n                var newLog = JSON.parse(reader.result)\n                newLog.filename = file.name\n                newLog.projects.forEach(project => project.filename = file.name)\n                allLogs.push(newLog)\n                localStorage.setItem('logsToExplore', JSON.stringify({logs: allLogs}))\n            }\n            reader.readAsText(file)\n        })\n    }\n\n    exploreLog(project, saveIndex) {\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.props.transitionToEditor }\n        const sharedState = new SharedState(-1, params)\n        this.props.transitionToEditor(sharedState)\n    }\n    \n    render() {\n        const participant_ids = [1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 14, 15, 17, 18, 21, 22, 23, 25, 26]\n\n        const loadLog = (id) => {\n            import('../../assets/logs/' + id + '.json')\n            .then((log) => {\n                console.log(log)\n                this.exploreLog(log.projects[0], log.projects[0].log.saves.length - 1)\n            })\n            document.title = \"P\" + id + \" - Write Reason\"\n        }\n\n        return (\n            <>\n                <div className=\"load-project\">\n                    <div className=\"logs-grid\">\n                        {\n                            participant_ids.map(id => <LogLoadButton participant_id={id} loadLog={loadLog} key={id}/>)\n                        }\n                        \n                    </div>\n                </div>\n\n                <div className='intro-section'> <div className=\"license\">\n                    <h4>Using this data</h4>\n\n                    <p>This data was collected by Adam Binks, Alice Toniolo and Miguel Nacenta, from consenting study participants, and is released  \n                        under <a href=\"https://creativecommons.org/licenses/by/4.0/\">Creative Commons Attribution 4.0 International License</a>. The data is shared in an anonymised form\n                        as approved by University of St Andrews <a href=\"https://www.st-andrews.ac.uk/research/environment/committees/utrec/\">UTREC</a>, approval code CS14896. \n                        By accessing this data you agree not to use it to attempt to reidentify individual participants.</p>\n\n                    {/* <p>When giving attribution, use the following citation information:<br/>\n                    Adam Binks, Alice Toniolo and Miguel A. Nacenta. (2021) Representational transformations: Using maps to write essays ... [etc, rest of citation]</p> */}\n\n                    <a href=\"representational_transformations_data.zip\"><button className=\"pure-button\">Download the data</button></a>\n                </div> </div>\n            </>\n        );\n      }\n}","import React, { Component } from 'react';\nimport './ExperimentalControls.css';\n\nexport default class ExperimentControls extends Component {\n    render() {\n        if (this.props.sharedState.params.logExplore) {\n            return (\n                <div className=\"experiment-controls\">\n                    <button className='pure-button button-primary' onClick={this.props.backToMenu}>Back</button>\n                </div>\n            );\n        }\n    }\n}","import React, { Component } from 'react'\n\nexport default class TimelineEntry extends Component {\n    render() {\n        let theClass = \"\"\n        if (this.props.log.type.includes('doc')) {\n            theClass = 'red'\n        }\n\n        if (this.props.log.type.includes('node')) {\n            theClass = 'blue'\n        }\n\n        if (this.props.log.type.includes('doc_create_from_node') || this.props.log.type.includes('doc_node_change_format')) {\n            theClass = 'yellow'\n        }\n\n        if (this.props.log.type.includes('arrow')) {\n            theClass = 'green'\n        }\n\n        if (this.props.isExploreHead) {\n            theClass += ' explore-head pure-button-active'\n        }\n\n        return (\n        <button className={theClass} onClick={this.props.onClick}>\n            {this.props.log.type} <i>{this.props.log.id && (this.props.log.id.toString().length < 4 ?\n                                                                this.props.log.id : \n                                                                this.props.log.source && this.props.log.source + \" → \" + this.props.log.target)}</i><br/>\n            {this.props.timestampFormatted}\n        </button>\n        );\n      }\n}","import React, { Component } from 'react'\nimport TimelineEntry from './TimelineEntry'\nimport { Block } from 'slate'\n\nexport default class LogExploreTimeline extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            exploreHead: undefined\n        }\n\n        this.moveExploreHead = this.moveExploreHead.bind(this)\n        this.exploreEvent = this.exploreEvent.bind(this)\n        this.setDocValue = this.setDocValue.bind(this)\n        this.handleKeyDown = this.handleKeyDown.bind(this)\n    }\n\n    moveExploreHead(event) {\n        const graph = document.getElementById('graph')\n        graph.classList.add('timeline-explore-mode')\n\n        const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\n\n        if (!orderedLogs) {\n            return\n        }\n\n        this.setState({\n            exploreHead: event\n        })\n\n        var pastExploreHead = false\n        var lastDocChangeContent = \"empty\"\n        for (let i = 0; i < orderedLogs.length; i++) {\n            this.exploreEvent(orderedLogs[i], pastExploreHead)\n\n            if (orderedLogs[i].type === 'doc_change' && !pastExploreHead) {\n                lastDocChangeContent = orderedLogs[i].content\n            }\n\n            if (orderedLogs[i] === event) {\n                pastExploreHead = true\n                \n                this.setDocValue(lastDocChangeContent)\n            }\n        }\n    }\n\n    setDocValue(text) {\n        const editor = this.props.sharedState.getEditor()\n\n        editor.moveToRangeOfDocument()\n        editor.delete()\n        editor.moveToStartOfDocument()\n\n        const blockToInsert = Block.create({object: 'block', type: ''})\n        const section = editor.value.document.getParent(editor.value.startBlock.key);\n        const sectionParent = editor.value.document.getParent(section.key);     \n        if (sectionParent) {\n            const sectionIndex = sectionParent.nodes.indexOf(section);\n            editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\n            editor.moveBackward(1)\n        }\n\n        editor.insertText(text)\n    }\n\n    exploreEvent(event, hasNotBeenExplored) {\n        const graphPane = this.props.sharedState.graphPane\n        var node\n\n        const updateSvgElement = (element) => {\n            if (!element) {\n                return\n            }\n\n            if (hasNotBeenExplored) {\n                element.removeClass('has-been-explored')\n            } else {\n                element.addClass('has-been-explored')\n            }\n        }\n\n        switch (event.type) {\n            case 'node_create':\n                node = graphPane.getNodeById(event.id)\n                if (node) {\n                    updateSvgElement(node.rect)\n                } else if (!hasNotBeenExplored) {\n                    node = graphPane.addTempNode(event.id)\n                    if (node) {\n                        updateSvgElement(node.rect)\n                    }\n                }\n                break\n            \n            case 'node_delete':\n                if (!hasNotBeenExplored) {\n                    node = graphPane.getNodeById(event.id)\n                    if (node) {\n                        node.delete(this.props.sharedState)\n                        graphPane.numTempNodes--\n                    }\n                }\n                break\n            \n            case 'arrow_create':\n                const arrow = graphPane.mouse_follower.getConnectorObjectConnecting(event.source, event.target)\n                if (arrow) {\n                    updateSvgElement(arrow.line)\n                } else if (!hasNotBeenExplored) {\n                    graphPane.mouse_follower.addTempArrow(event.source, event.target, \"black\", event.id)\n                }\n                break\n            \n            case 'arrow_delete':\n                if (hasNotBeenExplored) {\n                    break\n                }\n\n                const sourceDestString = graphPane.mouse_follower.temp_arrows[event.id]\n                if (sourceDestString) {\n                    graphPane.mouse_follower.remove_arrow(graphPane.mouse_follower.connector_objs[sourceDestString], undefined)\n                    graphPane.mouse_follower.connector_objs[sourceDestString] = undefined\n                }\n                break\n\n            case 'node_edit_short_text':\n                node = graphPane.getNodeById(event.id)\n                if (node && !hasNotBeenExplored) {\n                    node.updateShortText(event.text)\n                }\n                break\n\n            default:\n                break\n        }\n    }\n\n    handleKeyDown(e) {\n        var shift = undefined\n        if (e.keyCode === 39) { // right arrow\n            shift = 1\n        } else if (e.keyCode === 37) { // left arrow\n            shift = -1\n        }\n\n        if (shift !== undefined) {\n            const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\n            if (!orderedLogs) {\n                return\n            }\n\n            for (let i = 0; i < orderedLogs.length; i++) {\n                if (this.state.exploreHead === orderedLogs[i]) {\n                    if (i + shift > 0 && i + shift < orderedLogs.length) {\n                        this.moveExploreHead(orderedLogs[i + shift])\n                    }\n                }\n            }\n        }\n    }\n\n    render() {\n        const project = this.props.sharedState.params.logExplore.project\n        if (!project.orderedLogs) {\n            const markdown_events = project.log.events.document_content_markdown\n            project.log.events.doc_change = [] \n            markdown_events.forEach((e, index) => {\n                if (index === 0 || markdown_events[index - 1].content !== e.content) {\n                    project.log.events.doc_change.push({type: 'doc_change', content: e.content, timestamp: e.timestamp})\n                }})\n            project.log.events.doc_change.forEach(e => e.type = 'doc_change')\n\n            project.orderedLogs = [].concat.apply([], Object.values(project.log.events)).filter(e => e.type !== 'document_content_markdown')\n            project.orderedLogs.sort(function(a,b){\n                return new Date(a.timestamp) - new Date(b.timestamp);\n            })\n        }\n        const logs = project.orderedLogs\n\n        return (\n            <div className=\"timeline\" onKeyDown={this.handleKeyDown}>\n                <p className=\"timeline-description\">This timeline shows in what order the participant built their map and text.\n                <br/>Click on an event to see which elements had been created at that time.</p>\n                <p>{project.filename}</p>\n                {logs.map((log, index) => {\n                        const getDate = (timestamp) => timestamp.substring(\"2020-\".length, \"2020-07-21\".length)\n                        const time = log.timestamp.substring(\"2020-07-21T\".length, \"2020-07-21T12:51:45\".length)\n\n                        const makeEntry = () => <TimelineEntry\n                            onClick={() => this.moveExploreHead(log)}\n                            log={log}\n                            timestampFormatted={time}\n                            sharedState={this.props.sharedState}\n                            isExploreHead={this.state.exploreHead === log}\n                        />\n\n                        if (index === 0 || getDate(log.timestamp) !== getDate(logs[index - 1].timestamp)) {\n                            return <>\n                                <p><b>{getDate(log.timestamp)}</b></p>\n                                {makeEntry()}\n                            </>\n                        } else {\n                            return makeEntry()\n                        }\n                    }\n                )}\n            </div>\n        );\n      }\n}","import React, { Component } from 'react';\nimport './ExperimentalControls.css';\n\nexport default class SlideOutPane extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            open: false\n        }\n    }\n\n    render() {\n        const addClosed = (cn) => {\n            return cn + (this.state.open ? \"\" : \" closed\")\n        }\n        return (\n            <>\n                <button className={addClosed(\"pure-button timeline-toggle-button\")} onClick={() => {\n                    this.setState({open: !this.state.open})\n                    const graph = document.getElementById('graph')\n                    graph.classList.remove('timeline-explore-mode')\n                }}>\n                    {this.state.open ? \"Hide timeline\" : \"Show timeline\"}\n                </button>\n                <div className={addClosed(\"slide-out-pane\")}>\n                    {this.props.children}\n                </div>\n            </>\n        )\n    }\n}","import React, { Component } from 'react';\nimport { toast } from 'react-toastify';\n\nexport default class ExperimentInfo extends Component {\n    render() {\n        // eslint-disable-next-line no-useless-concat\n        const emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\n\n        const scenario = localStorage.getItem('scenario')\n\n        var question;\n        if (scenario === 'biohacking') {\n            question = <b>QUESTION: Should greater regulatory control be exerted over genetic biohacking?</b>\n        } else if (scenario === 'sharedSpace') {\n            question = <b>QUESTION: Should “shared spaces” in urban planning be promoted?</b>\n        } else {\n            toast.error(\"Question not found. Please re-open Write Reason using the link in the email we sent you.\")\n        }\n\n        return (\n            <>\n                <h2>Instructions for study participants</h2>\n                <p>Thank you for participating in this study!</p>\n\n                <h3>Before you start</h3>\n                <p>Watch the “How to use” video on the home page.</p>\n\n                <h3>The task</h3>\n\n                <p>Your task is to decide where you stand on the question below, and write an essay justifying your view. Use Write Reason for all parts of the task.</p>\n\n                {question}\n\n                <p>Write in the style of a short academic essay. You may not have heard of this topic before - don't worry, the fact sheet has all the information you need on it!</p>\n\n                <h3>How to work on the task</h3>\n                <ol>\n                    <li>First, <a href=\"#factsheet\" onClick={(e) => {e.preventDefault(); this.props.sharedState.viewFactSheet()}}>click here to read the fact sheet</a></li>\n                    <li>Spend around 1 hour 40 minutes on this task, over the next week</li>\n                    <li>Aim for around 700 words as a very rough guide - though it's fine to exceed this!</li>\n                    <li>Whenever you work on the task record it in the diary. <a href='/diary_template.csv' download>Download a blank diary here</a></li>\n                    <li>Please <b>do not enter any personal information</b> when using Write Reason</li>\n                    <li>Your work will be saved in your browser on this computer when you press \"Save\"</li>\n                </ol>\n\n                <h3>What to do when you're finished</h3>\n                <ol>\n                    <li>Press the \"Export logs\" button in the bottom right of the screen, and keep the downloaded file somewhere safe</li>\n                    <li>Make sure your diary is filled out</li>\n                    <li>Email us at <a href={'mailto:' + emailAddress + '?subject=Write Reason task complete'}>{emailAddress}</a> to arrange a short interview about your experiences!\n                        During the interview you will send us the logs and your diary</li>\n                    <li>You will receive a £20 Amazon voucher to thank you for your time</li>\n                </ol>\n\n                <p>Your contribution to our research is incredibly valuable, thank you!</p>\n            </>\n        );\n    }\n}","import React, { Component } from 'react';\n\nexport default class PreTaskSection extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            q1: '',\n            q2: '',\n            q3: '',\n        }\n\n        this.handleChange = this.handleChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n    }\n\n    handleChange(event, question) {\n        this.setState({ [question] : event.target.value })\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        const questions = [this.state.q1, this.state.q2, this.state.q3]\n        var shouldReturn = false\n        questions.forEach(questionValue => {\n            if (!shouldReturn && (!questionValue || questionValue === \"\")) {\n                alert(\"Please enter an answer for all three questions\")\n                shouldReturn = true\n                return\n            }\n        })\n        if (shouldReturn) {\n            return\n        }\n\n        if (window.confirm(\"Are you ready submit your answers? You cannot undo this action\")) {\n            localStorage.setItem('preTaskSubmission', JSON.stringify(this.state))\n            this.props.transitionToMenu()\n        }\n    }\n\n    render() {\n        // eslint-disable-next-line no-useless-concat\n        var emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\n        return (\n            <div className='intro-section'>\n                <h3 style={{paddingTop: \"40px\"}}>Thank you for participating in this experiment!</h3>\n                <ol className=\"steps\">\n                    <li>\n                        <p>Before we begin, please complete this <a href=\"https://standrews.eu.qualtrics.com/jfe/form/SV_9tYNKrCBK8uHOiV\">short, anonymous demographics\n                            questionnaire</a> if you have not done so already.</p>\n                    </li>\n                    <li>\n                        <p> Then, write a paragraph (at least 2 sentences) answering each of the questions below:</p>\n\n                        <form onSubmit={this.handleSubmit} className=\"pure-form pure-form-stacked\">\n                            <label>When you write an essay, what do you aim to produce?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q1\")} placeholder=\"Your answer...\" />\n                            <label>What makes a good essay?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q2\")} placeholder=\"Your answer...\" />\n                            <label>What do you think are the possible purposes of writing an essay?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q3\")} placeholder=\"Your answer...\" />\n                            <input className=\"pure-button button-primary\" type=\"submit\" value=\"Submit answer\" />\n                        </form>\n\n                    </li>\n                </ol>\n\n                <p><i>Any questions? Get in touch at <a href={'mailto:' + emailAddress + '?subject=Write Reason question'}>{emailAddress}</a>.</i></p>\n                <br/>\n            </div>\n        )\n    }\n}","import React, { Component } from 'react';\nimport Logo from '../../assets/logo.png'\nimport \"video-react/dist/video-react.css\"\n\nexport default class IntroSection extends Component {\n    \n    render() {\n        return (\n            <div className='intro-section'>\n                <a href=\"https://adambinks.me/write-reason/\"><img src={Logo} className='logo' alt=\"Write Reason\"/></a>\n\n                <p>Explore the representations created by participants in our study,<br/> <em>Representational transformations: Using maps to write essays</em>.</p>\n            </div>\n        );\n      }\n}","/* eslint-disable no-fallthrough */\n/* eslint-disable default-case */\nimport React, { Component } from 'react';\nimport './App.css';\nimport DocPane from './components/doc/DocPane.js';\nimport GraphPane from './components/graph/GraphPane.js';\nimport SplitPane from 'react-split-pane';\nimport LoadProject from './components/loadproject/LoadProject.js';\nimport { DndProvider } from 'react-dnd'\nimport Backend from 'react-dnd-html5-backend'\nimport { ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport SaveButton from './components/experiment/SaveButton';\nimport LogExploreTimeline from './components/experiment/LogExploreTimeline';\nimport SlideOutPane from './components/experiment/SlideOutPane';\nimport ExperimentInfo from './components/experiment/ExperimentInfo';\nimport PreTaskSection from './components/loadproject/PreTaskSection';\nimport IntroSection from './components/loadproject/IntroSection';\nimport Modal from 'react-modal'\nimport { isMobile } from \"react-device-detect\";\n\nModal.setAppElement('#root')\nconst modalStyles = {\n    content : {\n      top                   : '50%',\n      left                  : '50%',\n      right                 : 'auto',\n      bottom                : 'auto',\n      marginRight           : '-50%',\n      transform             : 'translate(-50%, -50%)',\n      maxWidth              : '40%',\n      maxHeight             : '90%',\n      padding               : '50px'\n    }\n  }\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props);\n\n        var startPhase = 'loadproject'\n\n        this.state = {\n            phase: startPhase,\n            params: undefined\n        }\n\n        this.transitionToEditor = this.transitionToEditor.bind(this)\n        this.transitionToMenu = this.transitionToMenu.bind(this)\n    }\n\n    componentDidMount() {\n        if(window.location.search) {\n            const urlParams = new URLSearchParams(window.location.search)\n            const scenario = urlParams.get('scenario')\n\n            if (scenario !== 'biohacking' && scenario !== 'sharedSpace') {\n                console.error('Unrecognised scenario ' + scenario)\n            } else {\n                localStorage.setItem('scenario', scenario)\n                console.log(localStorage.getItem('scenario'))\n            }\n        }\n\n        this.getStorageUsed()\n    }\n\n    transitionToEditor(newSharedState, resetFirst) {\n        if (resetFirst) {\n            this.setState({phase: \"reset\", sharedState: undefined})\n            window.setTimeout(() => {\n                this.setState({ \n                    sharedState: newSharedState,\n                    phase: \"editor\"\n                })\n            }, 0)\n        } else {\n            this.setState({ \n                sharedState: newSharedState,\n                phase: \"editor\"\n            })\n        }\n    }\n\n    transitionToMenu() {\n        if (this.state.sharedState) {\n            this.state.sharedState.finishCondition()\n        }\n        this.setState({\n            sharedState: undefined,\n            phase: \"loadproject\"\n        })\n    }\n\n    getStorageUsed() {\n        navigator.storage && navigator.storage.estimate().then(estimate => {\n            if (!estimate) {\n                return\n            }\n\n            var storageUsed = estimate.usage / estimate.quota * 100\n            if (storageUsed < 0.00000005) {\n                storageUsed = 0 // prevent 10e-16 sort of thing\n            }\n            storageUsed = storageUsed.toPrecision(2)\n\n            this.setState({ storageUsed })\n        });\n    }\n\n    render() {\n        if (isMobile) {\n            return (\n                <p>Write Reason is designed for non-mobile devices. Please access from a laptop or desktop computer.</p>\n            )\n        }\n\n        switch(this.state.phase) {\n            case \"pretask\":\n                return (\n                    <PreTaskSection transitionToMenu={this.transitionToMenu} />\n                )\n            case \"loadproject\":\n                return (\n                    <>\n                        <IntroSection />\n                        <LoadProject transitionToEditor={this.transitionToEditor} autoload={false} />\n                        <footer>\n                            <p><b>Privacy notice</b>: This webpage simply downloads the Write Reason application to your browser. Once loaded, \n                            everything runs locally in your browser. No data is sent back to the server.</p>\n                        </footer>\n                    </>\n                )\n            case \"editor\":\n                return (\n                    <div className=\"App\">\n                        <Modal\n                            isOpen={this.state.modalIsOpen}\n                            style={modalStyles}\n                            contentLabel=\"Experiment information\"\n                            onRequestClose={() => this.setState({ modalIsOpen: false })}\n                        >\n                            <ExperimentInfo sharedState={this.state.sharedState}/>\n                            <button className=\"pure-button\" onClick={() => this.setState({ modalIsOpen: false })}>Close</button>\n                        </Modal>\n\n                        <DndProvider backend={Backend}>\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\n                                <DocPane sharedState={this.state.sharedState} />\n                                <GraphPane sharedState={this.state.sharedState} />\n                            </SplitPane>\n                            {\n                                this.state.sharedState.params.logExplore && <SlideOutPane><LogExploreTimeline sharedState={this.state.sharedState}/></SlideOutPane>\n                            }\n                            <SaveButton \n                                sharedState={this.state.sharedState}\n                                backToMenu={this.transitionToMenu} \n                                showExperimentInfo={() => this.setState({ modalIsOpen: true })}\n                            />\n                        </DndProvider>\n\n                        <ToastContainer\n                            position=\"bottom-center\"\n                            autoClose={5000}\n                            hideProgressBar\n                            newestOnTop={false}\n                            closeOnClick\n                            rtl={false}\n                            pauseOnFocusLoss\n                            draggable={false}\n                            pauseOnHover\n                        />\n                    </div>\n                );\n            \n            case \"reset\":\n                // hacky way to destroy and recreate all components\n                return (\n                    <p>...</p>\n                )\n        }\n    }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.register();\n"],"sourceRoot":""}