{"version":3,"sources":["assets/CrimsonText-Regular.ttf","assets/CrimsonText-Bold.ttf","assets/logo.png","assets/instructions.mp4","assets/thumbnail.png","components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/StyleButton.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/WordCountPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","components/loadproject/ProjectsList.js","components/loadproject/LogsExploreTable.js","logging.js","shared_state.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","components/experiment/TimelineEntry.js","components/experiment/LogExploreTimeline.js","components/experiment/ExperimentInfo.js","components/loadproject/PreTaskSection.js","components/loadproject/IntroSection.js","App.js","index.js"],"names":["module","exports","OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","this","hidePopup","bind","div","document","createElement","classList","add","appendChild","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","e","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","remove","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","id","node","insertSectionBlock","text","longText","logger","logEvent","removeFirstNode","value","nodes","size","link","Block","create","type","data","node_id","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","removeNodeByKey","get","key","handleMouseUp","clickedNode","isOverHalf","resetPos","getGraphNode","focus","getParent","moveToStartOfNode","moveBackward","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","deleteNode","old","new","setNodeByKey","newStyle","moveToRangeOfNode","graphNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","getEmptyParagraph","wrapBlockByKey","insertInline","insertText","moveForward","convertToInline","querySelector","removeDocNode","StyleButton","props","onClick","Component","LinkNode","state","hover","externalHover","setHover","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","addGraphNode","position","moveTo","blur","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","innerDiv","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","blockTarget","getClientOffset","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","dragOverCurrent","onMouseOver","onMouseUp","onMouseMove","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","map","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","code","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","destOffset","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","wordCount","count","getBlocks","words","toString","countWords","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","t","n","r","s","o","u","require","a","i","f","Error","l","call","1","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","ids","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","x2centre","grad","vals","rightLeftCalc","topBotCalc","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","keys","Array","isArray","Object","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","connector_objs","temp_arrows","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","show","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","dest","temp_id","graphPane","getNodeById","dest_node","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","updateName","newValue","substring","finishEditing","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","removeChild","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","setArrowColour","selected_option","newRelation","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","zoomCanvasTo","isOnGraph","annotatedOrder","getNodeId","translate","dropShadow","radius","arrow_hitbox","editRect","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","editText","doNotDeleteIfEmptyText","setIsOnGraph","showAnnotatedOrder","isFromJSON","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","rectHeight","annotatedOrderText","delete_if_empty_text","orderAnnotate","annotatedNumbers","num","getNextAnnotateNum","textarea","preEditText","screen_coords","display","scrollHeight","save_changes","updateDocShortText","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","$el","panZoom","zoomMin","zoomMax","zoomFactor","level","pos","cb","zoom","runner","animate","duration","ease","after","zone","root_point","doc","nodesSvgGroup","numTempNodes","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","blurActiveElement","setAttribute","loadNodesFromJSON","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","isSvgCoords","el","db","Dexie","version","stores","projects","ProjectsList","project","role","aria-label","loadProject","renameProject","duplicateProject","deleteProject","EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY","Logger","db_id","shouldLogToConsole","conditions","logToConsole","JSON","stringify","stateIsDirty","getLog","events","timestamp","Date","setLog","save","forceLog","saves","then","catch","err","msg","SharedState","onDataLoad","getProjectThen","doc_value","graph_value","logExplore","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getArgumentMarkdown","downloadExperimentData","mapToJSON","exportPDF","exploreNext","explorePrev","exploreLog","makeNodeReport","exportAnnotatedLog","explodeNodes","onbeforeunload","getStateIsDirty","returnValue","getEditor","downloadJSON","filename","sort","b","annotatedNum","scenario","localStorage","factSheetURL","open","mapFromJSON","projectName","title","lastSavedDocumentState","changes","idExists","info","logSaveState","message","saveIndex","transitionToEditor","nodeReport","linkedTexts","unlinkedTexts","linked","unlinked","linkedCharsProportion","trim","linkedWords","unlinkedWords","linkedWordProportion","rawValue","nodeReports","parse","setItem","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","preTaskSubmission","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","file","Blob","downloadBlob","blob","href","URL","createObjectURL","download","getReactPdfDocument","markdown","Font","register","family","fonts","src","CrimsonText","CrimsonTextBold","fontWeight","styles","StyleSheet","page","fontFamily","paddingBottom","heading","textDecoration","startsWith","pdf","toBlob","getArgumentHTML","regex","replacement","innerText","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LoadProject","addProject","updateProjectsFromDb","onDropLogFiles","prompt","newName","files","reader","FileReader","onabort","onerror","onload","stored","logs","allLogs","newLog","result","readAsText","ExperimentControls","backToMenu","TimelineEntry","theClass","isExploreHead","timestampFormatted","LogExploreTimeline","exploreHead","moveExploreHead","exploreEvent","setDocValue","handleKeyDown","orderedLogs","pastExploreHead","lastDocChangeContent","moveToRangeOfDocument","moveToStartOfDocument","hasNotBeenExplored","updateSvgElement","addTempNode","getConnectorObjectConnecting","addTempArrow","sourceDestString","shift","keyCode","markdown_events","document_content_markdown","doc_change","concat","getDate","time","makeEntry","ExperimentInfo","question","viewFactSheet","PreTaskSection","q1","q2","q3","handleChange","handleSubmit","questions","shouldReturn","questionValue","alert","transitionToMenu","paddingTop","onSubmit","rows","IntroSection","Logo","alt","Video","poster","Thumbnail","Modal","setAppElement","modalStyles","marginRight","maxWidth","maxHeight","App","phase","location","search","URLSearchParams","getStorageUsed","newSharedState","resetFirst","finishCondition","navigator","storage","estimate","storageUsed","usage","quota","toPrecision","isMobile","autoload","isOpen","modalIsOpen","contentLabel","onRequestClose","DndProvider","backend","Backend","defaultSize","showExperimentInfo","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover"],"mappings":"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","file":"static/js/main.4e9856c1.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Regular.62f10d46.ttf\";","module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Bold.89b16aa6.ttf\";","module.exports = __webpack_public_path__ + \"static/media/logo.510deb2b.png\";","module.exports = __webpack_public_path__ + \"static/media/instructions.f31121e4.mp4\";","module.exports = \"data:image/png;base64,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\"","export default class OptionPopup {\r\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\r\n        this.hidePopup = this.hidePopup.bind(this)\r\n\r\n        this.div = document.createElement(\"div\");\r\n        this.div.classList.add(\"option-popup-div\");\r\n        this.div.appendChild(this.generateTable(entries, callback, selected));\r\n        this.div.style.left = x + \"px\";\r\n        this.div.style.top = y + \"px\";\r\n\r\n        if (parent === undefined) {\r\n            parent = document.getElementById(\"graph\");\r\n        }\r\n        parent.appendChild(this.div);\r\n\r\n        // prevent the popup from showing up partially offscreen\r\n        const rect = this.div.getBoundingClientRect()\r\n        if (rect.right > window.innerWidth) {\r\n            this.div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\r\n        }\r\n        if (rect.bottom > window.innerHeight) {\r\n            this.div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\r\n        }\r\n\r\n        if (shouldHideOnClickOutside) {\r\n            setTimeout(() => this.hideOnClickOutside(this.div), 0.01);\r\n        }\r\n    }\r\n\r\n    generateTable(entries, callback, selected) {\r\n        var table = document.createElement(\"table\");\r\n        entries.forEach(entry => {\r\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\r\n\r\n            var row = table.insertRow();\r\n            row.classList.add(\"option-row\");\r\n            if (entry.name === selected) {\r\n                row.classList.add(\"option-row-selected\");\r\n            }\r\n\r\n            const selectItem = (e) => {\r\n                if (entry.isClickable) {                    \r\n                    callback(entry);\r\n                    this.hidePopup();\r\n                }\r\n            }\r\n\r\n            var colourCell = row.insertCell();\r\n            colourCell.textContent = entry.symbol;\r\n            colourCell.style.color = entry.colour;\r\n            colourCell.style.fontSize = \"150%\";\r\n            colourCell.style.padding = '10px'\r\n            \r\n            var nameCell = row.insertCell();\r\n            nameCell.classList.add('option-cell')\r\n            nameCell.textContent = entry.name\r\n\r\n            colourCell.addEventListener('click', selectItem)\r\n            nameCell.addEventListener('click', selectItem)\r\n\r\n            if (entry.buttons) {\r\n                entry.buttons.forEach(buttonEntry => {\r\n                    var buttonCell = row.insertCell()\r\n                    var button = document.createElement('BUTTON')\r\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\r\n                    button.className = \"pure-button\"\r\n                    button.style.padding = \"0px 10px 0px 10px\"\r\n                    buttonCell.appendChild(button)\r\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \r\n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row, selected: entry.name === selected,\r\n                            hidePopup: this.hidePopup})\r\n                })\r\n            }\r\n        });\r\n\r\n        return table;\r\n    }\r\n\r\n    hidePopup() {\r\n        this.div.remove()\r\n    }\r\n\r\n    hideOnClickOutside(element) {\r\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\r\n\r\n        const outsideClickListener = event => {\r\n            if (!element.contains(event.target) && isVisible(element)) {\r\n              element.remove();\r\n              removeClickListener()\r\n            }\r\n        }\r\n    \r\n        const removeClickListener = () => {\r\n            document.removeEventListener('click', outsideClickListener)\r\n        }\r\n    \r\n        document.addEventListener('click', outsideClickListener)\r\n        document.addEventListener('contextmenu', outsideClickListener)\r\n    }\r\n}","import { Block, Text } from 'slate';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default function GraphPlugin(options) {\r\n    return {\r\n        onMouseUp(event, editor, next) {\r\n            var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n            if (draggedNode) {\r\n                draggedNode.resetPos();\r\n\r\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n                    toast.error('You can\\'t add the same node twice!')\r\n                    console.log('Duplicate - editor')\r\n                } else {\r\n                    const target = editor.findEventRange(event)\r\n                    if (target) {\r\n                        editor.select(target)\r\n\r\n                        // prevent insertion inside an inline link\r\n                        // (insertion inside a section is fixed by schema)\r\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\r\n                        if (linkNode) {\r\n                            editor.moveToEndOfNode(linkNode)\r\n                        }\r\n\r\n                        addSection(draggedNode, editor)\r\n                    }\r\n                }\r\n            }\r\n            next();\r\n        },\r\n        \r\n        onBlur(event, editor, next) {\r\n            editor.deselect();\r\n            next();\r\n        },\r\n\r\n        commands: {\r\n            removeGraphLink(editor, node) {\r\n                const document = editor.value.document\r\n                if (!document.hasNode(node.key)) {\r\n                    console.log('couldnt remove graph link, node doesnt exist');\r\n                    \r\n                    return\r\n                }\r\n\r\n                if (node.type === \"section\") {\r\n                    // move the children out from inside this section to be after it\r\n                    const section_index = editor.value.document.nodes.indexOf(node)\r\n                    if (section_index !== -1) {\r\n                        var child_index = 0;\r\n                        node.nodes.forEach(child => {\r\n                            if (!document.hasNode(child.key)) {\r\n                                return\r\n                            }\r\n\r\n                            const nodeStyle = node.data.get(\"nodeStyle\")\r\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\r\n                                editor.removeNodeByKey(child.key)\r\n                            } else {\r\n                                // offset varies because the link node has already been removed if body only\r\n                                const destOffset = (child_index === 1 && nodeStyle === \"Body only\") ? 1 : child_index + 1\r\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + destOffset)\r\n                            }\r\n\r\n                            child_index++\r\n                        });\r\n                    }\r\n                    editor.removeNodeByKey(node.key)\r\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \r\n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\r\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\r\n\r\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\r\n\r\n    editor.getSharedState().logger.logEvent({\r\n        'type': 'doc_create_from_node', \r\n        'node_id': draggedNode.id, \r\n        'short_text': draggedNode.text, \r\n        'long_text': draggedNode.longText\r\n    });\r\n}\r\n\r\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\r\n    // if its an empty document, prevent a blank node being shown above the section added\r\n    const removeFirstNode = editor.value.document.nodes.size === 1 && editor.value.document.text === \"\"\r\n    \r\n    var link = Block.create({\r\n        type: 'link',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: text})]\r\n    })\r\n\r\n    var body = Block.create({\r\n        type: 'body',\r\n        data: {node_id: id},\r\n        nodes: [Text.create({text: longText})]\r\n    })\r\n\r\n    var section = Block.create({\r\n        type: 'section',\r\n        data: {node_id: id, nodeStyle: initialNodeStyle},\r\n        nodes: [link, body]\r\n    })\r\n\r\n    editor.insertBlock(section);\r\n    editor.moveToEndOfNode(section)\r\n\r\n    if (removeFirstNode) {\r\n        editor.removeNodeByKey(editor.value.document.nodes.get(0).key)\r\n    }\r\n\r\n    return section\r\n}\r\n\r\nexport function handleMouseUp(editor, clickedNode, isOverHalf) {\r\n    var draggedNode = editor.getSharedState().draggedNode;\r\n\r\n    if (draggedNode) {\r\n        draggedNode.resetPos();\r\n\r\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\r\n            toast.error('You can\\'t add the same node twice!')\r\n            console.log('Duplicate - node');\r\n            \r\n        } else {\r\n            const { value } = editor\r\n            const { document } = value\r\n            editor.focus()\r\n\r\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\r\n                clickedNode = document.getParent(clickedNode);\r\n            }\r\n\r\n            if (isOverHalf) {\r\n                editor.moveToEndOfNode(clickedNode);\r\n            } else {\r\n                editor.moveToStartOfNode(clickedNode)\r\n                editor.moveBackward()\r\n            }\r\n\r\n            addSection(draggedNode, editor);\r\n\r\n            editor.getSharedState().draggedNode = false;\r\n            return true;\r\n        }\r\n    }\r\n}","import { Block } from 'slate';\r\nimport OptionPopup from '../graph/OptionPopup.js'\r\nimport { insertSectionBlock } from './GraphPlugin.js';\r\n\r\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\r\n    var entries = [\r\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"⌶\"},\r\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"▤\"},\r\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"▔\"},\r\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"▂\"},\r\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n    ]\r\n\r\n    if (entriesToHide) {\r\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    const onOptionSelect = (selectedEntry) => {\r\n        const selected = selectedEntry.name\r\n        if (selected === \"Delete\") {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_delete\",\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n            deleteNode(node, editor);\r\n        } else {\r\n            var nodeStyle = node.data.get(\"nodeStyle\")\r\n            if (!nodeStyle) {\r\n                nodeStyle = \"Inline\"\r\n            }\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"doc_node_change_format\",\r\n                old: nodeStyle,\r\n                new: selected,\r\n                id: node.data.get(\"node_id\")\r\n            });\r\n\r\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\r\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\r\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\r\n                convertFromInline(node, editor, selected)\r\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\r\n                convertToInline(node, editor, selected)\r\n            }\r\n        }\r\n    }\r\n\r\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\r\n}\r\n\r\nexport function deleteNode(node, editor) {\r\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\r\n\r\n    editor.removeNodeByKey(node.key)\r\n\r\n    if (editor.value.document.nodes.size === 0) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n}\r\n\r\nfunction convertFromInline(node, editor, newStyle) {\r\n    editor.moveToRangeOfNode(node);\r\n    const parent = editor.value.document.getParent(node.key)\r\n    if (parent && parent.text === node.text) {\r\n        editor.moveToRangeOfNode(parent)\r\n    }\r\n\r\n    const graphNode = editor.getSharedState().getGraphNode(node.data.get('node_id'))\r\n    const longText = graphNode && graphNode.longText ? graphNode.longText : \"\"\r\n\r\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, longText, newStyle)    \r\n}\r\n\r\nfunction getEmptyParagraph() {\r\n    return Block.create({\r\n        type: 'paragraph'\r\n    })\r\n}\r\n\r\nfunction convertToInline(node, editor) {\r\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\r\n    // need to get 0th child because previous of section is the body inside it\r\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\r\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\r\n\r\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\r\n    if (!prev && !next) {\r\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\r\n    }\r\n\r\n    editor.moveToRangeOfNode(node)\r\n\r\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\r\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\r\n        editor.wrapBlockByKey(node.key, \"paragraph\")\r\n        editor.removeNodeByKey(node.key)\r\n    } else {\r\n        editor.removeNodeByKey(node.key)\r\n    }\r\n\r\n    editor.insertInline({\r\n            type: \"link\",\r\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\r\n        })\r\n        .insertText(shortText)\r\n    \r\n    // prevent rare bug where style is changed inline > section > inline, and doc-graph link is severed\r\n    setTimeout(() => {editor.focus(); editor.moveForward(); editor.moveBackward()}, 0)\r\n}\r\n\r\nexport const getNodeStyleClass = (verbose) => {\r\n    switch (verbose) {\r\n        case \"Heading only\":\r\n            return \" hide-body\"\r\n\r\n        case \"Body only\":\r\n            return \" hide-heading\"\r\n    \r\n        default:\r\n            return \"\";\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport { showNodeSwitchMenu } from './NodeSwitch';\r\n\r\nexport default class StyleButton extends Component {\r\n    render() {\r\n        return (<button \r\n                    className={'style-button pure-button '\r\n                                 + ((this.props.nodeStyle === 'section') ? 'style-button-section' : 'style-button-inline')}\r\n                    onClick={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\r\n                        <p className='eye-icon'></p>\r\n                </button>)\r\n    }\r\n}","import React, { Component } from 'react'\r\nimport StyleButton from '../StyleButton'\r\n\r\nexport default class LinkNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n        }\r\n        \r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"link_cursor\", cursorInside)\r\n        }\r\n        \r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"node-link\" + hoverClass;\r\n\r\n        if (this.props.linkStyle === \"heading\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    <u><b>{this.props.children}</b></u>\r\n                </p>\r\n            );\r\n\r\n        } else if (this.props.linkStyle === \"inline\") {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}\r\n                        onMouseEnter={() => this.setHover(true)} \r\n                        onMouseLeave={() => this.setHover(false)}>\r\n                    {this.props.children}\r\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='inline' />}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","import React, { Component } from 'react';\r\n\r\nexport default class BodyNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n        this.selectNode = props.selectNode;\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\r\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\r\n\r\n        const { value } = this.props.editor;\r\n        const { document, selection } = value;\r\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"body_cursor\", cursorInside);\r\n            node.setHoverer(\"body_mouse\", this.state.hover);\r\n        }\r\n\r\n        if (this.props.isEmpty) {\r\n                return (\r\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\r\n                        Type some text...{this.props.children}\r\n                    </p>\r\n                );\r\n        } else {\r\n            return (\r\n                <p className={classes} {...this.props.attributes}>\r\n                    {this.props.children}\r\n                </p>\r\n            );\r\n        }\r\n    }\r\n}","export const ItemTypes = {\r\n    BLOCK: \"block\",\r\n}","import { DragSource } from 'react-dnd';\r\nimport { ItemTypes } from '../../dragtypes';\r\nimport { addSection } from './GraphPlugin.js'\r\n\r\nconst blockSource = {\r\n    canDrag(props) {\r\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\r\n        return props.editor.value.selection.isCollapsed\r\n    },\r\n\r\n    beginDrag(props) {\r\n      // Return the data describing the dragged item\r\n      const item = { id: props.node.id, node: props.node }\r\n      return item\r\n    },\r\n\r\n    endDrag(props, monitor, component) {\r\n        if (!monitor.didDrop()) {            \r\n            return\r\n        }\r\n\r\n        const dropResult = monitor.getDropResult()\r\n        const sharedState = props.editor.getSharedState()\r\n\r\n        if (dropResult.droppedOnGraph) {\r\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\r\n            const draggedNode = {\r\n                id: graphNode.id,\r\n                node: graphNode,\r\n                text: \"\",\r\n                longText: props.node.text\r\n            }\r\n            props.editor.moveTo(props.node.key)\r\n            \r\n            addSection(draggedNode, props.editor, \"Body only\")\r\n            props.editor.removeNodeByKey(props.node.key)\r\n            props.editor.blur()\r\n        } else {\r\n            const document = props.editor.value.document;\r\n            const blockParent = document.getParent(props.node.key);\r\n            const blockIndex = blockParent.nodes.indexOf(props.node);\r\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\r\n\r\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\r\n\r\n            sharedState.logger.logEvent({\r\n                'type': 'reorder',\r\n                'id': props.node.data.get('node_id'),\r\n                'old_index': blockIndex,\r\n                'new_index': dropResult.indexDroppedOn + indexShift,\r\n            });\r\n        }\r\n    },\r\n  }\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDragSource: connect.dragSource(),\r\n        dragPreview: connect.dragPreview(),\r\n        isDragging: monitor.isDragging(),\r\n    }\r\n}\r\n\r\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\r\nimport { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nexport function isOverHalf(component, event) {\r\n    // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\r\n    const outerDiv = ReactDOM.findDOMNode(component)        \r\n    const outerRect = outerDiv.getBoundingClientRect()\r\n    \r\n    var innerDiv;\r\n    for (let item of outerDiv.children) {\r\n        if (item.classList.contains('plain-block') || item.classList.contains('section')) {\r\n            innerDiv = item;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (!innerDiv) {\r\n        console.log('error: couldn\\'t find the inner div!');\r\n        return\r\n    }\r\n    const innerRect = innerDiv.getBoundingClientRect()       \r\n\r\n    // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\r\n    const offset = (innerRect.y - outerRect.y)\r\n    var newState = false\r\n    if (event.clientY + offset > (innerRect.y + innerRect.height / 2)) {\r\n        newState = true\r\n    }\r\n    \r\n    if (component.state.overHalf !== newState) {\r\n        component.setState({overHalf: newState});\r\n    }\r\n}\r\n\r\nconst blockTarget = {\r\n    hover(props, monitor, component) {\r\n        isOverHalf(component, { clientY: monitor.getClientOffset().y })\r\n    },\r\n    drop(props, monitor, component) {\r\n        const document = props.editor.value.document;\r\n        const blockParent = document.getParent(props.node.key);\r\n        const blockIndex = blockParent.nodes.indexOf(props.node);\r\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        isOver: monitor.isOver(),\r\n        isOverCurrent: monitor.isOver({ shallow: true }),\r\n        canDrop: monitor.canDrop(),\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\nimport { getNodeStyleClass } from '../NodeSwitch';\r\nimport StyleButton from '../StyleButton';\r\n\r\nclass SectionNode extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            hover: false,\r\n            externalHover: false,\r\n            overHalf: false,\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {     \r\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\r\n        if (node) {\r\n            node.setHoverer(\"section_mouse\", newHover);\r\n        }\r\n\r\n        this.setState({hover: newHover});\r\n    }\r\n    \r\n    setExternalHover(isHovered) {\r\n        this.setState({externalHover: isHovered});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\r\n\r\n        const value = this.props.editor.value\r\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\r\n\r\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\r\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\r\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\r\n\r\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'\r\n                onMouseEnter={() => this.setHover(true)}\r\n                onMouseOver={() => this.setHover(true)}\r\n                onMouseLeave={() => this.setHover(false)} \r\n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}}\r\n                onMouseMove={(e) => isOverHalf(this, e)}>\r\n\r\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\r\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='section' />}\r\n                    {this.props.children}\r\n                </div>\r\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(SectionNode))","\r\nimport { getEventTransfer } from 'slate-react';\r\n\r\nexport default function LoggingPlugin(options) {\r\n    return {\r\n        onCopy(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"copy\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onCut(event, editor, next) {\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"cut\",\r\n                content: editor.value.fragment.text\r\n            });\r\n            \r\n            next();\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            var transfer = getEventTransfer(event);\r\n\r\n            editor.getSharedState().logger.logEvent({\r\n                type: \"paste\",\r\n                paste_type: transfer.type,\r\n                content: transfer.fragment ? transfer.fragment.text : \"\",\r\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\r\n            });\r\n            \r\n            next();\r\n        },\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport DragifyBlock from '../DragifyBlock';\r\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\r\nimport { handleMouseUp } from '../GraphPlugin';\r\n\r\nclass PlainBlockNode extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            hover: false\r\n        }\r\n        this.setHover = this.setHover.bind(this);\r\n    }\r\n\r\n    setHover(newHover) {\r\n        this.setState({hover: newHover});\r\n    }\r\n\r\n    render() {\r\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\r\n\r\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\r\n\r\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\r\n\r\n        return connectDropTarget(\r\n            <div className='block-outer-div'\r\n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}} \r\n                onMouseEnter={() => this.setHover(true)}\r\n                onMouseOver={() => this.setHover(true)}\r\n                onMouseLeave={() => this.setHover(false)}\r\n                onMouseMove={(e) => isOverHalf(this, e)}>\r\n\r\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\r\n                    {this.props.children}\r\n                </div>\r\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\r\nimport { cx, css } from 'emotion'\r\n\r\nexport const Button = React.forwardRef(\r\n  ({ className, active, reversed, ...props }, ref) => (\r\n    <span\r\n      {...props}\r\n      ref={ref}\r\n      className={cx(\r\n        className,\r\n        css`\r\n          cursor: pointer;\r\n          color: ${reversed\r\n            ? active ? 'white' : '#aaa'\r\n            : active ? 'black' : '#ccc'};\r\n        `\r\n      )}\r\n    />\r\n  )\r\n)\r\n\r\nexport const EditorValue = React.forwardRef(\r\n  ({ className, value, ...props }, ref) => {\r\n    const textLines = value.document.nodes\r\n      .map(node => node.text)\r\n      .toArray()\r\n      .join('\\n')\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        {...props}\r\n        className={cx(\r\n          className,\r\n          css`\r\n            margin: 30px -20px 0;\r\n          `\r\n        )}\r\n      >\r\n        <div\r\n          className={css`\r\n            font-size: 14px;\r\n            padding: 5px 20px;\r\n            color: #404040;\r\n            border-top: 2px solid #eeeeee;\r\n            background: #f8f8f8;\r\n          `}\r\n        >\r\n          Slate's value as text\r\n        </div>\r\n        <div\r\n          className={css`\r\n            color: #404040;\r\n            font: 12px monospace;\r\n            white-space: pre-wrap;\r\n            padding: 10px 20px;\r\n            div {\r\n              margin: 0 0 0.5em;\r\n            }\r\n          `}\r\n        >\r\n          {textLines}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\n\r\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\r\n  <span\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      'material-icons',\r\n      className,\r\n      css`\r\n        font-size: 18px;\r\n        vertical-align: text-bottom;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        white-space: pre-wrap;\r\n        margin: 0 -20px 10px;\r\n        padding: 10px 20px;\r\n        font-size: 14px;\r\n        background: #f8f8e8;\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\r\n  <div\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        & > * {\r\n          display: inline-block;\r\n        }\r\n\r\n        & > * + * {\r\n          margin-left: 15px;\r\n        }\r\n      `\r\n    )}\r\n  />\r\n))\r\n\r\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\r\n  <Menu\r\n    {...props}\r\n    ref={ref}\r\n    className={cx(\r\n      className,\r\n      css`\r\n        position: relative;\r\n        padding: 1px 18px 17px;\r\n        margin: 0 -20px;\r\n        border-bottom: 2px solid #eee;\r\n        margin-bottom: 20px;\r\n      `\r\n    )}\r\n  />\r\n))","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { css } from 'emotion'\r\nimport { Button, Icon, Menu } from './SlateComponents.js'\r\n\r\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\r\n\r\nconst MarkButton = ({ editor, type, icon }) => {\r\n  const { value } = editor\r\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\r\n  return (\r\n    <Button\r\n      reversed\r\n      active={isActive}\r\n      onMouseDown={event => {\r\n        event.preventDefault()\r\n        editor.setBlocks((isActive ? \"paragraph\" : type))\r\n\r\n        editor.getSharedState().logger.logEvent({\r\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\r\n      });\r\n      }}\r\n    >\r\n      <Icon>{icon}</Icon>\r\n    </Button>\r\n  )\r\n}\r\n\r\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\r\n  const root = window.document.getElementById('root')\r\n  return ReactDOM.createPortal(\r\n    <Menu\r\n      ref={ref}\r\n      className={css`\r\n        padding: 8px 7px 6px;\r\n        position: absolute;\r\n        z-index: 1;\r\n        top: -10000px;\r\n        left: -10000px;\r\n        margin-top: -6px;\r\n        opacity: 0;\r\n        background-color: #222;\r\n        border-radius: 4px;\r\n        transition: opacity 0.25s;\r\n      `}\r\n    >\r\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\r\n    </Menu>,\r\n    root\r\n  )\r\n})\r\n\r\n\r\nclass HoveringMenu extends React.Component {\r\n\r\n  menuRef = React.createRef()\r\n\r\n  componentDidMount = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  componentDidUpdate = () => {\r\n    this.updateMenu()\r\n  }\r\n\r\n  updateMenu = () => {\r\n    const menu = this.menuRef.current\r\n    if (!menu) return\r\n\r\n    const value = this.props.editor.value\r\n    const { fragment, selection } = value\r\n\r\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\r\n      menu.removeAttribute('style')\r\n      return\r\n    }\r\n\r\n    const native = window.getSelection()\r\n    const range = native.getRangeAt(0)\r\n    const rect = range.getBoundingClientRect()\r\n    menu.style.opacity = 1\r\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\r\n\r\n    menu.style.left = `${rect.left +\r\n      window.pageXOffset -\r\n      menu.offsetWidth / 2 +\r\n      rect.width / 2}px`\r\n  }\r\n\r\n  render = (props, editor, next) => {\r\n    return (\r\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default function HoveringMenuPlugin(options) {\r\n    return {\r\n        renderEditor (props, editor, next) {\r\n            const children = next()\r\n            return (\r\n              <React.Fragment>\r\n                {children}\r\n                <HoveringMenu editor={editor} />\r\n              </React.Fragment>\r\n            )\r\n          },\r\n\r\n        renderBlock (props, editor, next) {\r\n            switch (props.node.type) {\r\n            case 'heading':\r\n                return <u><b>{props.children}</b></u>\r\n            default:\r\n                return next()\r\n            }\r\n        },\r\n    }\r\n}","import { Block, Text } from 'slate';\r\n\r\nexport const schema = {\r\n    inlines: {\r\n        link: {\r\n            parent: [{type: ''}, {type: 'paragraph'}],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'parent_type_invalid':\r\n                        editor.unwrapInlineByKey(error.node.key)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled link inline err \" + error);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    blocks: {\r\n        section: {\r\n            parent: {object: \"document\"},\r\n            nodes: [\r\n                {\r\n                    match: {type: 'link'},\r\n                    min: 1,\r\n                    max: 1,\r\n                },\r\n                {\r\n                    match: {type: 'body'},\r\n                    min: 1,\r\n                    max: 1,\r\n                }\r\n            ],\r\n\r\n            normalize: (editor, error) => {\r\n                switch (error.code) {\r\n                    case 'child_max_invalid':\r\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \r\n                        // this can happen if the enter key is pressed (splits the current node)\r\n                        moveBlockAfterSection(editor, error.child, error.node)\r\n                        editor.setNodeByKey(error.child.key, 'paragraph')\r\n                        return\r\n\r\n                    case 'child_type_invalid':\r\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \r\n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\r\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\r\n                            if (linkNode) {\r\n                                const textNode = linkNode.getLastText()\r\n                                const offset = textNode.text ? textNode.text.length : 0\r\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\r\n                            } else {\r\n                                addMissing(editor, error, \"link\", error.child.text)\r\n                            }\r\n                        }\r\n\r\n                        editor.removeNodeByKey(error.child.key)\r\n                        \r\n                        return\r\n                    \r\n                    case 'child_min_invalid':\r\n                        var hasChildTypes = [];\r\n                        error.node.nodes.forEach(node => {\r\n                            hasChildTypes.push(node.type)\r\n                        })\r\n                        \r\n                        if (!hasChildTypes.includes(\"link\")) {\r\n                            addMissing(editor, error, \"link\")\r\n                        }\r\n\r\n                        if (!hasChildTypes.includes(\"body\")) {\r\n                            addMissing(editor, error, \"body\")\r\n                        }\r\n\r\n                        return\r\n                    \r\n                    case 'parent_object_invalid':\r\n                        // a section has ended up inside another section - shift it out\r\n                        moveBlockAfterSection(editor, error.node, error.parent)\r\n                        return\r\n\r\n                    default:\r\n                        console.log(\"unhandled section schema err \" + error);\r\n                        \r\n                        return\r\n                }\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\r\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\r\n    if (sectionIndex === -1) {\r\n        return\r\n    }\r\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\r\n}\r\n\r\nfunction addMissing(editor, error, nodeType, text=\"\") {\r\n    const node_id = error.node.data.get(\"node_id\")\r\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\r\n    if (!text) {\r\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\r\n    }\r\n    const index = nodeType === \"link\" ? 0 : 1\r\n\r\n    addBlock(editor, error.node, nodeType, index, node_id, text)\r\n}\r\n\r\nfunction addBlock(editor, parent, nodeType, index, id, text) {\r\n    var block = Block.create({\r\n        type: nodeType,\r\n        data: {node_id: id},\r\n        nodes: [Text.create({'text': text})]\r\n    })\r\n    editor.insertNodeByKey(parent.key, index, block);\r\n    \r\n}","import React from 'react';\r\nimport { Editor } from 'slate-react';\r\nimport { Value } from 'slate';\r\nimport NodePlugin from './NodePlugin.js';\r\nimport GraphPlugin from './GraphPlugin.js';\r\nimport LoggingPlugin from './LoggingPlugin.js';\r\nimport ReorderPlugin from './ReorderPlugin.js';\r\nimport HoveringMenu from './HoveringMenu.js';\r\nimport WordCountPlugin from './WordCountPlugin.js';\r\nimport { schema } from './Schema.js'\r\n\r\nconst plugins = {\r\n    'graph': [\r\n        LoggingPlugin(),\r\n        GraphPlugin(),\r\n        NodePlugin(),\r\n        ReorderPlugin(),\r\n        WordCountPlugin(),\r\n    ],\r\n    'plain': [\r\n        LoggingPlugin(),\r\n        HoveringMenu(),\r\n    ]\r\n};\r\n\r\nconst emptyValue = Value.fromJSON({\r\n    document: {\r\n        nodes: [\r\n            {\r\n                object: 'block',\r\n                type: 'paragraph',\r\n                nodes: [\r\n                    {\r\n                        object: 'text',\r\n                        text: '',\r\n                    },\r\n                ],\r\n            },\r\n        ],\r\n    },\r\n});\r\n\r\nclass DocEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.props.sharedState.editor_ref = React.createRef();\r\n    }\r\n\r\n    componentDidMount() {\r\n        const sharedState = this.props.sharedState\r\n        sharedState.getSavedDocValue((savedValue) => {\r\n            this.setState({\r\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\r\n            }, sharedState.editorHasLoaded)\r\n        })\r\n    }\r\n\r\n    state = {\r\n        value: undefined, // don't display editor until the db's saved document loads\r\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\r\n    }\r\n    \r\n    queries = {\r\n        getSharedState: () => {\r\n            return this.props.sharedState;\r\n        },\r\n        getValue: () => {\r\n            return this.state.value;\r\n        },\r\n        mapHasLoaded: () => {\r\n            this.setState({ mapHasLoaded: true })\r\n        }\r\n    }\r\n\r\n    onChange = ({ value }) => {\r\n        this.setState({ value })\r\n    }\r\n\r\n    render() {\r\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\r\n\r\n        if (this.state.value !== undefined) {\r\n            return <Editor\r\n                className={\"slate-editor\" + plainClass}\r\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\r\n                ref={this.props.sharedState.editor_ref}\r\n                schema={schema}\r\n                plugins={plugins[this.props.sharedState.condition]}\r\n                queries={this.queries}\r\n                value={this.state.value}\r\n                onChange={this.onChange}\r\n                placeholder=\"Write your document here...\"\r\n                spellCheck={true}\r\n            />\r\n        } else {\r\n            return <p></p>\r\n        }\r\n    }\r\n}\r\n\r\nexport default DocEditor;","import SVG from 'svg.js';\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\r\n\r\n(function e(t, n, r) {\r\n    function s(o, u) {\r\n        if (!n[o]) {\r\n            if (!t[o]) {\r\n                // eslint-disable-next-line no-sequences\r\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\r\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\r\n                var n = t[o][1][e];return s(n ? n : e);\r\n            }, l, l.exports, e, t, n, r);\r\n        }return n[o].exports;\r\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\r\n        s(r[o]);\r\n    }return s;\r\n})({ 1: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Id = require(\"idy\"),\r\n            SetOrGet = require(\"set-or-get\"),\r\n            IterateObject = require(\"iterate-object\"),\r\n            Deffy = require(\"deffy\");\r\n\r\n        // Internal cache\r\n        var _connections = {},\r\n            _betweenTwoBubbles = {},\r\n            container = null,\r\n            markers = null;\r\n\r\n        function delete_connectable(con) {\r\n            con.line.remove();\r\n            con.marker.remove();\r\n\r\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\r\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\r\n\r\n            var toString = function() {\r\n                var ids = [con.source.id(), con.target.id()],\r\n                    id1 = ids.join(\"->\"),\r\n                    id2 = ids.reverse().join(\"->\");\r\n\r\n                con._ = con.id = id1;\r\n\r\n                if (_betweenTwoBubbles[id2]) {\r\n                    con._ = id2;\r\n                    return id2;\r\n                }\r\n\r\n                con.id = id1;\r\n                return id1;\r\n            }\r\n\r\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\r\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\r\n        }\r\n\r\n        /**\r\n         * connectable\r\n         * Connects two elements.\r\n         *\r\n         * @name connectable\r\n         * @function\r\n         * @param {Object} options An object containing the following fields:\r\n         *\r\n         *  - `container` (SVGElement): The line elements container.\r\n         *  - `markers` (SVGElement): The marker elements container.\r\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\r\n         *\r\n         * @param {SVGElement} elmTarget The target SVG element.\r\n         * @return {Object} The connectable object containing:\r\n         *\r\n         *  - `source` (SVGElement): The source element.\r\n         *  - `target` (SVGElement): The target element.\r\n         *  - `line` (SVGElement): The line element.\r\n         *  - `marker` (SVGElement): The marker element.\r\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\r\n         *  - [`update` (Function)](#update)\r\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\r\n         */\r\n        function connectable(options, elmTarget) {\r\n\r\n            var con = {};\r\n\r\n            if (elmTarget === undefined) {\r\n                elmTarget = options;\r\n                options = {};\r\n            }\r\n\r\n            container = options.container || container;\r\n            var elmSource = this;\r\n            markers = options.markers || markers;\r\n\r\n            options.k = options.k || 100;\r\n            options.kk = options.kk || 10;\r\n\r\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\r\n                markerId = \"triangle-\" + Id(),\r\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\r\n            \r\n            if (options.specialCoords) {\r\n                line.addClass('connector-line');\r\n            }\r\n\r\n            marker.attr({\r\n                id: markerId,\r\n                viewBox: \"0 0 10 10\",\r\n                refX: \"0\",\r\n                refY: \"5\",\r\n                markerUnits: \"strokeWidth\",\r\n                markerWidth: \"4\",\r\n                markerHeight: \"5\"\r\n            });\r\n\r\n            marker.path().attr({\r\n                d: \"M 0 0 L 10 5 L 0 10 z\"\r\n            });\r\n\r\n            // Append the SVG elements\r\n            con.source = elmSource;\r\n            con.target = elmTarget;\r\n            con.line = line;\r\n            con.marker = marker;\r\n\r\n\r\n            if (options.specialCoords) {\r\n                // remove this when node is deleted\r\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\r\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\r\n            }\r\n\r\n            SetOrGet(_connections, con.source.id(), []).push(con);\r\n            SetOrGet(_connections, con.target.id(), []).push(con);\r\n\r\n            SetOrGet(_betweenTwoBubbles, {\r\n                toString: function toString() {\r\n                    var ids = [con.source.id(), con.target.id()],\r\n                        id1 = ids.join(\"->\"),\r\n                        id2 = ids.reverse().join(\"->\");\r\n\r\n                    con._ = con.id = id1;\r\n\r\n                    if (_betweenTwoBubbles[id2]) {\r\n                        con._ = id2;\r\n                        return id2;\r\n                    }\r\n\r\n                    con.id = id1;\r\n                    return id1;\r\n                }\r\n            }, []).push(con);\r\n            \r\n\r\n            /**\r\n             * computeLineCoordinates\r\n             * The function that computes the new coordinates.\r\n             * It can be overriden with a custom function.\r\n             *\r\n             * @name computeLineCoordinates\r\n             * @function\r\n             * @param {Connectable} con The connectable instance.\r\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\r\n             */\r\n            con.computeLineCoordinates = function (cons) {\r\n\r\n                var output = [],\r\n                    l = cons.length;\r\n\r\n                IterateObject(cons, function (con, i) {\r\n\r\n                    var sT = con.source.transform(),\r\n                        tT = con.target.transform(),\r\n                        sB = con.source.bbox(),\r\n                        tB = con.target.bbox(),\r\n                        x1 = sT.x + sB.width / 2,\r\n                        y1 = sT.y + sB.height / 2,\r\n                        x2 = tT.x + tB.width / 2,\r\n                        y2 = tT.y + tB.height / 2,\r\n                        cx = (x1 + x2) / 2,\r\n                        cy = (y1 + y2) / 2,\r\n                        dx = Math.abs((x1 - x2) / 2),\r\n                        dy = Math.abs((y1 - y2) / 2),\r\n                        dd = null,\r\n                        out = {\r\n                        x1: x1,\r\n                        y1: y1,\r\n                        x2: x2,\r\n                        y2: y2,\r\n                        ex: x1,\r\n                        ey: y1\r\n                    };\r\n\r\n                    if (i !== (l - 1) / 2) {\r\n                        dd = Math.sqrt(dx * dx + dy * dy);\r\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                    }\r\n                    output.push(out);\r\n                });\r\n\r\n                return output;\r\n            };\r\n\r\n            if (options.specialCoords) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var sT = con.source.transform(),\r\n                            tT = con.target.transform(),\r\n                            sB = con.source.bbox(),\r\n                            tB = con.target.bbox(),\r\n                            x1 = sT.x + sB.width / 2,\r\n                            y1 = sT.y + sB.height / 2 - 20;\r\n\r\n                        var xDiff = sT.x - tT.x;\r\n                        var yDiff = sT.y - tT.y;\r\n                        var x2, y2;\r\n\r\n                        var x2centre = tT.x + tB.width / 2\r\n                        var y2centre = tT.y + tB.height / 2\r\n\r\n                        var grad = (y2centre - y1) / ((x2centre - x1) === 0 ? 0.0000001 : (x2centre - x1))\r\n\r\n                        if (grad === 0) {\r\n                            grad = 0.0000001\r\n                        }\r\n\r\n                        var left = tT.x - 10\r\n                        var right = tT.x + tB.width - 30\r\n                        var top = tT.y - 10\r\n                        var bottom = tT.y + tB.height - 30\r\n                        \r\n                        var rightLeftCalc = () => {\r\n                            var x2 = xDiff < 0 ? left : right\r\n                            return { \r\n                                x: x2,\r\n                                y: ((x2 - x1) * grad) + y1\r\n                            }\r\n                        }\r\n\r\n                        var topBotCalc = () => {\r\n                            var y2 = yDiff < 0 ? top : bottom\r\n                            return {\r\n                                x: ((y2 - y1) * (1/grad)) + x1,\r\n                                y: y2\r\n                            }\r\n                        }\r\n\r\n                        var vals\r\n                        if (Math.abs(xDiff) >= Math.abs(yDiff)) {\r\n                            vals = rightLeftCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (y2 > bottom || y2 < top) {\r\n                                vals = topBotCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n\r\n                        } else {\r\n                            vals = topBotCalc()\r\n                            x2 = vals.x\r\n                            y2 = vals.y\r\n\r\n                            if (x2 > right || x2 < left) {\r\n                                vals = rightLeftCalc()\r\n                                x2 = vals.x\r\n                                y2 = vals.y\r\n                            }\r\n                        }\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dx = Math.abs((x1 - x2) / 2),\r\n                            dy = Math.abs((y1 - y2) / 2),\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (i !== (l - 1) / 2) {\r\n                            dd = Math.sqrt(dx * dx + dy * dy);\r\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                        }\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            if (options.padEllipse) {\r\n                con.computeLineCoordinates = function (cons) {\r\n\r\n                    var output = [],\r\n                        l = cons.length;\r\n\r\n                    IterateObject(cons, function (con, i) {\r\n\r\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\r\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\r\n                            xR1,\r\n                            xR2,\r\n                            yR1,\r\n                            yR2,\r\n                            sT = con.source.transform(),\r\n                            tT = con.target.transform()\r\n\r\n                        if (elmS.tagName === \"circle\") {\r\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\r\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\r\n                        } else {\r\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\r\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\r\n\r\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\r\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\r\n                        }\r\n\r\n                        // Get centers\r\n                        var sx = sT.x + xR1 / 2,\r\n                            sy = sT.y + yR1 / 2,\r\n                            tx = tT.x + xR2 / 2,\r\n                            ty = tT.y + yR2 / 2\r\n\r\n                        // Calculate distance from source center to target center\r\n                        ,\r\n                            dx = tx - sx,\r\n                            dy = ty - sy,\r\n                            d = Math.sqrt(dx * dx + dy * dy)\r\n\r\n                        // Construct unit vector between centers\r\n                        ,\r\n                            ux = dx / d,\r\n                            uy = dy / d\r\n\r\n                        // Point on source circle\r\n                        ,\r\n                            cx1 = sx + xR1 * ux,\r\n                            cy1 = sy + yR1 * uy\r\n\r\n                        // Point on target circle\r\n                        ,\r\n                            cx2 = sx + (d - xR2 - 5) * ux,\r\n                            cy2 = sy + (d - yR2 - 5) * uy;\r\n\r\n                        var x1 = cx1 + xR1 / 2,\r\n                            y1 = cy1 + yR1 / 2,\r\n                            x2 = cx2 + xR2 / 2,\r\n                            y2 = cy2 + yR2 / 2\r\n                        // TODO\r\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\r\n                        //  , angle = 0\r\n                        ;\r\n\r\n                        //if (i !== (l - 1) / 2) {\r\n                        //    angle = step * (i + 1);\r\n                        //}\r\n\r\n\r\n                        //var xC1 = (sT.x + xR1)\r\n                        //  , yC1 = (sT.y + yR1)\r\n                        //  , xC2 = (tT.y + xR2)\r\n                        //  , yC2 = (tT.y + yR2)\r\n                        //  , ddx1 = x1 - xC1\r\n                        //  , ddy1 = y1 - yC1\r\n                        //  , ddx2 = x2 - xC2\r\n                        //  , ddy2 = y2 - yC2\r\n                        //  , cosAngle = Math.cos(angle)\r\n                        //  , sinAngle = Math.sin(angle)\r\n                        //  , cosAngleM = Math.cos(-angle)\r\n                        //  , sinAngleM = Math.sin(-angle)\r\n                        //  ;\r\n\r\n                        // TODO This should change the points to arrange them on the circle\r\n                        //\r\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\r\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\r\n\r\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\r\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\r\n\r\n                        // ===================\r\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\r\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\r\n\r\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\r\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\r\n\r\n                        var cx = (x1 + x2) / 2,\r\n                            cy = (y1 + y2) / 2,\r\n                            dd = null,\r\n                            out = {\r\n                            x1: x1,\r\n                            y1: y1,\r\n                            x2: x2,\r\n                            y2: y2,\r\n                            ex: x1,\r\n                            ey: y1\r\n                        };\r\n\r\n                        if (isNaN(out.x1)) {\r\n                            out.x1 = sT.x + xR1 * 2;\r\n                            out.y1 = sT.y + yR1 / 2;\r\n                            out.x2 = sT.x;\r\n                            out.y2 = out.y1;\r\n                            out.ex = (out.x1 + out.x2) / 2;\r\n                            out.ey = out.y1 - options.kk * (i + 1);\r\n                        } else {\r\n                            dx = Math.abs((x1 - x2) / 2);\r\n                            dy = Math.abs((y1 - y2) / 2);\r\n\r\n                            if (i !== (l - 1) / 2) {\r\n                                dd = Math.sqrt(dx * dx + dy * dy);\r\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\r\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\r\n                            }\r\n                        }\r\n\r\n                        output.push(out);\r\n                    });\r\n\r\n                    return output;\r\n                };\r\n            }\r\n\r\n            elmSource.cons = elmSource.cons || [];\r\n            elmSource.cons.push(con);\r\n\r\n            /**\r\n             * update\r\n             * Updates the line coordinates.\r\n             *\r\n             * @name update\r\n             * @function\r\n             * @return {undefined}\r\n             */\r\n            con.update = function () {\r\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\r\n                    results = con.computeLineCoordinates(cons);\r\n\r\n                IterateObject(results, function (r, i) {\r\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\r\n                });\r\n            };\r\n\r\n            con.update();\r\n            elmSource.on(\"dragmove\", con.update);\r\n            elmTarget.on(\"dragmove\", con.update);\r\n\r\n            /**\r\n             * setLineColor\r\n             * Sets the line color.\r\n             *\r\n             * @name setLineColor\r\n             * @function\r\n             * @param {String} color The new color.\r\n             * @param {Connectable} c The connectable instance.\r\n             * @return {undefined}\r\n             */\r\n            con.setLineColor = function (color, c) {\r\n                c = c || this;\r\n                c.line.stroke(color);\r\n                c.marker.fill(color);\r\n            };\r\n\r\n            return con;\r\n        }\r\n\r\n        if (typeof SVG === \"function\") {\r\n            SVG.extend(SVG.Element, {\r\n                connectable: connectable,\r\n                delete_connectable: delete_connectable\r\n            });\r\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\r\n            throw new Error(\"SVG.js is not loaded but it is required.\");\r\n        }\r\n\r\n        module.exports = connectable;\r\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Typpy = require(\"typpy\");\r\n\r\n        /**\r\n         * Deffy\r\n         * Computes a final value by providing the input and default values.\r\n         *\r\n         * @name Deffy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Anything|Function} def The default value or a function getting the\r\n         * input value as first argument.\r\n         * @param {Object|Boolean} options The `empty` value or an object containing\r\n         * the following fields:\r\n         *\r\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\r\n         *\r\n         * @return {Anything} The computed value.\r\n         */\r\n        function Deffy(input, def, options) {\r\n\r\n            // Default is a function\r\n            if (typeof def === \"function\") {\r\n                return def(input);\r\n            }\r\n\r\n            options = Typpy(options) === \"boolean\" ? {\r\n                empty: options\r\n            } : {\r\n                empty: false\r\n            };\r\n\r\n            // Handle empty\r\n            if (options.empty) {\r\n                return input || def;\r\n            }\r\n\r\n            // Return input\r\n            if (Typpy(input) === Typpy(def)) {\r\n                return input;\r\n            }\r\n\r\n            // Return the default\r\n            return def;\r\n        }\r\n\r\n        module.exports = Deffy;\r\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\r\n        /**\r\n         * Typpy\r\n         * Gets the type of the input value or compares it\r\n         * with a provided type.\r\n         *\r\n         * Usage:\r\n         *\r\n         * ```js\r\n         * Typpy({}) // => \"object\"\r\n         * Typpy(42, Number); // => true\r\n         * Typpy.get([], \"array\"); => true\r\n         * ```\r\n         *\r\n         * @name Typpy\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {String|Boolean} It returns `true` if the\r\n         * input has the provided type `target` (if was provided),\r\n         * `false` if the input type does *not* have the provided type\r\n         * `target` or the stringified type of the input (always lowercase).\r\n         */\r\n        function Typpy(input, target) {\r\n            if (arguments.length === 2) {\r\n                return Typpy.is(input, target);\r\n            }\r\n            return Typpy.get(input, true);\r\n        }\r\n\r\n        /**\r\n         * Typpy.is\r\n         * Checks if the input value has a specified type.\r\n         *\r\n         * @name Typpy.is\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Constructor|String} target The target type.\r\n         * It could be a string (e.g. `\"array\"`) or a\r\n         * constructor (e.g. `Array`).\r\n         * @return {Boolean} `true`, if the input has the same\r\n         * type with the target or `false` otherwise.\r\n         */\r\n        Typpy.is = function (input, target) {\r\n            return Typpy.get(input, typeof target === \"string\") === target;\r\n        };\r\n\r\n        /**\r\n         * Typpy.get\r\n         * Gets the type of the input value. This is used internally.\r\n         *\r\n         * @name Typpy.get\r\n         * @function\r\n         * @param {Anything} input The input value.\r\n         * @param {Boolean} str A flag to indicate if the return value\r\n         * should be a string or not.\r\n         * @return {Constructor|String} The input value constructor\r\n         * (if any) or the stringified type (always lowercase).\r\n         */\r\n        Typpy.get = function (input, str) {\r\n\r\n            if (typeof input === \"string\") {\r\n                return str ? \"string\" : String;\r\n            }\r\n\r\n            if (null === input) {\r\n                return str ? \"null\" : null;\r\n            }\r\n\r\n            if (undefined === input) {\r\n                return str ? \"undefined\" : undefined;\r\n            }\r\n\r\n            // eslint-disable-next-line no-self-compare\r\n            if (input !== input) {\r\n                return str ? \"nan\" : NaN;\r\n            }\r\n\r\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\r\n        };\r\n\r\n        module.exports = Typpy;\r\n    }, {}], 4: [function (require, module, exports) {\r\n        /**\r\n         * Idy\r\n         * Generates a random id and potentially unique.\r\n         *\r\n         * @name Idy\r\n         * @function\r\n         * @param {Number} length The id length (default: 10).\r\n         * @return {String} The generated id.\r\n         */\r\n        function Idy(length) {\r\n            length = length || 10;\r\n            return Math.random().toString(35).substr(2, length);\r\n        }\r\n\r\n        module.exports = Idy;\r\n    }, {}], 5: [function (require, module, exports) {\r\n        /**\r\n         * IterateObject\r\n         * Iterates an object. Note the object field order may differ.\r\n         *\r\n         * @name IterateObject\r\n         * @function\r\n         * @param {Object} obj The input object.\r\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\r\n         * @return {Function} The `IterateObject` function.\r\n         */\r\n        function IterateObject(obj, fn) {\r\n            var i = 0,\r\n                keys = [];\r\n\r\n            if (Array.isArray(obj)) {\r\n                for (; i < obj.length; ++i) {\r\n                    if (fn(obj[i], i, obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                keys = Object.keys(obj);\r\n                for (; i < keys.length; ++i) {\r\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        module.exports = IterateObject;\r\n    }, {}], 6: [function (require, module, exports) {\r\n        // Dependencies\r\n        var Deffy = require(\"deffy\");\r\n\r\n        /**\r\n         * SetOrGet\r\n         * Sets or gets an object field value.\r\n         *\r\n         * @name SetOrGet\r\n         * @function\r\n         * @param {Object|Array} input The cache/input object.\r\n         * @param {String|Number} field The field you want to update/create.\r\n         * @param {Object|Array} def The default value.\r\n         * @return {Object|Array} The field value.\r\n         */\r\n        function SetOrGet(input, field, def) {\r\n            return input[field] = Deffy(input[field], def);\r\n        }\r\n\r\n        module.exports = SetOrGet;\r\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\r\n        arguments[4][2][0].apply(exports, arguments);\r\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\r\n        arguments[4][3][0].apply(exports, arguments);\r\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\r\nimport LinkNode from './nodes/LinkNode.js'\r\nimport BodyNode from './nodes/BodyNode.js'\r\nimport SectionNode from './nodes/SectionNode.js'\r\nimport { Block } from 'slate'\r\nimport { getEventTransfer } from 'slate-react';\r\nimport { deleteNode } from './NodeSwitch.js'\r\n\r\nexport default function LinkPlugin(options) {\r\n    return {\r\n        commands: {\r\n            wrapLinkAtSelection(editor, node_id) {\r\n                return editor.wrapInline({\r\n                    type: \"link\",\r\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\r\n                });\r\n            }\r\n        },\r\n\r\n        renderInline(props, editor, next) {\r\n            if (props.node.type === 'link') {\r\n                var { ref, id } = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        renderBlock(props, editor, next) {\r\n            var refAndId;\r\n\r\n            if (props.node.type === 'body') {\r\n                refAndId = getRefAndId(props, editor, \"long\");\r\n\r\n                // set up the placeholder text to only appear when the body is empty and no text is selected\r\n                var isEmpty = !props.node.text\r\n\r\n                var selectNode = () => {\r\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\r\n                }\r\n\r\n                return <BodyNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                            isEmpty={isEmpty}\r\n                            selectNode={selectNode}\r\n                        />\r\n\r\n            } else if (props.node.type === 'link') {\r\n                refAndId = getRefAndId(props, editor, \"short\");\r\n\r\n                return <LinkNode\r\n                            ref={refAndId.ref}\r\n                            {...props}\r\n                            linkStyle=\"heading\"\r\n                            sharedState={editor.getSharedState()}\r\n                            nodeId={refAndId.id}\r\n                        />\r\n\r\n            } else if (props.node.type === 'section') {\r\n                refAndId = getRefAndId(props, editor, \"section\");\r\n\r\n                return <SectionNode\r\n                    ref={refAndId.ref}\r\n                    {...props}\r\n                    sharedState={editor.getSharedState()}\r\n                    nodeId={refAndId.id}\r\n                />\r\n            }\r\n\r\n            return next();\r\n        },\r\n\r\n        onDrop(event, editor, next) {\r\n            // suppress drop events\r\n            // do not call next()\r\n        },\r\n\r\n        onPaste(event, editor, next) {\r\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\r\n\r\n            var transfer = getEventTransfer(event);\r\n\r\n            if (transfer.type === \"fragment\") {\r\n\r\n                // if pasting into a link or body, just paste plain text, not a fragment\r\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\r\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\r\n                    editor.insertText(textNoNewlines)\r\n\r\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\r\n                    return\r\n                }\r\n\r\n                const fragmentInlines = getLinkInlines(transfer.fragment)\r\n\r\n                if (fragmentInlines) {\r\n                    const docInlines = getLinkInlines(editor.value.document)\r\n                    const usedIds = []\r\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\r\n                    \r\n                    // let the paste happen so we can operate on the document instead of inline\r\n                    next()\r\n\r\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\r\n                    fragmentInlines.forEach(inline => {\r\n                        usedIds.forEach(usedId => {\r\n                            const id = inline.data.get(\"node_id\")\r\n                            if (usedId.id === id) {\r\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\r\n                                inlinesWithId.forEach(inlineWithId => {\r\n                                    if (inlineWithId.key !== usedId.key) {\r\n                                        editor.unwrapInlineByKey(inlineWithId.key)\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                }\r\n            } else {\r\n                next()\r\n            }\r\n        },\r\n\r\n        onChange(editor, next) {\r\n            // update all node texts (both link and body)\r\n            const sharedState = editor.getSharedState();\r\n            [\r\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\r\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\r\n            ].forEach( update =>\r\n                editor.value.blocks.forEach(block => {\r\n                    const updateText = (linkNode) => {\r\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\r\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\r\n                        const id = linkNode.data.get('node_id')\r\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\r\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\r\n                            deleteNode(linkNode, editor)\r\n                        } else {\r\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\r\n                        }\r\n                    }\r\n\r\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\r\n                    linkNodes.forEach(updateText)\r\n\r\n                    if (block.type === update.nodeType) {\r\n                        updateText(block)\r\n                    }\r\n                })\r\n            )\r\n\r\n            next()\r\n        },\r\n\r\n        onKeyDown(e, editor, next) {\r\n            const { value } = editor\r\n            const { document, selection, startBlock} = value\r\n            const { start, end } = selection\r\n\r\n            // if a whole section (block or inline) is deleted, tell the graph node\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\r\n                document.getDescendantsAtRange(selection).forEach(node => {\r\n                    if (node.type === 'section' || node.type === 'link') {\r\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\r\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\r\n                        setTimeout(() => {\r\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\r\n                        }, 0)\r\n                    }\r\n                })\r\n            }\r\n\r\n            // prevent delete key from merging body and link blocks with next\r\n            if (e.key === \"Delete\") {\r\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\r\n                    const nextBlock = document.getNextBlock(start.key)\r\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\r\n                        editor.moveToStartOfNode(nextBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        }\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent backspace from merging body and link blocks with previous\r\n            if (e.key === 'Backspace') {\r\n                const prevBlock = document.getPreviousBlock(start.key)\r\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\r\n                    if (prevBlock) {\r\n                        editor.moveToEndOfNode(prevBlock);\r\n                        if (startBlock.text === \"\") {\r\n                            editor.removeNodeByKey(startBlock.key)\r\n                        } else if (prevBlock.text === \"\") {\r\n                            editor.removeNodeByKey(prevBlock.key)\r\n                         }\r\n                    }\r\n                    return editor\r\n                }\r\n            }\r\n\r\n            if (e.key === 'Enter') {\r\n                if (value.inlines.some(inline => inline.type === 'link')) {\r\n                    return // do nothing to avoid splitting the link\r\n                }\r\n\r\n                // when enter is pressed inside a link *block* (not inline), just go to body\r\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\r\n                    // unless the offset is 0, in which case insert a block before and go to that\r\n                    if (start.offset === 0) {\r\n                        const blockToInsert = Block.create({object: 'block', type: ''})\r\n                        const section = document.getParent(startBlock.key);\r\n                        const sectionParent = document.getParent(section.key);                    \r\n                        const sectionIndex = sectionParent.nodes.indexOf(section);\r\n\r\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\r\n                        return editor.moveBackward(1)\r\n                    } else {\r\n                        const nextBlock = document.getNextBlock(start.key)\r\n                        if (nextBlock) {\r\n                            return editor.moveToStartOfNode(nextBlock);\r\n                        } else {\r\n                            return editor.moveToEndOfNode(startBlock);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // prevent the cursor disappearing when navigating into the body placeholder text\r\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\r\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\r\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\r\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\r\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\r\n                    // its hard to work out how many lines of text there so use an estimate\r\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\r\n                        editor.moveToEndOfNode(relevantBlock)\r\n                        e.preventDefault()\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n\r\n            // prevent tab from taking focus from the editor\r\n            if (e.key === 'Tab') {\r\n                e.preventDefault()\r\n            }\r\n\r\n            return next()\r\n        }\r\n    }\r\n\r\n    function getRefAndId(props, editor, long_or_short) {\r\n        var id = props.node.data.get(\"node_id\");\r\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\r\n        var ref = React.createRef();\r\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\r\n        return { ref, id };\r\n    }\r\n}","import React from 'react';\r\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\r\n\r\nexport default function ReorderPlugin(options) {\r\n    return {\r\n        renderBlock(props, editor, next) {            \r\n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\r\n                return <PlainBlockNode {...props}/>\r\n            }\r\n            \r\n            return next();\r\n        },\r\n    }\r\n}","import React from 'react';\r\n\r\nexport default function WordCountPlugin(options) {\r\n    return {\r\n        renderEditor(props, editor, next) {\r\n            const wordCount = countWords(props.editor.value.document)\r\n            const children = next()\r\n\r\n            return (\r\n                <React.Fragment>\r\n                    {children}\r\n                    <span className=\"word-count\">{wordCount + \" words\"}</span>\r\n                </React.Fragment>\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\nfunction countWords(document) {\r\n    if (!document) {\r\n        return 0\r\n    }\r\n\r\n    // count words per block because document.text does not preserve newlines so undercounts\r\n    var count = 0\r\n    document.getBlocks().forEach(block => {\r\n        // skip hidden body/link elements\r\n        if (block.type === 'link' || block.type === 'body') {\r\n            const parent = document.getParent(block.key)\r\n            if (parent && parent.type === 'section') {\r\n                if ((parent.data.get('nodeStyle') === 'Heading only' && block.type === 'body') ||\r\n                    (parent.data.get('nodeStyle') === 'Body only' && block.type === 'link')) {\r\n                    return\r\n                }\r\n            }\r\n        }        \r\n\r\n        const words = block.text.match(/\\S+/g)  // split into non-whitespace substrings\r\n        if (words) {\r\n            count += words.length\r\n        }\r\n    })\r\n\r\n    return count.toString()\r\n}","import React, { Component } from 'react';\r\nimport './DocPane.css';\r\nimport DocEditor from './DocEditor.js'\r\n\r\nclass DocPane extends Component {\r\n    render() {\r\n        return (\r\n            <div className=\"pane doc\">\r\n                <DocEditor sharedState={this.props.sharedState} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\r\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\r\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\r\n\r\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\r\n\r\nconst COLOURS = [\r\n    'red',\r\n    'goldenrod',\r\n    'green',\r\n    'aqua',\r\n    'blue',\r\n    'fuchsia',\r\n    'purple',\r\n    'saddlebrown'\r\n]\r\n\r\nvar DEFAULT_ARROW_OPTIONS = [\r\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"→\"},\r\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"→\"},\r\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"→\"},\r\n];\r\n\r\nexport default class MouseFollower {\r\n    constructor(shared_state, svg, connectables_container, markers, links) {\r\n        this.shared_state = shared_state;\r\n        this.drawing_arrow_from = false;\r\n        this.connector = undefined;\r\n        this.connectables_container = connectables_container;\r\n        this.markers = markers;\r\n        this.links = links;\r\n\r\n        this.connector_objs = {}\r\n        this.temp_arrows = {}\r\n\r\n        this.arrow_id_counter = 0\r\n\r\n        this.completed_arrows = []\r\n\r\n        this.mouse_rect = svg.group();\r\n        window.addEventListener('mousemove', e => {\r\n            var point = svg.point(e.clientX, e.clientY);\r\n            this.mouse_rect.move(point.x, point.y);\r\n            \r\n            if (typeof(this.connector) !== 'undefined') {\r\n                this.connector.update();\r\n            }\r\n        });\r\n\r\n        // cancel arrows if they don't end on a node\r\n        window.addEventListener('mouseup', (e) => {\r\n            if (this.drawing_arrow_from) {\r\n                e.preventDefault();\r\n                this.stop_drawing_arrow();\r\n            }\r\n        });\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            arrows: this.completed_arrows,\r\n            arrow_id_counter: this.arrow_id_counter,\r\n            arrowOptions: this.arrowOptions,\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\r\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\r\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\r\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\r\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\r\n\r\n        return mf\r\n    }\r\n\r\n    // draw all the arrows in this.completed_arrows\r\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\r\n    draw_loaded_arrows(get_node) {\r\n        this.completed_arrows.forEach(arrow => {\r\n            const originNode = get_node(arrow.origin)\r\n            const destinationNode = get_node(arrow.destination)\r\n\r\n            if (!originNode) {\r\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\r\n                return\r\n            }\r\n\r\n            if (!destinationNode) {\r\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\r\n                return\r\n            }\r\n\r\n            const connector = this.draw_arrow(\r\n                originNode,\r\n                destinationNode,\r\n                arrow.colour\r\n            )\r\n            this.add_context_menu_to_arrow(connector, arrow)\r\n            this.connector_objs[arrow.origin + \"->\" + arrow.destination] = connector\r\n            \r\n            // update the arrow start and end points\r\n            originNode.group.node.dispatchEvent(new CustomEvent(\"dragmove\"))\r\n        })\r\n    }\r\n\r\n    update_source(new_source) {\r\n        if (typeof(this.connector) === 'undefined') {\r\n            this.connector = new_source.connectable({\r\n                container: this.connectables_container,\r\n                markers: this.markers\r\n            }, this.mouse_rect);\r\n        } else {\r\n            this.connector.marker.show();\r\n            this.connector.line.show();\r\n\r\n            this.connector.target = this.mouse_rect;\r\n            this.connector.source = new_source;\r\n            this.connector.update();\r\n        }\r\n        if (this.connector) {\r\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if (typeof(this.connector) !== 'undefined') {\r\n            this.connector.target = this.connector.source;\r\n            this.connector.marker.hide();\r\n            this.connector.line.hide();\r\n        }\r\n    }\r\n\r\n    start_arrow(source_node) {\r\n        this.drawing_arrow_from = source_node;\r\n        if (this.connector) {\r\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\r\n        }\r\n    }\r\n\r\n    draw_arrow(origin, destination, colour) {\r\n        var connector = origin.group.connectable({\r\n            container: this.links,\r\n            markers: this.markers,\r\n            specialCoords: true\r\n        }, destination.group);\r\n        connector.setLineColor(colour);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector)\r\n        });\r\n\r\n        return connector\r\n    }\r\n\r\n    add_context_menu_to_arrow(connector, arrowObject) {\r\n        const show_context_menu = e => {\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\r\n                arrowObject.colour = new_colour\r\n            }, arrowObject);\r\n            e.preventDefault();\r\n        };\r\n        connector.line.on(\"click\", show_context_menu);\r\n        connector.line.on(\"contextmenu\", show_context_menu);\r\n\r\n        connector.source.on(\"deletenode\", () => {\r\n            connector.source.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n        connector.target.on(\"deletenode\", () => {\r\n            connector.target.node.instance.delete_connectable(connector)\r\n            this.remove_arrow(connector, arrowObject)\r\n        });\r\n\r\n        // detect if the user changes the colour of this arrow\r\n        window.addEventListener('colourchange', (e) => {\r\n            if (e.detail.oldColour === arrowObject.colour) {\r\n                connector.setLineColor(e.detail.newColour)\r\n                arrowObject.colour = e.detail.newColour\r\n            }\r\n        })\r\n\r\n        // detect if all arrows of this colour were deleted\r\n        window.addEventListener('arrowdelete', (e) => {\r\n            if (e.detail.colour === arrowObject.colour) {\r\n                this.remove_arrow(connector, arrowObject)\r\n            }\r\n        })\r\n    }\r\n\r\n    complete_arrow(end_node) {\r\n        // no arrows to self\r\n        if (end_node === this.drawing_arrow_from) {\r\n            this.stop_drawing_arrow();\r\n            return;\r\n        }\r\n\r\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\r\n\r\n        var c1 = this.drawing_arrow_from.group.getScreenCoords('centre')\r\n        var c2 = end_node.group.getScreenCoords('centre')\r\n        var midpoint = {x: (c1.x + c2.x) / 2, y: (c1.y + c2.y) / 2}\r\n\r\n        // only add the arrow to the list of completed arrows once a colour is selected\r\n        // to prevent weird states being saved and loaded\r\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\r\n        const colourWasSelected = (colour) => {\r\n            const id = this.getNewId()\r\n            const arrowObject = {\r\n                id: id,\r\n                origin: drawing_arrow_from_id,\r\n                destination: end_node.id,\r\n                colour: colour,\r\n            }\r\n            this.completed_arrows.push(arrowObject)\r\n\r\n            this.add_context_menu_to_arrow(connector, arrowObject)\r\n        }\r\n\r\n        this.edit_connector_type(connector, midpoint.x, midpoint.y, false, colourWasSelected);\r\n\r\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\r\n        this.stop_drawing_arrow();\r\n    }\r\n\r\n    getArrowByID(id) {\r\n        return this.completed_arrows.find(arrow => arrow.id === id)\r\n    }\r\n\r\n    getConnectorObjectConnecting(source, dest) {\r\n        // if there are multiple, this will just return the first\r\n        return this.connector_objs[source + \"->\" + dest]\r\n    }\r\n\r\n    addTempArrow(source, dest, colour, temp_id) {\r\n        const source_node = this.shared_state.graphPane.getNodeById(source)\r\n        const dest_node = this.shared_state.graphPane.getNodeById(dest)\r\n        if (!source_node || !dest_node) {\r\n            return\r\n        }\r\n        this.connector_objs[source + '->' + dest] = this.draw_arrow(source_node, dest_node, colour)\r\n        this.temp_arrows[temp_id] = source + '->' + dest\r\n    }\r\n\r\n    getNewId() {\r\n        this.arrow_id_counter++\r\n        return this.arrow_id_counter\r\n    }\r\n\r\n    changeArrowColour(entry, direction) {\r\n        const oldColour = entry.colour\r\n        var newColour = this.getNextAvailableColour(entry, direction)\r\n        if (!newColour) {\r\n            return\r\n        }\r\n        entry.colour = newColour\r\n\r\n        window.dispatchEvent(new CustomEvent('colourchange', {\r\n            detail: {\r\n                oldColour: oldColour,\r\n                newColour: newColour,\r\n            }\r\n        }))\r\n\r\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\r\n\r\n        return newColour\r\n    }\r\n\r\n    getNextAvailableColour(entry, direction) {\r\n        // find all the colours which are not used by arrowOptions other than this one\r\n        const availableColours = COLOURS.filter(colour => \r\n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\r\n        )\r\n\r\n        if (!availableColours) {\r\n            return undefined\r\n        } else {\r\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\r\n            if (thisColourIndex !== -1) {\r\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\r\n                if (nextIndex < 0) {\r\n                    nextIndex = availableColours.length - 1\r\n                }\r\n                return availableColours[nextIndex]\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrowOptions() {\r\n        const clickEditButton = (e, params) => {\r\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\r\n\r\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\r\n\r\n            transientEntry.isClickable = false\r\n\r\n            var editButton = buttonCell.children[0]\r\n\r\n            const updateName = () => {\r\n                var newValue = input.value\r\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\r\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\r\n                }\r\n                if (newValue) {\r\n                    underlyingEntry.name = newValue\r\n                }\r\n\r\n                return newValue\r\n            }\r\n\r\n            const finishEditing = () => {\r\n                var newValue = updateName()\r\n                if (newValue) {\r\n                    nameCell.textContent = newValue\r\n                }\r\n\r\n                transientEntry.isClickable = true\r\n\r\n                colourCell.textContent = colourButton.textContent\r\n                colourCell.style.color = colourButton.style.color\r\n                \r\n                editButton.classList.remove('pure-button-active')\r\n                editButton.onclick = (e) => clickEditButton(e, params)\r\n            }\r\n\r\n            editButton.classList.add('pure-button-active')\r\n            editButton.onclick = finishEditing\r\n\r\n            var input = document.createElement(\"input\")\r\n            \r\n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\r\n            input.value = nameCell.textContent\r\n            input.addEventListener('keyup', (e) => {\r\n                if (e.key === 'Enter' && input.value) {\r\n                    finishEditing()\r\n                }\r\n            })\r\n            input.addEventListener('change', updateName)\r\n\r\n            nameCell.textContent = \"\"\r\n            nameCell.appendChild(input)\r\n\r\n            var colourButton = document.createElement(\"button\")\r\n            colourButton.className = 'pure-button'\r\n            colourButton.textContent = colourCell.textContent\r\n            colourCell.textContent = \"\"\r\n            colourCell.appendChild(colourButton)\r\n            colourButton.style.color = colourCell.style.color\r\n            colourButton.style.padding = 0\r\n            colourButton.addEventListener(\"click\", () => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\r\n                transientEntry.colour = underlyingEntry.colour\r\n            })\r\n            colourButton.addEventListener(\"contextmenu\", (e) => {\r\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\r\n                transientEntry.colour = underlyingEntry.colour\r\n                e.preventDefault()\r\n            })\r\n\r\n            input.focus()\r\n        }\r\n\r\n        const clickDeleteArrowTypeButton = (e, params) => {\r\n            var { row, underlyingEntries, underlyingEntry, transientEntry, selected, hidePopup } = params\r\n            transientEntry.isClickable = false\r\n            \r\n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\r\n                // remove from underlyingEntries\r\n                var index = underlyingEntries.indexOf(underlyingEntry)\r\n                if (index !== -1) {\r\n                    underlyingEntries.splice(index, 1)\r\n                }\r\n\r\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\r\n                setTimeout(() => row.parentNode.removeChild(row), 0)\r\n\r\n                // tell all arrows of this colour to delete themselves\r\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\r\n                    detail: {\r\n                        colour: underlyingEntry.colour,\r\n                    }\r\n                }))\r\n\r\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour})\r\n\r\n                // if the selected arrow type was deleted, hide the optionpopup\r\n                if (selected) {\r\n                    hidePopup()\r\n                }\r\n            }\r\n\r\n            transientEntry.isClickable = true\r\n        }\r\n\r\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\r\n            var entryWithButtons = {...entry}\r\n            entryWithButtons.buttons = [\r\n                {\r\n                    className: 'edit-icon',\r\n                    click: clickEditButton,\r\n                    underlyingEntry: entry,\r\n                },\r\n                {\r\n                    className: 'delete-icon',\r\n                    click: clickDeleteArrowTypeButton,\r\n                    underlyingEntry: entry,\r\n                    underlyingEntries: this.arrowOptions,\r\n                }\r\n            ]\r\n            return entryWithButtons\r\n        })\r\n        \r\n        return [\r\n            ...arrowOptionsWithButtons,\r\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\r\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n        ]\r\n    }\r\n\r\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\r\n        var prev_selected = undefined;\r\n        \r\n        const arrowOptions = this.getArrowOptions()\r\n\r\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\r\n        prev_selected = prev_selected ? prev_selected.name : undefined\r\n\r\n        const setArrowColour = (selected_option) => {\r\n            connector.setLineColor(selected_option.colour);\r\n            this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\r\n\r\n            if (onColourSelected) {\r\n                onColourSelected(selected_option.colour)\r\n            }\r\n        }\r\n\r\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\r\n            if (selected_option.name === \"Delete\") {\r\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\r\n                this.remove_arrow(connector, arrowObject);\r\n            } else if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\r\n                const colour = this.getNextAvailableColour(null, 1)\r\n\r\n                if (!colour) {\r\n                    toast.error(\"Maximum number of arrow types reached!\")\r\n                } else {\r\n                    const newRelation = {\r\n                        'name': 'New relation',\r\n                        'colour': colour,\r\n                        'symbol': \"→\",\r\n                    }\r\n                    this.arrowOptions.push(newRelation)\r\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\r\n\r\n                    if (!prev_selected) {\r\n                        setArrowColour(newRelation)\r\n                    }\r\n\r\n                    // open a new option popup to allow the user to select the new arrow type and edit it\r\n                    this.edit_connector_type(connector, popup_x, popup_y, true, onColourSelected, arrowObject)\r\n                }\r\n            } else {\r\n                setArrowColour(selected_option)\r\n            }\r\n        }, prev_selected);\r\n    }\r\n\r\n    remove_arrow(connector, arrowObject) {\r\n        if (connector && connector.line) {\r\n            connector.line.node.instance.delete_connectable(connector);\r\n        }\r\n\r\n        if (arrowObject) {\r\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \r\n        }\r\n    }\r\n\r\n    stop_drawing_arrow() {\r\n        this.drawing_arrow_from = false;\r\n        this.hide();\r\n    }\r\n}","import OptionPopup from \"./OptionPopup\";\r\n\r\nvar ARROW_HITBOX_MARGIN = 20;\r\n\r\nclass GraphNode {\r\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList, zoomCanvasTo) {\r\n        var { shortText, x, y, width, height, id, isOnGraph, longText, annotatedOrder } = params\r\n        this.id = id ? id : shared_state.getNodeId();\r\n\r\n        this.getNodesList = getNodesList\r\n        this.zoomCanvasTo = zoomCanvasTo\r\n        \r\n        this.group = nodes.group().translate(x, y);\r\n\r\n        this.dropShadow = this.group.rect(width, height).radius(5).addClass('node-drop-shadow')\r\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\r\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0).radius(10).addClass('arrow-hitbox');\r\n        \r\n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\r\n        this.editRect = this.group.rect(width - 10, height - 10).radius(5).translate(5, 5).addClass('editing-node-rect')\r\n        this.text = this.group.text(\"\").addClass('node-text');\r\n        this.updateShortText(shortText)\r\n        this.updateLongText(longText)\r\n\r\n        this.setupRectDragging(this.rect, shared_state);\r\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\r\n        const complete_arrow = (e) => {\r\n            if (mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.complete_arrow(this);\r\n            }\r\n        };\r\n        this.arrow_hitbox.on('mouseup', complete_arrow);\r\n        this.rect.on('mouseup', complete_arrow);\r\n        this.text.on('mouseup', complete_arrow);\r\n\r\n        this.setupHover(shared_state);\r\n        this.setupContextMenu(shared_state);\r\n\r\n        if (focus_text_area) {\r\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\r\n        }\r\n        \r\n        this.setIsOnGraph(isOnGraph);\r\n\r\n        this.annotatedOrder = annotatedOrder\r\n        this.showAnnotatedOrder()\r\n\r\n        // don't log add node events if they are just loaded from a save\r\n        if (!params.isFromJSON) {\r\n            shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\r\n        }\r\n    }\r\n\r\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList, zoomCanvasTo) {\r\n        var params = json\r\n        params.x = json.screenCoords.x\r\n        params.y = json.screenCoords.y\r\n        params.width = 200\r\n        params.height = 42\r\n        params.isFromJSON = true\r\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList, zoomCanvasTo)\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            id: this.id,\r\n            shortText: this.shortText,\r\n            longText: this.longText,\r\n            screenCoords: this.group.getScreenCoords(),\r\n            isOnGraph: this.isOnGraph,\r\n            annotatedOrder: this.annotatedOrder,\r\n        }\r\n    }\r\n\r\n    setIsOnGraph(newVal) {\r\n        this.isOnGraph = newVal;\r\n        if (this.isOnGraph) {\r\n            this.rect.addClass(\"node-on-graph\");\r\n        } else {\r\n            this.rect.removeClass(\"node-on-graph\");\r\n        }\r\n    }\r\n\r\n    setupContextMenu(shared_state) {\r\n        var showOptionMenu = e => {\r\n            e.preventDefault();\r\n            \r\n            var entries = [\r\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"🗙\"}\r\n            ]\r\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\r\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\r\n                if (selected_option.name === \"Delete\") {\r\n                    this.delete(shared_state);\r\n                }\r\n            });\r\n            \r\n            return false;\r\n        };\r\n        this.rect.on('contextmenu', showOptionMenu);\r\n        this.text.on('contextmenu', showOptionMenu);\r\n    }\r\n\r\n    setupHover(shared_state) {\r\n        this.hoverers = []\r\n\r\n        const startHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, true);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\r\n            });\r\n        };\r\n        const endHover = (e) => {\r\n            this.setHoverer(\"mouse_\" + e.target, false);\r\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\r\n                if (!ref) {\r\n                    return\r\n                }\r\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\r\n            });\r\n        };\r\n        this.rect.on('mouseenter', startHover);\r\n        this.text.on('mouseenter', startHover);\r\n        this.rect.on('mouseleave', endHover);\r\n        this.text.on('mouseleave', endHover);\r\n    }\r\n\r\n    setHoverer(hoverer, isHovering) {\r\n        if (isHovering) {\r\n            if (!this.hoverers.includes(hoverer)) {\r\n                this.hoverers.push(hoverer)\r\n            }\r\n        } else {\r\n            // remove the hoverer\r\n            var index = this.hoverers.indexOf(hoverer);\r\n            if (index !== -1) this.hoverers.splice(index, 1);\r\n        }\r\n\r\n        this.setHovered(this.hoverers.length > 0)\r\n    }\r\n\r\n    setHovered(isHovered) {        \r\n        if (isHovered) {\r\n            this.rect.addClass(\"hovered\");\r\n        } else {\r\n            this.rect.removeClass(\"hovered\");\r\n        }\r\n    }\r\n\r\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\r\n    // but we only want to make the node itself draggable\r\n    // so we need to intercept drag events on the rect, and move the entire group instead!\r\n    setupRectDragging(rect, shared_state) {\r\n        this.setupGroupDragging(rect, shared_state, rect);\r\n        this.setupGroupDragging(this.text, shared_state, rect, true);\r\n        \r\n        this.text.click((e) => e.preventDefault());\r\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\r\n        rect.click(edit_text_if_not_just_dropped);\r\n        this.text.click(edit_text_if_not_just_dropped);\r\n    }\r\n\r\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\r\n        rect.draggy(); // setup dragging on the rect\r\n        rect.on('mousedown', (e) => {\r\n            e.stopPropagation(); // don't pan when moving a node\r\n        });\r\n        just_dropped_obj.just_dropped = false;\r\n        rect.on('dragstart', (e) => {\r\n            var start_x = this.group.x();\r\n            var start_y = this.group.y();\r\n            document.activeElement.blur();\r\n            shared_state.draggedNode = {\r\n                id: this.id,\r\n                text: this.getShortText(),\r\n                longText: this.getLongText(),\r\n                resetPos: () => {\r\n                    this.group.move(start_x, start_y);\r\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n                },\r\n                node: this\r\n            };\r\n\r\n            this.dropShadow.translate(5, 5)\r\n            this.dropShadow.addClass('visible')\r\n            \r\n            rect.off('dragmove');\r\n            rect.on('dragmove', (e) => {\r\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\r\n                if (center) {\r\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n                } else {\r\n                    rect.x(0);\r\n                    rect.y(0);\r\n                }\r\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n            });\r\n            rect.off('dragend');\r\n            rect.on('dragend', (e) => {\r\n                // prevent the textarea showing\r\n                // unless the drag amount was zero or just a tiny accidental drag\r\n                var x_diff = (this.group.x() - start_x);\r\n                var y_diff = (this.group.y() - start_y);\r\n                var nudge = 10;\r\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\r\n                    just_dropped_obj.just_dropped = true;\r\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\r\n                }\r\n                shared_state.draggedNode = false;\r\n\r\n                this.dropShadow.translate(0, 0)\r\n                this.dropShadow.removeClass('visible')\r\n            });\r\n        });\r\n    }\r\n\r\n    // click/drag events on the arrow hitbox should start the arrow creation process\r\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\r\n        arrow_hitbox.on('mousemove', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.update_source(this.group);\r\n            }\r\n        });\r\n        arrow_hitbox.on('mouseleave', () => {\r\n            if (!mouse_follower.drawing_arrow_from) {\r\n                mouse_follower.hide();\r\n            }\r\n        });\r\n        arrow_hitbox.on('mousedown', (e) => {\r\n            mouse_follower.start_arrow(this);\r\n            e.stopPropagation(); // don't pan when dragging an arrow\r\n        });\r\n    }\r\n\r\n    updateShortText(newShortText) {\r\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\r\n        \r\n        const CHARS_PER_LINE = 21;\r\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\r\n\r\n        this.text.text(formattedText.join(\"\\n\"));\r\n        this.resizeRect(formattedText.length);\r\n    }\r\n\r\n    updateLongText(newLongText) {\r\n        this.longText = newLongText;\r\n    }\r\n\r\n    splitIntoLines(charsPerLine, text) {\r\n        var formattedText = [];\r\n        var line = \"\";\r\n        text.split(\" \").forEach(word => {\r\n            var segments = [];\r\n            if (word.length > charsPerLine) {\r\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\r\n                    if (segments.length > 0) {\r\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\r\n                    }\r\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\r\n                }\r\n            }\r\n            else {\r\n                segments = [word];\r\n            }\r\n            segments.forEach(segment => {\r\n                if ((line + segment).length < charsPerLine) {\r\n                    var space = line.length > 0 ? \" \" : \"\";\r\n                    line += space + segment;\r\n                }\r\n                else {\r\n                    formattedText.push(line);\r\n                    line = segment;\r\n                }\r\n            });\r\n        });\r\n        formattedText.push(line);\r\n        return formattedText;\r\n    }\r\n\r\n    // resize the rect so that the text fits on it\r\n    resizeRect(numLinesOfText) {\r\n        this.rect.width(200);\r\n        const rectHeight = numLinesOfText * 21 + 20\r\n        this.rect.height(rectHeight);\r\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\r\n        this.dropShadow.height(rectHeight)\r\n        this.editRect.height(rectHeight - 10)\r\n\r\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\r\n\r\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\r\n    }\r\n\r\n    getShortText() {\r\n        return this.shortText;\r\n    }\r\n\r\n    getLongText() {\r\n        return this.longText;\r\n    }\r\n\r\n    showAnnotatedOrder() {\r\n        if (this.annotatedOrder) {\r\n            this.annotatedOrderText = this.group.text(this.annotatedOrder.toString())\r\n        }\r\n    }\r\n\r\n    editText(shared_state, delete_if_empty_text = false) {\r\n        document.activeElement.blur(); // remove focus from everything\r\n\r\n        if (shared_state.orderAnnotate) {\r\n            if (this.annotatedOrder) {\r\n                shared_state.annotatedNumbers = shared_state.annotatedNumbers.filter(num => num !== this.annotatedOrder)\r\n                this.annotatedOrder = undefined\r\n                this.annotatedOrderText.remove()\r\n            } else {\r\n                const num = shared_state.getNextAnnotateNum()\r\n                this.annotatedOrder = num\r\n                shared_state.annotatedNumbers.push(num)\r\n                this.showAnnotatedOrder()\r\n            }\r\n            return\r\n        }\r\n\r\n        this.zoomCanvasTo(1, {x: this.group.cx(), y: this.group.cy()}, () => {\r\n            var textarea = document.querySelector('#nodeedit');\r\n            textarea.value = this.getShortText();\r\n\r\n            const preEditText = this.getShortText()\r\n\r\n            var screen_coords = this.rect.getScreenCoords();\r\n            textarea.style.left = screen_coords.x + \"px\";\r\n            textarea.style.top = screen_coords.y + \"px\";\r\n            textarea.style.display = \"inline-block\";\r\n            textarea.focus();\r\n\r\n            textarea.style.width = \"180px\";\r\n            textarea.style.height = 'auto';\r\n            textarea.style.height = (textarea.scrollHeight) + 'px';\r\n\r\n            this.text.hide();\r\n\r\n            this.editRect.addClass('visible')\r\n            this.setHoverer('editNodeDirectly', true)\r\n\r\n            var save_changes = () => {\r\n                this.updateShortText(textarea.value);\r\n                shared_state.updateDocShortText(this.id, this.getShortText());\r\n            };\r\n            var save_and_hide = () => {\r\n                save_changes();\r\n                textarea.style.display = \"none\";\r\n                if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\r\n                    this.delete(shared_state);\r\n                }\r\n                this.text.show();\r\n                this.updateShortText(this.shortText);\r\n\r\n                if (this.getShortText() !== preEditText) {\r\n                    shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\r\n                }\r\n\r\n                this.editRect.removeClass('visible')\r\n                this.setHoverer('editNodeDirectly', false)\r\n            };\r\n            textarea.onblur = save_and_hide;\r\n            textarea.onkeyup = (e) => {\r\n                if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\r\n                    e.preventDefault();\r\n                    document.activeElement.blur();\r\n                } else {\r\n                    save_changes();\r\n                }\r\n            };\r\n        })\r\n    }\r\n\r\n    delete(shared_state) {\r\n        shared_state.removeGraphNode(this.id);\r\n        \r\n        // remove from the list of nodes (used for saving)\r\n        const nodesList = this.getNodesList()\r\n        var index = nodesList.indexOf(this);\r\n        if (index !== -1) {\r\n            nodesList.splice(index, 1)\r\n        } else {\r\n            console.log('node not found in this.nodesList when deleting');\r\n        }        \r\n\r\n        this.group.remove();\r\n\r\n        // delete arrows\r\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\r\n\r\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\r\n    }\r\n}\r\n\r\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\r\nimport { ItemTypes } from \"../../dragtypes\";\r\n\r\nconst graphTarget = {\r\n    canDrop(props, monitor) {\r\n        const item = monitor.getItem()\r\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\r\n    },\r\n\r\n    drop(props, monitor, component) {\r\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\r\n    },\r\n}\r\n\r\nfunction collect(connect, monitor) {\r\n    return {\r\n        // Call this function inside render()\r\n        // to let React DnD handle the drag events:\r\n        connectDropTarget: connect.dropTarget(),\r\n        // You can ask the monitor about the current drag state:\r\n        itemType: monitor.getItemType(),\r\n    }\r\n}\r\n\r\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\r\nimport './GraphPane.css';\r\nimport SVG from 'svg.js';\r\nimport 'svg.panzoom.js';\r\nimport 'svg.draggy.js';\r\nimport './svg.connectable.js';\r\nimport MouseFollower from './MouseFollower.js';\r\nimport GraphNode from './GraphNode.js';\r\nimport DropifyGraphPane from './DropifyGraphPane.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nclass GraphPane extends React.Component {\r\n    componentDidMount() {\r\n        this.props.sharedState.getSavedGraph((json) => {\r\n            this.nodesList = [];\r\n\r\n            this.props.sharedState.graphPane = this;\r\n\r\n            this.$el = document.querySelector(\"#graph\")\r\n\r\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 0.2, zoomMax: 1, zoomFactor: 0.1 }); // just pan, no zoom\r\n            this.svg = svg\r\n            this.zoomCanvasTo = (level, pos, cb) => {\r\n                if (Math.abs(svg.zoom() - level) < 0.01) { // it doesn't zoom to the exact number\r\n                    if (cb) { cb() }\r\n                } else {\r\n                    const runner = svg.animate({duration: 100, ease: '>'})\r\n                        .zoom(level, pos)\r\n                    \r\n                    if (cb) { runner.after(cb) }\r\n                }\r\n            }\r\n\r\n            svg.zoom(1)\r\n\r\n            SVG.extend(SVG.Element, {\r\n                getScreenCoords: function (zone) {\r\n                    var root_point = this.doc().node.getBoundingClientRect()\r\n                    var point = this.node.getBoundingClientRect()\r\n\r\n                    if (zone === 'centre') {\r\n                        return {\r\n                            x: (point.left + point.right) / 2 - root_point.left,\r\n                            y: (point.top + point.bottom) / 2 - root_point.top\r\n                        }\r\n                    } else {\r\n                        return {\r\n                            x: point.x - root_point.left,\r\n                            y: point.y - root_point.top\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n\r\n            var links = svg.group();\r\n            var markers = svg.group();\r\n            var nodes = svg.group();\r\n            this.nodesSvgGroup = nodes\r\n\r\n            this.numTempNodes = 0\r\n\r\n            const json_connections = json ? json.connections : undefined\r\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\r\n            this.mouse_follower = mouse_follower\r\n\r\n            // add new nodes on mouse click\r\n            svg.on('dblclick', (e) => {\r\n                // only clicks on background and not when dragging\r\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\r\n                    return;\r\n                }\r\n\r\n                var x = e.clientX\r\n                if (x + 200 > window.innerWidth) {\r\n                    x = window.innerWidth - 200\r\n                }\r\n                var y = e.clientY\r\n                if (y + 60 > window.innerHeight) {\r\n                    y = window.innerHeight - 60\r\n                }\r\n\r\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", x, y, true);\r\n            });\r\n\r\n            this.setupTextDropping(svg, nodes, mouse_follower);\r\n\r\n            const blurActiveElement = (e) => {\r\n                document.activeElement.blur();\r\n            }\r\n            svg.on('panStart', blurActiveElement)\r\n            svg.on('zoom', blurActiveElement)\r\n\r\n            var textarea = document.querySelector('#nodeedit');\r\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\r\n            textarea.addEventListener(\"input\", (e) => {\r\n                textarea.style.height = 'auto';\r\n                textarea.style.height = (textarea.scrollHeight) + 'px';\r\n            });\r\n\r\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\r\n                if (x + 200 > window.innerWidth) {\r\n                    x = window.innerWidth - 200\r\n                }\r\n                if (y + 60 > window.innerHeight) {\r\n                    y = window.innerHeight - 60\r\n                }\r\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\r\n            }\r\n            if (json && json.nodes) {\r\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\r\n            }\r\n\r\n            this.getNodeById = this.getNodeById.bind(this)\r\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\r\n\r\n            if (this.nodesList.length === 0) {\r\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\r\n            }\r\n        })\r\n    }\r\n\r\n    getNodeById(id) {\r\n        return this.nodesList.find(node => node.id.toString() === id.toString())\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            nodes: this.nodesList.map(node => node.toJSON()),\r\n            connections: this.mouse_follower.toJSON()\r\n        }\r\n    }\r\n\r\n    loadNodesFromJSON(json, mouse_follower, nodes) {\r\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList, this.zoomCanvasTo))\r\n        // temp\r\n        console.log(\"num nodes: \" + this.nodesList.length)\r\n    }\r\n\r\n    explodeNodes() {\r\n        const factor = 0.1\r\n        this.nodesList.forEach((node) => {\r\n            node.group.move(\r\n                node.group.x() + node.group.x() * factor, \r\n                node.group.y() + node.group.y() * factor\r\n            )\r\n            node.group.node.dispatchEvent(new CustomEvent(\"dragmove\")) // update arrows\r\n        })\r\n    }\r\n\r\n    addTempNode(id) {\r\n        // this is to visualise nodes that were created then deleted, and are now being viewed in the log explore timeline\r\n        var node = this.addNodeAtScreenLocation(this.svg, this.nodesSvgGroup, this.mouse_follower, \"?\", 0, this.numTempNodes * 150, false, true, id, true)\r\n        this.numTempNodes++\r\n\r\n        return node\r\n    }\r\n\r\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\r\n        this.noNodesIndicator = svg.text(\"Double click to add a node\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\r\n        this.noNodesIndicator.on('dblclick', (e) => {\r\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\r\n        });\r\n    }\r\n\r\n    setupTextDropping(svg, nodes, mouse_follower) {\r\n        this.$el.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        this.$el.addEventListener(\"drop\", (e) => {\r\n            e.preventDefault();\r\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\r\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\r\n            }\r\n            \r\n            var data = e.dataTransfer.getData(\"Text\");\r\n\r\n            if (data.includes('\\n')) {\r\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\r\n                return\r\n            }\r\n\r\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\r\n                toast.error('You can\\'t add the same node to the graph twice!')\r\n                return\r\n            }\r\n\r\n            var x = e.clientX\r\n            if (x + 200 > window.innerWidth) {\r\n                x = window.innerWidth - 200\r\n            }\r\n            var y = e.clientY\r\n            if (y + 60 > window.innerHeight) {\r\n                y = window.innerHeight - 60\r\n            }\r\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, x, y, false);\r\n            this.props.sharedState.addLinkAtSelection(node.id, node);\r\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\r\n            document.activeElement.blur();\r\n        });\r\n    }\r\n\r\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false, id=undefined, isSvgCoords=false) {\r\n        var point = svg.point(x, y);\r\n        if (isSvgCoords) { // don't convert screen > svg coords\r\n            point = {x: x, y: y}\r\n        }\r\n        const params = {\r\n            shortText: text,\r\n            longText: \"\", \r\n            x: point.x,\r\n            y: point.y,\r\n            width: 200,\r\n            height: 42,\r\n            isOnGraph: false,\r\n            id: id, // set automatically\r\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\r\n        }\r\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList, this.zoomCanvasTo);\r\n        this.nodesList.push(node);\r\n\r\n        if (this.noNodesIndicator) {\r\n            this.noNodesIndicator.hide();\r\n        }\r\n\r\n        return node;\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.$el.somePlugin('destroy');\r\n    }\r\n\r\n    render() {\r\n        return this.props.connectDropTarget(\r\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\r\n                <textarea id='nodeedit'></textarea>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\r\n\r\nconst db = new Dexie('writeReasonDb');\r\ndb.version(3).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\r\n\r\nexport default db;","import React, { Component } from 'react';\r\n\r\nexport default class ProjectsList extends Component {\r\n    render() {\r\n        return (\r\n            <div className='display-block'>\r\n                <table className='pure-table'>\r\n                    <thead>\r\n                        <tr>\r\n                            {/* {(process.env.NODE_ENV === 'development') && <th>ID</th>} */}\r\n                            <th>Project</th>\r\n                            <th></th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {\r\n                            this.props.projects.map(project => <tr key={project.id.toString()}>\r\n                                {/* {(process.env.NODE_ENV === 'development') && <td>{project.id}</td>} */}\r\n                                <td>{project.name}</td>\r\n                                <td>\r\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"Project controls\">\r\n                                        <button className=\"pure-button\" onClick={() => this.props.loadProject(project.id)}>Open</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.renameProject(project.id)}>Rename</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.duplicateProject(project.id)}>Duplicate</button>\r\n                                        <button className=\"pure-button\" onClick={() => this.props.deleteProject(project.id)}>Delete</button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>)\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        )\r\n      }\r\n}","import React, { Component } from 'react';\r\n\r\nexport default class LogsExploreTable extends Component {\r\n    render() {\r\n        return (\r\n            <div className='display-block'>\r\n                <button className=\"pure-button\" onClick={() => localStorage.removeItem('logsToExplore')}>Delete stored logs</button>\r\n                <table className='pure-table'>\r\n                    <tbody>\r\n                        {\r\n                            this.props.logs && this.props.logs.map(log => <tr key={log.filename}>\r\n                                {/* {(process.env.NODE_ENV === 'development') && <td>{project.id}</td>} */}\r\n                                <td>{log.filename}</td>\r\n                                <td>\r\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"Project controls\">\r\n                                        {\r\n                                            log.projects.length > 1 && <p>MULTIPLE PROJECTS!</p>\r\n                                        }\r\n                                        {\r\n                                            log.projects[0].log.saves.map((save, index) => \r\n                                                <button className=\"pure-button\" onClick={(e) => this.props.exploreLog(log.projects[0], index)}>{index}</button>\r\n                                            )\r\n                                        }\r\n                                        {\r\n                                            // TEMP - just open the first log\r\n                                            // (log.filename === 'logs 2.json') && setTimeout(() => this.props.exploreLog(log.projects[0], 0), 0)\r\n                                        }\r\n                                    </div>\r\n                                </td>\r\n                            </tr>)\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        )\r\n      }\r\n}","import db from './db.js'\r\nimport { toast } from 'react-toastify';\r\n\r\nconst EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY = [\r\n    'session_start',\r\n    'document_content_detailed',\r\n    'document_content_markdown',\r\n]\r\n\r\nexport default class Logger {\r\n    shouldLogToConsole = false;\r\n\r\n    constructor(db_id, params) {\r\n        this.db_id = db_id;\r\n        this.conditions = params;\r\n        this.logToConsole(\"Logging begin, db_id \" + db_id + \"\\nParams \" + JSON.stringify(params, null, 1));\r\n\r\n        // used for tracking whether changes have been made since last save\r\n        // obviously, does not track events which are not logged, like typing in the document\r\n        this.stateIsDirty = false\r\n\r\n        this.logEvent({'type': 'session_start'})\r\n    }\r\n\r\n    logEvent(event) {\r\n        if (!EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY.includes(event.type)) {\r\n            this.stateIsDirty = true\r\n        }\r\n\r\n        if (event.type === 'save') {\r\n            this.stateIsDirty = false\r\n        }\r\n\r\n        this.getLog(log => {\r\n            if (log.events === undefined) {\r\n                log.events = {}\r\n            }\r\n    \r\n            if (log.events[event.type] === undefined) {\r\n                log.events[event.type] = []\r\n            }\r\n            event.timestamp = new Date()\r\n            log.events[event.type].push(event)\r\n            this.setLog(log)\r\n\r\n            this.logToConsole(\"Logging event: \" + JSON.stringify(event))\r\n        })\r\n    }\r\n\r\n    // keep a history of the save states so that we can look back at how the project developed\r\n    logSaveState(save, forceLog=false) {\r\n        this.getLog(log => {\r\n            if (log.saves === undefined) {\r\n                log.saves = []\r\n            }\r\n\r\n            // don't store this save if we have stored a save <3 minutes ago\r\n            // to prevent multiple clicks of the save button taking up lots of space\r\n            const timestamp = new Date()\r\n            const THREE_MINUTES = 3 * 60 * 1000; // ms\r\n            if (forceLog || !log.saves.find(save => (timestamp - save.timestamp < THREE_MINUTES))) {\r\n                log.saves.push({\r\n                    timestamp: timestamp,\r\n                    ...save,\r\n                })\r\n                this.setLog(log)\r\n            }\r\n        })\r\n    }\r\n\r\n    getLog(callback) {\r\n        db.table('projects')\r\n            .get(this.db_id)\r\n            .then((project) => {\r\n                callback(project.log ? project.log : {})\r\n            })\r\n    }\r\n\r\n    setLog(log) {\r\n        db.table('projects')\r\n            .update(this.db_id, { log: log })\r\n            .catch(err => {\r\n                toast.error('Logging error: ' + err)\r\n                console.log('Logging error: ' + err)\r\n            })\r\n    }\r\n\r\n    logToConsole(msg) {\r\n        if (this.shouldLogToConsole) {\r\n            console.log(msg);\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport { Text } from 'slate';\r\nimport Html from 'slate-html-serializer'\r\nimport Logger from './logging'\r\nimport db from './db.js'\r\nimport { toast } from 'react-toastify';\r\nimport { pdf, Document, Page, Text as PdfText, StyleSheet, Font } from '@react-pdf/renderer';\r\nimport CrimsonText from './assets/CrimsonText-Regular.ttf'\r\nimport CrimsonTextBold from './assets/CrimsonText-Bold.ttf'\r\n\r\n\r\nexport default class SharedState {\r\n    constructor(db_id, params) {\r\n        if (!params.logExplore) {\r\n            this.logger = new Logger(db_id, params)\r\n        } else {\r\n            this.logger = {logEvent: (x, y) => {} }\r\n        }\r\n        this.condition = params.condition;\r\n        this.params = params;\r\n        \r\n        this.node_id_counter = 0;\r\n        this.slate_id_counter = 10\r\n        this.map = {};\r\n        this.map_recycle_bin = {};\r\n        this.db_id = db_id\r\n        this.orderAnnotate = false\r\n        this.annotatedNumbers = []\r\n\r\n        // this.editor_ref and this.graphPane set in the editor and graphpane\r\n        this.editor_ref = undefined;\r\n        this.graphPane = undefined;\r\n\r\n        // log entire document content every 60 seconds\r\n        if (!this.params.logExplore) {\r\n            this.intervalLogger = window.setInterval(() => {\r\n                this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\r\n            }, 60000);\r\n        }\r\n        \r\n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\r\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\r\n        this.save = this.save.bind(this)\r\n        this.mapToJSON = this.mapToJSON.bind(this)\r\n        this.exportPDF = this.exportPDF.bind(this)\r\n        this.exploreNext = this.exploreNext.bind(this)\r\n        this.explorePrev = this.explorePrev.bind(this)\r\n        this.exploreLog = this.exploreLog.bind(this)\r\n        this.makeNodeReport = this.makeNodeReport.bind(this)\r\n        this.getNextAnnotateNum = this.getNextAnnotateNum.bind(this)\r\n        this.exportAnnotatedLog = this.exportAnnotatedLog.bind(this)\r\n        this.explodeNodes = this.explodeNodes.bind(this)\r\n\r\n        // when the tab is closed, if the document has been edited, warn before closing\r\n        window.onbeforeunload = (e) => {\r\n            if (process.env.NODE_ENV !== 'development' && this.getStateIsDirty()) { // disable in development for webpack hot reloading\r\n                e.preventDefault()\r\n                e.returnValue = '' // for Chrome\r\n            }\r\n        }\r\n    }\r\n\r\n    exportAnnotatedLog() {\r\n        const save = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        this.downloadJSON(save, this.params.logExplore.project.filename + \"__order_annotated.json\")\r\n    }\r\n\r\n    getNextAnnotateNum() {\r\n        if (this.annotatedNumbers.length === 0) {\r\n            return 1\r\n        } else {\r\n            // check for a gap\r\n            this.annotatedNumbers.sort((a, b) => a - b)\r\n            var prev = 0\r\n            this.annotatedNumbers.forEach(annotatedNum => {\r\n                if (prev + 1 !== annotatedNum) {\r\n                    return prev + 1\r\n                }\r\n                prev = annotatedNum\r\n            })\r\n            \r\n            // if no gaps\r\n            return this.annotatedNumbers[this.annotatedNumbers.length - 1] + 1\r\n        }\r\n    }\r\n\r\n    viewFactSheet() {\r\n        const scenario = localStorage.getItem('scenario')\r\n        if (!scenario) {\r\n            toast.error('Fact sheet not found. Please re-open Write Reason using the link in the email we sent you.')\r\n            return\r\n        }\r\n\r\n        const factSheetURL = scenario + '_factsheet.pdf'\r\n        window.open(factSheetURL, '_blank')  // open in new tab\r\n    }\r\n\r\n    // called by editor once the database saved value has been set as the document.value\r\n    editorHasLoaded() {\r\n        this.getProjectThen(project => {\r\n            this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\r\n            this.map = project.map ? this.mapFromJSON(project.map) : {}\r\n            this.getEditor().mapHasLoaded()\r\n            this.projectName = project.name\r\n            document.title = this.projectName + \" - Write Reason\"\r\n        })\r\n        \r\n        this.lastSavedDocumentState = this.getEditor().getValue().document // editor is definitely not dirty right now\r\n    }\r\n\r\n    save(cb=undefined, forceLog=false) {\r\n        const changes = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        db.table('projects')\r\n            .update(this.db_id, changes)\r\n            .then((idExists) => {\r\n                if (!idExists) {\r\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\r\n                    console.log(message)\r\n                    toast.error(message)\r\n                } else {\r\n                    toast.info('Changes saved!')\r\n                    this.lastSavedDocumentState = this.getEditor().getValue().document\r\n                    this.logger.logSaveState(changes, forceLog)\r\n                }\r\n            }).catch(err => {\r\n                toast.error('Save error: ' + err.toString())\r\n            })\r\n            \r\n        this.logger.logEvent({'type': 'save'})\r\n\r\n        if (cb) {\r\n            cb()\r\n        }\r\n    }\r\n\r\n    getStateIsDirty() {\r\n        return this.logger.stateIsDirty || (\r\n            this.getEditor() && this.getEditor().getValue() && this.getEditor().getValue().document !== this.lastSavedDocumentState\r\n        ) \r\n    }\r\n\r\n    explorePrev() {\r\n        if (this.params.logExplore.saveIndex === 0) {\r\n            return\r\n        }\r\n        \r\n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex - 1)\r\n    }\r\n\r\n    exploreNext() {\r\n        if (this.params.logExplore.saveIndex === this.params.logExplore.project.log.saves.length - 1) {\r\n            return\r\n        }\r\n\r\n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex + 1)\r\n    }\r\n\r\n    exploreLog(project, saveIndex) {\r\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.params.transitionToEditor }\r\n        const sharedState = new SharedState(-1, params)\r\n        this.params.transitionToEditor(sharedState, true)\r\n    }\r\n\r\n    makeNodeReport() {\r\n        const changes = {\r\n            map: this.mapToJSON(),\r\n            node_id_counter: this.node_id_counter,\r\n            doc_value: this.getEditor().getValue().toJSON(),\r\n            graph_value: this.graphPane.toJSON(),\r\n        }\r\n        this.downloadJSON(changes, this.params.logExplore.project.filename + \"_ANNOTATED.json\")\r\n\r\n        const nodeReport = {linkedTexts: [], unlinkedTexts: []}\r\n        const value = this.getEditor().getValue()\r\n        value.document.getBlocks().forEach(block => {\r\n            if (block.type === 'body' || block.type === 'link' || block.type === 'section') {\r\n                nodeReport.linkedTexts.push(block.text)\r\n            } else {\r\n                block.nodes.forEach(node => {\r\n                    if (!node.text) {\r\n                        return\r\n                    }\r\n                    if (node.type === 'link') {\r\n                        nodeReport.linkedTexts.push(node.text)\r\n                    } else {\r\n                        nodeReport.unlinkedTexts.push(node.text)\r\n                    }\r\n                })\r\n            }\r\n        })\r\n\r\n        nodeReport.linked = nodeReport.linkedTexts.join('\\n')\r\n        nodeReport.unlinked = nodeReport.unlinkedTexts.join('\\n')\r\n        \r\n        nodeReport.linkedCharsProportion = nodeReport.linked.length / (nodeReport.linked.length + nodeReport.unlinked.length)\r\n        \r\n        const countWords = (str) => str.trim().split(/\\s+/).length\r\n        nodeReport.linkedWords = countWords(nodeReport.linked)\r\n        nodeReport.unlinkedWords = countWords(nodeReport.unlinked)\r\n        nodeReport.linkedWordProportion = nodeReport.linkedWords / (nodeReport.linkedWords + nodeReport.unlinkedWords)\r\n\r\n        nodeReport.rawValue = value\r\n\r\n        var nodeReports = localStorage.getItem('nodeReports') ? JSON.parse(localStorage.getItem('nodeReports')) : {}\r\n        nodeReports[this.params.logExplore.project.filename] = nodeReport\r\n        localStorage.setItem('nodeReports', JSON.stringify(nodeReports))\r\n    }\r\n\r\n    getProjectThen(cb) {\r\n        if (this.params.logExplore) {\r\n            const logExplore = this.params.logExplore\r\n            cb(logExplore.project.log.saves[logExplore.saveIndex])\r\n        } else {\r\n            db.table('projects')\r\n                .get(this.db_id)\r\n                .then(project => {\r\n                    cb(project)\r\n                })\r\n        }\r\n    }\r\n\r\n    getSavedDocValue = async function(onDataLoad) {\r\n        this.getProjectThen(project => {\r\n            onDataLoad(project.doc_value)\r\n        })\r\n    }\r\n\r\n    getSavedGraph = async function(onDataLoad) {\r\n        this.getProjectThen(project => {\r\n            onDataLoad(project.graph_value)\r\n        })\r\n    }\r\n\r\n    mapToJSON() {\r\n        var mapJson = {}\r\n        const document = this.getEditor().value.document\r\n        for (const id in this.map) {\r\n            let doc_nodes = {};\r\n            ['section', 'long', 'short'].forEach(part => {\r\n                const docNodeObjects = this.getDocNodes(id)\r\n                if (docNodeObjects && docNodeObjects[part]) {\r\n                    const path = document.getPath(docNodeObjects[part])\r\n                    if (path) {\r\n                        doc_nodes[part] = path.toArray()\r\n                    }\r\n                } \r\n            })\r\n\r\n            mapJson[id] = {\r\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\r\n                doc_nodes: doc_nodes\r\n            }\r\n        }\r\n\r\n        return mapJson\r\n    }\r\n\r\n    mapFromJSON(json) {\r\n        this.map = {}\r\n        for (const id in json) {\r\n            if (json[id].graph_node) {\r\n                const graphNode = this.graphPane.getNodeById(id)\r\n                if (graphNode) {\r\n                    this.addGraphMapping(id, graphNode)\r\n                } else {\r\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\r\n                }\r\n            }\r\n\r\n            if (json[id].doc_nodes) {\r\n                for (const part in json[id].doc_nodes) {\r\n                    const path = json[id].doc_nodes[part]\r\n                    \r\n                    const document = this.getEditor().value.document\r\n                    if (document.hasNode(path)) {\r\n                        this.setLinkMapping(id, document.getNode(path), part)\r\n                    } else {\r\n                        console.log(document);\r\n                        \r\n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this.map\r\n    }\r\n\r\n    downloadExperimentData() {\r\n        // save first to log the latest document version\r\n        this.save(() => {\r\n            db.table('projects')\r\n            .toArray(projects => {\r\n                const data = {\r\n                    timestamp: new Date(),\r\n                    preTaskSubmission: localStorage.getItem('preTaskSubmission'),\r\n                    projects: projects,\r\n                }\r\n                this.downloadJSON(data, 'Write Reason logs.json')\r\n                \r\n            }).catch(err => {\r\n                toast.error(\"Error downloading logs: \" + err)\r\n            })\r\n        }, true)\r\n    }\r\n\r\n    getArgumentHTML() {\r\n        const parentStyleIs = (node, styleToCheck) => {\r\n            const parent = this.getEditor().value.document.getParent(node.key)\r\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\r\n        }\r\n\r\n        const RULES = [\r\n            {\r\n                serialize: (node, children) => {\r\n                    if ([\"block\", \"inline\"].includes(node.object)) {\r\n                        switch(node.type) {\r\n                            case 'paragraph':\r\n                            case '':\r\n                                return <p>{children}</p>\r\n\r\n                            case 'heading':\r\n                                return <h2>{children}</h2>\r\n                            \r\n                            case 'section':\r\n                                return <div>{children}</div>\r\n                            \r\n                            case 'body':\r\n                                if (parentStyleIs(node, \"Heading only\")) {\r\n                                    return <p></p>\r\n                                } else {\r\n                                    return <p>{children}</p>\r\n                                }\r\n\r\n                            case 'link':\r\n                                if (node.object === \"inline\") {\r\n                                    return <span>{children}</span>\r\n                                } else {\r\n                                    if (parentStyleIs(node, \"Body only\")) {\r\n                                        return <p></p>\r\n                                    } else {\r\n                                        return <h2>{children}</h2>\r\n                                    }\r\n                                }\r\n\r\n                            default:\r\n                                return undefined\r\n                        }\r\n                    } else if(node.object === 'string') {\r\n                        return node.text\r\n                    }\r\n                } \r\n            }\r\n        ]\r\n\r\n        const serializer = new Html({rules: RULES})\r\n        return serializer.serialize(this.getEditor().value)\r\n    }\r\n\r\n    downloadJSON(json, filename) {\r\n        const file = new Blob([JSON.stringify(json, null, 2)], {type: 'text/plain'})\r\n        this.downloadBlob(file, filename)\r\n    }\r\n\r\n    downloadBlob(blob, filename) {\r\n        const element = document.createElement(\"a\");\r\n        element.href = URL.createObjectURL(blob);\r\n        element.download = filename;\r\n        document.body.appendChild(element); // Required for this to work in FireFox\r\n        element.click();\r\n    }\r\n\r\n    exportPDF() {\r\n        this.logger.getLog(log => {\r\n            this.getReactPdfDocument().then(file => {      \r\n                this.downloadBlob(file, this.projectName + \".pdf\")\r\n            })\r\n        })\r\n    }\r\n\r\n    getReactPdfDocument() {\r\n        const markdown = this.getArgumentMarkdown()\r\n\r\n        Font.register({family: 'Crimson Text', fonts: [\r\n            {src: CrimsonText},\r\n            {src: CrimsonTextBold, fontWeight: 800}\r\n        ]})\r\n\r\n        const styles = StyleSheet.create({\r\n            page: {\r\n                padding: 80\r\n            },\r\n            text: {\r\n                fontFamily: \"Crimson Text\",\r\n                width: \"100%\",\r\n                fontSize: \"12pt\",\r\n                paddingBottom: 8,\r\n            },\r\n            heading: {\r\n                fontFamily: \"Crimson Text\",\r\n                textDecoration: \"underline\",\r\n                fontWeight: 800,\r\n                width: \"100%\",\r\n                fontSize: \"12pt\"\r\n            }\r\n        })\r\n\r\n        const document = (\r\n            <Document>\r\n                <Page style={styles.page}>\r\n                    {markdown.split('\\n').map(line => {                        \r\n                        if (line.startsWith('##')) { // markdown heading\r\n                            line = line.substring('##'.length)\r\n                            return <PdfText style={styles.heading}>{line}</PdfText>\r\n                        }\r\n\r\n                        return <PdfText style={styles.text}>{line}</PdfText>\r\n                        }\r\n                    )}\r\n                </Page>\r\n            </Document>\r\n        )\r\n        return pdf(document).toBlob()\r\n    }\r\n\r\n    getArgumentMarkdown() {\r\n        var output = this.getArgumentHTML()\r\n        \r\n        var tagReplacements = [\r\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\r\n\r\n            {regex: /<p>/g},\r\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\r\n            {regex: /<div>/g},\r\n            {regex: /<\\/div>/g},\r\n            {regex: /<span>/g},\r\n            {regex: /<\\/span>/g},\r\n            {regex: /<h2>/g, replace: \"## \"},\r\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\r\n        ]\r\n        tagReplacements.forEach((replacement) => {\r\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\r\n        })\r\n\r\n        // unescape HTML entities, eg replace '&amp' with '&'\r\n        var element = document.createElement(\"span\")\r\n        element.innerHTML = output\r\n        output = element.innerText\r\n\r\n        return output\r\n    }\r\n\r\n    finishCondition() {\r\n        window.onbeforeunload = undefined // remove the warning about closing the tab\r\n        window.clearInterval(this.intervalLogger)\r\n    }\r\n\r\n    getEditor() {\r\n        return this.editor_ref.current;\r\n    }\r\n\r\n    getNodeId() {\r\n        this.node_id_counter++;\r\n        return this.node_id_counter;\r\n    }\r\n\r\n    canAddLinkAtSelection() {\r\n        const value = this.getEditor().value;\r\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\r\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\r\n        return !is_in_linked_block && !is_in_linked_inline;\r\n    }\r\n\r\n    addLinkAtSelection(id, graph_node) {\r\n        this.getEditor().wrapLinkAtSelection(id);\r\n        this.addGraphMapping(id, graph_node);\r\n    }\r\n\r\n    addGraphMapping(id, graph_node) {\r\n        graph_node.setIsOnGraph(true);\r\n        this.map[id] = { graph_node: graph_node };\r\n    }\r\n\r\n    setLinkMapping(id, doc_node, long_or_short) {\r\n        if (!this.map[id]) {\r\n            // uh oh, this should exist\r\n            this.map[id] = {}\r\n\r\n            // maybe the mapping was deleted and re-added with ctrl-Z\r\n            // if so, hopefully it's stored as recently deleted\r\n            this.checkRecycleBinForGraphNode(id)\r\n        }\r\n\r\n        if (this.map[id].doc_nodes === undefined) {\r\n            this.map[id].doc_nodes = {};\r\n        }\r\n        this.map[id].doc_nodes[long_or_short] = doc_node;\r\n    }\r\n\r\n    getGraphNodeAndDocNode(id) {\r\n        return this.map[id];\r\n    }\r\n\r\n    checkRecycleBinForGraphNode(id) {\r\n        if (!this.map[id]) {\r\n            this.map[id] = {}\r\n        }\r\n\r\n        if (this.map[id].graph_node) {\r\n            // no need to restore\r\n            return;\r\n        }\r\n\r\n        const prev_version = this.map_recycle_bin[id]\r\n        if (prev_version && prev_version.graph_node) {\r\n            console.log('restored from recycle');\r\n            \r\n            this.addGraphMapping(id, prev_version.graph_node)\r\n        }\r\n    }\r\n\r\n    getGraphNode(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.graph_node;\r\n        }\r\n    }\r\n\r\n    removeGraphNode(id) {\r\n        if (this.getDocNodes(id)) {\r\n            Object.values(this.getDocNodes(id)).forEach(node => {\r\n                this.getEditor().removeGraphLink(node);\r\n            })\r\n            this.map[id] = undefined;\r\n        }\r\n    }\r\n\r\n    removeDocNode(id) {\r\n        var map = this.getGraphNodeAndDocNode(id)\r\n        if (map) {\r\n            if (map.graph_node) {\r\n                map.graph_node.setIsOnGraph(false);\r\n            }\r\n            \r\n            this.map_recycle_bin[id] = this.map[id]\r\n            this.map[id] = undefined\r\n        }\r\n    }\r\n\r\n    getDocNodes(id) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            return map.doc_nodes;\r\n        }\r\n    }\r\n\r\n    getDocNodeShortText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.short;\r\n        }\r\n    }\r\n\r\n    getDocNodeLongText(id) {\r\n        const docNode = this.getDocNodes(id);\r\n        if (docNode) {\r\n            return docNode.long;\r\n        }\r\n    }\r\n\r\n    getDocNodeRef(id, long_or_short) {\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map && map.doc_link_node) {\r\n            return map.doc_link_node[long_or_short].current;\r\n        }\r\n    }\r\n\r\n    getAllDocNodeRefs(id) {\r\n        var docNodes = [];\r\n        const map = this.getGraphNodeAndDocNode(id);\r\n        if (map) {\r\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\r\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\r\n                    docNodes.push(map.doc_link_node[long_or_short].current)\r\n                }\r\n            })\r\n        }\r\n        return docNodes;\r\n    }\r\n\r\n    registerLinkNode(id, ref, long_or_short) {\r\n        if (this.map[id].doc_link_node === undefined) {\r\n            this.map[id].doc_link_node = {};\r\n        }\r\n        this.map[id].doc_link_node[long_or_short] = ref;\r\n    }\r\n\r\n    // check whether a graph node's doc node still exists\r\n    updateIsOnGraphStatus(id) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        if (!docNode) {\r\n            return false\r\n        }\r\n\r\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\r\n            // tell the graph node that there is no doc node any more, for whatever reason\r\n            this.removeDocNode(id)\r\n            return false\r\n        }\r\n\r\n        return true\r\n    }\r\n\r\n    updateDocShortText(id, newText) {\r\n        var docNode = this.getDocNodeShortText(id);\r\n        \r\n        if (docNode) {\r\n            var editor = this.getEditor();\r\n\r\n            if (this.updateIsOnGraphStatus(id)) {\r\n                // replace any text with newText\r\n                docNode.nodes.forEach(child => {\r\n                    editor.removeNodeByKey(child.key);\r\n                });\r\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\r\n            }\r\n        }\r\n    }\r\n\r\n    updateGraphShortText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateShortText(newText);            \r\n        }\r\n    }\r\n\r\n    updateGraphLongText(id, newText) {\r\n        var graphNode = this.getGraphNode(id);\r\n        \r\n        if (graphNode) {\r\n            graphNode.updateLongText(newText);            \r\n        }\r\n    }\r\n\r\n    explodeNodes() {\r\n        this.graphPane.explodeNodes()\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport './LoadProject.css'\r\nimport db from '../../db.js'\r\nimport ProjectList from './ProjectsList.js'\r\nimport LogsExploreTable from './LogsExploreTable.js'\r\nimport SharedState from '../../shared_state.js';\r\nimport { toast } from 'react-toastify';\r\nimport DropZone from 'react-dropzone';\r\n\r\nexport default class LoadProject extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            projects: []\r\n        };\r\n        this.addProject = this.addProject.bind(this)\r\n        this.deleteProject = this.deleteProject.bind(this)\r\n        this.loadProject = this.loadProject.bind(this)\r\n        this.renameProject = this.renameProject.bind(this)\r\n        this.duplicateProject = this.duplicateProject.bind(this)\r\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\r\n        this.onDropLogFiles = this.onDropLogFiles.bind(this)\r\n        this.exploreLog = this.exploreLog.bind(this)\r\n        \r\n        document.title = \"Write Reason\"\r\n\r\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\r\n        if (process.env.NODE_ENV === 'development' && this.props.autoload) {\r\n            this.loadProject(this.props.autoload)\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (process.env.NODE_ENV !== 'development' || !this.props.autoload) {\r\n            this.updateProjectsFromDb()\r\n        }\r\n    }\r\n\r\n    updateProjectsFromDb() {\r\n        // todo - only retrieve relevant rows from projects table?\r\n        db.table('projects')\r\n            .toArray(projects => {\r\n                this.setState({ projects })\r\n            }).catch(err => {\r\n                toast.error(\"Error when loading projects: \" + err)\r\n            })\r\n    }\r\n\r\n    loadProject(id) {\r\n        const params = { condition: 'graph' }\r\n        const sharedState = new SharedState(id, params)\r\n        this.props.transitionToEditor(sharedState)\r\n    }\r\n\r\n    addProject() {\r\n        const project = {name: window.prompt('Name your project', 'New project')}\r\n        if (project.name) {\r\n            db.table('projects')\r\n                .add(project)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                });\r\n        }\r\n    }\r\n\r\n    renameProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                const newName = window.prompt('Set a new project name', project.name)\r\n                if (newName) {\r\n                    db.table('projects')\r\n                        .update(id, { name: newName })\r\n                        .then(() => {\r\n                            this.updateProjectsFromDb()\r\n                        })\r\n                }\r\n            });\r\n    }\r\n\r\n    duplicateProject(id) {\r\n        db.table('projects')\r\n            .get(id)\r\n            .then((project) => {\r\n                project.name += ' (copy)'\r\n                delete project.id // set a new one automatically\r\n                db.table('projects')\r\n                    .add(project)\r\n                    .then(() => {\r\n                        this.updateProjectsFromDb()\r\n                    });\r\n            })\r\n    }\r\n\r\n    deleteProject(id) {\r\n        if (window.confirm('Are you sure you want to delete this project? This cannot be undone.')) {\r\n            db.table('projects')\r\n                .delete(id)\r\n                .then(() => {\r\n                    this.updateProjectsFromDb()\r\n                })\r\n        }\r\n    }\r\n\r\n    onDropLogFiles(files) {\r\n        files.forEach((file) => {\r\n            const reader = new FileReader()\r\n      \r\n            reader.onabort = () => console.log('file reading was aborted')\r\n            reader.onerror = () => console.log('file reading has failed')\r\n            reader.onload = () => {\r\n                const stored = localStorage.getItem('logsToExplore') || JSON.stringify({logs: []})\r\n                const allLogs = JSON.parse(stored).logs\r\n\r\n                var newLog = JSON.parse(reader.result)\r\n                newLog.filename = file.name\r\n                newLog.projects.forEach(project => project.filename = file.name)\r\n                allLogs.push(newLog)\r\n                localStorage.setItem('logsToExplore', JSON.stringify({logs: allLogs}))\r\n            }\r\n            reader.readAsText(file)\r\n        })\r\n    }\r\n\r\n    exploreLog(project, saveIndex) {\r\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.props.transitionToEditor }\r\n        const sharedState = new SharedState(-1, params)\r\n        this.props.transitionToEditor(sharedState)\r\n    }\r\n    \r\n    render() {\r\n        return (\r\n            <div className=\"load-project\">\r\n                <button className=\"pure-button button-primary\" onClick={this.addProject}>New project</button>\r\n                {/* {process.env.NODE_ENV === 'development' && <><DropZone onDrop={this.onDropLogFiles}>\r\n                        {({getRootProps, getInputProps}) => (\r\n                            <section>\r\n                            <div {...getRootProps()}>\r\n                                <input {...getInputProps()} />\r\n                                <p>Drop/select log files</p>\r\n                            </div>\r\n                            </section>\r\n                        )}\r\n                    </DropZone>\r\n                    \r\n                    <div className=\"load-project-table\">\r\n                        <LogsExploreTable logs={localStorage.getItem('logsToExplore') && JSON.parse(localStorage.getItem('logsToExplore')).logs} \r\n                            exploreLog={this.exploreLog} />\r\n                    </div>\r\n                    </>\r\n                    } */}\r\n                <div className=\"load-project-table\">\r\n                    {this.state.projects && this.state.projects.length > 0 && <ProjectList projects={this.state.projects}\r\n                        deleteProject={this.deleteProject}\r\n                        loadProject={this.loadProject}\r\n                        renameProject={this.renameProject}\r\n                        duplicateProject={this.duplicateProject}\r\n                    />}\r\n                </div>\r\n            </div>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react';\r\nimport './ExperimentalControls.css';\r\n\r\nexport default class ExperimentControls extends Component {\r\n    render() {\r\n        if (this.props.sharedState.params.logExplore) {\r\n            return (\r\n                <div className=\"experiment-controls\">\r\n                    <button className='pure-button' onClick={this.props.backToMenu}>Back</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.explodeNodes}>Explode</button>\r\n                    <button className='pure-button' onClick={() => {this.props.sharedState.orderAnnotate = true}}>Order annotate</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.exportAnnotatedLog}>Export annotated log</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.makeNodeReport}>Make node report</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.explorePrev}>←</button>\r\n                    <button className='pure-button'>{this.props.sharedState.params.logExplore.project.filename + \" \" + this.props.sharedState.params.logExplore.saveIndex}</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.exploreNext}>→</button>\r\n                </div>\r\n            );\r\n        } else {\r\n            return (\r\n                <div className=\"experiment-controls\">\r\n                    <button className='pure-button' onClick={this.props.backToMenu}>Back</button>\r\n                    {/* <button className='pure-button' onClick={this.props.showExperimentInfo}>Study participant instructions</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.viewFactSheet}>View fact sheet</button> */}\r\n                    <button className='pure-button' onClick={this.props.sharedState.exportPDF}>Export PDF</button>\r\n                    <button className='pure-button' onClick={this.props.sharedState.downloadExperimentData}>Export logs</button>\r\n                    <button className='pure-button button-primary' onClick={() => {this.props.sharedState.save()}}>Save</button>\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n}","import React, { Component } from 'react'\r\n\r\nexport default class TimelineEntry extends Component {\r\n    render() {\r\n        let theClass = \"\"\r\n        if (this.props.log.type.includes('doc')) {\r\n            theClass = 'red'\r\n        }\r\n\r\n        if (this.props.log.type.includes('node')) {\r\n            theClass = 'blue'\r\n        }\r\n\r\n        if (this.props.log.type.includes('doc_create_from_node') || this.props.log.type.includes('doc_node_change_format')) {\r\n            theClass = 'yellow'\r\n        }\r\n\r\n        if (this.props.log.type.includes('arrow')) {\r\n            theClass = 'green'\r\n        }\r\n\r\n        if (this.props.isExploreHead) {\r\n            theClass += ' explore-head'\r\n        }\r\n\r\n        return (\r\n        <button className={theClass} onClick={this.props.onClick}>\r\n            {this.props.log.type} <i>{this.props.log.id && (this.props.log.id.toString().length < 4 ?\r\n                                                                this.props.log.id : \r\n                                                                this.props.log.source && this.props.log.source + \" → \" + this.props.log.target)}</i><br/>\r\n            {this.props.timestampFormatted}\r\n        </button>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react'\r\nimport TimelineEntry from './TimelineEntry'\r\nimport { Block } from 'slate'\r\n\r\nexport default class LogExploreTimeline extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            exploreHead: undefined\r\n        }\r\n\r\n        this.moveExploreHead = this.moveExploreHead.bind(this)\r\n        this.exploreEvent = this.exploreEvent.bind(this)\r\n        this.setDocValue = this.setDocValue.bind(this)\r\n        this.handleKeyDown = this.handleKeyDown.bind(this)\r\n    }\r\n\r\n    moveExploreHead(event) {\r\n        const graph = document.getElementById('graph')\r\n        graph.classList.add('timeline-explore-mode')\r\n\r\n        const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\r\n\r\n        if (!orderedLogs) {\r\n            return\r\n        }\r\n\r\n        this.setState({\r\n            exploreHead: event\r\n        })\r\n\r\n        var pastExploreHead = false\r\n        var lastDocChangeContent = \"empty\"\r\n        for (let i = 0; i < orderedLogs.length; i++) {\r\n            this.exploreEvent(orderedLogs[i], pastExploreHead)\r\n\r\n            if (orderedLogs[i].type === 'doc_change' && !pastExploreHead) {\r\n                lastDocChangeContent = orderedLogs[i].content\r\n            }\r\n\r\n            if (orderedLogs[i] === event) {\r\n                pastExploreHead = true\r\n                \r\n                this.setDocValue(lastDocChangeContent)\r\n            }\r\n        }\r\n    }\r\n\r\n    setDocValue(text) {\r\n        const editor = this.props.sharedState.getEditor()\r\n\r\n        editor.moveToRangeOfDocument()\r\n        editor.delete()\r\n        editor.moveToStartOfDocument()\r\n\r\n        const blockToInsert = Block.create({object: 'block', type: ''})\r\n        const section = editor.value.document.getParent(editor.value.startBlock.key);\r\n        const sectionParent = editor.value.document.getParent(section.key);     \r\n        if (sectionParent) {\r\n            const sectionIndex = sectionParent.nodes.indexOf(section);\r\n            editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\r\n            editor.moveBackward(1)\r\n        }\r\n\r\n        editor.insertText(text)\r\n    }\r\n\r\n    exploreEvent(event, hasNotBeenExplored) {\r\n        const graphPane = this.props.sharedState.graphPane\r\n        var node\r\n\r\n        const updateSvgElement = (element) => {\r\n            if (!element) {\r\n                return\r\n            }\r\n\r\n            if (hasNotBeenExplored) {\r\n                element.removeClass('has-been-explored')\r\n            } else {\r\n                element.addClass('has-been-explored')\r\n            }\r\n        }\r\n\r\n        switch (event.type) {\r\n            case 'node_create':\r\n                node = graphPane.getNodeById(event.id)\r\n                if (node) {\r\n                    updateSvgElement(node.rect)\r\n                } else if (!hasNotBeenExplored) {\r\n                    node = graphPane.addTempNode(event.id)\r\n                    if (node) {\r\n                        updateSvgElement(node.rect)\r\n                    }\r\n                }\r\n                break\r\n            \r\n            case 'node_delete':\r\n                if (!hasNotBeenExplored) {\r\n                    node = graphPane.getNodeById(event.id)\r\n                    if (node) {\r\n                        node.delete(this.props.sharedState)\r\n                        graphPane.numTempNodes--\r\n                    }\r\n                }\r\n                break\r\n            \r\n            case 'arrow_create':\r\n                const arrow = graphPane.mouse_follower.getConnectorObjectConnecting(event.source, event.target)\r\n                if (arrow) {\r\n                    updateSvgElement(arrow.line)\r\n                } else if (!hasNotBeenExplored) {\r\n                    graphPane.mouse_follower.addTempArrow(event.source, event.target, \"black\", event.id)\r\n                }\r\n                break\r\n            \r\n            case 'arrow_delete':\r\n                if (hasNotBeenExplored) {\r\n                    break\r\n                }\r\n\r\n                const sourceDestString = graphPane.mouse_follower.temp_arrows[event.id]\r\n                if (sourceDestString) {\r\n                    graphPane.mouse_follower.remove_arrow(graphPane.mouse_follower.connector_objs[sourceDestString], undefined)\r\n                    graphPane.mouse_follower.connector_objs[sourceDestString] = undefined\r\n                }\r\n                break\r\n\r\n            case 'node_edit_short_text':\r\n                node = graphPane.getNodeById(event.id)\r\n                if (node && !hasNotBeenExplored) {\r\n                    node.updateShortText(event.text)\r\n                }\r\n                break\r\n\r\n            default:\r\n                break\r\n        }\r\n    }\r\n\r\n    handleKeyDown(e) {\r\n        var shift = undefined\r\n        if (e.keyCode === 39) { // right arrow\r\n            shift = 1\r\n        } else if (e.keyCode === 37) { // left arrow\r\n            shift = -1\r\n        }\r\n\r\n        if (shift !== undefined) {\r\n            const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\r\n            if (!orderedLogs) {\r\n                return\r\n            }\r\n\r\n            for (let i = 0; i < orderedLogs.length; i++) {\r\n                if (this.state.exploreHead === orderedLogs[i]) {\r\n                    if (i + shift > 0 && i + shift < orderedLogs.length) {\r\n                        this.moveExploreHead(orderedLogs[i + shift])\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const project = this.props.sharedState.params.logExplore.project\r\n        if (!project.orderedLogs) {\r\n            const markdown_events = project.log.events.document_content_markdown\r\n            project.log.events.doc_change = [] \r\n            markdown_events.forEach((e, index) => {\r\n                if (index === 0 || markdown_events[index - 1].content !== e.content) {\r\n                    project.log.events.doc_change.push({type: 'doc_change', content: e.content, timestamp: e.timestamp})\r\n                }})\r\n            project.log.events.doc_change.forEach(e => e.type = 'doc_change')\r\n\r\n            project.orderedLogs = [].concat.apply([], Object.values(project.log.events)).filter(e => e.type !== 'document_content_markdown')\r\n            project.orderedLogs.sort(function(a,b){\r\n                return new Date(a.timestamp) - new Date(b.timestamp);\r\n            })\r\n        }\r\n        const logs = project.orderedLogs\r\n\r\n        return (\r\n            <div className=\"timeline\" onKeyDown={this.handleKeyDown}>\r\n                <p>{project.filename}</p>\r\n                {logs.map((log, index) => {\r\n                        const getDate = (timestamp) => timestamp.substring(\"2020-\".length, \"2020-07-21\".length)\r\n                        const time = log.timestamp.substring(\"2020-07-21T\".length, \"2020-07-21T12:51:45\".length)\r\n\r\n                        const makeEntry = () => <TimelineEntry\r\n                            onClick={() => this.moveExploreHead(log)}\r\n                            log={log}\r\n                            timestampFormatted={time}\r\n                            sharedState={this.props.sharedState}\r\n                            isExploreHead={this.state.exploreHead === log}\r\n                        />\r\n\r\n                        if (index === 0 || getDate(log.timestamp) !== getDate(logs[index - 1].timestamp)) {\r\n                            return <>\r\n                                <p><b>{getDate(log.timestamp)}</b></p>\r\n                                {makeEntry()}\r\n                            </>\r\n                        } else {\r\n                            return makeEntry()\r\n                        }\r\n                    }\r\n                )}\r\n            </div>\r\n        );\r\n      }\r\n}","import React, { Component } from 'react';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class ExperimentInfo extends Component {\r\n    render() {\r\n        // eslint-disable-next-line no-useless-concat\r\n        const emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\r\n\r\n        const scenario = localStorage.getItem('scenario')\r\n\r\n        var question;\r\n        if (scenario === 'biohacking') {\r\n            question = <b>QUESTION: Should greater regulatory control be exerted over genetic biohacking?</b>\r\n        } else if (scenario === 'sharedSpace') {\r\n            question = <b>QUESTION: Should “shared spaces” in urban planning be promoted?</b>\r\n        } else {\r\n            toast.error(\"Question not found. Please re-open Write Reason using the link in the email we sent you.\")\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <h2>Instructions for study participants</h2>\r\n                <p>Thank you for participating in this study!</p>\r\n\r\n                <h3>Before you start</h3>\r\n                <p>Watch the “How to use” video on the home page.</p>\r\n\r\n                <h3>The task</h3>\r\n\r\n                <p>Your task is to decide where you stand on the question below, and write an essay justifying your view. Use Write Reason for all parts of the task.</p>\r\n\r\n                {question}\r\n\r\n                <p>Write in the style of a short academic essay. You may not have heard of this topic before - don't worry, the fact sheet has all the information you need on it!</p>\r\n\r\n                <h3>How to work on the task</h3>\r\n                <ol>\r\n                    <li>First, <a href=\"#factsheet\" onClick={(e) => {e.preventDefault(); this.props.sharedState.viewFactSheet()}}>click here to read the fact sheet</a></li>\r\n                    <li>Spend around 1 hour 40 minutes on this task, over the next week</li>\r\n                    <li>Aim for around 700 words as a very rough guide - though it's fine to exceed this!</li>\r\n                    <li>Whenever you work on the task record it in the diary. <a href='/diary_template.csv' download>Download a blank diary here</a></li>\r\n                    <li>Please <b>do not enter any personal information</b> when using Write Reason</li>\r\n                    <li>Your work will be saved in your browser on this computer when you press \"Save\"</li>\r\n                </ol>\r\n\r\n                <h3>What to do when you're finished</h3>\r\n                <ol>\r\n                    <li>Press the \"Export logs\" button in the bottom right of the screen, and keep the downloaded file somewhere safe</li>\r\n                    <li>Make sure your diary is filled out</li>\r\n                    <li>Email us at <a href={'mailto:' + emailAddress + '?subject=Write Reason task complete'}>{emailAddress}</a> to arrange a short interview about your experiences!\r\n                        During the interview you will send us the logs and your diary</li>\r\n                    <li>You will receive a £20 Amazon voucher to thank you for your time</li>\r\n                </ol>\r\n\r\n                <p>Your contribution to our research is incredibly valuable, thank you!</p>\r\n            </>\r\n        );\r\n    }\r\n}","import React, { Component } from 'react';\r\n\r\nexport default class PreTaskSection extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            q1: '',\r\n            q2: '',\r\n            q3: '',\r\n        }\r\n\r\n        this.handleChange = this.handleChange.bind(this)\r\n        this.handleSubmit = this.handleSubmit.bind(this)\r\n    }\r\n\r\n    handleChange(event, question) {\r\n        this.setState({ [question] : event.target.value })\r\n    }\r\n\r\n    handleSubmit(event) {\r\n        event.preventDefault()\r\n        const questions = [this.state.q1, this.state.q2, this.state.q3]\r\n        var shouldReturn = false\r\n        questions.forEach(questionValue => {\r\n            if (!shouldReturn && (!questionValue || questionValue === \"\")) {\r\n                alert(\"Please enter an answer for all three questions\")\r\n                shouldReturn = true\r\n                return\r\n            }\r\n        })\r\n        if (shouldReturn) {\r\n            return\r\n        }\r\n\r\n        if (window.confirm(\"Are you ready submit your answers? You cannot undo this action\")) {\r\n            localStorage.setItem('preTaskSubmission', JSON.stringify(this.state))\r\n            this.props.transitionToMenu()\r\n        }\r\n    }\r\n\r\n    render() {\r\n        // eslint-disable-next-line no-useless-concat\r\n        var emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\r\n        return (\r\n            <div className='intro-section'>\r\n                <h3 style={{paddingTop: \"40px\"}}>Thank you for participating in this experiment!</h3>\r\n                <ol className=\"steps\">\r\n                    <li>\r\n                        <p>Before we begin, please complete this <a href=\"https://standrews.eu.qualtrics.com/jfe/form/SV_9tYNKrCBK8uHOiV\">short, anonymous demographics\r\n                            questionnaire</a> if you have not done so already.</p>\r\n                    </li>\r\n                    <li>\r\n                        <p> Then, write a paragraph (at least 2 sentences) answering each of the questions below:</p>\r\n\r\n                        <form onSubmit={this.handleSubmit} className=\"pure-form pure-form-stacked\">\r\n                            <label>When you write an essay, what do you aim to produce?</label>\r\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q1\")} placeholder=\"Your answer...\" />\r\n                            <label>What makes a good essay?</label>\r\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q2\")} placeholder=\"Your answer...\" />\r\n                            <label>What do you think are the possible purposes of writing an essay?</label>\r\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q3\")} placeholder=\"Your answer...\" />\r\n                            <input className=\"pure-button button-primary\" type=\"submit\" value=\"Submit answer\" />\r\n                        </form>\r\n\r\n                    </li>\r\n                </ol>\r\n\r\n                <p><i>Any questions? Get in touch at <a href={'mailto:' + emailAddress + '?subject=Write Reason question'}>{emailAddress}</a>.</i></p>\r\n                <br/>\r\n            </div>\r\n        )\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport Logo from '../../assets/logo.png'\r\nimport { Player, BigPlayButton } from 'video-react'\r\nimport Video from '../../assets/instructions.mp4'\r\nimport Thumbnail from '../../assets/thumbnail.png'\r\nimport \"video-react/dist/video-react.css\"\r\n\r\nexport default class IntroSection extends Component {\r\n    \r\n    render() {\r\n        return (\r\n            <div className='intro-section'>\r\n                <a href=\"https://adam-binks.github.io/write-reason/\"><img src={Logo} className='logo' alt=\"Write Reason\"/></a>\r\n\r\n                <>\r\n                    <Player src={Video} poster={Thumbnail}>\r\n                        <BigPlayButton className='play-button' position='center' />\r\n                    </Player>\r\n                </>\r\n            </div>\r\n        );\r\n      }\r\n}","/* eslint-disable no-fallthrough */\r\n/* eslint-disable default-case */\r\nimport React, { Component } from 'react';\r\nimport './App.css';\r\nimport DocPane from './components/doc/DocPane.js';\r\nimport GraphPane from './components/graph/GraphPane.js';\r\nimport SplitPane from 'react-split-pane';\r\nimport LoadProject from './components/loadproject/LoadProject.js';\r\nimport { DndProvider } from 'react-dnd'\r\nimport Backend from 'react-dnd-html5-backend'\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport SaveButton from './components/experiment/SaveButton';\r\nimport LogExploreTimeline from './components/experiment/LogExploreTimeline';\r\nimport ExperimentInfo from './components/experiment/ExperimentInfo';\r\nimport PreTaskSection from './components/loadproject/PreTaskSection';\r\nimport IntroSection from './components/loadproject/IntroSection';\r\nimport Modal from 'react-modal'\r\nimport { isMobile } from \"react-device-detect\";\r\n\r\nModal.setAppElement('#root')\r\nconst modalStyles = {\r\n    content : {\r\n      top                   : '50%',\r\n      left                  : '50%',\r\n      right                 : 'auto',\r\n      bottom                : 'auto',\r\n      marginRight           : '-50%',\r\n      transform             : 'translate(-50%, -50%)',\r\n      maxWidth              : '40%',\r\n      maxHeight             : '90%',\r\n      padding               : '50px'\r\n    }\r\n  }\r\n\r\nexport default class App extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        var startPhase = 'loadproject'\r\n\r\n        this.state = {\r\n            phase: startPhase,\r\n            params: undefined\r\n        }\r\n\r\n        this.transitionToEditor = this.transitionToEditor.bind(this)\r\n        this.transitionToMenu = this.transitionToMenu.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n        if(window.location.search) {\r\n            const urlParams = new URLSearchParams(window.location.search)\r\n            const scenario = urlParams.get('scenario')\r\n\r\n            if (scenario !== 'biohacking' && scenario !== 'sharedSpace') {\r\n                console.error('Unrecognised scenario ' + scenario)\r\n            } else {\r\n                localStorage.setItem('scenario', scenario)\r\n                console.log(localStorage.getItem('scenario'))\r\n            }\r\n        }\r\n\r\n        this.getStorageUsed()\r\n    }\r\n\r\n    transitionToEditor(newSharedState, resetFirst) {\r\n        if (resetFirst) {\r\n            this.setState({phase: \"reset\", sharedState: undefined})\r\n            window.setTimeout(() => {\r\n                this.setState({ \r\n                    sharedState: newSharedState,\r\n                    phase: \"editor\"\r\n                })\r\n            }, 0)\r\n        } else {\r\n            this.setState({ \r\n                sharedState: newSharedState,\r\n                phase: \"editor\"\r\n            })\r\n        }\r\n\r\n        // // open the instructions modal on first load\r\n        // if (!localStorage.getItem('editorHasLoadedBefore')) {\r\n        //     localStorage.setItem('editorHasLoadedBefore', true)\r\n        //     this.setState({ modalIsOpen: true })\r\n        // }\r\n    }\r\n\r\n    transitionToMenu() {\r\n        if (this.state.sharedState) {\r\n            if (this.state.sharedState.getStateIsDirty() && !window.confirm('Are you sure you want to go back to the menu? You will lose your unsaved changes.')) {\r\n                return // user wants to stay on this page\r\n            }\r\n\r\n            this.state.sharedState.finishCondition()\r\n        }\r\n        this.setState({\r\n            sharedState: undefined,\r\n            phase: \"loadproject\"\r\n        })\r\n    }\r\n\r\n    getStorageUsed() {\r\n        navigator.storage && navigator.storage.estimate().then(estimate => {\r\n            if (!estimate) {\r\n                return\r\n            }\r\n\r\n            var storageUsed = estimate.usage / estimate.quota * 100\r\n            if (storageUsed < 0.00000005) {\r\n                storageUsed = 0 // prevent 10e-16 sort of thing\r\n            }\r\n            storageUsed = storageUsed.toPrecision(2)\r\n\r\n            this.setState({ storageUsed })\r\n        });\r\n    }\r\n\r\n    render() {\r\n        if (isMobile) {\r\n            return (\r\n                <p>Write Reason is designed for non-mobile devices. Please access from a laptop or desktop computer.</p>\r\n            )\r\n        }\r\n\r\n        switch(this.state.phase) {\r\n            case \"pretask\":\r\n                return (\r\n                    <PreTaskSection transitionToMenu={this.transitionToMenu} />\r\n                )\r\n            case \"loadproject\":\r\n                return (\r\n                    <>\r\n                        <IntroSection />\r\n                        <LoadProject transitionToEditor={this.transitionToEditor} autoload={false} />\r\n                        <footer>\r\n                            {this.state.storageUsed && <p>Storage used: {this.state.storageUsed}%</p>}\r\n                            <p><b>Privacy notice</b>: This webpage simply downloads the Write Reason application to your browser. Once loaded, \r\n                            everything runs locally in your browser. No data is sent back to the server.</p>\r\n                        </footer>\r\n                    </>\r\n                )\r\n            case \"editor\":\r\n                return (\r\n                    <div className=\"App\">\r\n                        <Modal\r\n                            isOpen={this.state.modalIsOpen}\r\n                            style={modalStyles}\r\n                            contentLabel=\"Experiment information\"\r\n                            onRequestClose={() => this.setState({ modalIsOpen: false })}\r\n                        >\r\n                            <ExperimentInfo sharedState={this.state.sharedState}/>\r\n                            <button className=\"pure-button\" onClick={() => this.setState({ modalIsOpen: false })}>Close</button>\r\n                        </Modal>\r\n\r\n                        <DndProvider backend={Backend}>\r\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\r\n                                <DocPane sharedState={this.state.sharedState} />\r\n                                <GraphPane sharedState={this.state.sharedState} />\r\n                            </SplitPane>\r\n                            {\r\n                                this.state.sharedState.params.logExplore && <LogExploreTimeline sharedState={this.state.sharedState}/>\r\n                            }\r\n                            <SaveButton \r\n                                sharedState={this.state.sharedState}\r\n                                backToMenu={this.transitionToMenu} \r\n                                showExperimentInfo={() => this.setState({ modalIsOpen: true })}\r\n                            />\r\n                        </DndProvider>\r\n\r\n                        <ToastContainer\r\n                            position=\"bottom-center\"\r\n                            autoClose={5000}\r\n                            hideProgressBar\r\n                            newestOnTop={false}\r\n                            closeOnClick\r\n                            rtl={false}\r\n                            pauseOnFocusLoss\r\n                            draggable={false}\r\n                            pauseOnHover\r\n                        />\r\n                    </div>\r\n                );\r\n            \r\n            case \"reset\":\r\n                // hacky way to destroy and recreate all components\r\n                return (\r\n                    <p>...</p>\r\n                )\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n// import * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\n// serviceWorker.register();\r\n"],"sourceRoot":""}