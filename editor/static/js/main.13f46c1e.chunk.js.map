{"version":3,"sources":["assets/CrimsonText-Regular.ttf","assets/CrimsonText-Bold.ttf","assets/logo.png","assets/instructions.mp4","assets/thumbnail.png","components/graph/OptionPopup.js","components/doc/GraphPlugin.js","components/doc/NodeSwitch.js","components/doc/StyleButton.js","components/doc/nodes/LinkNode.js","components/doc/nodes/BodyNode.js","dragtypes.js","components/doc/DragifyBlock.js","components/doc/DropifyBlock.js","components/doc/nodes/SectionNode.js","components/doc/LoggingPlugin.js","components/doc/nodes/PlainBlockNode.js","components/doc/SlateComponents.js","components/doc/HoveringMenu.js","components/doc/Schema.js","components/doc/DocEditor.js","components/graph/svg.connectable.js","components/doc/NodePlugin.js","components/doc/ReorderPlugin.js","components/doc/WordCountPlugin.js","components/doc/DocPane.js","components/graph/MouseFollower.js","components/graph/GraphNode.js","components/graph/DropifyGraphPane.js","components/graph/GraphPane.js","db.js","components/loadproject/ProjectsList.js","components/loadproject/LogsExploreTable.js","logging.js","shared_state.js","components/loadproject/LoadProject.js","components/experiment/SaveButton.js","components/experiment/TimelineEntry.js","components/experiment/LogExploreTimeline.js","components/experiment/ExperimentInfo.js","components/loadproject/PreTaskSection.js","components/loadproject/IntroSection.js","App.js","index.js"],"names":["module","exports","OptionPopup","entries","x","y","shouldHideOnClickOutside","callback","selected","undefined","parent","this","hidePopup","bind","div","document","createElement","classList","add","appendChild","generateTable","style","left","top","getElementById","rect","getBoundingClientRect","right","window","innerWidth","bottom","innerHeight","setTimeout","hideOnClickOutside","table","forEach","entry","isClickable","row","insertRow","name","selectItem","e","colourCell","insertCell","textContent","symbol","color","colour","fontSize","padding","nameCell","addEventListener","buttons","buttonEntry","buttonCell","button","innerHTML","className","onclick","click","underlyingEntry","transientEntry","underlyingEntries","remove","element","outsideClickListener","event","elem","contains","target","offsetWidth","offsetHeight","getClientRects","length","removeClickListener","removeEventListener","addSection","draggedNode","editor","initialNodeStyle","getSharedState","addGraphMapping","id","node","insertSectionBlock","text","longText","logger","logEvent","removeFirstNode","value","nodes","size","link","Block","create","type","data","node_id","Text","body","section","nodeStyle","insertBlock","moveToEndOfNode","removeNodeByKey","get","key","handleMouseUp","clickedNode","isOverHalf","resetPos","getGraphNode","focus","getParent","moveToStartOfNode","moveBackward","toast","error","console","log","showNodeSwitchMenu","entriesToHide","filter","includes","preventDefault","clientX","clientY","selectedEntry","deleteNode","old","new","setNodeByKey","newStyle","moveToRangeOfNode","graphNode","convertFromInline","shortText","getBlocksByType","prev","getPreviousBlock","next","getNextBlock","insertNodeByKey","getEmptyParagraph","wrapBlockByKey","insertInline","insertText","moveForward","convertToInline","querySelector","removeDocNode","StyleButton","props","onClick","Component","LinkNode","state","hover","externalHover","setHover","newHover","sharedState","nodeId","setHoverer","setState","isHovered","selection","cursorInside","getDescendantsAtRange","classes","linkStyle","attributes","children","onMouseEnter","onMouseLeave","BodyNode","selectNode","isEmpty","onMouseDown","ItemTypes","blockSource","canDrag","isCollapsed","beginDrag","endDrag","monitor","component","didDrop","dropResult","getDropResult","droppedOnGraph","addGraphNode","position","moveTo","blur","blockIndex","indexOf","indexShift","insertBefore","indexDroppedOn","moveNodeByKey","parentKey","DragSource","connect","connectDragSource","dragSource","dragPreview","isDragging","innerDiv","outerDiv","ReactDOM","findDOMNode","outerRect","item","innerRect","offset","newState","height","overHalf","blockTarget","getClientOffset","drop","blockParent","DropTarget","connectDropTarget","dropTarget","isOver","isOverCurrent","shallow","canDrop","itemType","getItemType","DragifyBlock","DropifyBlock","blocks","some","block","verbose","getNodeStyleClass","dragOverCurrent","onMouseOver","onMouseUp","onMouseMove","ref","LoggingPlugin","options","onCopy","content","fragment","onCut","onPaste","transfer","getEventTransfer","paste_type","content_html","html","Button","React","forwardRef","active","reversed","cx","css","Icon","textLines","map","toArray","join","Menu","MarkButton","icon","isActive","setBlocks","HoverMenu","root","createPortal","HoveringMenu","menuRef","createRef","componentDidMount","updateMenu","componentDidUpdate","menu","current","isBlurred","removeAttribute","getSelection","getRangeAt","opacity","pageYOffset","pageXOffset","width","render","schema","inlines","normalize","code","unwrapInlineByKey","object","match","min","max","moveBlockAfterSection","child","linkNode","find","textNode","getLastText","insertTextByKey","addMissing","hasChildTypes","push","blockToMove","sectionToMoveAfter","sectionIndex","nodeType","getShortText","getLongText","index","addBlock","plugins","findEventRange","select","inline","onBlur","deselect","commands","removeGraphLink","hasNode","section_index","child_index","destOffset","getChild","wrapLinkAtSelection","wrapInline","renderInline","getRefAndId","renderBlock","refAndId","onDrop","getLinkInlines","the_doc","filterDescendants","textNoNewlines","replace","fragmentInlines","docInlines","usedIds","usedId","inlineWithId","onChange","updateFunc","updateGraphShortText","updateGraphLongText","update","updateText","checkRecycleBinForGraphNode","onKeyDown","startBlock","start","end","isExpanded","updateIsOnGraphStatus","isAtEndOfNode","nextBlock","prevBlock","blockToInsert","sectionParent","relevantBlock","long_or_short","setLinkMapping","registerLinkNode","NodePlugin","renderEditor","wordCount","count","getBlocks","words","toString","countWords","Fragment","emptyValue","Value","fromJSON","DocEditor","mapHasLoaded","queries","getValue","editor_ref","getSavedDocValue","savedValue","editorHasLoaded","plainClass","condition","placeholder","spellCheck","DocPane","_typeof","Symbol","iterator","obj","constructor","prototype","t","n","r","s","o","u","require","a","i","f","Error","l","call","1","Id","SetOrGet","IterateObject","Deffy","_connections","_betweenTwoBubbles","container","markers","connectable","elmTarget","con","k","kk","marker","addClass","markerId","line","path","attr","fill","stroke","specialCoords","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","d","source","ids","id1","id2","reverse","_","computeLineCoordinates","cons","output","sT","transform","tT","sB","bbox","tB","x1","y1","x2","y2","cy","dx","Math","abs","dy","dd","out","ex","ey","sqrt","xDiff","yDiff","x2centre","grad","vals","rightLeftCalc","topBotCalc","padEllipse","xR1","xR2","yR1","yR2","elmS","elmT","tagName","parseFloat","getAttribute","sx","sy","ux","uy","isNaN","results","plot","on","setLineColor","c","SVG","extend","Element","delete_connectable","dispatchEvent","CustomEvent","2","Typpy","input","def","empty","3","arguments","is","str","String","NaN","toLowerCase","4","random","substr","5","fn","keys","Array","isArray","Object","6","field","7","apply","8","COLOURS","DEFAULT_ARROW_OPTIONS","MouseFollower","shared_state","svg","connectables_container","links","drawing_arrow_from","connector","connector_objs","temp_arrows","arrow_id_counter","completed_arrows","mouse_rect","group","point","move","stop_drawing_arrow","arrows","arrowOptions","get_node","arrow","originNode","origin","destinationNode","destination","draw_arrow","add_context_menu_to_arrow","new_source","show","hide","source_node","instance","remove_arrow","arrowObject","show_context_menu","graph_pos","edit_connector_type","new_colour","detail","oldColour","newColour","end_node","c1","getScreenCoords","c2","midpoint","drawing_arrow_from_id","getNewId","dest","temp_id","graphPane","getNodeById","dest_node","direction","getNextAvailableColour","availableColours","option","thisColourIndex","nextIndex","clickEditButton","params","editButton","updateName","newValue","substring","finishEditing","colourButton","changeArrowColour","clickDeleteArrowTypeButton","confirm","splice","parentNode","removeChild","arrowOptionsWithButtons","entryWithButtons","popup_x","popup_y","onColourSelected","prev_selected","getArrowOptions","setArrowColour","selected_option","newRelation","json","mf","ARROW_HITBOX_MARGIN","GraphNode","mouse_follower","focus_text_area","getNodesList","zoomCanvasTo","isOnGraph","annotatedOrder","getNodeId","translate","dropShadow","radius","arrow_hitbox","editRect","updateShortText","updateLongText","setupRectDragging","setupArrowHitbox","complete_arrow","setupHover","setupContextMenu","editText","doNotDeleteIfEmptyText","setIsOnGraph","showAnnotatedOrder","isFromJSON","screenCoords","newVal","removeClass","showOptionMenu","delete","hoverers","startHover","getAllDocNodeRefs","decoratedRef","setExternalHover","endHover","hoverer","isHovering","setHovered","setupGroupDragging","edit_text_if_not_just_dropped","just_dropped","just_dropped_obj","center","draggy","stopPropagation","start_x","start_y","activeElement","off","delta","movedX","movedY","x_diff","y_diff","update_source","start_arrow","newShortText","formattedText","splitIntoLines","resizeRect","newLongText","charsPerLine","split","word","segments","segment","space","numLinesOfText","rectHeight","annotatedOrderText","delete_if_empty_text","orderAnnotate","annotatedNumbers","num","getNextAnnotateNum","textarea","preEditText","screen_coords","display","scrollHeight","save_changes","updateDocShortText","onblur","onkeyup","removeGraphNode","nodesList","DropifyGraphPane","getItem","findDescendant","getSavedGraph","$el","panZoom","zoomMin","zoomMax","zoomFactor","level","pos","cb","zoom","runner","animate","duration","ease","after","zone","root_point","doc","nodesSvgGroup","numTempNodes","json_connections","connections","addNodeAtScreenLocation","setupTextDropping","blurActiveElement","setAttribute","loadNodesFromJSON","draw_loaded_arrows","addNoNodesIndicator","toJSON","nodeJSON","noNodesIndicator","dataTransfer","types","getData","canAddLinkAtSelection","addLinkAtSelection","isSvgCoords","el","db","Dexie","version","stores","projects","ProjectsList","project","role","aria-label","loadProject","renameProject","duplicateProject","deleteProject","EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY","Logger","db_id","shouldLogToConsole","conditions","logToConsole","JSON","stringify","stateIsDirty","getLog","events","timestamp","Date","setLog","save","forceLog","saves","then","catch","err","msg","SharedState","onDataLoad","getProjectThen","doc_value","graph_value","logExplore","node_id_counter","slate_id_counter","map_recycle_bin","intervalLogger","setInterval","getArgumentMarkdown","downloadExperimentData","mapToJSON","exportPDF","exploreNext","explorePrev","exploreLog","makeNodeReport","exportAnnotatedLog","explodeNodes","onbeforeunload","getStateIsDirty","returnValue","getEditor","downloadJSON","filename","sort","b","annotatedNum","scenario","localStorage","factSheetURL","open","mapFromJSON","projectName","title","lastSavedDocumentState","changes","idExists","info","logSaveState","message","saveIndex","transitionToEditor","nodeReport","linkedTexts","unlinkedTexts","linked","unlinked","linkedCharsProportion","trim","linkedWords","unlinkedWords","linkedWordProportion","rawValue","nodeReports","parse","setItem","mapJson","doc_nodes","part","docNodeObjects","getDocNodes","getPath","graph_node","getNode","preTaskSubmission","parentStyleIs","styleToCheck","RULES","serialize","Html","rules","file","Blob","downloadBlob","blob","href","URL","createObjectURL","download","getReactPdfDocument","markdown","Font","register","family","fonts","src","CrimsonText","CrimsonTextBold","fontWeight","styles","StyleSheet","page","fontFamily","paddingBottom","heading","textDecoration","startsWith","pdf","toBlob","getArgumentHTML","regex","replacement","innerText","clearInterval","is_in_linked_block","is_in_linked_inline","doc_node","prev_version","getGraphNodeAndDocNode","values","docNode","short","long","doc_link_node","docNodes","getDocNodeShortText","newText","LoadProject","addProject","updateProjectsFromDb","onDropLogFiles","prompt","newName","files","reader","FileReader","onabort","onerror","onload","stored","logs","allLogs","newLog","result","readAsText","ExperimentControls","backToMenu","TimelineEntry","theClass","isExploreHead","timestampFormatted","LogExploreTimeline","exploreHead","moveExploreHead","exploreEvent","setDocValue","handleKeyDown","orderedLogs","pastExploreHead","lastDocChangeContent","moveToRangeOfDocument","moveToStartOfDocument","hasNotBeenExplored","updateSvgElement","addTempNode","getConnectorObjectConnecting","addTempArrow","sourceDestString","shift","keyCode","markdown_events","document_content_markdown","doc_change","concat","getDate","time","makeEntry","ExperimentInfo","question","viewFactSheet","PreTaskSection","q1","q2","q3","handleChange","handleSubmit","questions","shouldReturn","questionValue","alert","transitionToMenu","paddingTop","onSubmit","rows","IntroSection","Logo","alt","Video","poster","Thumbnail","Modal","setAppElement","modalStyles","marginRight","maxWidth","maxHeight","App","phase","location","search","URLSearchParams","getStorageUsed","newSharedState","resetFirst","finishCondition","navigator","storage","estimate","storageUsed","usage","quota","toPrecision","isMobile","autoload","isOpen","modalIsOpen","contentLabel","onRequestClose","DndProvider","backend","Backend","defaultSize","showExperimentInfo","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover"],"mappings":"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","file":"static/js/main.13f46c1e.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Regular.62f10d46.ttf\";","module.exports = __webpack_public_path__ + \"static/media/CrimsonText-Bold.89b16aa6.ttf\";","module.exports = __webpack_public_path__ + \"static/media/logo.510deb2b.png\";","module.exports = __webpack_public_path__ + \"static/media/instructions.f31121e4.mp4\";","module.exports = \"data:image/png;base64,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\"","export default class OptionPopup {\n    constructor(entries, x, y, shouldHideOnClickOutside, callback, selected=undefined, parent=undefined) {\n        this.hidePopup = this.hidePopup.bind(this)\n\n        this.div = document.createElement(\"div\");\n        this.div.classList.add(\"option-popup-div\");\n        this.div.appendChild(this.generateTable(entries, callback, selected));\n        this.div.style.left = x + \"px\";\n        this.div.style.top = y + \"px\";\n\n        if (parent === undefined) {\n            parent = document.getElementById(\"graph\");\n        }\n        parent.appendChild(this.div);\n\n        // prevent the popup from showing up partially offscreen\n        const rect = this.div.getBoundingClientRect()\n        if (rect.right > window.innerWidth) {\n            this.div.style.left = (x - (rect.right - window.innerWidth)) + \"px\"\n        }\n        if (rect.bottom > window.innerHeight) {\n            this.div.style.top = (y - (rect.bottom - window.innerHeight)) + \"px\"\n        }\n\n        if (shouldHideOnClickOutside) {\n            setTimeout(() => this.hideOnClickOutside(this.div), 0.01);\n        }\n    }\n\n    generateTable(entries, callback, selected) {\n        var table = document.createElement(\"table\");\n        entries.forEach(entry => {\n            entry.isClickable = entry.isClickable !== undefined ? entry.isClickable : true\n\n            var row = table.insertRow();\n            row.classList.add(\"option-row\");\n            if (entry.name === selected) {\n                row.classList.add(\"option-row-selected\");\n            }\n\n            const selectItem = (e) => {\n                if (entry.isClickable) {                    \n                    callback(entry);\n                    this.hidePopup();\n                }\n            }\n\n            var colourCell = row.insertCell();\n            colourCell.textContent = entry.symbol;\n            colourCell.style.color = entry.colour;\n            colourCell.style.fontSize = \"150%\";\n            colourCell.style.padding = '10px'\n            \n            var nameCell = row.insertCell();\n            nameCell.classList.add('option-cell')\n            nameCell.textContent = entry.name\n\n            colourCell.addEventListener('click', selectItem)\n            nameCell.addEventListener('click', selectItem)\n\n            if (entry.buttons) {\n                entry.buttons.forEach(buttonEntry => {\n                    var buttonCell = row.insertCell()\n                    var button = document.createElement('BUTTON')\n                    button.innerHTML = '<p class=\"' + buttonEntry.className + '\"></p>'\n                    button.className = \"pure-button\"\n                    button.style.padding = \"0px 10px 0px 10px\"\n                    buttonCell.appendChild(button)\n                    button.onclick = (e) => buttonEntry.click(e, {colourCell, nameCell, buttonCell, underlyingEntry: buttonEntry.underlyingEntry, \n                            transientEntry: entry, underlyingEntries: buttonEntry.underlyingEntries, row, selected: entry.name === selected,\n                            hidePopup: this.hidePopup})\n                })\n            }\n        });\n\n        return table;\n    }\n\n    hidePopup() {\n        this.div.remove()\n    }\n\n    hideOnClickOutside(element) {\n        const isVisible = elem => !!elem && !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\n\n        const outsideClickListener = event => {\n            if (!element.contains(event.target) && isVisible(element)) {\n              element.remove();\n              removeClickListener()\n            }\n        }\n    \n        const removeClickListener = () => {\n            document.removeEventListener('click', outsideClickListener)\n        }\n    \n        document.addEventListener('click', outsideClickListener)\n        document.addEventListener('contextmenu', outsideClickListener)\n    }\n}","import { Block, Text } from 'slate';\nimport { toast } from 'react-toastify';\n\nexport default function GraphPlugin(options) {\n    return {\n        onMouseUp(event, editor, next) {\n            var draggedNode = editor.getSharedState().draggedNode;\n\n            if (draggedNode) {\n                draggedNode.resetPos();\n\n                if (editor.getSharedState().getGraphNode(draggedNode.id)) {\n                    toast.error('You can\\'t add the same node twice!')\n                    console.log('Duplicate - editor')\n                } else {\n                    const target = editor.findEventRange(event)\n                    if (target) {\n                        editor.select(target)\n\n                        // prevent insertion inside an inline link\n                        // (insertion inside a section is fixed by schema)\n                        const linkNode = editor.value.inlines.find(inline => inline.type === 'link')\n                        if (linkNode) {\n                            editor.moveToEndOfNode(linkNode)\n                        }\n\n                        addSection(draggedNode, editor)\n                    }\n                }\n            }\n            next();\n        },\n        \n        onBlur(event, editor, next) {\n            editor.deselect();\n            next();\n        },\n\n        commands: {\n            removeGraphLink(editor, node) {\n                const document = editor.value.document\n                if (!document.hasNode(node.key)) {\n                    console.log('couldnt remove graph link, node doesnt exist');\n                    \n                    return\n                }\n\n                if (node.type === \"section\") {\n                    // move the children out from inside this section to be after it\n                    const section_index = editor.value.document.nodes.indexOf(node)\n                    if (section_index !== -1) {\n                        var child_index = 0;\n                        node.nodes.forEach(child => {\n                            if (!document.hasNode(child.key)) {\n                                return\n                            }\n\n                            const nodeStyle = node.data.get(\"nodeStyle\")\n                            if ((child_index === 0 && nodeStyle === \"Body only\") || (child_index === 1 && nodeStyle === \"Heading only\")) {\n                                editor.removeNodeByKey(child.key)\n                            } else {\n                                // offset varies because the link node has already been removed if body only\n                                const destOffset = (child_index === 1 && nodeStyle === \"Body only\") ? 1 : child_index + 1\n                                editor.moveNodeByKey(child.key, editor.value.document.key, section_index + destOffset)\n                            }\n\n                            child_index++\n                        });\n                    }\n                    editor.removeNodeByKey(node.key)\n                } else if (editor.value.document.getChild(node.key) || node.object === \"inline\") {           \n                    editor.setNodeByKey(node.key, {\"type\": \"\"})\n                }\n            }\n        }\n    }\n}\n\nexport function addSection(draggedNode, editor, initialNodeStyle=\"Heading and body\") {\n    editor.getSharedState().addGraphMapping(draggedNode.id, draggedNode.node)\n\n    insertSectionBlock(editor, draggedNode.id, draggedNode.text, draggedNode.longText, initialNodeStyle)\n\n    editor.getSharedState().logger.logEvent({\n        'type': 'doc_create_from_node', \n        'node_id': draggedNode.id, \n        'short_text': draggedNode.text, \n        'long_text': draggedNode.longText\n    });\n}\n\nexport function insertSectionBlock(editor, id, text, longText, initialNodeStyle) {\n    // if its an empty document, prevent a blank node being shown above the section added\n    const removeFirstNode = editor.value.document.nodes.size === 1 && editor.value.document.text === \"\"\n    \n    var link = Block.create({\n        type: 'link',\n        data: {node_id: id},\n        nodes: [Text.create({text: text})]\n    })\n\n    var body = Block.create({\n        type: 'body',\n        data: {node_id: id},\n        nodes: [Text.create({text: longText})]\n    })\n\n    var section = Block.create({\n        type: 'section',\n        data: {node_id: id, nodeStyle: initialNodeStyle},\n        nodes: [link, body]\n    })\n\n    editor.insertBlock(section);\n    editor.moveToEndOfNode(section)\n\n    if (removeFirstNode) {\n        editor.removeNodeByKey(editor.value.document.nodes.get(0).key)\n    }\n\n    return section\n}\n\nexport function handleMouseUp(editor, clickedNode, isOverHalf) {\n    var draggedNode = editor.getSharedState().draggedNode;\n\n    if (draggedNode) {\n        draggedNode.resetPos();\n\n        if (editor.getSharedState().getGraphNode(draggedNode.id)) {\n            toast.error('You can\\'t add the same node twice!')\n            console.log('Duplicate - node');\n            \n        } else {\n            const { value } = editor\n            const { document } = value\n            editor.focus()\n\n            if (clickedNode.type === \"body\" || clickedNode.type === \"link\") {\n                clickedNode = document.getParent(clickedNode);\n            }\n\n            if (isOverHalf) {\n                editor.moveToEndOfNode(clickedNode);\n            } else {\n                editor.moveToStartOfNode(clickedNode)\n                editor.moveBackward()\n            }\n\n            addSection(draggedNode, editor);\n\n            editor.getSharedState().draggedNode = false;\n            return true;\n        }\n    }\n}","import { Block } from 'slate';\nimport OptionPopup from '../graph/OptionPopup.js'\nimport { insertSectionBlock } from './GraphPlugin.js';\n\nexport const showNodeSwitchMenu = (event, node, editor, entriesToHide) => {\n    var entries = [\n        {'colour': 'black', 'name': 'Inline', 'symbol': \"\"},\n        {'colour': 'black', 'name': 'Heading and body', 'symbol': \"\"},\n        {'colour': 'black', 'name': 'Heading only', 'symbol': \"\"},\n        {'colour': 'black', 'name': 'Body only', 'symbol': \"\"},\n        {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\n    ]\n\n    if (entriesToHide) {\n        entries = entries.filter((entry) => {return !entriesToHide.includes(entry.name)})\n    }\n\n    event.preventDefault();\n\n    const onOptionSelect = (selectedEntry) => {\n        const selected = selectedEntry.name\n        if (selected === \"Delete\") {\n            editor.getSharedState().logger.logEvent({\n                type: \"doc_node_delete\",\n                id: node.data.get(\"node_id\")\n            });\n            deleteNode(node, editor);\n        } else {\n            var nodeStyle = node.data.get(\"nodeStyle\")\n            if (!nodeStyle) {\n                nodeStyle = \"Inline\"\n            }\n\n            editor.getSharedState().logger.logEvent({\n                type: \"doc_node_change_format\",\n                old: nodeStyle,\n                new: selected,\n                id: node.data.get(\"node_id\")\n            });\n\n            if (nodeStyle !== \"Inline\" && selected !== \"Inline\") {\n                editor.setNodeByKey(node.key, { data: {node_id: node.data.get(\"node_id\"), nodeStyle: selected} })\n            } else if (nodeStyle === \"Inline\" && selected !== \"Inline\") {\n                convertFromInline(node, editor, selected)\n            }  else if (nodeStyle !== \"Inline\" && selected === \"Inline\") {\n                convertToInline(node, editor, selected)\n            }\n        }\n    }\n\n    new OptionPopup(entries, event.clientX, event.clientY, true, onOptionSelect, node.data.get('nodeStyle'), document.querySelector(\".App\"))\n}\n\nexport function deleteNode(node, editor) {\n    editor.getSharedState().removeDocNode(node.data.get(\"node_id\"))\n\n    editor.removeNodeByKey(node.key)\n\n    if (editor.value.document.nodes.size === 0) {\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\n    }\n}\n\nfunction convertFromInline(node, editor, newStyle) {\n    editor.moveToRangeOfNode(node);\n    const parent = editor.value.document.getParent(node.key)\n    if (parent && parent.text === node.text) {\n        editor.moveToRangeOfNode(parent)\n    }\n\n    const graphNode = editor.getSharedState().getGraphNode(node.data.get('node_id'))\n    const longText = graphNode && graphNode.longText ? graphNode.longText : \"\"\n\n    insertSectionBlock(editor, node.data.get(\"node_id\"), node.text, longText, newStyle)    \n}\n\nfunction getEmptyParagraph() {\n    return Block.create({\n        type: 'paragraph'\n    })\n}\n\nfunction convertToInline(node, editor) {\n    const shortText = node.getBlocksByType(\"link\").get(0).text;\n    // need to get 0th child because previous of section is the body inside it\n    const prev = editor.value.document.getPreviousBlock(node.nodes.get(0).key)\n    const next = editor.value.document.getNextBlock(node.nodes.get(1).key)\n\n    // if doc only contains this section, add an empty paragraph at the start to prevent emptying the doc\n    if (!prev && !next) {\n        editor.insertNodeByKey(editor.value.document.key, 0, getEmptyParagraph())\n    }\n\n    editor.moveToRangeOfNode(node)\n\n    // don't merge with prev block if prev is another section - wrap it in a fresh paragraph instead\n    if ((prev && (prev.type === \"section\" || prev.type === \"body\")) || (!prev && next && (next.type === \"section\" || next.type === \"link\"))) {\n        editor.wrapBlockByKey(node.key, \"paragraph\")\n        editor.removeNodeByKey(node.key)\n    } else {\n        editor.removeNodeByKey(node.key)\n    }\n\n    editor.insertInline({\n            type: \"link\",\n            data: {node_id: node.data.get(\"node_id\"), nodeStyle: \"Inline\"},\n        })\n        .insertText(shortText)\n    \n    // prevent rare bug where style is changed inline > section > inline, and doc-graph link is severed\n    setTimeout(() => {editor.focus(); editor.moveForward(); editor.moveBackward()}, 0)\n}\n\nexport const getNodeStyleClass = (verbose) => {\n    switch (verbose) {\n        case \"Heading only\":\n            return \" hide-body\"\n\n        case \"Body only\":\n            return \" hide-heading\"\n    \n        default:\n            return \"\";\n    }\n}","import React, { Component } from 'react';\nimport { showNodeSwitchMenu } from './NodeSwitch';\n\nexport default class StyleButton extends Component {\n    render() {\n        return (<button \n                    className={'style-button pure-button '\n                                 + ((this.props.nodeStyle === 'section') ? 'style-button-section' : 'style-button-inline')}\n                    onClick={(e) => showNodeSwitchMenu(e, this.props.node, this.props.editor)}>\n                        <p className='eye-icon'></p>\n                </button>)\n    }\n}","import React, { Component } from 'react'\nimport StyleButton from '../StyleButton'\n\nexport default class LinkNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false,\n        }\n        \n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {     \n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"link_mouse\", newHover);\n        }\n\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        const { value } = this.props.editor;\n        const { document, selection } = value;\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"link_cursor\", cursorInside)\n        }\n        \n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\n        var classes = \"node-link\" + hoverClass;\n\n        if (this.props.linkStyle === \"heading\") {\n            return (\n                <p className={classes} {...this.props.attributes}>\n                    <u><b>{this.props.children}</b></u>\n                </p>\n            );\n\n        } else if (this.props.linkStyle === \"inline\") {\n            return (\n                <p className={classes} {...this.props.attributes}\n                        onMouseEnter={() => this.setHover(true)} \n                        onMouseLeave={() => this.setHover(false)}>\n                    {this.props.children}\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='inline' />}\n                </p>\n            );\n        }\n    }\n}","import React, { Component } from 'react';\n\nexport default class BodyNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false\n        }\n        this.setHover = this.setHover.bind(this);\n        this.selectNode = props.selectNode;\n    }\n\n    setHover(newHover) {\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        var hoverClass = (this.state.externalHover || this.state.hover) ? \" hovered\" : \"\";\n        var classes = \"node-body\" + hoverClass + (this.props.isEmpty ? \" placeholder\" : \"\");\n\n        const { value } = this.props.editor;\n        const { document, selection } = value;\n        var cursorInside = document.getDescendantsAtRange(selection).contains(this.props.node)\n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"body_cursor\", cursorInside);\n            node.setHoverer(\"body_mouse\", this.state.hover);\n        }\n\n        if (this.props.isEmpty) {\n                return (\n                    <p className={classes} {...this.props.attributes} onMouseDown={this.selectNode}>\n                        Type some text...{this.props.children}\n                    </p>\n                );\n        } else {\n            return (\n                <p className={classes} {...this.props.attributes}>\n                    {this.props.children}\n                </p>\n            );\n        }\n    }\n}","export const ItemTypes = {\n    BLOCK: \"block\",\n}","import { DragSource } from 'react-dnd';\nimport { ItemTypes } from '../../dragtypes';\nimport { addSection } from './GraphPlugin.js'\n\nconst blockSource = {\n    canDrag(props) {\n        // don't drag if there is a non-collapsed selection, so it doesn't interfere with dragging selections to graph\n        return props.editor.value.selection.isCollapsed\n    },\n\n    beginDrag(props) {\n      // Return the data describing the dragged item\n      const item = { id: props.node.id, node: props.node }\n      return item\n    },\n\n    endDrag(props, monitor, component) {\n        if (!monitor.didDrop()) {            \n            return\n        }\n\n        const dropResult = monitor.getDropResult()\n        const sharedState = props.editor.getSharedState()\n\n        if (dropResult.droppedOnGraph) {\n            const graphNode = sharedState.addGraphNode('', dropResult.position.x, dropResult.position.y, true)\n            const draggedNode = {\n                id: graphNode.id,\n                node: graphNode,\n                text: \"\",\n                longText: props.node.text\n            }\n            props.editor.moveTo(props.node.key)\n            \n            addSection(draggedNode, props.editor, \"Body only\")\n            props.editor.removeNodeByKey(props.node.key)\n            props.editor.blur()\n        } else {\n            const document = props.editor.value.document;\n            const blockParent = document.getParent(props.node.key);\n            const blockIndex = blockParent.nodes.indexOf(props.node);\n            const indexShift = (dropResult.insertBefore ? 1 : 0) - (dropResult.indexDroppedOn > blockIndex ? 1 : 0)\n\n            props.editor.moveNodeByKey(props.node.key, dropResult.parentKey, dropResult.indexDroppedOn + indexShift)\n\n            sharedState.logger.logEvent({\n                'type': 'reorder',\n                'id': props.node.data.get('node_id'),\n                'old_index': blockIndex,\n                'new_index': dropResult.indexDroppedOn + indexShift,\n            });\n        }\n    },\n  }\n\n/**\n * Specifies which props to inject into your component.\n */\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDragSource: connect.dragSource(),\n        dragPreview: connect.dragPreview(),\n        isDragging: monitor.isDragging(),\n    }\n}\n\nexport default DragSource(ItemTypes.BLOCK, blockSource, collect)","import ReactDOM from 'react-dom';\nimport { DropTarget } from \"react-dnd\";\nimport { ItemTypes } from \"../../dragtypes\";\n\nexport function isOverHalf(component, event) {\n    // calculate based on height of firstChild because if this is the last node in the doc, its outer div expands to fill the remaining vertical space\n    const outerDiv = ReactDOM.findDOMNode(component)        \n    const outerRect = outerDiv.getBoundingClientRect()\n    \n    var innerDiv;\n    for (let item of outerDiv.children) {\n        if (item.classList.contains('plain-block') || item.classList.contains('section')) {\n            innerDiv = item;\n            break;\n        }\n    }\n\n    if (!innerDiv) {\n        console.log('error: couldn\\'t find the inner div!');\n        return\n    }\n    const innerRect = innerDiv.getBoundingClientRect()       \n\n    // subtract offset of the innerRect from the outerRect, to prevent the insertion of the drag indicator from affecting things\n    const offset = (innerRect.y - outerRect.y)\n    var newState = false\n    if (event.clientY + offset > (innerRect.y + innerRect.height / 2)) {\n        newState = true\n    }\n    \n    if (component.state.overHalf !== newState) {\n        component.setState({overHalf: newState});\n    }\n}\n\nconst blockTarget = {\n    hover(props, monitor, component) {\n        isOverHalf(component, { clientY: monitor.getClientOffset().y })\n    },\n    drop(props, monitor, component) {\n        const document = props.editor.value.document;\n        const blockParent = document.getParent(props.node.key);\n        const blockIndex = blockParent.nodes.indexOf(props.node);\n        return { droppedOnGraph: false, parentKey: blockParent.key, indexDroppedOn: blockIndex, insertBefore: component.state.overHalf }\n    },\n}\n\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDropTarget: connect.dropTarget(),\n        // You can ask the monitor about the current drag state:\n        isOver: monitor.isOver(),\n        isOverCurrent: monitor.isOver({ shallow: true }),\n        canDrop: monitor.canDrop(),\n        itemType: monitor.getItemType(),\n    }\n}\n\nexport default DropTarget(ItemTypes.BLOCK, blockTarget, collect)","import React, { Component } from 'react';\nimport DragifyBlock from '../DragifyBlock';\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\nimport { handleMouseUp } from '../GraphPlugin';\nimport { getNodeStyleClass } from '../NodeSwitch';\nimport StyleButton from '../StyleButton';\n\nclass SectionNode extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            hover: false,\n            externalHover: false,\n            overHalf: false,\n        }\n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {     \n        var node = this.props.sharedState.getGraphNode(this.props.nodeId);\n        if (node) {\n            node.setHoverer(\"section_mouse\", newHover);\n        }\n\n        this.setState({hover: newHover});\n    }\n    \n    setExternalHover(isHovered) {\n        this.setState({externalHover: isHovered});\n    }\n\n    render() {\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props;\n\n        const value = this.props.editor.value\n        var cursorInside = value.blocks && value.blocks.some(block => block === this.props.node || this.props.node.nodes.includes(block))\n\n        var hoverClass = (this.state.externalHover || cursorInside) ? \" hovered\" : \"\";\n        var classes = \"section plain-block \" + hoverClass  + (isDragging ? \" display-none\" : \"\");\n        classes += getNodeStyleClass(this.props.node.data.get(\"nodeStyle\"))\n\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\n\n        return connectDropTarget(\n            <div className='block-outer-div'\n                onMouseEnter={() => this.setHover(true)}\n                onMouseOver={() => this.setHover(true)}\n                onMouseLeave={() => this.setHover(false)} \n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}}\n                onMouseMove={(e) => isOverHalf(this, e)}>\n\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\n                    {this.state.hover && <StyleButton node={this.props.node} editor={this.props.editor} nodeStyle='section' />}\n                    {this.props.children}\n                </div>\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\n\n            </div>\n        );\n    }\n}\n\nexport default DragifyBlock(DropifyBlock(SectionNode))","\nimport { getEventTransfer } from 'slate-react';\n\nexport default function LoggingPlugin(options) {\n    return {\n        onCopy(event, editor, next) {\n            editor.getSharedState().logger.logEvent({\n                type: \"copy\",\n                content: editor.value.fragment.text\n            });\n            \n            next();\n        },\n\n        onCut(event, editor, next) {\n            editor.getSharedState().logger.logEvent({\n                type: \"cut\",\n                content: editor.value.fragment.text\n            });\n            \n            next();\n        },\n\n        onPaste(event, editor, next) {\n            var transfer = getEventTransfer(event);\n\n            editor.getSharedState().logger.logEvent({\n                type: \"paste\",\n                paste_type: transfer.type,\n                content: transfer.fragment ? transfer.fragment.text : \"\",\n                content_html: transfer.fragment ? \"\" : transfer.html  // only include if there is no fragment (pasted from external)\n            });\n            \n            next();\n        },\n    }\n}","import React, { Component } from 'react';\nimport DragifyBlock from '../DragifyBlock';\nimport DropifyBlock, { isOverHalf } from '../DropifyBlock';\nimport { handleMouseUp } from '../GraphPlugin';\n\nclass PlainBlockNode extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            hover: false\n        }\n        this.setHover = this.setHover.bind(this);\n    }\n\n    setHover(newHover) {\n        this.setState({hover: newHover});\n    }\n\n    render() {\n        const { isOverCurrent, connectDropTarget, connectDragSource, isDragging } = this.props\n\n        const classes = \"plain-block \" + (isDragging ? \" display-none\" : \"\")\n\n        const dragOverCurrent = isOverCurrent || (this.state.hover && this.props.editor.getSharedState().draggedNode)\n\n        return connectDropTarget(\n            <div className='block-outer-div'\n                onMouseUp={() => {handleMouseUp(this.props.editor, this.props.node, this.state.overHalf) && this.setState({hover: false})}} \n                onMouseEnter={() => this.setHover(true)}\n                onMouseOver={() => this.setHover(true)}\n                onMouseLeave={() => this.setHover(false)}\n                onMouseMove={(e) => isOverHalf(this, e)}>\n\n                {(dragOverCurrent && !this.state.overHalf && <div className=\"drop-indicator\" />)}\n                <div className={classes} {...this.props.attributes} ref={connectDragSource}>\n                    {this.props.children}\n                </div>\n                {(dragOverCurrent && this.state.overHalf && <div className=\"drop-indicator\" />)}\n\n            </div>\n        );\n    }\n}\n\nexport default DragifyBlock(DropifyBlock(PlainBlockNode))","import React from 'react'\nimport { cx, css } from 'emotion'\n\nexport const Button = React.forwardRef(\n  ({ className, active, reversed, ...props }, ref) => (\n    <span\n      {...props}\n      ref={ref}\n      className={cx(\n        className,\n        css`\n          cursor: pointer;\n          color: ${reversed\n            ? active ? 'white' : '#aaa'\n            : active ? 'black' : '#ccc'};\n        `\n      )}\n    />\n  )\n)\n\nexport const EditorValue = React.forwardRef(\n  ({ className, value, ...props }, ref) => {\n    const textLines = value.document.nodes\n      .map(node => node.text)\n      .toArray()\n      .join('\\n')\n    return (\n      <div\n        ref={ref}\n        {...props}\n        className={cx(\n          className,\n          css`\n            margin: 30px -20px 0;\n          `\n        )}\n      >\n        <div\n          className={css`\n            font-size: 14px;\n            padding: 5px 20px;\n            color: #404040;\n            border-top: 2px solid #eeeeee;\n            background: #f8f8f8;\n          `}\n        >\n          Slate's value as text\n        </div>\n        <div\n          className={css`\n            color: #404040;\n            font: 12px monospace;\n            white-space: pre-wrap;\n            padding: 10px 20px;\n            div {\n              margin: 0 0 0.5em;\n            }\n          `}\n        >\n          {textLines}\n        </div>\n      </div>\n    )\n  }\n)\n\nexport const Icon = React.forwardRef(({ className, ...props }, ref) => (\n  <span\n    {...props}\n    ref={ref}\n    className={cx(\n      'material-icons',\n      className,\n      css`\n        font-size: 18px;\n        vertical-align: text-bottom;\n      `\n    )}\n  />\n))\n\nexport const Instruction = React.forwardRef(({ className, ...props }, ref) => (\n  <div\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        white-space: pre-wrap;\n        margin: 0 -20px 10px;\n        padding: 10px 20px;\n        font-size: 14px;\n        background: #f8f8e8;\n      `\n    )}\n  />\n))\n\nexport const Menu = React.forwardRef(({ className, ...props }, ref) => (\n  <div\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        & > * {\n          display: inline-block;\n        }\n\n        & > * + * {\n          margin-left: 15px;\n        }\n      `\n    )}\n  />\n))\n\nexport const Toolbar = React.forwardRef(({ className, ...props }, ref) => (\n  <Menu\n    {...props}\n    ref={ref}\n    className={cx(\n      className,\n      css`\n        position: relative;\n        padding: 1px 18px 17px;\n        margin: 0 -20px;\n        border-bottom: 2px solid #eee;\n        margin-bottom: 20px;\n      `\n    )}\n  />\n))","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { css } from 'emotion'\nimport { Button, Icon, Menu } from './SlateComponents.js'\n\n// adapted from https://github.com/ianstormtaylor/slate/blob/master/site/examples/hovering-toolbar.js\n\nconst MarkButton = ({ editor, type, icon }) => {\n  const { value } = editor\n  const isActive = value.blocks && value.blocks.some(block => block.type === type)\n  return (\n    <Button\n      reversed\n      active={isActive}\n      onMouseDown={event => {\n        event.preventDefault()\n        editor.setBlocks((isActive ? \"paragraph\" : type))\n\n        editor.getSharedState().logger.logEvent({\n          'type': 'set_title' + (isActive ? \"_disabled\" : \"_enabled\"),\n      });\n      }}\n    >\n      <Icon>{icon}</Icon>\n    </Button>\n  )\n}\n\nconst HoverMenu = React.forwardRef(({ editor }, ref) => {\n  const root = window.document.getElementById('root')\n  return ReactDOM.createPortal(\n    <Menu\n      ref={ref}\n      className={css`\n        padding: 8px 7px 6px;\n        position: absolute;\n        z-index: 1;\n        top: -10000px;\n        left: -10000px;\n        margin-top: -6px;\n        opacity: 0;\n        background-color: #222;\n        border-radius: 4px;\n        transition: opacity 0.25s;\n      `}\n    >\n      <MarkButton editor={editor} type=\"heading\" icon=\"Heading\" />\n    </Menu>,\n    root\n  )\n})\n\n\nclass HoveringMenu extends React.Component {\n\n  menuRef = React.createRef()\n\n  componentDidMount = () => {\n    this.updateMenu()\n  }\n\n  componentDidUpdate = () => {\n    this.updateMenu()\n  }\n\n  updateMenu = () => {\n    const menu = this.menuRef.current\n    if (!menu) return\n\n    const value = this.props.editor.value\n    const { fragment, selection } = value\n\n    if (selection.isBlurred || selection.isCollapsed || fragment.text === '') {\n      menu.removeAttribute('style')\n      return\n    }\n\n    const native = window.getSelection()\n    const range = native.getRangeAt(0)\n    const rect = range.getBoundingClientRect()\n    menu.style.opacity = 1\n    menu.style.top = `${rect.top + window.pageYOffset - menu.offsetHeight}px`\n\n    menu.style.left = `${rect.left +\n      window.pageXOffset -\n      menu.offsetWidth / 2 +\n      rect.width / 2}px`\n  }\n\n  render = (props, editor, next) => {\n    return (\n        <HoverMenu ref={this.menuRef} editor={this.props.editor} />\n    )\n  }\n}\n\n\nexport default function HoveringMenuPlugin(options) {\n    return {\n        renderEditor (props, editor, next) {\n            const children = next()\n            return (\n              <React.Fragment>\n                {children}\n                <HoveringMenu editor={editor} />\n              </React.Fragment>\n            )\n          },\n\n        renderBlock (props, editor, next) {\n            switch (props.node.type) {\n            case 'heading':\n                return <u><b>{props.children}</b></u>\n            default:\n                return next()\n            }\n        },\n    }\n}","import { Block, Text } from 'slate';\n\nexport const schema = {\n    inlines: {\n        link: {\n            parent: [{type: ''}, {type: 'paragraph'}],\n\n            normalize: (editor, error) => {\n                switch (error.code) {\n                    case 'parent_type_invalid':\n                        editor.unwrapInlineByKey(error.node.key)\n                        return\n\n                    default:\n                        console.log(\"unhandled link inline err \" + error);\n                }\n            }\n        }\n    },\n\n    blocks: {\n        section: {\n            parent: {object: \"document\"},\n            nodes: [\n                {\n                    match: {type: 'link'},\n                    min: 1,\n                    max: 1,\n                },\n                {\n                    match: {type: 'body'},\n                    min: 1,\n                    max: 1,\n                }\n            ],\n\n            normalize: (editor, error) => {\n                switch (error.code) {\n                    case 'child_max_invalid':\n                        // if we somehow end up with multiple headings/bodies inside the section, make it a paragraph move it after the section                     \n                        // this can happen if the enter key is pressed (splits the current node)\n                        moveBlockAfterSection(editor, error.child, error.node)\n                        editor.setNodeByKey(error.child.key, 'paragraph')\n                        return\n\n                    case 'child_type_invalid':\n                        // if we somehow end up with a paragraph inside the section, put the content in the heading instead                     \n                        if (error.child.object === \"text\" || error.child.type === \"paragraph\") {\n                            const linkNode = error.node.nodes.find(node => node.type === 'link')\n                            if (linkNode) {\n                                const textNode = linkNode.getLastText()\n                                const offset = textNode.text ? textNode.text.length : 0\n                                editor.insertTextByKey(textNode.key, offset, error.child.text)\n                            } else {\n                                addMissing(editor, error, \"link\", error.child.text)\n                            }\n                        }\n\n                        editor.removeNodeByKey(error.child.key)\n                        \n                        return\n                    \n                    case 'child_min_invalid':\n                        var hasChildTypes = [];\n                        error.node.nodes.forEach(node => {\n                            hasChildTypes.push(node.type)\n                        })\n                        \n                        if (!hasChildTypes.includes(\"link\")) {\n                            addMissing(editor, error, \"link\")\n                        }\n\n                        if (!hasChildTypes.includes(\"body\")) {\n                            addMissing(editor, error, \"body\")\n                        }\n\n                        return\n                    \n                    case 'parent_object_invalid':\n                        // a section has ended up inside another section - shift it out\n                        moveBlockAfterSection(editor, error.node, error.parent)\n                        return\n\n                    default:\n                        console.log(\"unhandled section schema err \" + error);\n                        \n                        return\n                }\n            }\n        },\n    }\n}\n\nfunction moveBlockAfterSection(editor, blockToMove, sectionToMoveAfter) {\n    const sectionIndex = editor.value.document.nodes.indexOf(sectionToMoveAfter)\n    if (sectionIndex === -1) {\n        return\n    }\n    editor.moveNodeByKey(blockToMove.key, editor.value.document.key, sectionIndex + 1)\n}\n\nfunction addMissing(editor, error, nodeType, text=\"\") {\n    const node_id = error.node.data.get(\"node_id\")\n    const graphNode = editor.getSharedState().getGraphNode(node_id)\n    if (!text) {\n        text = nodeType === \"link\" ? graphNode.getShortText() : graphNode.getLongText()\n    }\n    const index = nodeType === \"link\" ? 0 : 1\n\n    addBlock(editor, error.node, nodeType, index, node_id, text)\n}\n\nfunction addBlock(editor, parent, nodeType, index, id, text) {\n    var block = Block.create({\n        type: nodeType,\n        data: {node_id: id},\n        nodes: [Text.create({'text': text})]\n    })\n    editor.insertNodeByKey(parent.key, index, block);\n    \n}","import React from 'react';\nimport { Editor } from 'slate-react';\nimport { Value } from 'slate';\nimport NodePlugin from './NodePlugin.js';\nimport GraphPlugin from './GraphPlugin.js';\nimport LoggingPlugin from './LoggingPlugin.js';\nimport ReorderPlugin from './ReorderPlugin.js';\nimport HoveringMenu from './HoveringMenu.js';\nimport WordCountPlugin from './WordCountPlugin.js';\nimport { schema } from './Schema.js'\n\nconst plugins = {\n    'graph': [\n        LoggingPlugin(),\n        GraphPlugin(),\n        NodePlugin(),\n        ReorderPlugin(),\n        WordCountPlugin(),\n    ],\n    'plain': [\n        LoggingPlugin(),\n        HoveringMenu(),\n    ]\n};\n\nconst emptyValue = Value.fromJSON({\n    document: {\n        nodes: [\n            {\n                object: 'block',\n                type: 'paragraph',\n                nodes: [\n                    {\n                        object: 'text',\n                        text: '',\n                    },\n                ],\n            },\n        ],\n    },\n});\n\nclass DocEditor extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.props.sharedState.editor_ref = React.createRef();\n    }\n\n    componentDidMount() {\n        const sharedState = this.props.sharedState\n        sharedState.getSavedDocValue((savedValue) => {\n            this.setState({\n                value: savedValue ? Value.fromJSON(savedValue) : emptyValue\n            }, sharedState.editorHasLoaded)\n        })\n    }\n\n    state = {\n        value: undefined, // don't display editor until the db's saved document loads\n        mapHasLoaded: false, // force a refresh of the component once the sharedState.map has loaded so section refs are hooked up to graph nodes\n    }\n    \n    queries = {\n        getSharedState: () => {\n            return this.props.sharedState;\n        },\n        getValue: () => {\n            return this.state.value;\n        },\n        mapHasLoaded: () => {\n            this.setState({ mapHasLoaded: true })\n        }\n    }\n\n    onChange = ({ value }) => {\n        this.setState({ value })\n    }\n\n    render() {\n        const plainClass = this.props.sharedState.condition === \"plain\" ? \" slate-editor-no-graph\" : \"\"\n\n        if (this.state.value !== undefined) {\n            return <Editor\n                className={\"slate-editor\" + plainClass}\n                key={this.state.mapHasLoaded ? \"map-loading\" : \"map-loaded\"}\n                ref={this.props.sharedState.editor_ref}\n                schema={schema}\n                plugins={plugins[this.props.sharedState.condition]}\n                queries={this.queries}\n                value={this.state.value}\n                onChange={this.onChange}\n                placeholder=\"Write your document here...\"\n                spellCheck={true}\n            />\n        } else {\n            return <p></p>\n        }\n    }\n}\n\nexport default DocEditor;","import SVG from 'svg.js';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n(function e(t, n, r) {\n    function s(o, u) {\n        if (!n[o]) {\n            if (!t[o]) {\n                // eslint-disable-next-line no-sequences\n                var a = typeof require == \"function\" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error(\"Cannot find module '\" + o + \"'\");throw f.code = \"MODULE_NOT_FOUND\", f;\n            }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {\n                var n = t[o][1][e];return s(n ? n : e);\n            }, l, l.exports, e, t, n, r);\n        }return n[o].exports;\n    }var i = typeof require == \"function\" && require;for (var o = 0; o < r.length; o++) {\n        s(r[o]);\n    }return s;\n})({ 1: [function (require, module, exports) {\n        // Dependencies\n        var Id = require(\"idy\"),\n            SetOrGet = require(\"set-or-get\"),\n            IterateObject = require(\"iterate-object\"),\n            Deffy = require(\"deffy\");\n\n        // Internal cache\n        var _connections = {},\n            _betweenTwoBubbles = {},\n            container = null,\n            markers = null;\n\n        function delete_connectable(con) {\n            con.line.remove();\n            con.marker.remove();\n\n            _connections[con.source.id()] = _connections[con.source.id()].filter(e => e !== con);\n            _connections[con.target.id()] = _connections[con.target.id()].filter(e => e !== con);\n\n            var toString = function() {\n                var ids = [con.source.id(), con.target.id()],\n                    id1 = ids.join(\"->\"),\n                    id2 = ids.reverse().join(\"->\");\n\n                con._ = con.id = id1;\n\n                if (_betweenTwoBubbles[id2]) {\n                    con._ = id2;\n                    return id2;\n                }\n\n                con.id = id1;\n                return id1;\n            }\n\n            _betweenTwoBubbles[toString()] = _betweenTwoBubbles[toString()].filter(e => e !== con);\n            con.source.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any other connectables looking for drag events\n        }\n\n        /**\n         * connectable\n         * Connects two elements.\n         *\n         * @name connectable\n         * @function\n         * @param {Object} options An object containing the following fields:\n         *\n         *  - `container` (SVGElement): The line elements container.\n         *  - `markers` (SVGElement): The marker elements container.\n         *  - `padEllipse` (Boolean): If `true`, the line coordinates will be placed with a padding.\n         *\n         * @param {SVGElement} elmTarget The target SVG element.\n         * @return {Object} The connectable object containing:\n         *\n         *  - `source` (SVGElement): The source element.\n         *  - `target` (SVGElement): The target element.\n         *  - `line` (SVGElement): The line element.\n         *  - `marker` (SVGElement): The marker element.\n         *  - [`computeLineCoordinates` (Function)](#computelinecoordinatescon)\n         *  - [`update` (Function)](#update)\n         *  - [`setLineColor` (Function)](#setlinecolorcolor-c)\n         */\n        function connectable(options, elmTarget) {\n\n            var con = {};\n\n            if (elmTarget === undefined) {\n                elmTarget = options;\n                options = {};\n            }\n\n            container = options.container || container;\n            var elmSource = this;\n            markers = options.markers || markers;\n\n            options.k = options.k || 100;\n            options.kk = options.kk || 10;\n\n            var marker = markers.marker(10, 10).addClass('connector-marker'),\n                markerId = \"triangle-\" + Id(),\n                line = container.path().attr(\"marker-end\", \"url(#\" + markerId + \")\").fill(\"none\").stroke({width: 3});\n            \n            if (options.specialCoords) {\n                line.addClass('connector-line');\n            }\n\n            marker.attr({\n                id: markerId,\n                viewBox: \"0 0 10 10\",\n                refX: \"0\",\n                refY: \"5\",\n                markerUnits: \"strokeWidth\",\n                markerWidth: \"4\",\n                markerHeight: \"5\"\n            });\n\n            marker.path().attr({\n                d: \"M 0 0 L 10 5 L 0 10 z\"\n            });\n\n            // Append the SVG elements\n            con.source = elmSource;\n            con.target = elmTarget;\n            con.line = line;\n            con.marker = marker;\n\n\n            if (options.specialCoords) {\n                // remove this when node is deleted\n                // con.source.on(\"deletenode\", () => con.source.node.instance.delete_connectable(con));\n                // con.target.on(\"deletenode\", () => con.target.node.instance.delete_connectable(con));\n            }\n\n            SetOrGet(_connections, con.source.id(), []).push(con);\n            SetOrGet(_connections, con.target.id(), []).push(con);\n\n            SetOrGet(_betweenTwoBubbles, {\n                toString: function toString() {\n                    var ids = [con.source.id(), con.target.id()],\n                        id1 = ids.join(\"->\"),\n                        id2 = ids.reverse().join(\"->\");\n\n                    con._ = con.id = id1;\n\n                    if (_betweenTwoBubbles[id2]) {\n                        con._ = id2;\n                        return id2;\n                    }\n\n                    con.id = id1;\n                    return id1;\n                }\n            }, []).push(con);\n            \n\n            /**\n             * computeLineCoordinates\n             * The function that computes the new coordinates.\n             * It can be overriden with a custom function.\n             *\n             * @name computeLineCoordinates\n             * @function\n             * @param {Connectable} con The connectable instance.\n             * @return {Object} An object containing the `x1`, `x2`, `y1` and `y2` coordinates.\n             */\n            con.computeLineCoordinates = function (cons) {\n\n                var output = [],\n                    l = cons.length;\n\n                IterateObject(cons, function (con, i) {\n\n                    var sT = con.source.transform(),\n                        tT = con.target.transform(),\n                        sB = con.source.bbox(),\n                        tB = con.target.bbox(),\n                        x1 = sT.x + sB.width / 2,\n                        y1 = sT.y + sB.height / 2,\n                        x2 = tT.x + tB.width / 2,\n                        y2 = tT.y + tB.height / 2,\n                        cx = (x1 + x2) / 2,\n                        cy = (y1 + y2) / 2,\n                        dx = Math.abs((x1 - x2) / 2),\n                        dy = Math.abs((y1 - y2) / 2),\n                        dd = null,\n                        out = {\n                        x1: x1,\n                        y1: y1,\n                        x2: x2,\n                        y2: y2,\n                        ex: x1,\n                        ey: y1\n                    };\n\n                    if (i !== (l - 1) / 2) {\n                        dd = Math.sqrt(dx * dx + dy * dy);\n                        out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                        out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                    }\n                    output.push(out);\n                });\n\n                return output;\n            };\n\n            if (options.specialCoords) {\n                con.computeLineCoordinates = function (cons) {\n\n                    var output = [],\n                        l = cons.length;\n\n                    IterateObject(cons, function (con, i) {\n\n                        var sT = con.source.transform(),\n                            tT = con.target.transform(),\n                            sB = con.source.bbox(),\n                            tB = con.target.bbox(),\n                            x1 = sT.x + sB.width / 2,\n                            y1 = sT.y + sB.height / 2 - 20;\n\n                        var xDiff = sT.x - tT.x;\n                        var yDiff = sT.y - tT.y;\n                        var x2, y2;\n\n                        var x2centre = tT.x + tB.width / 2\n                        var y2centre = tT.y + tB.height / 2\n\n                        var grad = (y2centre - y1) / ((x2centre - x1) === 0 ? 0.0000001 : (x2centre - x1))\n\n                        if (grad === 0) {\n                            grad = 0.0000001\n                        }\n\n                        var left = tT.x - 10\n                        var right = tT.x + tB.width - 30\n                        var top = tT.y - 10\n                        var bottom = tT.y + tB.height - 30\n                        \n                        var rightLeftCalc = () => {\n                            var x2 = xDiff < 0 ? left : right\n                            return { \n                                x: x2,\n                                y: ((x2 - x1) * grad) + y1\n                            }\n                        }\n\n                        var topBotCalc = () => {\n                            var y2 = yDiff < 0 ? top : bottom\n                            return {\n                                x: ((y2 - y1) * (1/grad)) + x1,\n                                y: y2\n                            }\n                        }\n\n                        var vals\n                        if (Math.abs(xDiff) >= Math.abs(yDiff)) {\n                            vals = rightLeftCalc()\n                            x2 = vals.x\n                            y2 = vals.y\n\n                            if (y2 > bottom || y2 < top) {\n                                vals = topBotCalc()\n                                x2 = vals.x\n                                y2 = vals.y\n                            }\n\n                        } else {\n                            vals = topBotCalc()\n                            x2 = vals.x\n                            y2 = vals.y\n\n                            if (x2 > right || x2 < left) {\n                                vals = rightLeftCalc()\n                                x2 = vals.x\n                                y2 = vals.y\n                            }\n                        }\n\n                        var cx = (x1 + x2) / 2,\n                            cy = (y1 + y2) / 2,\n                            dx = Math.abs((x1 - x2) / 2),\n                            dy = Math.abs((y1 - y2) / 2),\n                            dd = null,\n                            out = {\n                            x1: x1,\n                            y1: y1,\n                            x2: x2,\n                            y2: y2,\n                            ex: x1,\n                            ey: y1\n                        };\n\n                        if (i !== (l - 1) / 2) {\n                            dd = Math.sqrt(dx * dx + dy * dy);\n                            out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                            out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                        }\n                        output.push(out);\n                    });\n\n                    return output;\n                };\n            }\n\n            if (options.padEllipse) {\n                con.computeLineCoordinates = function (cons) {\n\n                    var output = [],\n                        l = cons.length;\n\n                    IterateObject(cons, function (con, i) {\n\n                        var elmS = con.source.node.querySelector(\"ellipse\") || con.source.node.querySelector(\"circle\"),\n                            elmT = con.target.node.querySelector(\"ellipse\") || con.target.node.querySelector(\"circle\"),\n                            xR1,\n                            xR2,\n                            yR1,\n                            yR2,\n                            sT = con.source.transform(),\n                            tT = con.target.transform()\n\n                        if (elmS.tagName === \"circle\") {\n                            xR1 = yR1 = parseFloat(elmS.getAttribute(\"r\"));\n                            xR2 = yR2 = parseFloat(elmT.getAttribute(\"r\"));\n                        } else {\n                            xR1 = parseFloat(elmS.getAttribute(\"rx\"));\n                            yR1 = parseFloat(elmS.getAttribute(\"ry\"));\n\n                            xR2 = parseFloat(elmT.getAttribute(\"rx\"));\n                            yR2 = parseFloat(elmT.getAttribute(\"ry\"));\n                        }\n\n                        // Get centers\n                        var sx = sT.x + xR1 / 2,\n                            sy = sT.y + yR1 / 2,\n                            tx = tT.x + xR2 / 2,\n                            ty = tT.y + yR2 / 2\n\n                        // Calculate distance from source center to target center\n                        ,\n                            dx = tx - sx,\n                            dy = ty - sy,\n                            d = Math.sqrt(dx * dx + dy * dy)\n\n                        // Construct unit vector between centers\n                        ,\n                            ux = dx / d,\n                            uy = dy / d\n\n                        // Point on source circle\n                        ,\n                            cx1 = sx + xR1 * ux,\n                            cy1 = sy + yR1 * uy\n\n                        // Point on target circle\n                        ,\n                            cx2 = sx + (d - xR2 - 5) * ux,\n                            cy2 = sy + (d - yR2 - 5) * uy;\n\n                        var x1 = cx1 + xR1 / 2,\n                            y1 = cy1 + yR1 / 2,\n                            x2 = cx2 + xR2 / 2,\n                            y2 = cy2 + yR2 / 2\n                        // TODO\n                        //  , step = (Math.PI / 2 / l) * (i % 2 !== 0 ? 1 : -1)\n                        //  , angle = 0\n                        ;\n\n                        //if (i !== (l - 1) / 2) {\n                        //    angle = step * (i + 1);\n                        //}\n\n\n                        //var xC1 = (sT.x + xR1)\n                        //  , yC1 = (sT.y + yR1)\n                        //  , xC2 = (tT.y + xR2)\n                        //  , yC2 = (tT.y + yR2)\n                        //  , ddx1 = x1 - xC1\n                        //  , ddy1 = y1 - yC1\n                        //  , ddx2 = x2 - xC2\n                        //  , ddy2 = y2 - yC2\n                        //  , cosAngle = Math.cos(angle)\n                        //  , sinAngle = Math.sin(angle)\n                        //  , cosAngleM = Math.cos(-angle)\n                        //  , sinAngleM = Math.sin(-angle)\n                        //  ;\n\n                        // TODO This should change the points to arrange them on the circle\n                        //\n                        // x1 = ddx1 * cosAngle - ddy1 * sinAngle + xC1;\n                        // y1 = ddx1 * sinAngle + ddy1 * cosAngle + yC1;\n\n                        // x2 = ddx2 * cosAngleM - ddy2 * sinAngle + xC2;\n                        // y2 = ddx2 * sinAngleM + ddy2 * cosAngle + yC2;\n\n                        // ===================\n                        // x1 = cx1 + ddx1 * Math.cos(angle) - ddy1 * Math.sin(angle)\n                        // y1 = cy1 + ddx1 * Math.sin(angle) - ddy1 * Math.cos(angle)\n\n                        //x2 = cx2 + ddx2 * Math.cos(angle) - ddy2 * Math.sin(angle) + xR2\n                        //y2 = cy2 + ddx2 * Math.sin(angle) - ddy2 * Math.cos(angle) + yR2\n\n                        var cx = (x1 + x2) / 2,\n                            cy = (y1 + y2) / 2,\n                            dd = null,\n                            out = {\n                            x1: x1,\n                            y1: y1,\n                            x2: x2,\n                            y2: y2,\n                            ex: x1,\n                            ey: y1\n                        };\n\n                        if (isNaN(out.x1)) {\n                            out.x1 = sT.x + xR1 * 2;\n                            out.y1 = sT.y + yR1 / 2;\n                            out.x2 = sT.x;\n                            out.y2 = out.y1;\n                            out.ex = (out.x1 + out.x2) / 2;\n                            out.ey = out.y1 - options.kk * (i + 1);\n                        } else {\n                            dx = Math.abs((x1 - x2) / 2);\n                            dy = Math.abs((y1 - y2) / 2);\n\n                            if (i !== (l - 1) / 2) {\n                                dd = Math.sqrt(dx * dx + dy * dy);\n                                out.ex = cx + dy / dd * options.k * (i - (l - 1) / 2);\n                                out.ey = cy - dx / dd * options.k * (i - (l - 1) / 2);\n                            }\n                        }\n\n                        output.push(out);\n                    });\n\n                    return output;\n                };\n            }\n\n            elmSource.cons = elmSource.cons || [];\n            elmSource.cons.push(con);\n\n            /**\n             * update\n             * Updates the line coordinates.\n             *\n             * @name update\n             * @function\n             * @return {undefined}\n             */\n            con.update = function () {\n                var cons = Deffy(_betweenTwoBubbles[con._], []),\n                    results = con.computeLineCoordinates(cons);\n\n                IterateObject(results, function (r, i) {\n                    cons[i].line.plot(\"M\" + r.x1 + \" \" + r.y1 + \" Q\" + r.ex + \" \" + r.ey + \" \" + r.x2 + \" \" + r.y2);\n                });\n            };\n\n            con.update();\n            elmSource.on(\"dragmove\", con.update);\n            elmTarget.on(\"dragmove\", con.update);\n\n            /**\n             * setLineColor\n             * Sets the line color.\n             *\n             * @name setLineColor\n             * @function\n             * @param {String} color The new color.\n             * @param {Connectable} c The connectable instance.\n             * @return {undefined}\n             */\n            con.setLineColor = function (color, c) {\n                c = c || this;\n                c.line.stroke(color);\n                c.marker.fill(color);\n            };\n\n            return con;\n        }\n\n        if (typeof SVG === \"function\") {\n            SVG.extend(SVG.Element, {\n                connectable: connectable,\n                delete_connectable: delete_connectable\n            });\n        } else if ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") {\n            throw new Error(\"SVG.js is not loaded but it is required.\");\n        }\n\n        module.exports = connectable;\n    }, { \"deffy\": 2, \"idy\": 4, \"iterate-object\": 5, \"set-or-get\": 6 }], 2: [function (require, module, exports) {\n        // Dependencies\n        var Typpy = require(\"typpy\");\n\n        /**\n         * Deffy\n         * Computes a final value by providing the input and default values.\n         *\n         * @name Deffy\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Anything|Function} def The default value or a function getting the\n         * input value as first argument.\n         * @param {Object|Boolean} options The `empty` value or an object containing\n         * the following fields:\n         *\n         *  - `empty` (Boolean): Handles the input value as empty field (`input || default`). Default is `false`.\n         *\n         * @return {Anything} The computed value.\n         */\n        function Deffy(input, def, options) {\n\n            // Default is a function\n            if (typeof def === \"function\") {\n                return def(input);\n            }\n\n            options = Typpy(options) === \"boolean\" ? {\n                empty: options\n            } : {\n                empty: false\n            };\n\n            // Handle empty\n            if (options.empty) {\n                return input || def;\n            }\n\n            // Return input\n            if (Typpy(input) === Typpy(def)) {\n                return input;\n            }\n\n            // Return the default\n            return def;\n        }\n\n        module.exports = Deffy;\n    }, { \"typpy\": 3 }], 3: [function (require, module, exports) {\n        /**\n         * Typpy\n         * Gets the type of the input value or compares it\n         * with a provided type.\n         *\n         * Usage:\n         *\n         * ```js\n         * Typpy({}) // => \"object\"\n         * Typpy(42, Number); // => true\n         * Typpy.get([], \"array\"); => true\n         * ```\n         *\n         * @name Typpy\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Constructor|String} target The target type.\n         * It could be a string (e.g. `\"array\"`) or a\n         * constructor (e.g. `Array`).\n         * @return {String|Boolean} It returns `true` if the\n         * input has the provided type `target` (if was provided),\n         * `false` if the input type does *not* have the provided type\n         * `target` or the stringified type of the input (always lowercase).\n         */\n        function Typpy(input, target) {\n            if (arguments.length === 2) {\n                return Typpy.is(input, target);\n            }\n            return Typpy.get(input, true);\n        }\n\n        /**\n         * Typpy.is\n         * Checks if the input value has a specified type.\n         *\n         * @name Typpy.is\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Constructor|String} target The target type.\n         * It could be a string (e.g. `\"array\"`) or a\n         * constructor (e.g. `Array`).\n         * @return {Boolean} `true`, if the input has the same\n         * type with the target or `false` otherwise.\n         */\n        Typpy.is = function (input, target) {\n            return Typpy.get(input, typeof target === \"string\") === target;\n        };\n\n        /**\n         * Typpy.get\n         * Gets the type of the input value. This is used internally.\n         *\n         * @name Typpy.get\n         * @function\n         * @param {Anything} input The input value.\n         * @param {Boolean} str A flag to indicate if the return value\n         * should be a string or not.\n         * @return {Constructor|String} The input value constructor\n         * (if any) or the stringified type (always lowercase).\n         */\n        Typpy.get = function (input, str) {\n\n            if (typeof input === \"string\") {\n                return str ? \"string\" : String;\n            }\n\n            if (null === input) {\n                return str ? \"null\" : null;\n            }\n\n            if (undefined === input) {\n                return str ? \"undefined\" : undefined;\n            }\n\n            // eslint-disable-next-line no-self-compare\n            if (input !== input) {\n                return str ? \"nan\" : NaN;\n            }\n\n            return str ? input.constructor.name.toLowerCase() : input.constructor;\n        };\n\n        module.exports = Typpy;\n    }, {}], 4: [function (require, module, exports) {\n        /**\n         * Idy\n         * Generates a random id and potentially unique.\n         *\n         * @name Idy\n         * @function\n         * @param {Number} length The id length (default: 10).\n         * @return {String} The generated id.\n         */\n        function Idy(length) {\n            length = length || 10;\n            return Math.random().toString(35).substr(2, length);\n        }\n\n        module.exports = Idy;\n    }, {}], 5: [function (require, module, exports) {\n        /**\n         * IterateObject\n         * Iterates an object. Note the object field order may differ.\n         *\n         * @name IterateObject\n         * @function\n         * @param {Object} obj The input object.\n         * @param {Function} fn A function that will be called with the current value, field name and provided object.\n         * @return {Function} The `IterateObject` function.\n         */\n        function IterateObject(obj, fn) {\n            var i = 0,\n                keys = [];\n\n            if (Array.isArray(obj)) {\n                for (; i < obj.length; ++i) {\n                    if (fn(obj[i], i, obj) === false) {\n                        break;\n                    }\n                }\n            } else {\n                keys = Object.keys(obj);\n                for (; i < keys.length; ++i) {\n                    if (fn(obj[keys[i]], keys[i], obj) === false) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        module.exports = IterateObject;\n    }, {}], 6: [function (require, module, exports) {\n        // Dependencies\n        var Deffy = require(\"deffy\");\n\n        /**\n         * SetOrGet\n         * Sets or gets an object field value.\n         *\n         * @name SetOrGet\n         * @function\n         * @param {Object|Array} input The cache/input object.\n         * @param {String|Number} field The field you want to update/create.\n         * @param {Object|Array} def The default value.\n         * @return {Object|Array} The field value.\n         */\n        function SetOrGet(input, field, def) {\n            return input[field] = Deffy(input[field], def);\n        }\n\n        module.exports = SetOrGet;\n    }, { \"deffy\": 7 }], 7: [function (require, module, exports) {\n        arguments[4][2][0].apply(exports, arguments);\n    }, { \"dup\": 2, \"typpy\": 8 }], 8: [function (require, module, exports) {\n        arguments[4][3][0].apply(exports, arguments);\n    }, { \"dup\": 3 }] }, {}, [1]);","import React from 'react';\nimport LinkNode from './nodes/LinkNode.js'\nimport BodyNode from './nodes/BodyNode.js'\nimport SectionNode from './nodes/SectionNode.js'\nimport { Block } from 'slate'\nimport { getEventTransfer } from 'slate-react';\nimport { deleteNode } from './NodeSwitch.js'\n\nexport default function LinkPlugin(options) {\n    return {\n        commands: {\n            wrapLinkAtSelection(editor, node_id) {\n                return editor.wrapInline({\n                    type: \"link\",\n                    data: { \"node_id\": node_id, \"nodeStyle\": \"Inline\" }\n                });\n            }\n        },\n\n        renderInline(props, editor, next) {\n            if (props.node.type === 'link') {\n                var { ref, id } = getRefAndId(props, editor, \"short\");\n\n                return <LinkNode ref={ref} {...props} linkStyle=\"inline\" sharedState={editor.getSharedState()} nodeId={id}/>\n            }\n\n            return next();\n        },\n\n        renderBlock(props, editor, next) {\n            var refAndId;\n\n            if (props.node.type === 'body') {\n                refAndId = getRefAndId(props, editor, \"long\");\n\n                // set up the placeholder text to only appear when the body is empty and no text is selected\n                var isEmpty = !props.node.text\n\n                var selectNode = () => {\n                    setTimeout(() => {editor.focus(); editor.moveToStartOfNode(props.node);}, 0)\n                }\n\n                return <BodyNode\n                            ref={refAndId.ref}\n                            {...props}\n                            sharedState={editor.getSharedState()}\n                            nodeId={refAndId.id}\n                            isEmpty={isEmpty}\n                            selectNode={selectNode}\n                        />\n\n            } else if (props.node.type === 'link') {\n                refAndId = getRefAndId(props, editor, \"short\");\n\n                return <LinkNode\n                            ref={refAndId.ref}\n                            {...props}\n                            linkStyle=\"heading\"\n                            sharedState={editor.getSharedState()}\n                            nodeId={refAndId.id}\n                        />\n\n            } else if (props.node.type === 'section') {\n                refAndId = getRefAndId(props, editor, \"section\");\n\n                return <SectionNode\n                    ref={refAndId.ref}\n                    {...props}\n                    sharedState={editor.getSharedState()}\n                    nodeId={refAndId.id}\n                />\n            }\n\n            return next();\n        },\n\n        onDrop(event, editor, next) {\n            // suppress drop events\n            // do not call next()\n        },\n\n        onPaste(event, editor, next) {\n            const getLinkInlines = (the_doc) => the_doc.filterDescendants(node => node.type === 'link' && node.object === 'inline')\n\n            var transfer = getEventTransfer(event);\n\n            if (transfer.type === \"fragment\") {\n\n                // if pasting into a link or body, just paste plain text, not a fragment\n                if (editor.value.blocks.some(block => block.type === \"link\" || block.type === \"body\")) {\n                    const textNoNewlines = transfer.fragment.text.replace(/(\\r\\n|\\n|\\r)/gm, \"\")\n                    editor.insertText(textNoNewlines)\n\n                    // NB: no next() call, so this plugin must be the last one in the stack that handles onPaste()\n                    return\n                }\n\n                const fragmentInlines = getLinkInlines(transfer.fragment)\n\n                if (fragmentInlines) {\n                    const docInlines = getLinkInlines(editor.value.document)\n                    const usedIds = []\n                    docInlines.forEach(inline => {usedIds.push({key: inline.key, id: inline.data.get(\"node_id\")})})\n                    \n                    // let the paste happen so we can operate on the document instead of inline\n                    next()\n\n                    // if an inline in the pasted content has the same id as one in the document, unwrap the pasted inline\n                    fragmentInlines.forEach(inline => {\n                        usedIds.forEach(usedId => {\n                            const id = inline.data.get(\"node_id\")\n                            if (usedId.id === id) {\n                                const inlinesWithId = editor.value.document.filterDescendants(node => node.type === 'link' && node.object === 'inline' && node.data.get('node_id') === id)\n                                inlinesWithId.forEach(inlineWithId => {\n                                    if (inlineWithId.key !== usedId.key) {\n                                        editor.unwrapInlineByKey(inlineWithId.key)\n                                    }\n                                })\n                            }\n                        })\n                    })\n                }\n            } else {\n                next()\n            }\n        },\n\n        onChange(editor, next) {\n            // update all node texts (both link and body)\n            const sharedState = editor.getSharedState();\n            [\n                {nodeType: 'link', updateFunc: sharedState.updateGraphShortText.bind(sharedState)},\n                {nodeType: 'body', updateFunc: sharedState.updateGraphLongText.bind(sharedState)}\n            ].forEach( update =>\n                editor.value.blocks.forEach(block => {\n                    const updateText = (linkNode) => {\n                        // if we've just emptied an inline text node, we should delete the node and its link to the graph\n                        // also if we ever have a link node disconnected from the graph, just remove it to restore legal state\n                        const id = linkNode.data.get('node_id')\n                        sharedState.checkRecycleBinForGraphNode(id) // in case there was an undo and redo, we should restore the graph link\n                        if (linkNode.object === 'inline' && (linkNode.text === \"\" || !sharedState.getGraphNode(id))) {\n                            deleteNode(linkNode, editor)\n                        } else {\n                            update.updateFunc(linkNode.data.get(\"node_id\"), linkNode.text)\n                        }\n                    }\n\n                    var linkNodes = block.filterDescendants(node => node.type === update.nodeType)\n                    linkNodes.forEach(updateText)\n\n                    if (block.type === update.nodeType) {\n                        updateText(block)\n                    }\n                })\n            )\n\n            next()\n        },\n\n        onKeyDown(e, editor, next) {\n            const { value } = editor\n            const { document, selection, startBlock} = value\n            const { start, end } = selection\n\n            // if a whole section (block or inline) is deleted, tell the graph node\n            if ((e.key === 'Backspace' || e.key === 'Delete') && selection.isExpanded) {\n                document.getDescendantsAtRange(selection).forEach(node => {\n                    if (node.type === 'section' || node.type === 'link') {\n                        // it's not certain whether the section will be deleted, as it may only be partially selected\n                        // so check in 0 seconds, once the deletion happens, whether that's the case\n                        setTimeout(() => {\n                            editor.getSharedState().updateIsOnGraphStatus(node.data.get('node_id'))\n                        }, 0)\n                    }\n                })\n            }\n\n            // prevent delete key from merging body and link blocks with next\n            if (e.key === \"Delete\") {\n                if (startBlock && value.selection.isCollapsed && value.selection.end.isAtEndOfNode(startBlock)) {\n                    const nextBlock = document.getNextBlock(start.key)\n                    if (nextBlock && (nextBlock.type === \"body\" || nextBlock.type === \"link\" || nextBlock.type === \"section\")) {\n                        editor.moveToStartOfNode(nextBlock);\n                        if (startBlock.text === \"\") {\n                            editor.removeNodeByKey(startBlock.key)\n                        }\n                        return\n                    }\n                }\n            }\n\n            // prevent backspace from merging body and link blocks with previous\n            if (e.key === 'Backspace') {\n                const prevBlock = document.getPreviousBlock(start.key)\n                if (startBlock && selection.isCollapsed && start.offset === 0 && prevBlock && (startBlock.type === \"body\" || startBlock.type === \"link\")) {\n                    if (prevBlock) {\n                        editor.moveToEndOfNode(prevBlock);\n                        if (startBlock.text === \"\") {\n                            editor.removeNodeByKey(startBlock.key)\n                        } else if (prevBlock.text === \"\") {\n                            editor.removeNodeByKey(prevBlock.key)\n                         }\n                    }\n                    return editor\n                }\n            }\n\n            if (e.key === 'Enter') {\n                if (value.inlines.some(inline => inline.type === 'link')) {\n                    return // do nothing to avoid splitting the link\n                }\n\n                // when enter is pressed inside a link *block* (not inline), just go to body\n                if (startBlock && startBlock.type === \"link\" && start.key === end.key) {\n                    // unless the offset is 0, in which case insert a block before and go to that\n                    if (start.offset === 0) {\n                        const blockToInsert = Block.create({object: 'block', type: ''})\n                        const section = document.getParent(startBlock.key);\n                        const sectionParent = document.getParent(section.key);                    \n                        const sectionIndex = sectionParent.nodes.indexOf(section);\n\n                        editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\n                        return editor.moveBackward(1)\n                    } else {\n                        const nextBlock = document.getNextBlock(start.key)\n                        if (nextBlock) {\n                            return editor.moveToStartOfNode(nextBlock);\n                        } else {\n                            return editor.moveToEndOfNode(startBlock);\n                        }\n                    }\n                }\n            }\n            \n            // prevent the cursor disappearing when navigating into the body placeholder text\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\n                const relevantBlock = e.key === 'ArrowDown' ? document.getNextBlock(start.key) : document.getPreviousBlock(start.key)\n                const ESTIMATED_CHARS_PER_LINE = 130 // calibrated on a 1920x1080 screen... :/\n                // we only need to handle the case where the cursor offset is < the length of the placeholder\n                if (relevantBlock && relevantBlock.type === 'body' && start.offset < 'Type some text... '.length) {\n                    // if down arrow was pressed, only jump to the body if there is only one line of text in the block\n                    // its hard to work out how many lines of text there so use an estimate\n                    if (e.key === 'ArrowUp' || startBlock.text.length < ESTIMATED_CHARS_PER_LINE) {\n                        editor.moveToEndOfNode(relevantBlock)\n                        e.preventDefault()\n                        return\n                    }\n                }\n            }\n\n            // prevent tab from taking focus from the editor\n            if (e.key === 'Tab') {\n                e.preventDefault()\n            }\n\n            return next()\n        }\n    }\n\n    function getRefAndId(props, editor, long_or_short) {\n        var id = props.node.data.get(\"node_id\");\n        editor.getSharedState().setLinkMapping(id, props.node, long_or_short);\n        var ref = React.createRef();\n        editor.getSharedState().registerLinkNode(id, ref, long_or_short);\n        return { ref, id };\n    }\n}","import React from 'react';\nimport PlainBlockNode from './nodes/PlainBlockNode.js'\n\nexport default function ReorderPlugin(options) {\n    return {\n        renderBlock(props, editor, next) {            \n            if (!props.node.type || props.node.type === '' || props.node.type === 'paragraph') {\n                return <PlainBlockNode {...props}/>\n            }\n            \n            return next();\n        },\n    }\n}","import React from 'react';\n\nexport default function WordCountPlugin(options) {\n    return {\n        renderEditor(props, editor, next) {\n            const wordCount = countWords(props.editor.value.document)\n            const children = next()\n\n            return (\n                <React.Fragment>\n                    {children}\n                    <span className=\"word-count\">{wordCount + \" words\"}</span>\n                </React.Fragment>\n            )\n        }\n    }\n}\n\nfunction countWords(document) {\n    if (!document) {\n        return 0\n    }\n\n    // count words per block because document.text does not preserve newlines so undercounts\n    var count = 0\n    document.getBlocks().forEach(block => {\n        // skip hidden body/link elements\n        if (block.type === 'link' || block.type === 'body') {\n            const parent = document.getParent(block.key)\n            if (parent && parent.type === 'section') {\n                if ((parent.data.get('nodeStyle') === 'Heading only' && block.type === 'body') ||\n                    (parent.data.get('nodeStyle') === 'Body only' && block.type === 'link')) {\n                    return\n                }\n            }\n        }        \n\n        const words = block.text.match(/\\S+/g)  // split into non-whitespace substrings\n        if (words) {\n            count += words.length\n        }\n    })\n\n    return count.toString()\n}","import React, { Component } from 'react';\nimport './DocPane.css';\nimport DocEditor from './DocEditor.js'\n\nclass DocPane extends Component {\n    render() {\n        return (\n            <div className=\"pane doc\">\n                <DocEditor sharedState={this.props.sharedState} />\n            </div>\n        );\n    }\n}\n\nexport default DocPane;","import OptionPopup from './OptionPopup.js'\nimport { toast } from 'react-toastify';\n\nconst COMPLETED_ARROW_COLOUR = \"#5D4037\";\nconst POTENTIAL_ARROW_COLOUR = \"#d4b8b0\";\nconst DRAWING_ARROW_COLOUR = \"#719deb\";\n\nconst ADD_ARROW_TYPE_MENU_ITEM = 'Add arrow type'\n\nconst COLOURS = [\n    'red',\n    'goldenrod',\n    'green',\n    'aqua',\n    'blue',\n    'fuchsia',\n    'purple',\n    'saddlebrown'\n]\n\nvar DEFAULT_ARROW_OPTIONS = [\n    {'colour': 'green', 'name': 'Supports', 'symbol': \"\"},\n    {'colour': 'red', 'name': 'Opposes', 'symbol': \"\"},\n    {'colour': 'blue', 'name': 'Expands', 'symbol': \"\"},\n];\n\nexport default class MouseFollower {\n    constructor(shared_state, svg, connectables_container, markers, links) {\n        this.shared_state = shared_state;\n        this.drawing_arrow_from = false;\n        this.connector = undefined;\n        this.connectables_container = connectables_container;\n        this.markers = markers;\n        this.links = links;\n\n        this.connector_objs = {}\n        this.temp_arrows = {}\n\n        this.arrow_id_counter = 0\n\n        this.completed_arrows = []\n\n        this.mouse_rect = svg.group();\n        window.addEventListener('mousemove', e => {\n            var point = svg.point(e.clientX, e.clientY);\n            this.mouse_rect.move(point.x, point.y);\n            \n            if (typeof(this.connector) !== 'undefined') {\n                this.connector.update();\n            }\n        });\n\n        // cancel arrows if they don't end on a node\n        window.addEventListener('mouseup', (e) => {\n            if (this.drawing_arrow_from) {\n                e.preventDefault();\n                this.stop_drawing_arrow();\n            }\n        });\n    }\n\n    toJSON() {\n        return {\n            arrows: this.completed_arrows,\n            arrow_id_counter: this.arrow_id_counter,\n            arrowOptions: this.arrowOptions,\n        }\n    }\n\n    static fromJSON(json, shared_state, svg, connectables_container, markers, links) {\n        var mf = new MouseFollower(shared_state, svg, connectables_container, markers, links)\n        mf.arrow_id_counter = json && json.arrow_id_counter ? json.arrow_id_counter : 0\n        mf.completed_arrows = json && json.arrows ? json.arrows : []\n        mf.arrowOptions = json && json.arrowOptions ? json.arrowOptions : DEFAULT_ARROW_OPTIONS\n\n        return mf\n    }\n\n    // draw all the arrows in this.completed_arrows\n    // needs to happen separately from loading because when the mouse_follower is first created, the nodes have not yet been loaded\n    draw_loaded_arrows(get_node) {\n        this.completed_arrows.forEach(arrow => {\n            const originNode = get_node(arrow.origin)\n            const destinationNode = get_node(arrow.destination)\n\n            if (!originNode) {\n                toast.error(\"Error: could not draw arrow from origin \" + arrow.origin)\n                return\n            }\n\n            if (!destinationNode) {\n                toast.error(\"Error: could not draw arrow to destination \" + arrow.destination)\n                return\n            }\n\n            const connector = this.draw_arrow(\n                originNode,\n                destinationNode,\n                arrow.colour\n            )\n            this.add_context_menu_to_arrow(connector, arrow)\n            this.connector_objs[arrow.origin + \"->\" + arrow.destination] = connector\n            \n            // update the arrow start and end points\n            originNode.group.node.dispatchEvent(new CustomEvent(\"dragmove\"))\n        })\n    }\n\n    update_source(new_source) {\n        if (typeof(this.connector) === 'undefined') {\n            this.connector = new_source.connectable({\n                container: this.connectables_container,\n                markers: this.markers\n            }, this.mouse_rect);\n        } else {\n            this.connector.marker.show();\n            this.connector.line.show();\n\n            this.connector.target = this.mouse_rect;\n            this.connector.source = new_source;\n            this.connector.update();\n        }\n        if (this.connector) {\n            this.connector.setLineColor(POTENTIAL_ARROW_COLOUR);\n        }\n    }\n\n    hide() {\n        if (typeof(this.connector) !== 'undefined') {\n            this.connector.target = this.connector.source;\n            this.connector.marker.hide();\n            this.connector.line.hide();\n        }\n    }\n\n    start_arrow(source_node) {\n        this.drawing_arrow_from = source_node;\n        if (this.connector) {\n            this.connector.setLineColor(DRAWING_ARROW_COLOUR);\n        }\n    }\n\n    draw_arrow(origin, destination, colour) {\n        var connector = origin.group.connectable({\n            container: this.links,\n            markers: this.markers,\n            specialCoords: true\n        }, destination.group);\n        connector.setLineColor(colour);\n\n        connector.source.on(\"deletenode\", () => {\n            connector.source.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector)\n        });\n        connector.target.on(\"deletenode\", () => {\n            connector.target.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector)\n        });\n\n        return connector\n    }\n\n    add_context_menu_to_arrow(connector, arrowObject) {\n        const show_context_menu = e => {\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\n            this.edit_connector_type(connector, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (new_colour) => {\n                arrowObject.colour = new_colour\n            }, arrowObject);\n            e.preventDefault();\n        };\n        connector.line.on(\"click\", show_context_menu);\n        connector.line.on(\"contextmenu\", show_context_menu);\n\n        connector.source.on(\"deletenode\", () => {\n            connector.source.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector, arrowObject)\n        });\n        connector.target.on(\"deletenode\", () => {\n            connector.target.node.instance.delete_connectable(connector)\n            this.remove_arrow(connector, arrowObject)\n        });\n\n        // detect if the user changes the colour of this arrow\n        window.addEventListener('colourchange', (e) => {\n            if (e.detail.oldColour === arrowObject.colour) {\n                connector.setLineColor(e.detail.newColour)\n                arrowObject.colour = e.detail.newColour\n            }\n        })\n\n        // detect if all arrows of this colour were deleted\n        window.addEventListener('arrowdelete', (e) => {\n            if (e.detail.colour === arrowObject.colour) {\n                this.remove_arrow(connector, arrowObject)\n            }\n        })\n    }\n\n    complete_arrow(end_node) {\n        // no arrows to self\n        if (end_node === this.drawing_arrow_from) {\n            this.stop_drawing_arrow();\n            return;\n        }\n\n        var connector = this.draw_arrow(this.drawing_arrow_from, end_node, COMPLETED_ARROW_COLOUR)\n\n        var c1 = this.drawing_arrow_from.group.getScreenCoords('centre')\n        var c2 = end_node.group.getScreenCoords('centre')\n        var midpoint = {x: (c1.x + c2.x) / 2, y: (c1.y + c2.y) / 2}\n\n        // only add the arrow to the list of completed arrows once a colour is selected\n        // to prevent weird states being saved and loaded\n        const drawing_arrow_from_id = this.drawing_arrow_from.id\n        const colourWasSelected = (colour) => {\n            const id = this.getNewId()\n            const arrowObject = {\n                id: id,\n                origin: drawing_arrow_from_id,\n                destination: end_node.id,\n                colour: colour,\n            }\n            this.completed_arrows.push(arrowObject)\n\n            this.add_context_menu_to_arrow(connector, arrowObject)\n        }\n\n        this.edit_connector_type(connector, midpoint.x, midpoint.y, false, colourWasSelected);\n\n        this.shared_state.logger.logEvent({'type': 'arrow_create', 'id': connector.id, 'source': this.drawing_arrow_from.id, 'target': end_node.id});\n        this.stop_drawing_arrow();\n    }\n\n    getArrowByID(id) {\n        return this.completed_arrows.find(arrow => arrow.id === id)\n    }\n\n    getConnectorObjectConnecting(source, dest) {\n        // if there are multiple, this will just return the first\n        return this.connector_objs[source + \"->\" + dest]\n    }\n\n    addTempArrow(source, dest, colour, temp_id) {\n        const source_node = this.shared_state.graphPane.getNodeById(source)\n        const dest_node = this.shared_state.graphPane.getNodeById(dest)\n        if (!source_node || !dest_node) {\n            return\n        }\n        this.connector_objs[source + '->' + dest] = this.draw_arrow(source_node, dest_node, colour)\n        this.temp_arrows[temp_id] = source + '->' + dest\n    }\n\n    getNewId() {\n        this.arrow_id_counter++\n        return this.arrow_id_counter\n    }\n\n    changeArrowColour(entry, direction) {\n        const oldColour = entry.colour\n        var newColour = this.getNextAvailableColour(entry, direction)\n        if (!newColour) {\n            return\n        }\n        entry.colour = newColour\n\n        window.dispatchEvent(new CustomEvent('colourchange', {\n            detail: {\n                oldColour: oldColour,\n                newColour: newColour,\n            }\n        }))\n\n        this.shared_state.logger.logEvent({'type': 'update_arrow_colour', 'newColour': newColour});\n\n        return newColour\n    }\n\n    getNextAvailableColour(entry, direction) {\n        // find all the colours which are not used by arrowOptions other than this one\n        const availableColours = COLOURS.filter(colour => \n            !this.arrowOptions.find(option => option.colour === colour && option !== entry)\n        )\n\n        if (!availableColours) {\n            return undefined\n        } else {\n            const thisColourIndex = entry ? availableColours.indexOf(entry.colour) : 0\n            if (thisColourIndex !== -1) {\n                var nextIndex = (thisColourIndex + 1 * direction) % availableColours.length\n                if (nextIndex < 0) {\n                    nextIndex = availableColours.length - 1\n                }\n                return availableColours[nextIndex]\n            }\n        }\n    }\n\n    getArrowOptions() {\n        const clickEditButton = (e, params) => {\n            const MAX_ARROW_TYPE_NAME_LENGTH = 50 // chars\n\n            var { colourCell, nameCell, buttonCell, underlyingEntry, transientEntry } = params\n\n            transientEntry.isClickable = false\n\n            var editButton = buttonCell.children[0]\n\n            const updateName = () => {\n                var newValue = input.value\n                if (newValue.length >= MAX_ARROW_TYPE_NAME_LENGTH) {\n                    newValue = newValue.substring(0, MAX_ARROW_TYPE_NAME_LENGTH)\n                }\n                if (newValue) {\n                    underlyingEntry.name = newValue\n                }\n\n                return newValue\n            }\n\n            const finishEditing = () => {\n                var newValue = updateName()\n                if (newValue) {\n                    nameCell.textContent = newValue\n                }\n\n                transientEntry.isClickable = true\n\n                colourCell.textContent = colourButton.textContent\n                colourCell.style.color = colourButton.style.color\n                \n                editButton.classList.remove('pure-button-active')\n                editButton.onclick = (e) => clickEditButton(e, params)\n            }\n\n            editButton.classList.add('pure-button-active')\n            editButton.onclick = finishEditing\n\n            var input = document.createElement(\"input\")\n            \n            input.style.width = (nameCell.getBoundingClientRect().width - 5).toString() + \"px\"\n            input.value = nameCell.textContent\n            input.addEventListener('keyup', (e) => {\n                if (e.key === 'Enter' && input.value) {\n                    finishEditing()\n                }\n            })\n            input.addEventListener('change', updateName)\n\n            nameCell.textContent = \"\"\n            nameCell.appendChild(input)\n\n            var colourButton = document.createElement(\"button\")\n            colourButton.className = 'pure-button'\n            colourButton.textContent = colourCell.textContent\n            colourCell.textContent = \"\"\n            colourCell.appendChild(colourButton)\n            colourButton.style.color = colourCell.style.color\n            colourButton.style.padding = 0\n            colourButton.addEventListener(\"click\", () => {\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, 1)\n                transientEntry.colour = underlyingEntry.colour\n            })\n            colourButton.addEventListener(\"contextmenu\", (e) => {\n                colourButton.style.color = this.changeArrowColour(underlyingEntry, -1)  // on right click, scroll backwards through the colours\n                transientEntry.colour = underlyingEntry.colour\n                e.preventDefault()\n            })\n\n            input.focus()\n        }\n\n        const clickDeleteArrowTypeButton = (e, params) => {\n            var { row, underlyingEntries, underlyingEntry, transientEntry, selected, hidePopup } = params\n            transientEntry.isClickable = false\n            \n            if (window.confirm('Are you sure you want to delete all \"' + underlyingEntry.name + '\" arrows? This cannot be undone.')) {\n                // remove from underlyingEntries\n                var index = underlyingEntries.indexOf(underlyingEntry)\n                if (index !== -1) {\n                    underlyingEntries.splice(index, 1)\n                }\n\n                // remove row after 0 delay to prevent this click event being registered as a click outside the option popup\n                setTimeout(() => row.parentNode.removeChild(row), 0)\n\n                // tell all arrows of this colour to delete themselves\n                window.dispatchEvent(new CustomEvent('arrowdelete', {\n                    detail: {\n                        colour: underlyingEntry.colour,\n                    }\n                }))\n\n                this.shared_state.logger.logEvent({'type': 'delete_arrow_type', 'colour': underlyingEntry.colour})\n\n                // if the selected arrow type was deleted, hide the optionpopup\n                if (selected) {\n                    hidePopup()\n                }\n            }\n\n            transientEntry.isClickable = true\n        }\n\n        const arrowOptionsWithButtons = this.arrowOptions.map(entry => {\n            var entryWithButtons = {...entry}\n            entryWithButtons.buttons = [\n                {\n                    className: 'edit-icon',\n                    click: clickEditButton,\n                    underlyingEntry: entry,\n                },\n                {\n                    className: 'delete-icon',\n                    click: clickDeleteArrowTypeButton,\n                    underlyingEntry: entry,\n                    underlyingEntries: this.arrowOptions,\n                }\n            ]\n            return entryWithButtons\n        })\n        \n        return [\n            ...arrowOptionsWithButtons,\n            {'colour': 'black', 'name': ADD_ARROW_TYPE_MENU_ITEM, 'symbol': '+'},\n            {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\n        ]\n    }\n\n    edit_connector_type(connector, popup_x, popup_y, hideOnClickOutside, onColourSelected, arrowObject) {\n        var prev_selected = undefined;\n        \n        const arrowOptions = this.getArrowOptions()\n\n        prev_selected = arrowOptions.find(entry => entry.colour === connector.line.attr('stroke') && entry.name !== 'Delete' && entry.name !== ADD_ARROW_TYPE_MENU_ITEM)\n        prev_selected = prev_selected ? prev_selected.name : undefined\n\n        const setArrowColour = (selected_option) => {\n            connector.setLineColor(selected_option.colour);\n            this.shared_state.logger.logEvent({'type': 'arrow_set_type', 'id': connector.id, 'new_type': selected_option.name});\n\n            if (onColourSelected) {\n                onColourSelected(selected_option.colour)\n            }\n        }\n\n        new OptionPopup(arrowOptions, popup_x, popup_y, hideOnClickOutside, (selected_option) => {\n            if (selected_option.name === \"Delete\") {\n                this.shared_state.logger.logEvent({'type': 'arrow_delete', 'id': connector.id});\n                this.remove_arrow(connector, arrowObject);\n            } else if (selected_option.name === ADD_ARROW_TYPE_MENU_ITEM) {\n                const colour = this.getNextAvailableColour(null, 1)\n\n                if (!colour) {\n                    toast.error(\"Maximum number of arrow types reached!\")\n                } else {\n                    const newRelation = {\n                        'name': 'New relation',\n                        'colour': colour,\n                        'symbol': \"\",\n                    }\n                    this.arrowOptions.push(newRelation)\n                    this.shared_state.logger.logEvent({'type': 'add_arrow_type', 'colour': colour});\n\n                    if (!prev_selected) {\n                        setArrowColour(newRelation)\n                    }\n\n                    // open a new option popup to allow the user to select the new arrow type and edit it\n                    this.edit_connector_type(connector, popup_x, popup_y, true, onColourSelected, arrowObject)\n                }\n            } else {\n                setArrowColour(selected_option)\n            }\n        }, prev_selected);\n    }\n\n    remove_arrow(connector, arrowObject) {\n        if (connector && connector.line) {\n            connector.line.node.instance.delete_connectable(connector);\n        }\n\n        if (arrowObject) {\n            this.completed_arrows = this.completed_arrows.filter(arrow => arrow !== arrowObject)        \n        }\n    }\n\n    stop_drawing_arrow() {\n        this.drawing_arrow_from = false;\n        this.hide();\n    }\n}","import OptionPopup from \"./OptionPopup\";\n\nvar ARROW_HITBOX_MARGIN = 20;\n\nclass GraphNode {\n    constructor(params, nodes, mouse_follower, shared_state, focus_text_area, getNodesList, zoomCanvasTo) {\n        var { shortText, x, y, width, height, id, isOnGraph, longText, annotatedOrder } = params\n        this.id = id ? id : shared_state.getNodeId();\n\n        this.getNodesList = getNodesList\n        this.zoomCanvasTo = zoomCanvasTo\n        \n        this.group = nodes.group().translate(x, y);\n\n        this.dropShadow = this.group.rect(width, height).radius(5).addClass('node-drop-shadow')\n        this.arrow_hitbox = this.group.rect(width + 2 * ARROW_HITBOX_MARGIN, height + 2 * ARROW_HITBOX_MARGIN)\n            .translate(-ARROW_HITBOX_MARGIN, -ARROW_HITBOX_MARGIN).opacity(0).radius(10).addClass('arrow-hitbox');\n        \n        this.rect = this.group.rect(width, height).radius(5).addClass('node');\n        this.editRect = this.group.rect(width - 10, height - 10).radius(5).translate(5, 5).addClass('editing-node-rect')\n        this.text = this.group.text(\"\").addClass('node-text');\n        this.updateShortText(shortText)\n        this.updateLongText(longText)\n\n        this.setupRectDragging(this.rect, shared_state);\n        this.setupArrowHitbox(this.arrow_hitbox, mouse_follower);\n        const complete_arrow = (e) => {\n            if (mouse_follower.drawing_arrow_from) {\n                mouse_follower.complete_arrow(this);\n            }\n        };\n        this.arrow_hitbox.on('mouseup', complete_arrow);\n        this.rect.on('mouseup', complete_arrow);\n        this.text.on('mouseup', complete_arrow);\n\n        this.setupHover(shared_state);\n        this.setupContextMenu(shared_state);\n\n        if (focus_text_area) {\n            this.editText(shared_state, !params.doNotDeleteIfEmptyText);\n        }\n        \n        this.setIsOnGraph(isOnGraph);\n\n        this.annotatedOrder = annotatedOrder\n        this.showAnnotatedOrder()\n\n        // don't log add node events if they are just loaded from a save\n        if (!params.isFromJSON) {\n            shared_state.logger.logEvent({'type': 'node_create', 'id': this.id});\n        }\n    }\n\n    static fromJSON(json, nodes, mouse_follower, shared_state, getNodesList, zoomCanvasTo) {\n        var params = json\n        params.x = json.screenCoords.x\n        params.y = json.screenCoords.y\n        params.width = 200\n        params.height = 42\n        params.isFromJSON = true\n        return new GraphNode(params, nodes, mouse_follower, shared_state, false, getNodesList, zoomCanvasTo)\n    }\n\n    toJSON() {\n        return {\n            id: this.id,\n            shortText: this.shortText,\n            longText: this.longText,\n            screenCoords: this.group.getScreenCoords(),\n            isOnGraph: this.isOnGraph,\n            annotatedOrder: this.annotatedOrder,\n        }\n    }\n\n    setIsOnGraph(newVal) {\n        this.isOnGraph = newVal;\n        if (this.isOnGraph) {\n            this.rect.addClass(\"node-on-graph\");\n        } else {\n            this.rect.removeClass(\"node-on-graph\");\n        }\n    }\n\n    setupContextMenu(shared_state) {\n        var showOptionMenu = e => {\n            e.preventDefault();\n            \n            var entries = [\n                {'colour': 'red', 'name': 'Delete', 'symbol': \"\"}\n            ]\n            var graph_pos = document.getElementById(\"graph\").getBoundingClientRect();\n            new OptionPopup(entries, e.clientX - graph_pos.left, e.clientY - graph_pos.top, true, (selected_option) => {\n                if (selected_option.name === \"Delete\") {\n                    this.delete(shared_state);\n                }\n            });\n            \n            return false;\n        };\n        this.rect.on('contextmenu', showOptionMenu);\n        this.text.on('contextmenu', showOptionMenu);\n    }\n\n    setupHover(shared_state) {\n        this.hoverers = []\n\n        const startHover = (e) => {\n            this.setHoverer(\"mouse_\" + e.target, true);\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\n                if (!ref) {\n                    return\n                }\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(true) : ref.setExternalHover(true);\n            });\n        };\n        const endHover = (e) => {\n            this.setHoverer(\"mouse_\" + e.target, false);\n            shared_state.getAllDocNodeRefs(this.id).forEach(ref => {\n                if (!ref) {\n                    return\n                }\n                ref.decoratedRef ? ref.decoratedRef.current.decoratedRef.current.setExternalHover(false) : ref.setExternalHover(false);\n            });\n        };\n        this.rect.on('mouseenter', startHover);\n        this.text.on('mouseenter', startHover);\n        this.rect.on('mouseleave', endHover);\n        this.text.on('mouseleave', endHover);\n    }\n\n    setHoverer(hoverer, isHovering) {\n        if (isHovering) {\n            if (!this.hoverers.includes(hoverer)) {\n                this.hoverers.push(hoverer)\n            }\n        } else {\n            // remove the hoverer\n            var index = this.hoverers.indexOf(hoverer);\n            if (index !== -1) this.hoverers.splice(index, 1);\n        }\n\n        this.setHovered(this.hoverers.length > 0)\n    }\n\n    setHovered(isHovered) {        \n        if (isHovered) {\n            this.rect.addClass(\"hovered\");\n        } else {\n            this.rect.removeClass(\"hovered\");\n        }\n    }\n\n    // the hitbox for arrows is an invisible rect a bit bigger than the visible node rect\n    // but we only want to make the node itself draggable\n    // so we need to intercept drag events on the rect, and move the entire group instead!\n    setupRectDragging(rect, shared_state) {\n        this.setupGroupDragging(rect, shared_state, rect);\n        this.setupGroupDragging(this.text, shared_state, rect, true);\n        \n        this.text.click((e) => e.preventDefault());\n        var edit_text_if_not_just_dropped = () => { if (!rect.just_dropped) this.editText(shared_state) };\n        rect.click(edit_text_if_not_just_dropped);\n        this.text.click(edit_text_if_not_just_dropped);\n    }\n\n    setupGroupDragging(rect, shared_state, just_dropped_obj, center=false) {\n        rect.draggy(); // setup dragging on the rect\n        rect.on('mousedown', (e) => {\n            e.stopPropagation(); // don't pan when moving a node\n        });\n        just_dropped_obj.just_dropped = false;\n        rect.on('dragstart', (e) => {\n            var start_x = this.group.x();\n            var start_y = this.group.y();\n            document.activeElement.blur();\n            shared_state.draggedNode = {\n                id: this.id,\n                text: this.getShortText(),\n                longText: this.getLongText(),\n                resetPos: () => {\n                    this.group.move(start_x, start_y);\n                    this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n                },\n                node: this\n            };\n\n            this.dropShadow.translate(5, 5)\n            this.dropShadow.addClass('visible')\n            \n            rect.off('dragmove');\n            rect.on('dragmove', (e) => {\n                this.group.move(start_x + e.detail.delta.movedX, start_y + e.detail.delta.movedY);\n                if (center) {\n                    this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\n                } else {\n                    rect.x(0);\n                    rect.y(0);\n                }\n                this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n            });\n            rect.off('dragend');\n            rect.on('dragend', (e) => {\n                // prevent the textarea showing\n                // unless the drag amount was zero or just a tiny accidental drag\n                var x_diff = (this.group.x() - start_x);\n                var y_diff = (this.group.y() - start_y);\n                var nudge = 10;\n                if (x_diff > nudge || x_diff < -nudge || y_diff > nudge || y_diff < -nudge) {\n                    just_dropped_obj.just_dropped = true;\n                    setTimeout(() => { just_dropped_obj.just_dropped = false; }, 0.05);\n                }\n                shared_state.draggedNode = false;\n\n                this.dropShadow.translate(0, 0)\n                this.dropShadow.removeClass('visible')\n            });\n        });\n    }\n\n    // click/drag events on the arrow hitbox should start the arrow creation process\n    setupArrowHitbox(arrow_hitbox, mouse_follower) {\n        arrow_hitbox.on('mousemove', () => {\n            if (!mouse_follower.drawing_arrow_from) {\n                mouse_follower.update_source(this.group);\n            }\n        });\n        arrow_hitbox.on('mouseleave', () => {\n            if (!mouse_follower.drawing_arrow_from) {\n                mouse_follower.hide();\n            }\n        });\n        arrow_hitbox.on('mousedown', (e) => {\n            mouse_follower.start_arrow(this);\n            e.stopPropagation(); // don't pan when dragging an arrow\n        });\n    }\n\n    updateShortText(newShortText) {\n        this.shortText = newShortText.replace(/[\\r\\n\\v]+/g, '');\n        \n        const CHARS_PER_LINE = 21;\n        var formattedText = this.splitIntoLines(CHARS_PER_LINE, this.shortText);\n\n        this.text.text(formattedText.join(\"\\n\"));\n        this.resizeRect(formattedText.length);\n    }\n\n    updateLongText(newLongText) {\n        this.longText = newLongText;\n    }\n\n    splitIntoLines(charsPerLine, text) {\n        var formattedText = [];\n        var line = \"\";\n        text.split(\" \").forEach(word => {\n            var segments = [];\n            if (word.length > charsPerLine) {\n                for (let i = 0; i < word.length; i += charsPerLine - 1) {\n                    if (segments.length > 0) {\n                        segments[segments.length - 1] += \"-\"; // append a '-' onto the end of unfinished strings\n                    }\n                    segments.push(word.substring(i, Math.min(i + charsPerLine, word.length)));\n                }\n            }\n            else {\n                segments = [word];\n            }\n            segments.forEach(segment => {\n                if ((line + segment).length < charsPerLine) {\n                    var space = line.length > 0 ? \" \" : \"\";\n                    line += space + segment;\n                }\n                else {\n                    formattedText.push(line);\n                    line = segment;\n                }\n            });\n        });\n        formattedText.push(line);\n        return formattedText;\n    }\n\n    // resize the rect so that the text fits on it\n    resizeRect(numLinesOfText) {\n        this.rect.width(200);\n        const rectHeight = numLinesOfText * 21 + 20\n        this.rect.height(rectHeight);\n        this.text.center(0.5 * this.rect.width(), 0.5 * this.rect.height());\n        this.dropShadow.height(rectHeight)\n        this.editRect.height(rectHeight - 10)\n\n        this.arrow_hitbox.size(this.rect.width() + ARROW_HITBOX_MARGIN * 2, this.rect.height() + ARROW_HITBOX_MARGIN * 2);\n\n        this.group.node.dispatchEvent(new CustomEvent(\"dragmove\")); // update any connectables looking for drag events\n    }\n\n    getShortText() {\n        return this.shortText;\n    }\n\n    getLongText() {\n        return this.longText;\n    }\n\n    showAnnotatedOrder() {\n        if (this.annotatedOrder) {\n            this.annotatedOrderText = this.group.text(this.annotatedOrder.toString())\n        }\n    }\n\n    editText(shared_state, delete_if_empty_text = false) {\n        document.activeElement.blur(); // remove focus from everything\n\n        if (shared_state.orderAnnotate) {\n            if (this.annotatedOrder) {\n                shared_state.annotatedNumbers = shared_state.annotatedNumbers.filter(num => num !== this.annotatedOrder)\n                this.annotatedOrder = undefined\n                this.annotatedOrderText.remove()\n            } else {\n                const num = shared_state.getNextAnnotateNum()\n                this.annotatedOrder = num\n                shared_state.annotatedNumbers.push(num)\n                this.showAnnotatedOrder()\n            }\n            return\n        }\n\n        this.zoomCanvasTo(1, {x: this.group.cx(), y: this.group.cy()}, () => {\n            var textarea = document.querySelector('#nodeedit');\n            textarea.value = this.getShortText();\n\n            const preEditText = this.getShortText()\n\n            var screen_coords = this.rect.getScreenCoords();\n            textarea.style.left = screen_coords.x + \"px\";\n            textarea.style.top = screen_coords.y + \"px\";\n            textarea.style.display = \"inline-block\";\n            textarea.focus();\n\n            textarea.style.width = \"180px\";\n            textarea.style.height = 'auto';\n            textarea.style.height = (textarea.scrollHeight) + 'px';\n\n            this.text.hide();\n\n            this.editRect.addClass('visible')\n            this.setHoverer('editNodeDirectly', true)\n\n            var save_changes = () => {\n                this.updateShortText(textarea.value);\n                shared_state.updateDocShortText(this.id, this.getShortText());\n            };\n            var save_and_hide = () => {\n                save_changes();\n                textarea.style.display = \"none\";\n                if (delete_if_empty_text && (!this.text.text() || this.text.text() === \"\")) {\n                    this.delete(shared_state);\n                }\n                this.text.show();\n                this.updateShortText(this.shortText);\n\n                if (this.getShortText() !== preEditText) {\n                    shared_state.logger.logEvent({'type': 'node_edit_short_text', 'id': this.id, 'text': this.shortText});\n                }\n\n                this.editRect.removeClass('visible')\n                this.setHoverer('editNodeDirectly', false)\n            };\n            textarea.onblur = save_and_hide;\n            textarea.onkeyup = (e) => {\n                if (e.key === \"Escape\" || e.key === \"Esc\" || e.key === \"Enter\") {\n                    e.preventDefault();\n                    document.activeElement.blur();\n                } else {\n                    save_changes();\n                }\n            };\n        })\n    }\n\n    delete(shared_state) {\n        shared_state.removeGraphNode(this.id);\n        \n        // remove from the list of nodes (used for saving)\n        const nodesList = this.getNodesList()\n        var index = nodesList.indexOf(this);\n        if (index !== -1) {\n            nodesList.splice(index, 1)\n        } else {\n            console.log('node not found in this.nodesList when deleting');\n        }        \n\n        this.group.remove();\n\n        // delete arrows\n        this.group.node.dispatchEvent(new CustomEvent(\"deletenode\"));\n\n        shared_state.logger.logEvent({'type': 'node_delete', 'id': this.id});\n    }\n}\n\nexport default GraphNode;","import { DropTarget } from \"react-dnd\";\nimport { ItemTypes } from \"../../dragtypes\";\n\nconst graphTarget = {\n    canDrop(props, monitor) {\n        const item = monitor.getItem()\n        return item.node.type !== 'section' && !item.node.findDescendant(node => node.type === 'link')\n    },\n\n    drop(props, monitor, component) {\n        return { droppedOnGraph: true, position: monitor.getClientOffset() }\n    },\n}\n\nfunction collect(connect, monitor) {\n    return {\n        // Call this function inside render()\n        // to let React DnD handle the drag events:\n        connectDropTarget: connect.dropTarget(),\n        // You can ask the monitor about the current drag state:\n        itemType: monitor.getItemType(),\n    }\n}\n\nexport default DropTarget(ItemTypes.BLOCK, graphTarget, collect)","import React from 'react';\nimport './GraphPane.css';\nimport SVG from 'svg.js';\nimport 'svg.panzoom.js';\nimport 'svg.draggy.js';\nimport './svg.connectable.js';\nimport MouseFollower from './MouseFollower.js';\nimport GraphNode from './GraphNode.js';\nimport DropifyGraphPane from './DropifyGraphPane.js'\nimport { toast } from 'react-toastify';\n\nclass GraphPane extends React.Component {\n    componentDidMount() {\n        this.props.sharedState.getSavedGraph((json) => {\n            this.nodesList = [];\n\n            this.props.sharedState.graphPane = this;\n\n            this.$el = document.querySelector(\"#graph\")\n\n            var svg = new SVG(this.$el).size(\"100%\", \"100%\").panZoom({ zoomMin: 0.2, zoomMax: 1, zoomFactor: 0.1 }); // just pan, no zoom\n            this.svg = svg\n            this.zoomCanvasTo = (level, pos, cb) => {\n                if (Math.abs(svg.zoom() - level) < 0.01) { // it doesn't zoom to the exact number\n                    if (cb) { cb() }\n                } else {\n                    const runner = svg.animate({duration: 100, ease: '>'})\n                        .zoom(level, pos)\n                    \n                    if (cb) { runner.after(cb) }\n                }\n            }\n\n            svg.zoom(1)\n\n            SVG.extend(SVG.Element, {\n                getScreenCoords: function (zone) {\n                    var root_point = this.doc().node.getBoundingClientRect()\n                    var point = this.node.getBoundingClientRect()\n\n                    if (zone === 'centre') {\n                        return {\n                            x: (point.left + point.right) / 2 - root_point.left,\n                            y: (point.top + point.bottom) / 2 - root_point.top\n                        }\n                    } else {\n                        return {\n                            x: point.x - root_point.left,\n                            y: point.y - root_point.top\n                        }\n                    }\n                }\n            })\n\n            var links = svg.group();\n            var markers = svg.group();\n            var nodes = svg.group();\n            this.nodesSvgGroup = nodes\n\n            this.numTempNodes = 0\n\n            const json_connections = json ? json.connections : undefined\n            var mouse_follower = MouseFollower.fromJSON(json_connections, this.props.sharedState, svg, links, markers, links);\n            this.mouse_follower = mouse_follower\n\n            // add new nodes on mouse click\n            svg.on('dblclick', (e) => {\n                // only clicks on background and not when dragging\n                if (e.target !== svg.node && !mouse_follower.drawing_arrow_from) {\n                    return;\n                }\n\n                var x = e.clientX\n                if (x + 200 > window.innerWidth) {\n                    x = window.innerWidth - 200\n                }\n                var y = e.clientY\n                if (y + 60 > window.innerHeight) {\n                    y = window.innerHeight - 60\n                }\n\n                this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", x, y, true);\n            });\n\n            this.setupTextDropping(svg, nodes, mouse_follower);\n\n            const blurActiveElement = (e) => {\n                document.activeElement.blur();\n            }\n            svg.on('panStart', blurActiveElement)\n            svg.on('zoom', blurActiveElement)\n\n            var textarea = document.querySelector('#nodeedit');\n            textarea.setAttribute('style', 'height:' + (textarea.scrollHeight) + 'px;overflow-y:hidden;');\n            textarea.addEventListener(\"input\", (e) => {\n                textarea.style.height = 'auto';\n                textarea.style.height = (textarea.scrollHeight) + 'px';\n            });\n\n            this.props.sharedState.addGraphNode = (text, x, y, doNotDeleteIfEmptyText) => {\n                if (x + 200 > window.innerWidth) {\n                    x = window.innerWidth - 200\n                }\n                if (y + 60 > window.innerHeight) {\n                    y = window.innerHeight - 60\n                }\n                return this.addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, true, doNotDeleteIfEmptyText)\n            }\n            if (json && json.nodes) {\n                this.loadNodesFromJSON(json.nodes, mouse_follower, nodes)\n            }\n\n            this.getNodeById = this.getNodeById.bind(this)\n            mouse_follower.draw_loaded_arrows(this.getNodeById)\n\n            if (this.nodesList.length === 0) {\n                this.addNoNodesIndicator(svg, nodes, mouse_follower);\n            }\n        })\n    }\n\n    getNodeById(id) {\n        return this.nodesList.find(node => node.id.toString() === id.toString())\n    }\n\n    toJSON() {\n        return {\n            nodes: this.nodesList.map(node => node.toJSON()),\n            connections: this.mouse_follower.toJSON()\n        }\n    }\n\n    loadNodesFromJSON(json, mouse_follower, nodes) {\n        this.nodesList = json.map(nodeJSON => GraphNode.fromJSON(nodeJSON, nodes, mouse_follower, this.props.sharedState, () => this.nodesList, this.zoomCanvasTo))\n        // temp\n        console.log(\"num nodes: \" + this.nodesList.length)\n    }\n\n    explodeNodes() {\n        const factor = 0.1\n        this.nodesList.forEach((node) => {\n            node.group.move(\n                node.group.x() + node.group.x() * factor, \n                node.group.y() + node.group.y() * factor\n            )\n            node.group.node.dispatchEvent(new CustomEvent(\"dragmove\")) // update arrows\n        })\n    }\n\n    addTempNode(id) {\n        // this is to visualise nodes that were created then deleted, and are now being viewed in the log explore timeline\n        var node = this.addNodeAtScreenLocation(this.svg, this.nodesSvgGroup, this.mouse_follower, \"?\", 0, this.numTempNodes * 150, false, true, id, true)\n        this.numTempNodes++\n\n        return node\n    }\n\n    addNoNodesIndicator(svg, nodes, mouse_follower) {\n        this.noNodesIndicator = svg.text(\"Double click to add a node\").addClass(\"indicator-text\").attr({x: \"40%\", y: \"45%\"});\n        this.noNodesIndicator.on('dblclick', (e) => {\n            this.addNodeAtScreenLocation(svg, nodes, mouse_follower, \"\", e.clientX, e.clientY, true);\n        });\n    }\n\n    setupTextDropping(svg, nodes, mouse_follower) {\n        this.$el.addEventListener(\"dragover\", (e) => {\n            e.preventDefault();\n        });\n\n        this.$el.addEventListener(\"drop\", (e) => {\n            e.preventDefault();\n            if (!e.dataTransfer.types.includes(\"text/plain\")) {\n                return // the dropped thing is probably a whole block, which is handled by React-DnD in DragifyGraph.js\n            }\n            \n            var data = e.dataTransfer.getData(\"Text\");\n\n            if (data.includes('\\n')) {\n                toast.error('You can\\'t add multiple paragraphs to the graph at once')\n                return\n            }\n\n            if (!this.props.sharedState.canAddLinkAtSelection()) {\n                toast.error('You can\\'t add the same node to the graph twice!')\n                return\n            }\n\n            var x = e.clientX\n            if (x + 200 > window.innerWidth) {\n                x = window.innerWidth - 200\n            }\n            var y = e.clientY\n            if (y + 60 > window.innerHeight) {\n                y = window.innerHeight - 60\n            }\n            var node = this.addNodeAtScreenLocation(svg, nodes, mouse_follower, data, x, y, false);\n            this.props.sharedState.addLinkAtSelection(node.id, node);\n            this.props.sharedState.logger.logEvent({'type': 'node_create_from_doc', 'node_id': node.id, 'text': data});\n            document.activeElement.blur();\n        });\n    }\n\n    addNodeAtScreenLocation(svg, nodes, mouse_follower, text, x, y, focus_text_area, doNotDeleteIfEmptyText=false, id=undefined, isSvgCoords=false) {\n        var point = svg.point(x, y);\n        if (isSvgCoords) { // don't convert screen > svg coords\n            point = {x: x, y: y}\n        }\n        const params = {\n            shortText: text,\n            longText: \"\", \n            x: point.x,\n            y: point.y,\n            width: 200,\n            height: 42,\n            isOnGraph: false,\n            id: id, // set automatically\n            doNotDeleteIfEmptyText: doNotDeleteIfEmptyText\n        }\n        var node = new GraphNode(params, nodes, mouse_follower, this.props.sharedState, focus_text_area, () => this.nodesList, this.zoomCanvasTo);\n        this.nodesList.push(node);\n\n        if (this.noNodesIndicator) {\n            this.noNodesIndicator.hide();\n        }\n\n        return node;\n    }\n\n    componentWillUnmount() {\n        // this.$el.somePlugin('destroy');\n    }\n\n    render() {\n        return this.props.connectDropTarget(\n            <div id=\"graph\" className=\"pane\" ref={el => this.el = el}>\n                <textarea id='nodeedit'></textarea>\n            </div>\n        );\n    }\n}\n\nexport default DropifyGraphPane(GraphPane);","import Dexie from 'dexie';\n\nconst db = new Dexie('writeReasonDb');\ndb.version(3).stores({ projects: '++id,name' }); // NB: this is just the *indexed* properties, not all of them!\n\nexport default db;","import React, { Component } from 'react';\n\nexport default class ProjectsList extends Component {\n    render() {\n        return (\n            <div className='display-block'>\n                <table className='pure-table'>\n                    <thead>\n                        <tr>\n                            {/* {(process.env.NODE_ENV === 'development') && <th>ID</th>} */}\n                            <th>Project</th>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {\n                            this.props.projects.map(project => <tr key={project.id.toString()}>\n                                {/* {(process.env.NODE_ENV === 'development') && <td>{project.id}</td>} */}\n                                <td>{project.name}</td>\n                                <td>\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"Project controls\">\n                                        <button className=\"pure-button\" onClick={() => this.props.loadProject(project.id)}>Open</button>\n                                        <button className=\"pure-button\" onClick={() => this.props.renameProject(project.id)}>Rename</button>\n                                        <button className=\"pure-button\" onClick={() => this.props.duplicateProject(project.id)}>Duplicate</button>\n                                        <button className=\"pure-button\" onClick={() => this.props.deleteProject(project.id)}>Delete</button>\n                                    </div>\n                                </td>\n                            </tr>)\n                        }\n                    </tbody>\n                </table>\n            </div>\n        )\n      }\n}","import React, { Component } from 'react';\n\nexport default class LogsExploreTable extends Component {\n    render() {\n        return (\n            <div className='display-block'>\n                <button className=\"pure-button\" onClick={() => localStorage.removeItem('logsToExplore')}>Delete stored logs</button>\n                <table className='pure-table'>\n                    <tbody>\n                        {\n                            this.props.logs && this.props.logs.map(log => <tr key={log.filename}>\n                                {/* {(process.env.NODE_ENV === 'development') && <td>{project.id}</td>} */}\n                                <td>{log.filename}</td>\n                                <td>\n                                    <div className=\"pure-button-group\" role=\"group\" aria-label=\"Project controls\">\n                                        {\n                                            log.projects.length > 1 && <p>MULTIPLE PROJECTS!</p>\n                                        }\n                                        {\n                                            log.projects[0].log.saves.map((save, index) => \n                                                <button className=\"pure-button\" onClick={(e) => this.props.exploreLog(log.projects[0], index)}>{index}</button>\n                                            )\n                                        }\n                                        {\n                                            // TEMP - just open the first log\n                                            // (log.filename === 'logs 2.json') && setTimeout(() => this.props.exploreLog(log.projects[0], 0), 0)\n                                        }\n                                    </div>\n                                </td>\n                            </tr>)\n                        }\n                    </tbody>\n                </table>\n            </div>\n        )\n      }\n}","import db from './db.js'\nimport { toast } from 'react-toastify';\n\nconst EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY = [\n    'session_start',\n    'document_content_detailed',\n    'document_content_markdown',\n]\n\nexport default class Logger {\n    shouldLogToConsole = false;\n\n    constructor(db_id, params) {\n        this.db_id = db_id;\n        this.conditions = params;\n        this.logToConsole(\"Logging begin, db_id \" + db_id + \"\\nParams \" + JSON.stringify(params, null, 1));\n\n        // used for tracking whether changes have been made since last save\n        // obviously, does not track events which are not logged, like typing in the document\n        this.stateIsDirty = false\n\n        this.logEvent({'type': 'session_start'})\n    }\n\n    logEvent(event) {\n        if (!EVENT_TYPES_WHICH_DO_NOT_MAKE_STATE_DIRTY.includes(event.type)) {\n            this.stateIsDirty = true\n        }\n\n        if (event.type === 'save') {\n            this.stateIsDirty = false\n        }\n\n        this.getLog(log => {\n            if (log.events === undefined) {\n                log.events = {}\n            }\n    \n            if (log.events[event.type] === undefined) {\n                log.events[event.type] = []\n            }\n            event.timestamp = new Date()\n            log.events[event.type].push(event)\n            this.setLog(log)\n\n            this.logToConsole(\"Logging event: \" + JSON.stringify(event))\n        })\n    }\n\n    // keep a history of the save states so that we can look back at how the project developed\n    logSaveState(save, forceLog=false) {\n        this.getLog(log => {\n            if (log.saves === undefined) {\n                log.saves = []\n            }\n\n            // don't store this save if we have stored a save <3 minutes ago\n            // to prevent multiple clicks of the save button taking up lots of space\n            const timestamp = new Date()\n            const THREE_MINUTES = 3 * 60 * 1000; // ms\n            if (forceLog || !log.saves.find(save => (timestamp - save.timestamp < THREE_MINUTES))) {\n                log.saves.push({\n                    timestamp: timestamp,\n                    ...save,\n                })\n                this.setLog(log)\n            }\n        })\n    }\n\n    getLog(callback) {\n        db.table('projects')\n            .get(this.db_id)\n            .then((project) => {\n                callback(project.log ? project.log : {})\n            })\n    }\n\n    setLog(log) {\n        db.table('projects')\n            .update(this.db_id, { log: log })\n            .catch(err => {\n                toast.error('Logging error: ' + err)\n                console.log('Logging error: ' + err)\n            })\n    }\n\n    logToConsole(msg) {\n        if (this.shouldLogToConsole) {\n            console.log(msg);\n        }\n    }\n}","import React from 'react';\nimport { Text } from 'slate';\nimport Html from 'slate-html-serializer'\nimport Logger from './logging'\nimport db from './db.js'\nimport { toast } from 'react-toastify';\nimport { pdf, Document, Page, Text as PdfText, StyleSheet, Font } from '@react-pdf/renderer';\nimport CrimsonText from './assets/CrimsonText-Regular.ttf'\nimport CrimsonTextBold from './assets/CrimsonText-Bold.ttf'\n\n\nexport default class SharedState {\n    constructor(db_id, params) {\n        if (!params.logExplore) {\n            this.logger = new Logger(db_id, params)\n        } else {\n            this.logger = {logEvent: (x, y) => {} }\n        }\n        this.condition = params.condition;\n        this.params = params;\n        \n        this.node_id_counter = 0;\n        this.slate_id_counter = 10\n        this.map = {};\n        this.map_recycle_bin = {};\n        this.db_id = db_id\n        this.orderAnnotate = false\n        this.annotatedNumbers = []\n\n        // this.editor_ref and this.graphPane set in the editor and graphpane\n        this.editor_ref = undefined;\n        this.graphPane = undefined;\n\n        // log entire document content every 60 seconds\n        if (!this.params.logExplore) {\n            this.intervalLogger = window.setInterval(() => {\n                this.logger.logEvent({'type': 'document_content_markdown', 'content': this.getArgumentMarkdown()});\n            }, 60000);\n        }\n        \n        this.downloadExperimentData = this.downloadExperimentData.bind(this);\n        this.editorHasLoaded = this.editorHasLoaded.bind(this);\n        this.save = this.save.bind(this)\n        this.mapToJSON = this.mapToJSON.bind(this)\n        this.exportPDF = this.exportPDF.bind(this)\n        this.exploreNext = this.exploreNext.bind(this)\n        this.explorePrev = this.explorePrev.bind(this)\n        this.exploreLog = this.exploreLog.bind(this)\n        this.makeNodeReport = this.makeNodeReport.bind(this)\n        this.getNextAnnotateNum = this.getNextAnnotateNum.bind(this)\n        this.exportAnnotatedLog = this.exportAnnotatedLog.bind(this)\n        this.explodeNodes = this.explodeNodes.bind(this)\n\n        // when the tab is closed, if the document has been edited, warn before closing\n        window.onbeforeunload = (e) => {\n            if (process.env.NODE_ENV !== 'development' && this.getStateIsDirty()) { // disable in development for webpack hot reloading\n                e.preventDefault()\n                e.returnValue = '' // for Chrome\n            }\n        }\n    }\n\n    exportAnnotatedLog() {\n        const save = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        this.downloadJSON(save, this.params.logExplore.project.filename + \"__order_annotated.json\")\n    }\n\n    getNextAnnotateNum() {\n        if (this.annotatedNumbers.length === 0) {\n            return 1\n        } else {\n            // check for a gap\n            this.annotatedNumbers.sort((a, b) => a - b)\n            var prev = 0\n            this.annotatedNumbers.forEach(annotatedNum => {\n                if (prev + 1 !== annotatedNum) {\n                    return prev + 1\n                }\n                prev = annotatedNum\n            })\n            \n            // if no gaps\n            return this.annotatedNumbers[this.annotatedNumbers.length - 1] + 1\n        }\n    }\n\n    viewFactSheet() {\n        const scenario = localStorage.getItem('scenario')\n        if (!scenario) {\n            toast.error('Fact sheet not found. Please re-open Write Reason using the link in the email we sent you.')\n            return\n        }\n\n        const factSheetURL = scenario + '_factsheet.pdf'\n        window.open(factSheetURL, '_blank')  // open in new tab\n    }\n\n    // called by editor once the database saved value has been set as the document.value\n    editorHasLoaded() {\n        this.getProjectThen(project => {\n            this.node_id_counter = project.node_id_counter ? project.node_id_counter : 0\n            this.map = project.map ? this.mapFromJSON(project.map) : {}\n            this.getEditor().mapHasLoaded()\n            this.projectName = project.name\n            document.title = this.projectName + \" - Write Reason\"\n        })\n        \n        this.lastSavedDocumentState = this.getEditor().getValue().document // editor is definitely not dirty right now\n    }\n\n    save(cb=undefined, forceLog=false) {\n        const changes = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        db.table('projects')\n            .update(this.db_id, changes)\n            .then((idExists) => {\n                if (!idExists) {\n                    const message = 'Save error: file with ID ' + this.db_id.toString() + ' does not exist!'\n                    console.log(message)\n                    toast.error(message)\n                } else {\n                    toast.info('Changes saved!')\n                    this.lastSavedDocumentState = this.getEditor().getValue().document\n                    this.logger.logSaveState(changes, forceLog)\n                }\n            }).catch(err => {\n                toast.error('Save error: ' + err.toString())\n            })\n            \n        this.logger.logEvent({'type': 'save'})\n\n        if (cb) {\n            cb()\n        }\n    }\n\n    getStateIsDirty() {\n        return this.logger.stateIsDirty || (\n            this.getEditor() && this.getEditor().getValue() && this.getEditor().getValue().document !== this.lastSavedDocumentState\n        ) \n    }\n\n    explorePrev() {\n        if (this.params.logExplore.saveIndex === 0) {\n            return\n        }\n        \n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex - 1)\n    }\n\n    exploreNext() {\n        if (this.params.logExplore.saveIndex === this.params.logExplore.project.log.saves.length - 1) {\n            return\n        }\n\n        this.exploreLog(this.params.logExplore.project, this.params.logExplore.saveIndex + 1)\n    }\n\n    exploreLog(project, saveIndex) {\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.params.transitionToEditor }\n        const sharedState = new SharedState(-1, params)\n        this.params.transitionToEditor(sharedState, true)\n    }\n\n    makeNodeReport() {\n        const changes = {\n            map: this.mapToJSON(),\n            node_id_counter: this.node_id_counter,\n            doc_value: this.getEditor().getValue().toJSON(),\n            graph_value: this.graphPane.toJSON(),\n        }\n        this.downloadJSON(changes, this.params.logExplore.project.filename + \"_ANNOTATED.json\")\n\n        const nodeReport = {linkedTexts: [], unlinkedTexts: []}\n        const value = this.getEditor().getValue()\n        value.document.getBlocks().forEach(block => {\n            if (block.type === 'body' || block.type === 'link' || block.type === 'section') {\n                nodeReport.linkedTexts.push(block.text)\n            } else {\n                block.nodes.forEach(node => {\n                    if (!node.text) {\n                        return\n                    }\n                    if (node.type === 'link') {\n                        nodeReport.linkedTexts.push(node.text)\n                    } else {\n                        nodeReport.unlinkedTexts.push(node.text)\n                    }\n                })\n            }\n        })\n\n        nodeReport.linked = nodeReport.linkedTexts.join('\\n')\n        nodeReport.unlinked = nodeReport.unlinkedTexts.join('\\n')\n        \n        nodeReport.linkedCharsProportion = nodeReport.linked.length / (nodeReport.linked.length + nodeReport.unlinked.length)\n        \n        const countWords = (str) => str.trim().split(/\\s+/).length\n        nodeReport.linkedWords = countWords(nodeReport.linked)\n        nodeReport.unlinkedWords = countWords(nodeReport.unlinked)\n        nodeReport.linkedWordProportion = nodeReport.linkedWords / (nodeReport.linkedWords + nodeReport.unlinkedWords)\n\n        nodeReport.rawValue = value\n\n        var nodeReports = localStorage.getItem('nodeReports') ? JSON.parse(localStorage.getItem('nodeReports')) : {}\n        nodeReports[this.params.logExplore.project.filename] = nodeReport\n        localStorage.setItem('nodeReports', JSON.stringify(nodeReports))\n    }\n\n    getProjectThen(cb) {\n        if (this.params.logExplore) {\n            const logExplore = this.params.logExplore\n            cb(logExplore.project.log.saves[logExplore.saveIndex])\n        } else {\n            db.table('projects')\n                .get(this.db_id)\n                .then(project => {\n                    cb(project)\n                })\n        }\n    }\n\n    getSavedDocValue = async function(onDataLoad) {\n        this.getProjectThen(project => {\n            onDataLoad(project.doc_value)\n        })\n    }\n\n    getSavedGraph = async function(onDataLoad) {\n        this.getProjectThen(project => {\n            onDataLoad(project.graph_value)\n        })\n    }\n\n    mapToJSON() {\n        var mapJson = {}\n        const document = this.getEditor().value.document\n        for (const id in this.map) {\n            let doc_nodes = {};\n            ['section', 'long', 'short'].forEach(part => {\n                const docNodeObjects = this.getDocNodes(id)\n                if (docNodeObjects && docNodeObjects[part]) {\n                    const path = document.getPath(docNodeObjects[part])\n                    if (path) {\n                        doc_nodes[part] = path.toArray()\n                    }\n                } \n            })\n\n            mapJson[id] = {\n                graph_node: this.getGraphNode(id) ? this.getGraphNode(id).id : undefined,\n                doc_nodes: doc_nodes\n            }\n        }\n\n        return mapJson\n    }\n\n    mapFromJSON(json) {\n        this.map = {}\n        for (const id in json) {\n            if (json[id].graph_node) {\n                const graphNode = this.graphPane.getNodeById(id)\n                if (graphNode) {\n                    this.addGraphMapping(id, graphNode)\n                } else {\n                    toast.error(\"Error when loading: could not find graph node with ID \" + id)\n                }\n            }\n\n            if (json[id].doc_nodes) {\n                for (const part in json[id].doc_nodes) {\n                    const path = json[id].doc_nodes[part]\n                    \n                    const document = this.getEditor().value.document\n                    if (document.hasNode(path)) {\n                        this.setLinkMapping(id, document.getNode(path), part)\n                    } else {\n                        console.log(document);\n                        \n                        toast.error(\"Error when loading: could not find \" + part + \" with ID \" + id)\n                    }\n                }\n            }\n        }\n\n        return this.map\n    }\n\n    downloadExperimentData() {\n        // save first to log the latest document version\n        this.save(() => {\n            db.table('projects')\n            .toArray(projects => {\n                const data = {\n                    timestamp: new Date(),\n                    preTaskSubmission: localStorage.getItem('preTaskSubmission'),\n                    projects: projects,\n                }\n                this.downloadJSON(data, 'Write Reason logs.json')\n                \n            }).catch(err => {\n                toast.error(\"Error downloading logs: \" + err)\n            })\n        }, true)\n    }\n\n    getArgumentHTML() {\n        const parentStyleIs = (node, styleToCheck) => {\n            const parent = this.getEditor().value.document.getParent(node.key)\n            return parent && parent.data.get(\"nodeStyle\") === styleToCheck\n        }\n\n        const RULES = [\n            {\n                serialize: (node, children) => {\n                    if ([\"block\", \"inline\"].includes(node.object)) {\n                        switch(node.type) {\n                            case 'paragraph':\n                            case '':\n                                return <p>{children}</p>\n\n                            case 'heading':\n                                return <h2>{children}</h2>\n                            \n                            case 'section':\n                                return <div>{children}</div>\n                            \n                            case 'body':\n                                if (parentStyleIs(node, \"Heading only\")) {\n                                    return <p></p>\n                                } else {\n                                    return <p>{children}</p>\n                                }\n\n                            case 'link':\n                                if (node.object === \"inline\") {\n                                    return <span>{children}</span>\n                                } else {\n                                    if (parentStyleIs(node, \"Body only\")) {\n                                        return <p></p>\n                                    } else {\n                                        return <h2>{children}</h2>\n                                    }\n                                }\n\n                            default:\n                                return undefined\n                        }\n                    } else if(node.object === 'string') {\n                        return node.text\n                    }\n                } \n            }\n        ]\n\n        const serializer = new Html({rules: RULES})\n        return serializer.serialize(this.getEditor().value)\n    }\n\n    downloadJSON(json, filename) {\n        const file = new Blob([JSON.stringify(json, null, 2)], {type: 'text/plain'})\n        this.downloadBlob(file, filename)\n    }\n\n    downloadBlob(blob, filename) {\n        const element = document.createElement(\"a\");\n        element.href = URL.createObjectURL(blob);\n        element.download = filename;\n        document.body.appendChild(element); // Required for this to work in FireFox\n        element.click();\n    }\n\n    exportPDF() {\n        this.logger.getLog(log => {\n            this.getReactPdfDocument().then(file => {      \n                this.downloadBlob(file, this.projectName + \".pdf\")\n            })\n        })\n    }\n\n    getReactPdfDocument() {\n        const markdown = this.getArgumentMarkdown()\n\n        Font.register({family: 'Crimson Text', fonts: [\n            {src: CrimsonText},\n            {src: CrimsonTextBold, fontWeight: 800}\n        ]})\n\n        const styles = StyleSheet.create({\n            page: {\n                padding: 80\n            },\n            text: {\n                fontFamily: \"Crimson Text\",\n                width: \"100%\",\n                fontSize: \"12pt\",\n                paddingBottom: 8,\n            },\n            heading: {\n                fontFamily: \"Crimson Text\",\n                textDecoration: \"underline\",\n                fontWeight: 800,\n                width: \"100%\",\n                fontSize: \"12pt\"\n            }\n        })\n\n        const document = (\n            <Document>\n                <Page style={styles.page}>\n                    {markdown.split('\\n').map(line => {                        \n                        if (line.startsWith('##')) { // markdown heading\n                            line = line.substring('##'.length)\n                            return <PdfText style={styles.heading}>{line}</PdfText>\n                        }\n\n                        return <PdfText style={styles.text}>{line}</PdfText>\n                        }\n                    )}\n                </Page>\n            </Document>\n        )\n        return pdf(document).toBlob()\n    }\n\n    getArgumentMarkdown() {\n        var output = this.getArgumentHTML()\n        \n        var tagReplacements = [\n            {regex: /<p>\\s*<\\/p>/g},  // special rule for removing empty paragraphs without inserting a newline\n\n            {regex: /<p>/g},\n            {regex: /<\\/p>/g, replace: \"\\n\\n\"},\n            {regex: /<div>/g},\n            {regex: /<\\/div>/g},\n            {regex: /<span>/g},\n            {regex: /<\\/span>/g},\n            {regex: /<h2>/g, replace: \"## \"},\n            {regex: /<\\/h2>/g, replace: \"\\n\"},\n        ]\n        tagReplacements.forEach((replacement) => {\n            output = output.replace(replacement.regex, replacement.replace ? replacement.replace : \"\")\n        })\n\n        // unescape HTML entities, eg replace '&amp' with '&'\n        var element = document.createElement(\"span\")\n        element.innerHTML = output\n        output = element.innerText\n\n        return output\n    }\n\n    finishCondition() {\n        window.onbeforeunload = undefined // remove the warning about closing the tab\n        window.clearInterval(this.intervalLogger)\n    }\n\n    getEditor() {\n        return this.editor_ref.current;\n    }\n\n    getNodeId() {\n        this.node_id_counter++;\n        return this.node_id_counter;\n    }\n\n    canAddLinkAtSelection() {\n        const value = this.getEditor().value;\n        const is_in_linked_block = value.blocks.some(block => (block.type === 'link' || block.type === 'section' || block.type === 'body'));\n        const is_in_linked_inline = value.inlines.some(inline => (inline.type === 'link'));\n        return !is_in_linked_block && !is_in_linked_inline;\n    }\n\n    addLinkAtSelection(id, graph_node) {\n        this.getEditor().wrapLinkAtSelection(id);\n        this.addGraphMapping(id, graph_node);\n    }\n\n    addGraphMapping(id, graph_node) {\n        graph_node.setIsOnGraph(true);\n        this.map[id] = { graph_node: graph_node };\n    }\n\n    setLinkMapping(id, doc_node, long_or_short) {\n        if (!this.map[id]) {\n            // uh oh, this should exist\n            this.map[id] = {}\n\n            // maybe the mapping was deleted and re-added with ctrl-Z\n            // if so, hopefully it's stored as recently deleted\n            this.checkRecycleBinForGraphNode(id)\n        }\n\n        if (this.map[id].doc_nodes === undefined) {\n            this.map[id].doc_nodes = {};\n        }\n        this.map[id].doc_nodes[long_or_short] = doc_node;\n    }\n\n    getGraphNodeAndDocNode(id) {\n        return this.map[id];\n    }\n\n    checkRecycleBinForGraphNode(id) {\n        if (!this.map[id]) {\n            this.map[id] = {}\n        }\n\n        if (this.map[id].graph_node) {\n            // no need to restore\n            return;\n        }\n\n        const prev_version = this.map_recycle_bin[id]\n        if (prev_version && prev_version.graph_node) {\n            console.log('restored from recycle');\n            \n            this.addGraphMapping(id, prev_version.graph_node)\n        }\n    }\n\n    getGraphNode(id) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            return map.graph_node;\n        }\n    }\n\n    removeGraphNode(id) {\n        if (this.getDocNodes(id)) {\n            Object.values(this.getDocNodes(id)).forEach(node => {\n                this.getEditor().removeGraphLink(node);\n            })\n            this.map[id] = undefined;\n        }\n    }\n\n    removeDocNode(id) {\n        var map = this.getGraphNodeAndDocNode(id)\n        if (map) {\n            if (map.graph_node) {\n                map.graph_node.setIsOnGraph(false);\n            }\n            \n            this.map_recycle_bin[id] = this.map[id]\n            this.map[id] = undefined\n        }\n    }\n\n    getDocNodes(id) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            return map.doc_nodes;\n        }\n    }\n\n    getDocNodeShortText(id) {\n        const docNode = this.getDocNodes(id);\n        if (docNode) {\n            return docNode.short;\n        }\n    }\n\n    getDocNodeLongText(id) {\n        const docNode = this.getDocNodes(id);\n        if (docNode) {\n            return docNode.long;\n        }\n    }\n\n    getDocNodeRef(id, long_or_short) {\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map && map.doc_link_node) {\n            return map.doc_link_node[long_or_short].current;\n        }\n    }\n\n    getAllDocNodeRefs(id) {\n        var docNodes = [];\n        const map = this.getGraphNodeAndDocNode(id);\n        if (map) {\n            [\"long\", \"short\", \"section\"].forEach(long_or_short => {\n                if (map.doc_link_node && map.doc_link_node[long_or_short]) {\n                    docNodes.push(map.doc_link_node[long_or_short].current)\n                }\n            })\n        }\n        return docNodes;\n    }\n\n    registerLinkNode(id, ref, long_or_short) {\n        if (this.map[id].doc_link_node === undefined) {\n            this.map[id].doc_link_node = {};\n        }\n        this.map[id].doc_link_node[long_or_short] = ref;\n    }\n\n    // check whether a graph node's doc node still exists\n    updateIsOnGraphStatus(id) {\n        var docNode = this.getDocNodeShortText(id);\n        if (!docNode) {\n            return false\n        }\n\n        if (docNode && !this.getEditor().value.document.hasNode(docNode.key)) {\n            // tell the graph node that there is no doc node any more, for whatever reason\n            this.removeDocNode(id)\n            return false\n        }\n\n        return true\n    }\n\n    updateDocShortText(id, newText) {\n        var docNode = this.getDocNodeShortText(id);\n        \n        if (docNode) {\n            var editor = this.getEditor();\n\n            if (this.updateIsOnGraphStatus(id)) {\n                // replace any text with newText\n                docNode.nodes.forEach(child => {\n                    editor.removeNodeByKey(child.key);\n                });\n                editor.insertNodeByKey(docNode.key, 0, Text.create({text: newText}));\n            }\n        }\n    }\n\n    updateGraphShortText(id, newText) {\n        var graphNode = this.getGraphNode(id);\n        \n        if (graphNode) {\n            graphNode.updateShortText(newText);            \n        }\n    }\n\n    updateGraphLongText(id, newText) {\n        var graphNode = this.getGraphNode(id);\n        \n        if (graphNode) {\n            graphNode.updateLongText(newText);            \n        }\n    }\n\n    explodeNodes() {\n        this.graphPane.explodeNodes()\n    }\n}","import React, { Component } from 'react';\nimport './LoadProject.css'\nimport db from '../../db.js'\nimport ProjectList from './ProjectsList.js'\nimport LogsExploreTable from './LogsExploreTable.js'\nimport SharedState from '../../shared_state.js';\nimport { toast } from 'react-toastify';\nimport DropZone from 'react-dropzone';\n\nexport default class LoadProject extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            projects: []\n        };\n        this.addProject = this.addProject.bind(this)\n        this.deleteProject = this.deleteProject.bind(this)\n        this.loadProject = this.loadProject.bind(this)\n        this.renameProject = this.renameProject.bind(this)\n        this.duplicateProject = this.duplicateProject.bind(this)\n        this.updateProjectsFromDb = this.updateProjectsFromDb.bind(this)\n        this.onDropLogFiles = this.onDropLogFiles.bind(this)\n        this.exploreLog = this.exploreLog.bind(this)\n        \n        document.title = \"Write Reason\"\n\n        // skip the project select screen if the autoload prop is supplied, instead load project with that id\n        if (process.env.NODE_ENV === 'development' && this.props.autoload) {\n            this.loadProject(this.props.autoload)\n        }\n    }\n\n    componentDidMount() {\n        if (process.env.NODE_ENV !== 'development' || !this.props.autoload) {\n            this.updateProjectsFromDb()\n        }\n    }\n\n    updateProjectsFromDb() {\n        // todo - only retrieve relevant rows from projects table?\n        db.table('projects')\n            .toArray(projects => {\n                this.setState({ projects })\n            }).catch(err => {\n                toast.error(\"Error when loading projects: \" + err)\n            })\n    }\n\n    loadProject(id) {\n        const params = { condition: 'graph' }\n        const sharedState = new SharedState(id, params)\n        this.props.transitionToEditor(sharedState)\n    }\n\n    addProject() {\n        const project = {name: window.prompt('Name your project', 'New project')}\n        if (project.name) {\n            db.table('projects')\n                .add(project)\n                .then(() => {\n                    this.updateProjectsFromDb()\n                });\n        }\n    }\n\n    renameProject(id) {\n        db.table('projects')\n            .get(id)\n            .then((project) => {\n                const newName = window.prompt('Set a new project name', project.name)\n                if (newName) {\n                    db.table('projects')\n                        .update(id, { name: newName })\n                        .then(() => {\n                            this.updateProjectsFromDb()\n                        })\n                }\n            });\n    }\n\n    duplicateProject(id) {\n        db.table('projects')\n            .get(id)\n            .then((project) => {\n                project.name += ' (copy)'\n                delete project.id // set a new one automatically\n                db.table('projects')\n                    .add(project)\n                    .then(() => {\n                        this.updateProjectsFromDb()\n                    });\n            })\n    }\n\n    deleteProject(id) {\n        if (window.confirm('Are you sure you want to delete this project? This cannot be undone.')) {\n            db.table('projects')\n                .delete(id)\n                .then(() => {\n                    this.updateProjectsFromDb()\n                })\n        }\n    }\n\n    onDropLogFiles(files) {\n        files.forEach((file) => {\n            const reader = new FileReader()\n      \n            reader.onabort = () => console.log('file reading was aborted')\n            reader.onerror = () => console.log('file reading has failed')\n            reader.onload = () => {\n                const stored = localStorage.getItem('logsToExplore') || JSON.stringify({logs: []})\n                const allLogs = JSON.parse(stored).logs\n\n                var newLog = JSON.parse(reader.result)\n                newLog.filename = file.name\n                newLog.projects.forEach(project => project.filename = file.name)\n                allLogs.push(newLog)\n                localStorage.setItem('logsToExplore', JSON.stringify({logs: allLogs}))\n            }\n            reader.readAsText(file)\n        })\n    }\n\n    exploreLog(project, saveIndex) {\n        const params = { condition: 'graph', logExplore: {project: project, saveIndex: saveIndex}, transitionToEditor: this.props.transitionToEditor }\n        const sharedState = new SharedState(-1, params)\n        this.props.transitionToEditor(sharedState)\n    }\n    \n    render() {\n        return (\n            <div className=\"load-project\">\n                <button className=\"pure-button button-primary\" onClick={this.addProject}>New project</button>\n                {/* {process.env.NODE_ENV === 'development' && <><DropZone onDrop={this.onDropLogFiles}>\n                        {({getRootProps, getInputProps}) => (\n                            <section>\n                            <div {...getRootProps()}>\n                                <input {...getInputProps()} />\n                                <p>Drop/select log files</p>\n                            </div>\n                            </section>\n                        )}\n                    </DropZone>\n                    \n                    <div className=\"load-project-table\">\n                        <LogsExploreTable logs={localStorage.getItem('logsToExplore') && JSON.parse(localStorage.getItem('logsToExplore')).logs} \n                            exploreLog={this.exploreLog} />\n                    </div>\n                    </>\n                    } */}\n                <div className=\"load-project-table\">\n                    {this.state.projects && this.state.projects.length > 0 && <ProjectList projects={this.state.projects}\n                        deleteProject={this.deleteProject}\n                        loadProject={this.loadProject}\n                        renameProject={this.renameProject}\n                        duplicateProject={this.duplicateProject}\n                    />}\n                </div>\n            </div>\n        );\n      }\n}","import React, { Component } from 'react';\nimport './ExperimentalControls.css';\n\nexport default class ExperimentControls extends Component {\n    render() {\n        if (this.props.sharedState.params.logExplore) {\n            return (\n                <div className=\"experiment-controls\">\n                    <button className='pure-button' onClick={this.props.backToMenu}>Back</button>\n                    <button className='pure-button' onClick={this.props.sharedState.explodeNodes}>Explode</button>\n                    <button className='pure-button' onClick={() => {this.props.sharedState.orderAnnotate = true}}>Order annotate</button>\n                    <button className='pure-button' onClick={this.props.sharedState.exportAnnotatedLog}>Export annotated log</button>\n                    <button className='pure-button' onClick={this.props.sharedState.makeNodeReport}>Make node report</button>\n                    <button className='pure-button' onClick={this.props.sharedState.explorePrev}></button>\n                    <button className='pure-button'>{this.props.sharedState.params.logExplore.project.filename + \" \" + this.props.sharedState.params.logExplore.saveIndex}</button>\n                    <button className='pure-button' onClick={this.props.sharedState.exploreNext}></button>\n                </div>\n            );\n        } else {\n            return (\n                <div className=\"experiment-controls\">\n                    <button className='pure-button' onClick={this.props.backToMenu}>Back</button>\n                    {/* <button className='pure-button' onClick={this.props.showExperimentInfo}>Study participant instructions</button>\n                    <button className='pure-button' onClick={this.props.sharedState.viewFactSheet}>View fact sheet</button> */}\n                    <button className='pure-button' onClick={this.props.sharedState.exportPDF}>Export PDF</button>\n                    <button className='pure-button' onClick={this.props.sharedState.downloadExperimentData}>Export logs</button>\n                    <button className='pure-button button-primary' onClick={() => {this.props.sharedState.save()}}>Save</button>\n                </div>\n            );\n        }\n    }\n}","import React, { Component } from 'react'\n\nexport default class TimelineEntry extends Component {\n    render() {\n        let theClass = \"\"\n        if (this.props.log.type.includes('doc')) {\n            theClass = 'red'\n        }\n\n        if (this.props.log.type.includes('node')) {\n            theClass = 'blue'\n        }\n\n        if (this.props.log.type.includes('doc_create_from_node') || this.props.log.type.includes('doc_node_change_format')) {\n            theClass = 'yellow'\n        }\n\n        if (this.props.log.type.includes('arrow')) {\n            theClass = 'green'\n        }\n\n        if (this.props.isExploreHead) {\n            theClass += ' explore-head'\n        }\n\n        return (\n        <button className={theClass} onClick={this.props.onClick}>\n            {this.props.log.type} <i>{this.props.log.id && (this.props.log.id.toString().length < 4 ?\n                                                                this.props.log.id : \n                                                                this.props.log.source && this.props.log.source + \"  \" + this.props.log.target)}</i><br/>\n            {this.props.timestampFormatted}\n        </button>\n        );\n      }\n}","import React, { Component } from 'react'\nimport TimelineEntry from './TimelineEntry'\nimport { Block } from 'slate'\n\nexport default class LogExploreTimeline extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            exploreHead: undefined\n        }\n\n        this.moveExploreHead = this.moveExploreHead.bind(this)\n        this.exploreEvent = this.exploreEvent.bind(this)\n        this.setDocValue = this.setDocValue.bind(this)\n        this.handleKeyDown = this.handleKeyDown.bind(this)\n    }\n\n    moveExploreHead(event) {\n        const graph = document.getElementById('graph')\n        graph.classList.add('timeline-explore-mode')\n\n        const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\n\n        if (!orderedLogs) {\n            return\n        }\n\n        this.setState({\n            exploreHead: event\n        })\n\n        var pastExploreHead = false\n        var lastDocChangeContent = \"empty\"\n        for (let i = 0; i < orderedLogs.length; i++) {\n            this.exploreEvent(orderedLogs[i], pastExploreHead)\n\n            if (orderedLogs[i].type === 'doc_change' && !pastExploreHead) {\n                lastDocChangeContent = orderedLogs[i].content\n            }\n\n            if (orderedLogs[i] === event) {\n                pastExploreHead = true\n                \n                this.setDocValue(lastDocChangeContent)\n            }\n        }\n    }\n\n    setDocValue(text) {\n        const editor = this.props.sharedState.getEditor()\n\n        editor.moveToRangeOfDocument()\n        editor.delete()\n        editor.moveToStartOfDocument()\n\n        const blockToInsert = Block.create({object: 'block', type: ''})\n        const section = editor.value.document.getParent(editor.value.startBlock.key);\n        const sectionParent = editor.value.document.getParent(section.key);     \n        if (sectionParent) {\n            const sectionIndex = sectionParent.nodes.indexOf(section);\n            editor.insertNodeByKey(sectionParent.key, sectionIndex, blockToInsert);\n            editor.moveBackward(1)\n        }\n\n        editor.insertText(text)\n    }\n\n    exploreEvent(event, hasNotBeenExplored) {\n        const graphPane = this.props.sharedState.graphPane\n        var node\n\n        const updateSvgElement = (element) => {\n            if (!element) {\n                return\n            }\n\n            if (hasNotBeenExplored) {\n                element.removeClass('has-been-explored')\n            } else {\n                element.addClass('has-been-explored')\n            }\n        }\n\n        switch (event.type) {\n            case 'node_create':\n                node = graphPane.getNodeById(event.id)\n                if (node) {\n                    updateSvgElement(node.rect)\n                } else if (!hasNotBeenExplored) {\n                    node = graphPane.addTempNode(event.id)\n                    if (node) {\n                        updateSvgElement(node.rect)\n                    }\n                }\n                break\n            \n            case 'node_delete':\n                if (!hasNotBeenExplored) {\n                    node = graphPane.getNodeById(event.id)\n                    if (node) {\n                        node.delete(this.props.sharedState)\n                        graphPane.numTempNodes--\n                    }\n                }\n                break\n            \n            case 'arrow_create':\n                const arrow = graphPane.mouse_follower.getConnectorObjectConnecting(event.source, event.target)\n                if (arrow) {\n                    updateSvgElement(arrow.line)\n                } else if (!hasNotBeenExplored) {\n                    graphPane.mouse_follower.addTempArrow(event.source, event.target, \"black\", event.id)\n                }\n                break\n            \n            case 'arrow_delete':\n                if (hasNotBeenExplored) {\n                    break\n                }\n\n                const sourceDestString = graphPane.mouse_follower.temp_arrows[event.id]\n                if (sourceDestString) {\n                    graphPane.mouse_follower.remove_arrow(graphPane.mouse_follower.connector_objs[sourceDestString], undefined)\n                    graphPane.mouse_follower.connector_objs[sourceDestString] = undefined\n                }\n                break\n\n            case 'node_edit_short_text':\n                node = graphPane.getNodeById(event.id)\n                if (node && !hasNotBeenExplored) {\n                    node.updateShortText(event.text)\n                }\n                break\n\n            default:\n                break\n        }\n    }\n\n    handleKeyDown(e) {\n        var shift = undefined\n        if (e.keyCode === 39) { // right arrow\n            shift = 1\n        } else if (e.keyCode === 37) { // left arrow\n            shift = -1\n        }\n\n        if (shift !== undefined) {\n            const orderedLogs = this.props.sharedState.params.logExplore.project.orderedLogs\n            if (!orderedLogs) {\n                return\n            }\n\n            for (let i = 0; i < orderedLogs.length; i++) {\n                if (this.state.exploreHead === orderedLogs[i]) {\n                    if (i + shift > 0 && i + shift < orderedLogs.length) {\n                        this.moveExploreHead(orderedLogs[i + shift])\n                    }\n                }\n            }\n        }\n    }\n\n    render() {\n        const project = this.props.sharedState.params.logExplore.project\n        if (!project.orderedLogs) {\n            const markdown_events = project.log.events.document_content_markdown\n            project.log.events.doc_change = [] \n            markdown_events.forEach((e, index) => {\n                if (index === 0 || markdown_events[index - 1].content !== e.content) {\n                    project.log.events.doc_change.push({type: 'doc_change', content: e.content, timestamp: e.timestamp})\n                }})\n            project.log.events.doc_change.forEach(e => e.type = 'doc_change')\n\n            project.orderedLogs = [].concat.apply([], Object.values(project.log.events)).filter(e => e.type !== 'document_content_markdown')\n            project.orderedLogs.sort(function(a,b){\n                return new Date(a.timestamp) - new Date(b.timestamp);\n            })\n        }\n        const logs = project.orderedLogs\n\n        return (\n            <div className=\"timeline\" onKeyDown={this.handleKeyDown}>\n                <p>{project.filename}</p>\n                {logs.map((log, index) => {\n                        const getDate = (timestamp) => timestamp.substring(\"2020-\".length, \"2020-07-21\".length)\n                        const time = log.timestamp.substring(\"2020-07-21T\".length, \"2020-07-21T12:51:45\".length)\n\n                        const makeEntry = () => <TimelineEntry\n                            onClick={() => this.moveExploreHead(log)}\n                            log={log}\n                            timestampFormatted={time}\n                            sharedState={this.props.sharedState}\n                            isExploreHead={this.state.exploreHead === log}\n                        />\n\n                        if (index === 0 || getDate(log.timestamp) !== getDate(logs[index - 1].timestamp)) {\n                            return <>\n                                <p><b>{getDate(log.timestamp)}</b></p>\n                                {makeEntry()}\n                            </>\n                        } else {\n                            return makeEntry()\n                        }\n                    }\n                )}\n            </div>\n        );\n      }\n}","import React, { Component } from 'react';\nimport { toast } from 'react-toastify';\n\nexport default class ExperimentInfo extends Component {\n    render() {\n        // eslint-disable-next-line no-useless-concat\n        const emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\n\n        const scenario = localStorage.getItem('scenario')\n\n        var question;\n        if (scenario === 'biohacking') {\n            question = <b>QUESTION: Should greater regulatory control be exerted over genetic biohacking?</b>\n        } else if (scenario === 'sharedSpace') {\n            question = <b>QUESTION: Should shared spaces in urban planning be promoted?</b>\n        } else {\n            toast.error(\"Question not found. Please re-open Write Reason using the link in the email we sent you.\")\n        }\n\n        return (\n            <>\n                <h2>Instructions for study participants</h2>\n                <p>Thank you for participating in this study!</p>\n\n                <h3>Before you start</h3>\n                <p>Watch the How to use video on the home page.</p>\n\n                <h3>The task</h3>\n\n                <p>Your task is to decide where you stand on the question below, and write an essay justifying your view. Use Write Reason for all parts of the task.</p>\n\n                {question}\n\n                <p>Write in the style of a short academic essay. You may not have heard of this topic before - don't worry, the fact sheet has all the information you need on it!</p>\n\n                <h3>How to work on the task</h3>\n                <ol>\n                    <li>First, <a href=\"#factsheet\" onClick={(e) => {e.preventDefault(); this.props.sharedState.viewFactSheet()}}>click here to read the fact sheet</a></li>\n                    <li>Spend around 1 hour 40 minutes on this task, over the next week</li>\n                    <li>Aim for around 700 words as a very rough guide - though it's fine to exceed this!</li>\n                    <li>Whenever you work on the task record it in the diary. <a href='/diary_template.csv' download>Download a blank diary here</a></li>\n                    <li>Please <b>do not enter any personal information</b> when using Write Reason</li>\n                    <li>Your work will be saved in your browser on this computer when you press \"Save\"</li>\n                </ol>\n\n                <h3>What to do when you're finished</h3>\n                <ol>\n                    <li>Press the \"Export logs\" button in the bottom right of the screen, and keep the downloaded file somewhere safe</li>\n                    <li>Make sure your diary is filled out</li>\n                    <li>Email us at <a href={'mailto:' + emailAddress + '?subject=Write Reason task complete'}>{emailAddress}</a> to arrange a short interview about your experiences!\n                        During the interview you will send us the logs and your diary</li>\n                    <li>You will receive a 20 Amazon voucher to thank you for your time</li>\n                </ol>\n\n                <p>Your contribution to our research is incredibly valuable, thank you!</p>\n            </>\n        );\n    }\n}","import React, { Component } from 'react';\n\nexport default class PreTaskSection extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            q1: '',\n            q2: '',\n            q3: '',\n        }\n\n        this.handleChange = this.handleChange.bind(this)\n        this.handleSubmit = this.handleSubmit.bind(this)\n    }\n\n    handleChange(event, question) {\n        this.setState({ [question] : event.target.value })\n    }\n\n    handleSubmit(event) {\n        event.preventDefault()\n        const questions = [this.state.q1, this.state.q2, this.state.q3]\n        var shouldReturn = false\n        questions.forEach(questionValue => {\n            if (!shouldReturn && (!questionValue || questionValue === \"\")) {\n                alert(\"Please enter an answer for all three questions\")\n                shouldReturn = true\n                return\n            }\n        })\n        if (shouldReturn) {\n            return\n        }\n\n        if (window.confirm(\"Are you ready submit your answers? You cannot undo this action\")) {\n            localStorage.setItem('preTaskSubmission', JSON.stringify(this.state))\n            this.props.transitionToMenu()\n        }\n    }\n\n    render() {\n        // eslint-disable-next-line no-useless-concat\n        var emailAddress = 'ab' + '390' + '@st-andrews' + '.ac.uk' // concat to avoid having the raw email address in git\n        return (\n            <div className='intro-section'>\n                <h3 style={{paddingTop: \"40px\"}}>Thank you for participating in this experiment!</h3>\n                <ol className=\"steps\">\n                    <li>\n                        <p>Before we begin, please complete this <a href=\"https://standrews.eu.qualtrics.com/jfe/form/SV_9tYNKrCBK8uHOiV\">short, anonymous demographics\n                            questionnaire</a> if you have not done so already.</p>\n                    </li>\n                    <li>\n                        <p> Then, write a paragraph (at least 2 sentences) answering each of the questions below:</p>\n\n                        <form onSubmit={this.handleSubmit} className=\"pure-form pure-form-stacked\">\n                            <label>When you write an essay, what do you aim to produce?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q1\")} placeholder=\"Your answer...\" />\n                            <label>What makes a good essay?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q2\")} placeholder=\"Your answer...\" />\n                            <label>What do you think are the possible purposes of writing an essay?</label>\n                            <textarea className=\"pure-input-1\" rows=\"10\" value={this.state.value} onChange={(e) => this.handleChange(e, \"q3\")} placeholder=\"Your answer...\" />\n                            <input className=\"pure-button button-primary\" type=\"submit\" value=\"Submit answer\" />\n                        </form>\n\n                    </li>\n                </ol>\n\n                <p><i>Any questions? Get in touch at <a href={'mailto:' + emailAddress + '?subject=Write Reason question'}>{emailAddress}</a>.</i></p>\n                <br/>\n            </div>\n        )\n    }\n}","import React, { Component } from 'react';\nimport Logo from '../../assets/logo.png'\nimport { Player, BigPlayButton } from 'video-react'\nimport Video from '../../assets/instructions.mp4'\nimport Thumbnail from '../../assets/thumbnail.png'\nimport \"video-react/dist/video-react.css\"\n\nexport default class IntroSection extends Component {\n    \n    render() {\n        return (\n            <div className='intro-section'>\n                <a href=\"https://writereason.app\"><img src={Logo} className='logo' alt=\"Write Reason\"/></a>\n\n                <>\n                    <Player src={Video} poster={Thumbnail}>\n                        <BigPlayButton className='play-button' position='center' />\n                    </Player>\n                </>\n            </div>\n        );\n      }\n}","/* eslint-disable no-fallthrough */\n/* eslint-disable default-case */\nimport React, { Component } from 'react';\nimport './App.css';\nimport DocPane from './components/doc/DocPane.js';\nimport GraphPane from './components/graph/GraphPane.js';\nimport SplitPane from 'react-split-pane';\nimport LoadProject from './components/loadproject/LoadProject.js';\nimport { DndProvider } from 'react-dnd'\nimport Backend from 'react-dnd-html5-backend'\nimport { ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport SaveButton from './components/experiment/SaveButton';\nimport LogExploreTimeline from './components/experiment/LogExploreTimeline';\nimport ExperimentInfo from './components/experiment/ExperimentInfo';\nimport PreTaskSection from './components/loadproject/PreTaskSection';\nimport IntroSection from './components/loadproject/IntroSection';\nimport Modal from 'react-modal'\nimport { isMobile } from \"react-device-detect\";\n\nModal.setAppElement('#root')\nconst modalStyles = {\n    content : {\n      top                   : '50%',\n      left                  : '50%',\n      right                 : 'auto',\n      bottom                : 'auto',\n      marginRight           : '-50%',\n      transform             : 'translate(-50%, -50%)',\n      maxWidth              : '40%',\n      maxHeight             : '90%',\n      padding               : '50px'\n    }\n  }\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props);\n\n        var startPhase = 'loadproject'\n\n        this.state = {\n            phase: startPhase,\n            params: undefined\n        }\n\n        this.transitionToEditor = this.transitionToEditor.bind(this)\n        this.transitionToMenu = this.transitionToMenu.bind(this)\n    }\n\n    componentDidMount() {\n        if(window.location.search) {\n            const urlParams = new URLSearchParams(window.location.search)\n            const scenario = urlParams.get('scenario')\n\n            if (scenario !== 'biohacking' && scenario !== 'sharedSpace') {\n                console.error('Unrecognised scenario ' + scenario)\n            } else {\n                localStorage.setItem('scenario', scenario)\n                console.log(localStorage.getItem('scenario'))\n            }\n        }\n\n        this.getStorageUsed()\n    }\n\n    transitionToEditor(newSharedState, resetFirst) {\n        if (resetFirst) {\n            this.setState({phase: \"reset\", sharedState: undefined})\n            window.setTimeout(() => {\n                this.setState({ \n                    sharedState: newSharedState,\n                    phase: \"editor\"\n                })\n            }, 0)\n        } else {\n            this.setState({ \n                sharedState: newSharedState,\n                phase: \"editor\"\n            })\n        }\n\n        // // open the instructions modal on first load\n        // if (!localStorage.getItem('editorHasLoadedBefore')) {\n        //     localStorage.setItem('editorHasLoadedBefore', true)\n        //     this.setState({ modalIsOpen: true })\n        // }\n    }\n\n    transitionToMenu() {\n        if (this.state.sharedState) {\n            if (this.state.sharedState.getStateIsDirty() && !window.confirm('Are you sure you want to go back to the menu? You will lose your unsaved changes.')) {\n                return // user wants to stay on this page\n            }\n\n            this.state.sharedState.finishCondition()\n        }\n        this.setState({\n            sharedState: undefined,\n            phase: \"loadproject\"\n        })\n    }\n\n    getStorageUsed() {\n        navigator.storage && navigator.storage.estimate().then(estimate => {\n            if (!estimate) {\n                return\n            }\n\n            var storageUsed = estimate.usage / estimate.quota * 100\n            if (storageUsed < 0.00000005) {\n                storageUsed = 0 // prevent 10e-16 sort of thing\n            }\n            storageUsed = storageUsed.toPrecision(2)\n\n            this.setState({ storageUsed })\n        });\n    }\n\n    render() {\n        if (isMobile) {\n            return (\n                <p>Write Reason is designed for non-mobile devices. Please access from a laptop or desktop computer.</p>\n            )\n        }\n\n        switch(this.state.phase) {\n            case \"pretask\":\n                return (\n                    <PreTaskSection transitionToMenu={this.transitionToMenu} />\n                )\n            case \"loadproject\":\n                return (\n                    <>\n                        <IntroSection />\n                        <LoadProject transitionToEditor={this.transitionToEditor} autoload={false} />\n                        <footer>\n                            {this.state.storageUsed && <p>Storage used: {this.state.storageUsed}%</p>}\n                            <p><b>Privacy notice</b>: This webpage simply downloads the Write Reason application to your browser. Once loaded, \n                            everything runs locally in your browser. No data is sent back to the server.</p>\n                        </footer>\n                    </>\n                )\n            case \"editor\":\n                return (\n                    <div className=\"App\">\n                        <Modal\n                            isOpen={this.state.modalIsOpen}\n                            style={modalStyles}\n                            contentLabel=\"Experiment information\"\n                            onRequestClose={() => this.setState({ modalIsOpen: false })}\n                        >\n                            <ExperimentInfo sharedState={this.state.sharedState}/>\n                            <button className=\"pure-button\" onClick={() => this.setState({ modalIsOpen: false })}>Close</button>\n                        </Modal>\n\n                        <DndProvider backend={Backend}>\n                            <SplitPane split=\"vertical\" defaultSize=\"50%\">\n                                <DocPane sharedState={this.state.sharedState} />\n                                <GraphPane sharedState={this.state.sharedState} />\n                            </SplitPane>\n                            {\n                                this.state.sharedState.params.logExplore && <LogExploreTimeline sharedState={this.state.sharedState}/>\n                            }\n                            <SaveButton \n                                sharedState={this.state.sharedState}\n                                backToMenu={this.transitionToMenu} \n                                showExperimentInfo={() => this.setState({ modalIsOpen: true })}\n                            />\n                        </DndProvider>\n\n                        <ToastContainer\n                            position=\"bottom-center\"\n                            autoClose={5000}\n                            hideProgressBar\n                            newestOnTop={false}\n                            closeOnClick\n                            rtl={false}\n                            pauseOnFocusLoss\n                            draggable={false}\n                            pauseOnHover\n                        />\n                    </div>\n                );\n            \n            case \"reset\":\n                // hacky way to destroy and recreate all components\n                return (\n                    <p>...</p>\n                )\n        }\n    }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.register();\n"],"sourceRoot":""}